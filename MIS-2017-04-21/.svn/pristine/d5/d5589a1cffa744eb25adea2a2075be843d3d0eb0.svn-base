<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<html>
<head>
<meta charset="utf-8">
<link rel="shortcut icon" href="images/favicon.png">
<title>丽家照护养老服务管理系统</title>
<!-- Bootstrap core CSS -->
<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
<link rel="stylesheet"
	href="fonts/font-awesome-4/css/font-awesome.min.css">
<!-- Custom styles for this template -->
<link href="css/style.css" rel="stylesheet" />
<style>
body.texture {background:url(images/bg-lijia.jpg) no-repeat;min-width:1024px}
#username:-webkit-autofill {-webkit-box-shadow:0 0 0px 1000px white inset;}
#password:-webkit-autofill {-webkit-box-shadow:0 0 0px 1000px white inset;}
.control-label {padding-top:7px;font-size:16px;font-weight:normal;padding-right:0}
#loginbtn {padding:5px 10px;font-size:18px;}
.btn-gold {background-color:#bc9a56;border-color:#bc9a56;color:#fff}
.btn-gold:hover{background-color:#ae8a48;color:#fff}
.nightingale {width:100%;height:auto}
.shadow {-webkit-box-shadow:#666 0px 0px 5px;-moz-box-shadow:#666 0px 0px 5px;box-shadow:#666 0px 0px 5px;border:1px solid #eee;margin:0 auto;max-width:1450px;background:#fff;}
.form-horizontal .form-group {margin-right:0}

</style>
<script type="text/javascript">
    if (self != top) {  //判断页面是否在iframe里面
		parent.location.reload();  //若页面在iframe中，则刷新父页面。用以避免session过期时，将登陆页面显示到了iframe中
	}
    </script>
</head>
<body class="texture">
    <div id="cl-wrapper" class="" style="padding:0 10px">     
        <div class="row shadow" >
          <div class="col-xs-8" style="width:69%;padding:0;">
            <img src="images/nightingale-lijia.jpg" class="nightingale" /></div>
          <div class="col-xs-4" style="width:31%;padding:0;">
            <h3 class="title text-center" style="margin-top:6%;margin-bottom:7%" id="lijialogo">
              <img src="images/logo-lijia.png" style="width:50%;height:auto" /></h3>
            <div class="form-horizontal ">
              <div class="form-group " >
                <label for="username" class="col-sm-3 control-label">用户名</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" id="username"></div>
              </div>
              <div class="form-group " style="margin-bottom:0;" id="passdiv">
                <label for="password" class="col-sm-3 control-label">密码</label>
                <div class="col-sm-7">
                  <input type="password" class="form-control" id="password">
                  <span style="color:red;text-align:center" id="data-des">&nbsp;</span></div>
              </div>
              <p class=" text-center">
                <label class="checkbox-inline" style="padding-top:0">
                  <input id="rememberUsername" type="checkbox" checked="" name="rad1" class="icheck">记住用户名</label>
                <label class="checkbox-inline" style="padding-top:0">
                  <input id="rememberPasswd" type="checkbox" checked="" name="rad1" class="icheck">记住密码</label></p>
              <div class="form-group " style="margin-top:5%;margin-bottom:0"  id="logindiv">
                <label class="col-sm-3 control-label">&nbsp;</label>
                <div class="col-sm-7">
                  <input type="button" class="btn btn-gold form-control" id="loginbtn" value="登 录" style="margin-left:0;"></div>
              </div>
            </div>
          </div>
        </div>      
    </div>
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.md5.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript">
      var project_path= "<%=request.getContextPath()%>";
		$(document).ready(
			function() {
				$("#loginbtn").click(function() {
					var username = $("#username")[0].value;
					var password = $("#password")[0].value;
					login(username, password);
				});
				$("#register").click(function() {
					alert("注册用户请联系客服，电话:8888-88888888");
				});
				$("#username").keydown(function() { //焦点在用户名框时，按回车，焦点跳转到密码框
					if (event.keyCode == 13) {
						$("#password").focus();
					}
				});
				$("#password").keydown(function(event) { //焦点在在密码框时，按回车，视为点击“登录”按钮
					if (event.keyCode == 13) {
						$("#loginbtn").click();
					}
				});
				//从Cookies中读取记住的用户名（如果有的话）
				if ($.cookie("rememberUsername") != null
						&& $.cookie("rememberUsername") == "true") {
					$("#rememberUsername").prop("checked", true);
					$("#username").val($.cookie("username"));
				}
				//从Cookies中读取记住的密码（如果有的话）
				if ($.cookie("rememberPasswd") != null
						&& $.cookie("rememberPasswd") == "true") {
					$("#rememberPasswd").prop("checked", true);
					$("#password").val($.cookie("password"));
				}
				resizeRow();
			});
		
		$(window).resize(function() {
			resizeRow();//页面拉伸后，重新加载居中
			});
		
		function login(username, password) {
			if ($("#rememberUsername").prop("checked")) {
				$.cookie("rememberUsername", "true", {
					expires : 7,
					path : "/"
				});
				$.cookie("username", username, {
					expires : 7,
					path : "/"
				});

				if ($("#rememberPasswd").prop("checked")) {
					$.cookie("rememberPasswd", "true", {
						expires : 7,
						path : "/"
					});
					$.cookie("password", password, {
						expires : 7,
						path : "/"
					});
				} else {
					$.cookie("rememberPasswd", "false", {
						expires : -1,
						path : "/"
					});
					$.cookie("password", password, {
						expires : -1,
						path : "/"
					});
				}
			} else {
				$.cookie("rememberUsername", "false", {
					expires : -1,
					path : "/"
				});
				$.cookie("username", "", {
					expires : -1,
					path : "/"
				});
				$.cookie("rememberPasswd", "false", {
					expires : -1,
					path : "/"
				});
				$.cookie("password", "", {
					expires : -1,
					path : "/"
				});
			}

			password = $.md5(password); //在cookies保存之后再进行变换，避免cookies中存的密码信息被多次变换
			$.ajax({
				type : "post",
				async : true,
				url : project_path + "/systemLogin.do?login",
				dataType : "json",
				data : {
					"username" : username,
					"password" : password
				},
				// jsonp: "callbackjson",
				//  jsonpCallback:"jsonpCallback_loginbtn",
				success : function(data) {
					//var returnresult = $.parseJOSN(data);
					if (data.result == "success") {
						location.href = project_path + "/welcome.do?main"
					} else if (data.result == "failure") {
						// alert(data.des);
						document.getElementById('data-des').innerHTML = data.des; //登录错误提示消息
					}
				},
				error : function() {
					alert("error");
				}
			});
		}
		
		
	    /** 调整居中 */
	    function resizeRow() {
	    	$(".shadow").each(function() {
	    		if ($("body").height() > $(this).height()) {  
	    			$(this).css("margin-top", ($("body").height() - $(this).height())/2 + "px");
	    		}	    		
	    	});
	    	if($("body").width() < 1280){
	    		$("#logindiv").css("margin-top", "3%");
	    		$("#lijialogo").css("margin-top", "5%");
	    		$("#passdiv").css("margin-top", "-5px");
	    		$("#lijialogo").css("margin-bottom", "5%");
	    		$(".control-label").css("font-size", "14px");
	    	}else{
	    		$("#logindiv").css("margin-top", "5%");
	    		$("#lijialogo").css("margin-top", "6%");
	    		$("#passdiv").css("margin-top", "10px");
	    		$("#lijialogo").css("margin-bottom", "7%");
	    		$(".control-label").css("font-size", "16px");
	    	}
	    }
	</script>

</body>
</html>
