<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<%@ page import="fsk.init.SystemInit" %>
<%
	String nickname = (String) session.getAttribute("nickname");
	if (nickname == null) {
		nickname = "";
	}
	String header = SystemInit.header;
	String headerImage = SystemInit.headerImage;
%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>服务工单-详情</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  <link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="js/dropzone/css/dropzone.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.timeline/css/component.css" />
  <link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.magnific-popup/dist/magnific-popup.css" /> 
	<link href="css/style.css" rel="stylesheet" />	
	<style>
		.control-label0{padding-top:6px;}
		.asqqsize{font-size:14px}
		.asqq{margin-right:15px}
		.color999{color:#999}
		.color3380ff{color:#3380FF}
		.jiange5px >div{margin-bottom:10px}
		.mytablenopadding>tr>td{padding-top:0 !important;padding-bottom:0 !important;}
		.mytablenopadding>tr>td:nth-child(4){padding-top:7px !important;padding-bottom:7px !important;text-align:right}
		.mytablenopadding>tr{background:#fff !important;}
		.mytablenopadding input,.mytablenopadding select{border:0}
		 textarea{resize:vertical}
		.minH100px{min-height:100px}
		.cbp_tmlabel{padding:10px !important;}
		.cbp_tmicon strong{font-size:24px}
		#pfrontOverlay, #pbackOverlay{position:absolute;left:0;top:0;right:0;bottom:0}
		#pbackOverlay>div, #pfrontOverlay>div{width:20px;height:20px;border-radius:50%;background:red;position:absolute;margin-top:-10px;margin-left:-10px;
			color:#fff;text-align:center;cursor:pointer}	
		.TPhide{display:none}
		.gallery-cont .item {width:100% !important;} 
		#pfrontdiv ,#pbackdiv {position:relative;float:left;width:50%;max-width:500px;}
		#pfrontdiv img,#pbackdiv img{width:100%;height:auto}
		#PPTlisttable1 td,#PPTlisttable1 th{padding:2px;vertical-align:middle !important}
		#PPTlisttable1>thead>tr>th:nth-child(5){width:110px;}
		#PPTlisttable tr td:nth-child(5){width:110px;}
	</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>	
<div class="navbar-fixed-top">
<div class="navbar navbar-default" style="margin-bottom: 0;">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="fa fa-gear"></span>
          </button>
          <a class="navbar-brand" href="#"  style="width:auto;background: url(images/<%=headerImage %>) no-repeat 0 10px;"><span><%=header %>/服务工单详情</span></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right user-nav">
            <li class="dropdown profile_menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="images/avatar2.jpg"/>
                <span id="accountNickname"><%=nickname %></span>
<!--                 <b class="caret"></b> -->
              </a>
<!--               <ul class="dropdown-menu"> -->
<!--                 <li><a href="#" class="md-trigger" data-modal="md-scale3">密码修改</a></li> -->
<!--                 <li class="divider"></li> -->
<!--                 <li><a href="systemLogin.do?logout">退出登录</a></li> -->
<!--               </ul> -->
            </li>
          </ul>
        </div><!--/.nav-collapse animate-collapse -->
      </div>
    </div>  <!-- 上侧栏结束 -->
<div id="head-nav" class=""> 
        <div class="block-flat" style="padding-bottom:0;margin-bottom: 0px;">
          <div class="row">
            <div class=" col-xs-10">
              <div >
                <h3 style="margin-top:5px;margin-bottom:15px">服务工单(<span id="FWGDBH_head">无</span>)&nbsp;&nbsp;
                <span class="asqqsize color999">服务站点&nbsp;</span><span class="asqq asqqsize color3380ff"><a href="###" id="FWSite_head"  target="_blank">未知</a></span>
                <span class=" asqqsize color999 ">类别&nbsp;</span><span class="asqq asqqsize color3380ff" id="FWXMType_head">未知</span>
                <span class=" asqqsize color999 ">市场类型&nbsp;</span><span class="asqq asqqsize color3380ff" id="FWXMSCType_head">未知</span>
                <span class=" asqqsize color999 ">价格&nbsp;</span><span class="asqq asqqsize color3380ff" id="FWXMSCJGType_head">未知</span>
                <span class=" asqqsize color999" id="FWIfWancheng_head">未完成 </span>
                <input type="hidden" id="hide_id" value="">
                <input type="hidden" id="hide_OldId" value="">
                </h3>
                <p> <a class="btn btn-default" href="#link1">基本信息</a>
					<a class="btn btn-default" href="#link2">服务照片</a>
					<a class="btn btn-default" href="#link3">生理参数</a>
					<a class="btn btn-default" href="#link4">水肿情况</a>
					<a class="btn btn-default" href="#link5">全身观察情况</a>
					<a class="btn btn-default" href="#link6">康复护理情况</a>
					<a class="btn btn-default" href="#link7">客户告知</a>				
					<a class="btn btn-default" href="#link8">回访</a>				
					<a class="btn btn-default" href="#link10">日常生活问询</a>
					<a class="btn btn-default" href="#link9">服务日志</a>				
                </p>                           
               </div>               
            </div>
            <div class=" col-xs-2" style="text-align:right;padding-top:15px">
            	<button class="btn btn-primary md-trigger" data-modal="servicegongdan_quxiao" onclick="baocunrizhi()">日志记录 </button>
            	<button class="btn btn-danger  md-trigger" onclick="quxiao_qingkong()" id="head_quxiao" data-modal="servicegongdan_quxiao">取消</button>	
				<button class="btn btn-primary" onclick="baocun()"> 提 交 </button>
            </div>
          </div>
        </div>
	</div>
</div>
<div id="cl-wrapper1" style="overflow:hidden;padding-top:180px;">	
<div class="cl-mcont">
<div class="block-flat">
<div class="row" style="margin-top:0">
<div class="col-sm-12">
	<!-- 图片 -->
    <form style="display:none;" id="image_submit" action="position.do?pic2" method="post"  enctype="multipart/form-data">
               		<input type="hidden" name="srcPath" id="srcPath" value="" />
               		<input type="hidden" name="type" id="type" value="serviceTaskPhoto_" />
  					<input type="hidden" name="x1" id="x1" value="0" />
  					<input type="hidden" name="y1" id="y1" value="0" />
  					<input type="hidden" name="x2" id="x2" value="0" />
  					<input type="hidden" name="y2" id="y2" value="0" />
	</form> 
	<form id="picuploadform1" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload1" name="pic4upload" type="file" onchange="uploadPic('1','')" accept="image/*">
             			</form>
						<form id="picuploadform2" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload2" name="pic4upload" type="file" onchange="uploadPic('2','')" accept="image/*">
             			</form>
						<form id="picuploadform3" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload3" name="pic4upload" type="file" onchange="uploadPic('3','')" accept="image/*">
             			</form>
						<form id="picuploadform4" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload4" name="pic4upload" type="file" onchange="uploadPic('4','')" accept="image/*">
             			</form>
						<form id="picuploadform5" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload5" name="pic4upload" type="file" onchange="uploadPic('5','')" accept="image/*">
             			</form>
						<form id="picuploadform6" class="secondcol" action="position.do?pic1" method="post" style="display:none;" enctype="multipart/form-data">
                			<input id="pic4upload6" name="pic4upload" type="file" onchange="uploadPic('6','')" accept="image/*">
             			</form>
      <!-- 图片 -->       			
             					
	<!-- <form class="form-horizontal group-border-dashed" > -->
		 	<div class="form-group form-horizontal group-border-dashed" style="padding-top:0">  
		 		<div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link1" id="link1"></a>
		 		</div>               
                <div class="row jiange5px" style="margin-top:0">  
                	<div class="col-sm-12" ><h4>基本信息</h4></div>
					<div class="col-sm-2 col-md-2 col-lg-1  " >老人姓名</div>
					<input type="hidden" value="" id="oldId_hide">
					<div class="col-sm-4 col-md-4 col-lg-3 color3380ff">
                		<a href="###" id="zt_nameBHAge" target="_blank">无</a>
					</div> 
					<div class="col-sm-2 col-md-2 col-lg-1 " >服务人员</div>
					<div class="col-sm-4 col-md-4 col-lg-7 color3380ff" id="zt_fwryBH">
                		未添加		
					</div> 
					<div class="col-sm-2 col-md-2 col-lg-1  " >服务内容</div>
					<div class="col-sm-10 col-md-10 col-lg-11  "><a href="###" id="zt_fwneirong" target="_blank">无</a></div>
					<div class="col-sm-2 col-md-2 col-lg-1  "  >服务地址</div>
					<div class="col-sm-10 col-md-10 col-lg-11  " id="zt_fwdizhi" >无</div>
					<div style="clear:both"></div>
					<div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >预计服务时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 " style="margin-bottom: 10px;">
						<div class=" input-group date datetime" style="margin-bottom: 10px;">                     
	                      <input class="form-control" size="16" value=""  type="text" id="zt_yjfwshijian" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1  control-label0" >服务开始时间</div>
	                <div class="col-sm-4 col-md-4 col-lg-2 " style="margin-bottom: 10px;">
						<div class=" input-group date datetime" style="margin-bottom: 10px;">                     
	                      <input class="form-control" size="16" value=""  type="text" id="zt_fwshijianStart" onchange="jsSC()" placeholder="">
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >服务结束时间</div>
	                <div class="col-sm-4 col-md-4 col-lg-2 " style="margin-bottom: 10px;">
						<div class=" input-group date datetime" style="margin-bottom: 10px;">                     
	                      <input class="form-control" size="16" value=""  type="text" id="zt_fwshijianEnd" onchange="jsSC()" placeholder="">
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div style="clear:both"></div>
	                <div class="col-sm-2 col-md-2 col-lg-1  control-label0" >服务时长</div>
					<div class="col-sm-4 col-md-4 col-lg-2 control-label0" id="zt_fwshijian">暂无</div>	
					<div class="col-sm-2 col-md-2 col-lg-1  control-label0" >预计服务时长</div>
					<div class="col-sm-4 col-md-4 col-lg-2 control-label0" id="zt_yjfwsc">无</div>					
                </div>
                <div class="row" >
                <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link2" id="link2"></a>
		 		</div> 
                <!-- 图片容器 -->
                <input type="hidden" id="photoTitle" value="" />
                <input type="hidden" id="photoDes" value="" /> 
                   
		 		<input type="hidden" id="weizhiId" value="" /> 
		 		<input type="hidden" id="hide_tupian1" value="" /> 
		 		<input type="hidden" id="hide_tupian2" value="" /> 
		 		<input type="hidden" id="hide_tupian3" value="" /> 
		 		<input type="hidden" id="hide_tupian4" value="" /> 
		 		<input type="hidden" id="hide_tupian5" value="" /> 
		 		<input type="hidden" id="hide_tupian6" value="" /> 
		 		<button type="button" class="btn btn-primary btn-flat" style="display:none;" id="sure_SC" onclick="uploadPic_cut()">确定</button>  
		 		
               		<div class="gallery-cont "  style="min-height:50px">
               		<div class="col-sm-12 "   >&nbsp;&nbsp;&nbsp;服务照片:</div>
              <div class="col-sm-12 " id="picpreview" > 
                <div class="row">
                	<!-- 第一个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto1" >
						<div class="item">
							<div class="photo" >
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('1')">删除图片</button> </span><h4 id="tpTitle1">标题</h4>
							        <span class="desc" id="tpmiaoshu1">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu1">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto1"  width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP1" onclick="uploadPic('1','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto1" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div>
               		 
               		<!-- 第二个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto2">
						<div class="item">
							<div class="photo">
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('2')">删除图片</button> </span><h4 id="tpTitle2">标题</h4>
							        <span class="desc" id="tpmiaoshu2">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu2">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto2" width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP2" onclick="uploadPic('2','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto2" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div>    
               		 
               		<!-- 第三个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto3">
						<div class="item">
							<div class="photo">
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('3')">删除图片</button> </span><h4 id="tpTitle3">标题</h4>
							        <span class="desc" id="tpmiaoshu3">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu3">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto3" width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP3" onclick="uploadPic('3','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto3" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div> 
					  
               		<!-- 第四个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto4">
						<div class="item">
							<div class="photo">
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('4')">删除图片</button> </span><h4 id="tpTitle4">标题</h4>
							        <span class="desc" id="tpmiaoshu4">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu4">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto4" width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP4" onclick="uploadPic('4','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto4" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div>
					 
               		<!-- 第五个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto5">
						<div class="item">
							<div class="photo">
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('5')">删除图片</button> </span><h4 id="tpTitle5">标题</h4>
							        <span class="desc" id="tpmiaoshu5">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu5">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto5" width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP5" onclick="uploadPic('5','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto5" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div>
					 
               		<!-- 第六个图片容器 -->
               		<div class="gallery-cont col-sm-6 col-md-4 col-lg-3 TPhide" name="hide" id="Fptphoto6">
						<div class="item">
							<div class="photo">
							    <div class="head">
							        <span class="pull-right"> <button type="button" class="btn btn-danger btn-sm" onclick="deltupian('6')">删除图片</button> </span><h4 id="tpTitle6">标题</h4>
							        <span class="desc" id="tpmiaoshu6">描述</span>
							        <input type="hidden" id="hide_tpmiaoshu6">
							    </div>
							    <div class="img">
							        <img src="" id="ptphoto6" width="100%" height="auto" />
							        <div class="over">
							            <div class="func"><a id="bianjiTP6" onclick="uploadPic('6','flag')"><i class="fa fa-pencil"></i></a><a class="image-zoom" id="Bigptphoto6" href=""><i class="fa fa-search"></i></a></div>
							        </div>            
							    </div>
							</div>
						</div>
						
					 </div>
					 
               		 <div class="col-sm-6 col-md-4 col-lg-3" id="Fptphoto_add"><!-- 单个图片容器 -->
               			<div class="btn btn-default" style="" onclick="addtupian()">添加更多图片</div>	
               		 </div>
               		 
               		 </div>
               		
                </div>
                
               		</div>
               	</div> 
               	<div ></div>
              </div>
	 		<div class="form-group">    
	 		<div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link3" id="link3"></a>
		 		</div>            
                <div class="row " style="margin-top:0" > 
                	<div class="col-sm-12" ><h4>生理参数</h4></div>
                	<div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >体温</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcsTW" onpaste="return false;" onkeypress="keyPress2()"><span class="input-group-addon">℃</span></div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >体温测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_slcsTWTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >血压</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
							<input type="text" class="form-control" id="zt_slcsxueya_di" onpaste="return false;" onkeypress="keyPress()">
					        <span class="input-group-addon no-bg-border">/</span>
					        <input type="text" class="form-control"  id="zt_slcsxueya_gao" onpaste="return false;" onkeypress="keyPress()">
							<span class="input-group-addon">mmHg</span>
						</div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >血压测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_slcsxueyaTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >脉搏</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcsmaibo"  onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">次/分</span>
						</div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >脉搏测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_slcsmaiboTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >呼吸</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcshuxi"  onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">次/分</span></div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >呼吸测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group  " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime"  size="16" value=""  type="text" id="zt_slcshuxiTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >餐前血糖</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcsxuetang_cq"  onpaste="return false;" onkeypress="keyPress2()"><span class="input-group-addon">mmol/L</span></div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >餐前血糖测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_xuetang_cqTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >餐后血糖</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcsxuetang_ch"  onpaste="return false;" onkeypress="keyPress2()"><span class="input-group-addon">mmol/L</span></div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >餐后血糖测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group  " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_xuetang_chTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                 <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >血氧</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class="input-group">
						<input type="text" class="form-control" id="zt_slcsxueyang"  onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">%</span></div>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >血氧测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_slcsxueyangTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >骨密度</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<input type="text" class="form-control" id="zt_slcsgumidu"  onpaste="return false;" onkeypress="keyPress3()">
	                </div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >骨密度测量时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<div class=" input-group  " style="margin-bottom: 20px;">                     
	                      <input class="form-control datetime" size="16" value=""  type="text" id="zt_slcsgumiduTime" >
	                       <span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
	                    </div>
	                </div>
	                
                </div>
                <div class="row">	                  
	                	<div class="col-sm-2 col-md-2 col-lg-1 control-label0" >其他事项</div>
						<div class="col-sm-10 col-md-10 col-lg-11" >
	                		<textarea  class="form-control"  id="zt_slcsmiaoshu"></textarea>
						</div> 
					</div>
              </div>
              <div class="form-group">    
              <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link4" id="link4"></a>
		 		</div>            
                <div class="row" style="margin-top:0"> 
                <div class="col-sm-12" ><h4>水肿情况</h4></div>
                <div class="col-sm-12">                
                	 <table class="table no-border  " >
								<thead class="no-border">
									<tr>										
										<th style="width:120px"><strong>&nbsp;&nbsp;水肿类别</strong></th>									
										<th style=""><strong>&nbsp;&nbsp;水肿部位</strong></th>		
										<th style=""><strong>&nbsp;&nbsp;记录时间</strong></th>								
										<th style="text-align:right;width:80px" ><strong>操作</strong></th>
									</tr>
								</thead>
								<tbody class="no-border-y mytablenopadding" id="szqkLB">									 
									<tr id="addshuizhong">								
										<td> </td>
										<td> </td>		
										<td> </td>										
										<td style="text-align:right"><a class="label btn-primary " onclick="addshuizhong();"><i class="fa fa-plus"></i></a> </td>
									</tr>
								</tbody>
							</table></div>
                </div>
              </div>
              <div class="form-group" >     
              <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link6" id="link6"></a>
		 		</div>           
	                <div class="row" style="margin-top:0"> 
	                <div class="col-sm-12" ><h4>康复护理情况</h4></div>
	                <div class="col-sm-12 " >
	                	<textarea  class="form-control minH100px"  id="zt_kfhlqk">
	                	</textarea>						   
					</div>                
	                </div>				
               </div>
               <div class="form-group" >  
               <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link7" id="link7"></a>
		 		</div>              
	                <div class="row" style="margin-top:0"> 
	                <div class="col-sm-12" ><h4>客户告知</h4></div>
	                <div class="col-sm-12 " >
	                	<textarea  class="form-control minH100px"  id="zt_kfgz">
	                	</textarea>						   
					</div>                
	                </div>				
               </div>
               <div class="form-group" >  
               <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link8" id="link8"></a>
		 		</div>              
	                <div class="row" style="margin-top:0"> 
	                <div class="col-sm-12"  ><h4>回访</h4></div>
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >服务时间</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<select class="form-control" id="zt_hfsj_hf" style="margin-bottom:5px">
						<option value=""></option><option value="按计划">按计划</option><option value="时间不足">时间不足</option>
						</select>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >服务态度</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<select class="form-control" id="zt_hftd_hf" style="margin-bottom:5px">
						<option value=""></option><option value="很好">很好</option><option value="好">好</option><option value="中">中</option><option value="一般">一般</option><option value="差">差</option>
						</select>
	                </div> 
	                <div class="col-sm-2 col-md-2 col-lg-1 control-label0 " >服务质量</div>
					<div class="col-sm-4 col-md-4 col-lg-2 ">
						<select class="form-control" id="zt_hfzl_hf" style="margin-bottom:5px">
						<option value=""></option><option value="很好">很好</option><option value="好">好</option><option value="中">中</option><option value="一般">一般</option><option value="差">差</option>
						</select>
	                </div> 
	                <div class="col-sm-4 col-md-4 col-lg-2 ">
						<button class="btn btn-primary " id="huifangId" onclick="huifang()">回 访</button>
	                </div> 
	                <div class="col-sm-12 " >
	                	<textarea  class="form-control minH100px"  id="zt_hfneirong_hf">
	                	</textarea>						   
					</div>               
	                </div>				
               </div>
               
               <div class="form-group" >     
                <div style="height:0;position:relative">
		 			<a style="position:absolute;top:-120px" name="link10" id="link10"></a>
		 		</div>           
	                <div class="row" style="margin-top:0"> 
	                <div class="col-sm-12" ><h4>日常生活问询</h4></div>
	                <div class="col-sm-12 " >
	                	<div id="ac8-3" class="panel-collapse collapse in">
						  <div class="panel-body" style="padding-top:0">
						  <div class="row" style="margin-top:0">
									
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" >												
											<div class="btn-group" style="margin-top:5px;float:right;margin-right:0">
						  						 <button type="button" class="btn btn-primary  md-trigger"  data-modal="richangshenghuojilu" onclick="zhikong_rcshlsjl()">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
						 						 </button>
						 						 <button type="button" class="btn btn-primary  md-trigger"  data-modal="richangshenghuojilu" style="display:none;" id="rcshlsjl_bj">编辑</button>
						 						 <button type="button" class="btn btn-danger  md-trigger" data-modal="" style="margin-left:5px;margin-right:0" onclick="del_historyAll()">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>批量删除</span>
						 						 </button>												
										 	</div>
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="" >
												<thead>
													<tr role="row">
													<th style="width:2%;"><input id="allselectchecker_history" type="checkbox" class="col_selector_history" onclick="selectAll_history();"></th>
														<th><strong>记录日期</strong></th>
														<th><strong>记录人</strong></th>
														<th><strong>日摄水量1</strong></th>
														<th><strong>日摄水量2</strong></th>
														<th><strong>日摄食量</strong></th>
														<th><strong>小便次数</strong></th>
														<th><strong>小便量</strong></th>
														<th><strong>大便次数</strong></th>
														<th><strong>睡眠(小时/天)</strong></th>
														<th><strong>睡眠质量</strong></th>
														<th><strong>精神</strong></th>
														<th><strong>其他情况</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer_history" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
												<!-- <tbody id="" >
													<tr>
							                          <td><input type="checkbox" class="col_selector_history"></td>
							                          <td>2016-10-10 23:23:23</td>
							                          <td>小王</td>
							                          <td>354ml</td>
							                          <td title="主食500g 油3g 盐5g 鱼100g 果蔬200g 肉200g 豆制品200g 奶300g"><a>悬浮查看</a></td>							                          
							                          <td>4</td>							                          
							                          <td>1500ml</td>							                          
							                          <td>1次/天</td>							                          
							                          <td>10</td>							                          
							                          <td>一般</td>							                          
							                          <td>一般</td>							                          
							                          <td>
							                            <div class="btn-group">
							                              <button class="btn btn-default btn-xs" type="button">操作</button>
							                              <button data-toggle="dropdown" class="btn btn-xs btn-primary dropdown-toggle" type="button">
							                                <span class="caret"></span><span class="sr-only">Toggle Dropdown</span>
							                              </button>
							                              <ul role="menu" class="dropdown-menu pull-right">
							                                <li><a href="###">编辑</a></li>
							                                <li><a href="##">删除</a></li>
							                              </ul>
							                            </div>
							                          </td>
							                        </tr>																											
												</tbody> -->
											</table>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
											每页 <select id="pageSizeSelector_history"  size="1" name="datatable2_length" onchange="query_history()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div>
													<ul id="paginationArea_history" class="pagination" style="margin-top:0">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									
									<!-- 分页条结束 -->
						    </div>
						</div>			   
					</div>                
	                </div>				
               </div>
               
                <div class="form-group" >  
                	            
	              <div class="row" style="margin-top:0"> 
	             
	               
					<div class="col-sm-12 " >
						<div style="height:0;position:relative">
			 				<a style="position:absolute;top:-120px;" name="link5" id="link5" ></a>
			 			</div> 
						<h4 >全身情况观察<button class="btn btn-info md-trigger" data-modal="openPPTlist" >查看列表</button></h4>
						<div id="pfrontdiv" > 
							<img src="images/pfront.png" >
							<div id="pfrontOverlay" >
								<!-- 红点放这里 -->
							</div>
						</div>
						<div id="pbackdiv" > 
							<img src="images/pback.png" >
							<div id="pbackOverlay" >
								<!-- 红点放这里 -->
							</div>
							
						</div>
					</div>  
					 <div class="col-sm-6 " >
	                <div style="height:0;position:relative">
		 				<a style="position:absolute;top:-120px" name="link9" id="link9"></a>
		 			</div>  
	               	 <h4 >服务日志</h4>
	                	<ul class="cbp_tmtimeline" id="zt_fuwuLog">
				      </ul>
	                				   
					</div>              
	              </div>				
               </div>
     <!-- </form> -->
     <input class="md-trigger" data-modal="view-point"  type="hidden" id="open2viewpoint" value="假按钮">
     <input class="md-trigger" data-modal="add-point"  type="hidden" id="open2addpoint" value="假按钮">
   </div>

</div>
</div>
</div></div>				

<!-- 主页面结束 -->

    <!-- 模态框开始-->
               

		
            
             <!-- 添加 日常生活记录-->
                <div class="md-modal colored-header custom-width md-effect-9" id="richangshenghuojilu" style="width:60%;max-width:60%">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>日常生活记录添加或编辑</h3>
                        <input type="hidden" value="" id="rcshjl_id_hide"/>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body ">                     
							<div class="row " style="font-size:12px">		               
               
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">记录时间</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input class="datetime form-control"  size="16" type="text" value="" readonly="readonly" id="rcshjl_time" placeholder="YYYY-MM-DD HH:mm" />
				                </div> 
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">评定人</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input class="form-control" type="text" value="" id="rcshjl_pdr" readonly="readonly"/>
				                </div>       
							 	 <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">日摄水量(ml)</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_rshl" onpaste="return false;" onkeypress="keyPress2()"/>
				                </div>
				                 <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">日摄饮料量(ml)</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_rsyll" onpaste="return false;" onkeypress="keyPress2()"/>
				                </div>
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">日摄食量(主食·g)</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_rshlzs" onpaste="return false;" onkeypress="keyPress2()"/>
				                </div> 
							  <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">小便次数</div>
							  <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_xbcs" onpaste="return false;" onkeypress="keyPress()"/>
				                </div>
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">小便量(ml)</div>
							  <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_xbl" onpaste="return false;" onkeypress="keyPress2()"/>
				                </div>
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">大便次数</div>
							  <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <div class="input-group" style="margin-bottom:0">
										<input type="text" class="form-control" id="rcshjl_dbcs" onpaste="return false;" onkeypress="keyPress()">
										<span class="input-group-addon" style="border:0;font-size:12px;background:#fff;padding:6px 1px">次/</span>
										<input type="text" class="form-control" id="rcshjl_dbts" onpaste="return false;" onkeypress="keyPress()">
										<span class="input-group-addon" style="border:0;font-size:12px;background:#fff;padding:6px 1px">天</span>
										</div>
				                </div>
				                <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">睡眠(小时/天)</div>
							  <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_smsj"  onpaste="return false;" onkeypress="keyPress()"/>
				                </div>		  
							    <div class="col-sm-3  col-xs-6 " style="padding-top:6px;;">睡眠质量</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <select class="form-control" id="rcshjl_smzj" >
				                  		<option value=""></option>
										<option value="好">好</option>
										<option value="一般">一般</option>
										<option value="差（难入睡·需要药物助眠·多梦·早醒)">差（难入睡·需要药物助眠·多梦·早醒)</option>
										<option value="常打盹">常打盹 </option>
										</select>
				                </div>
				                 <div class="col-sm-3  col-xs-6 " style="padding-top:6px;">精神</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <select class="form-control" id="rcshjl_jinshen" >
				                  		<option value=""></option>
										<option value="好">好</option>
										<option value="一般">一般</option>
										</select>
				                </div>
								<div class="col-sm-3  col-xs-6 " style="padding-top:6px;">其他情况</div>
				                <div class="col-sm-3  col-xs-6" style="margin-bottom:6px">
				                  <input type="text" class="form-control" value="" id="rcshjl_qitaqk"/>
				                </div> 
					</div>
			               
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat" data-dismiss="modal" onclick="save_rcshlsjl()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="close_rcshlsjl" onclick="zhikong_rcshlsjl()">取消</button>
                      </div>
                    </div>
                </div>
            
            
            	<!-- 工单操作-->
                <div class="md-modal colored-header custom-width md-effect-9" id="servicegongdan_quxiao">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3 id="gdczTitle"></h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form form-horizontal">
                     <!--  <form class="" > -->
                     	<div class="form-group" id="hyIfxianshi">
						    <label class="col-sm-4 control-label">操作</label>
						<div class="col-sm-6 " >
							<input class="form-control" type="text" id="model_caozuo">	
						</div>
                        </div>
						<div class="form-group" id="hyIfxianshi">
						    <label class="col-sm-4 control-label">备注</label>
						<div class="col-sm-6 " >
							<textarea class="form-control" id="model_quxiaobeizhu"></textarea>		
						</div>
                        </div>
                        <!-- </form> -->	
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat" data-dismiss="modal" onclick="sureQuxiao()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="quxiao_tanchuang">取消</button>
                      </div>
                    </div>
                </div>
                
            <!-- 全身情况观察 列表-->
                <div class="md-modal colored-header custom-width md-effect-9" id="openPPTlist" style="min-width:80%">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3 >全身情况观察列表</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body  ">
                   			 <table class="table no-border  "  id="PPTlisttable1">
								<thead class="no-border">
									<tr>										
										<th style="max-width:40px"><strong>序号</strong></th>									
										<th><strong>描述</strong></th>		
										<th ><strong>记录人</strong></th>								
										<th ><strong>记录时间</strong></th>								
										<th ><strong>&nbsp;&nbsp;操作</strong></th>
									</tr>
								</thead>
								<tbody class="no-border-y " id="PPTlisttable">									 
									
								</tbody>
							</table>
					  </div>
                    </div>
                </div>
            <div class="md-modal colored-header custom-width md-effect-9" id="view-point" >
                <div class="md-content">
                  <div class="modal-header">
                    <h3>编辑身体部位状况</h3>
                    <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body form">                        
                     <div class="form-group">
                     	<input type="hidden" value="" id="pp4">
                     	<input type="hidden" value="" id="pp0">
                     	<p>添加人： <span id="pp1"></span></p>
                     	<p>添加时间： <span id="pp2"></span></p>
                       <label>描述</label>
                       <textarea class="form-control" id="pp3" ></textarea>
                       
					</div> 
				  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-flat pull-left" onclick="delPP()">删除该点</button>
                    <button type="button" class="btn btn-success btn-flat " onclick="savePPT('edit')">提交</button>
                    <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal"  id="dismissmodal">关闭</button>
                  </div>
                </div>
         </div>
         <div class="md-modal colored-header custom-width md-effect-9" id="add-point" >
                <div class="md-content">
                  <div class="modal-header">
                    <h3>新增身体部位状况</h3>
                    <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body form">                        
                     <div class="form-group">
                       <label>描述</label>
                       <textarea class="form-control" id="addpp3" ></textarea>
                       
					</div> 
				  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-flat " onclick="savePPT('add')">提交</button>
                    <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="dismissmodal2">关闭</button>
                  </div>
                </div>
         </div>
            
 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>
<script src="js/ckeditor/ckeditor.js"></script>
	<script src="js/ckeditor/adapters/jquery.js"></script>
  <script src="js/jquery.timeline/js/modernizr.custom.js"></script>
  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>
<script type="text/javascript" src="js/dropzone/dropzone.js"></script>
	<script type="text/javascript" src="js/jquery.magnific-popup/dist/jquery.magnific-popup.min.js"></script>


    <script type="text/javascript">
   $(document).ready(function(){
   		query();
   		query_history();
   		var homeUrl = "<%=request.getContextPath()%>" + "/welcome.do?main";
  		$(".navbar-brand").attr("href",homeUrl);
   		var name = getLoginName();
    	$("#rcshjl_pdr").val(name);
    
    	$(".deleteThisTime").click(function(){               //清除日期框中的值
    	       $(this).parent().prev()[0].value = "";
    	    });
      App.init();
      //Initialize Mansory
      var $container = $('.gallery-cont');
      // initialize
      $container.masonry({
        columnWidth: 0,
        itemSelector: '.item'
      });
      
      //Resizes gallery items on sidebar collapse
      $("#sidebar-collapse").click(function(){
          $container.masonry();      
      });
      
      //MagnificPopup for images zoom
      $('.image-zoom').magnificPopup({ 
        type: 'image',
        mainClass: 'mfp-with-zoom', // this class is for CSS animation below
        zoom: {
        enabled: true, // By default it's false, so don't forget to enable it

        duration: 300, // duration of the effect, in milliseconds
        easing: 'ease-in-out', // CSS transition easing function 

        // The "opener" function should return the element from which popup will be zoomed in
        // and to which popup will be scaled down
        // By defailt it looks for an image tag:
        opener: function(openerElement) {
          // openerElement is the element on which popup was initialized, in this case its <a> tag
          // you don't need to add "opener" option if this code matches your needs, it's defailt one.
          var parent = $(openerElement).parents("div.img");
          return parent;
        }
        }

      });
		
		
     // rePosPoint();
    //  $("body").bind("resize", rePosPoint);  //尺寸变化时，调整红点位置
    
    	 setTimeout("tztpys()",50);
    	 
    	 $("#model_caozuo").keydown(function() { //焦点在弹窗第一个时，按回车，焦点跳转到第二个
			if (event.keyCode == 13) {
				$("#model_quxiaobeizhu").focus();
				return;
			}
		 });
		 $("#model_quxiaobeizhu").keydown(function() {//....
			if (event.keyCode == 13) {
				$("#sureQuxiao").click();
				return;
			}
		 });
		
    });
   window.onload = function () {      
	   drawPPT();//加载全身情况观察点
	};
	$(window).resize(function() {
	   drawPPT();//页面拉伸后，重新加载全身情况观察点
	});
   var userName="管理员";
   function drawPPT(){
       var id = "<%=request.getAttribute("id")%>";     //服务工单id 
       var reqmsg="{'action':'QUERY_SITUATION_OBSERVATION_LIST_REQUEST','page':{'pageno':'1','pagesize':'99'},'content':{\"serviceTaskId\":"+id+"}}";   		
   		  jQuery.ajax({
             type : "post",
             async:false,
             url : "situationObservation.do?handler",
             dataType : "json",
             data: {
                  "reqmsg":reqmsg
             },
             success : function(data){
                 if(data.des=="success"){
               	    changetable(data);
               	    changePPT(data);
                 }else if(data.des=="failure"){
                    alert("查询全身情况观察失败");
                 }
             },
             error:function(){
   	           alert("error");
             }
       	 });	   
   }
   
   function changetable(data){//查看全身情况表格内容
	    var htmlstring = "";
		if(data.content != null && data.content != ""){		
			$.each(data.content.situationObservationList, function (i, item) {
				htmlstring += "<tr>";
				htmlstring += "<td>" + (i+1) + "</td>";
				htmlstring += "<td>" + item.des + "</td>";
				htmlstring += "<td>" + item.createPerson + "</td>";
				htmlstring += "<td>" + formateTime(item.createTime) + "</td>";
				htmlstring += "<td>" +"<button class=\"btn btn-xs btn-primary\" onclick=\"viewPPT('" + item.id +"','" + item.des +"','" + item.createPerson +"','" + item.createTime +"','" + item.position +"')\">编辑</button>";
				htmlstring += "<button class=\"btn btn-xs btn-danger\" onclick=\"delPPT('" + item.id +"')\">删除</button>"+"</td>";
				htmlstring += "</tr>";
			});			
		}
		$("#PPTlisttable").html(htmlstring);
   }
   function changePPT(data){ //图片上打红点
	   var pfrontOverlay = "" ; 
   	   var pbackOverlay = "";
   	   var imgWidth = $("#pfrontdiv").width();//获取此时图片的宽、高(整数)
   	   var imgHeight = $("#pfrontdiv").height();//获取此时图片的宽、高
   	   //console.log(imgWidth+","+imgHeight);
		if(data.content != null && data.content != ""){		
			$.each(data.content.situationObservationList, function (i, item) {
				var pos = item.position.split(',');   // 将item.position，转为数组[正反面，x比例，y比例]
				posX = Math.round(imgWidth * pos[1]);
				posY = Math.round(imgHeight * pos[2]);//取整 四舍五入
				if(pos[0] == "1"){//正面
					pfrontOverlay += "<div onclick=\"viewPPT('" + item.id +"','" + item.des +"','" + item.createPerson +"','" + item.createTime +"','" + item.position +"')\" style=\"left:" + posX +"px;top:" + posY +"px;\">" + (i+1)+ "</div>";
				}else if(pos[0] == "2"){//背面
					pbackOverlay += "<div onclick=\"viewPPT('" + item.id +"','" + item.des +"','" + item.createPerson +"','" + item.createTime +"','" + item.position +"')\" style=\"left:" + posX +"px;top:" + posY +"px;\">" + (i+1)+ "</div>";
				}
			});			
		}
		$("#pfrontOverlay").html(pfrontOverlay);
		$("#pbackOverlay").html(pbackOverlay);
   }

   var positionAdd = ""; //新增红点的位置
   function viewOrAdd(id) {
	    return document.getElementById(id);
	}
   viewOrAdd('pfrontOverlay').onclick = function(e) { // 正面打点
	    var e = e|| window.event,
	        target = e.target || e.srcElement;
	    //判断是否点在空白处，还是已经存在红点？	    
	    if(target.id == "pfrontOverlay"){
	    	$("#addpp3").val("");
	 	    $("#open2addpoint").click();
	 	   	var x =  Math.round(event.offsetX/$("#pfrontdiv").width()*100)/100;
	 	   	var y =  Math.round(event.offsetY/$("#pfrontdiv").height()*100)/100;//保留小数点后两位
		    positionAdd = "1"+","+x+","+y;
		    console.log(positionAdd);//获取鼠标相对图片1的位置比例
	    }else{
	    	return;
	    }
	}
   viewOrAdd('pbackOverlay').onclick = function(e) { // 反面打点
	    var e = e|| window.event,
	        target = e.target || e.srcElement;
	    //判断是否点在空白处，还是已经存在红点？	    
	    if(target.id == "pbackOverlay"){
	    	$("#addpp3").val("");
	 	    $("#open2addpoint").click();
	 	   	var x =  Math.round(event.offsetX/$("#pfrontdiv").width()*100)/100;
	 	   	var y =  Math.round(event.offsetY/$("#pfrontdiv").height()*100)/100;	    
		    positionAdd = "2"+","+x+","+y;
		    console.log(positionAdd);//获取鼠标相对图片2的位置比例
	    }else{
	    	return;
	    }
	}
   function viewPPT(id,des,persion,time,pos){
	  $("#pp0").val(id);
	  $("#pp1").text(persion);
	  $("#pp2").text(formateTime(time));
	  $("#pp3").val(des);
	  $("#pp4").val(pos);
	  $("#open2viewpoint").click();
	   
   }
   function savePPT(doType){//修改
	    var serviceTaskId = "<%=request.getAttribute("id")%>";     //服务工单id 
		var reqmsg="{'action':'ADD_SITUATION_OBSERVATION_INFO_REQUEST','content':{";		
		if (serviceTaskId != null && serviceTaskId != "") {
			reqmsg += "\"serviceTaskId\":" + serviceTaskId + ",";
		}
		if (userName != null && userName != "") {
			reqmsg += "\"createPerson\":\"" + userName + "\",";
		}
		var createTime= getNowFormatDate2();//当前时间20120212121200
		console.log(createTime);
		if (createTime != null && createTime != "") {
			reqmsg += "\"createTime\":\"" + createTime + "\",";
		}
		if(doType == "edit"){
			var id = $("#pp0").val();
			var position = $("#pp4").val();
			var des = $("#pp3").val();
			if (id != null && id != "") {
				reqmsg += "\"id\":" + id + ",";
			}
			if (position != null && position != "") {
				reqmsg += "\"position\":\"" + position + "\",";
			}
			if (des != null && des != "") {
				reqmsg += "\"des\":\"" + des + "\",";
			}
		}else if(doType == "add"){
			if (positionAdd != null && positionAdd != "") {
				reqmsg += "\"position\":\"" + positionAdd + "\",";
			}
			var des = $("#addpp3").val();
			if (des != null && des != "") {
				reqmsg += "\"des\":\"" + des + "\",";
			}			
		}else{
			return;
		}
		reqmsg += "}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "situationObservation.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  drawPPT();
            	  $("#dismissmodal").click();
            	  $("#dismissmodal2").click();
            	  alert("新增或修改成功");
            	  positionAdd ="";//清空新增位置信息
              }else if(data.des=="failure"){
                 alert("新增或修改失败");
              }
          },
          error:function(){
	           alert("error");
          }
    	 });
	   
   }
   function delPPT(id){ //删除
  		//var reqmsg="{'action':'DEL_SITUATION_OBSERVATION_INFO_REQUEST','content':{\"id\":"+id+",\"delServiceTask\":'true'}}";   
	  		var r=confirm("是否确认删除？");
	  		if (r==true)
		  	  {
	   		  jQuery.ajax({
	              type : "post",
	              async:false,
	              url : "situationObservation.do?del",
	              dataType : "json",
	              data: {
	                   "ids":id
	              },
	              success : function(data){
	                  if(data.result=="success"){
	                	  drawPPT();//删除成功后重新查询
	                	  $("#dismissmodal").click();
	               	   	  alert(data.des);	               	  
	                  }else if(data.result=="failure"){
	                     alert(data.des);
	                  }
	              },
	              error:function(){
	    	           alert("error");
	              }
	        	 });
		  	  }
		  	else
		  	  {
		  	  return;
		  	  }
   }
   
  function delPP(){ //模态框上点击删除该点
	  var id = $("#pp0").val();
  	  if(id != null && id !=""){
  		delPPT(id);
  	  }
  }
   function tztpys(){
 		var i =  $("#ptphoto1").height();
 		if(i !=0){
 			 i += 100;
  			 $("#Fptphoto1").css("height",i+"px");
 		 }
   }
   
   
   function addshuizhong(){
   		var addhtml = '<tr><td ><select class="form-control"><option value="+">+</option><option value="-">-</option></select></td><td><input value="" class="form-control" ></td><td><input class="form-control date datetime" size="16" value="" type="text"></td>	<td><a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td></tr>';
   		$(addhtml).insertBefore("#addshuizhong"); 
 		  var config = {dateTime:true};  //初始化新增的datepicker，不会导致格式错乱
          $( ".ui-datepicker" ).datepicker();
         if(config.dateTime){
         $(".datetime").datetimepicker({autoclose: true});
       }
   }
   
  		 //只能输入数字0-9
        function keyPress() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        } 
        //限制输入数字，且小数点保留两位
        function keyPress2() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 46 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        } 
        //限制输入数字，小数点，负号，且小数点保留两位
        function keyPress3() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 45 && keyCode != 46 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        }
        
/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}
/**
 * 格式化时间
 * @method formateTime2
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(HH:mm)
 */
function formateTime2(time) {
	if (time != null && time.length == 14) {
		return time.substring(8, 10) + ":" + time.substring(10, 12);
	} else {
		return time;
	}
}
/**
 * 格式化时间
 * @method formateTime3
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm)
 */
function formateTime3(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12);
	} else {
		return time;
	}
}
   //根据出生年月日计算年龄yyyymmdd
	function getAge(strBirthday){
		if(strBirthday == null || strBirthday == ""){
			return "未知";
		}
		var birthYear = strBirthday.substr(0,4);
		var d = new Date();
		var nowYear = d.getFullYear();
		var age = nowYear-birthYear;
		return age + "岁";
	}
	//服务人员类型
	 function pipeiFWRYType(type){
     	var name = "未知";
     	switch (type)
		{
			case 1:
  			name = "负责人";
  			break;
  			
			case 2:
  			name = "参与人";
  			break;
  			
  			default:
  			break;
		}
		return name;
     }
	
   //查询服务工单详情
   function query(){
   		var id = "<%=request.getAttribute("id")%>";
		var reqmsg="{'action':'QUERY_SERVICE_TASK_INFO_REQUEST','content':{\"olderShow\":\"true\",\"serviceListShow\":\"true\",\"serviceEmployeeListShow\":\"true\",\"serviceTaskPhotoListShow\":\"true\",\"physiologicalParametersHistoryListShow\":\"true\",\"edemaConditionListShow\":\"true\",\"serviceLogListShow\":\"true\",\"id\":"+id+"}}";
		
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    	 });
	}
	function changeData(data){
		if (data.content != null) {
			if(data.content.status == 6){
 				$("#huifangId").show();
 			}else{
 				$("#huifangId").hide();
 			}
 			if(data.content.status == 1){
 				$("#head_quxiao").hide();
 			}else{
 				$("#head_quxiao").show();
 			}
 			
			//头部
			var headUrl = "<%=request.getContextPath()%>";
 			$("#hide_id").val(data.content.id);
 			$("#hide_OldId").val(data.content.olderId);
 			
 			$("#FWGDBH_head").html(data.content.serviceCode);
 			if(data.content.siteName != null && data.content.siteName != ""){
 				$("#FWSite_head").html(data.content.siteName);
 			}
 			var url1 = headUrl + "/daeSite.do?main&siteId=" + data.content.siteId;
 			$("#FWSite_head").attr("href",url1);
 			if(data.content.serviceList != null  ){
 				if(data.content.serviceList[0] != null){
 					$("#FWXMType_head").html(getNameById(data.content.serviceList[0].typeId));
 				}
 			}
 			if(data.content.serviceEndTime != null && data.content.serviceEndTime != ""){
 				$("#FWIfWancheng_head").html("已完成  " + formateTime(data.content.serviceStartTime).substr(0,16) + "~" + formateTime2(data.content.serviceEndTime));
 			}else{
 				$("#FWIfWancheng_head").html("未完成  ");
 			}
 			if(data.content.healthInsurance != null && data.content.healthInsurance != ""){
 				$("#FWXMSCType_head").html(fwlbChange(data.content.healthInsurance));
 			}
 			if(data.content.price != null && data.content.price != ""){
 				$("#FWXMSCJGType_head").html(data.content.price + "元");
 			}
 			
 			//基本信息
 			var url2 = headUrl + "/daeOlder.do?main&id=" + data.content.olderId;
 			$("#oldId_hide").val(data.content.olderId);
 			$("#zt_nameBHAge").attr("href",url2);
 			var olderBirthdate = data.content.olderBirthdate;
 			/* if(olderBirthdate == null || olderBirthdate == ""){
 				if(data.content.older != null && data.content.older != ""){
 					olderBirthdate = data.content.older.birthdate;
 				}
 			} */
 			$("#zt_nameBHAge").html(data.content.olderName + " (" + data.content.olderMemberNum + ") " + getAge(olderBirthdate));
 			
 			var html1 = "";
 			if(data.content.serviceEmployeeList != null){
 				jQuery.each(data.content.serviceEmployeeList, function(i, item) {
 					html1 += "<a href=\"" + headUrl + "/daeEmployee.do?main&employeeId=" + item.employeeId + "\" target=\"_blank\">" + pipeiFWRYType(item.type) + "-" + item.name + " (" + item.employeeCode + " " + item.role + ") " + "</a>";	
 				});
 				if(html1 != ""){
 					$("#zt_fwryBH").html(html1);
 				}
 				
 			}

 			if(data.content.serviceList != null){
 				if(data.content.serviceList[0] != null){
 					var url3 = headUrl + "/service.do?mainXQ&id=" + data.content.serviceList[0].id;
 					$("#zt_fwneirong").attr("href",url3);
 					if(data.content.serviceList[0].fuwuSonNames != null && data.content.serviceList[0].fuwuSonNames != ""){
 						$("#zt_fwneirong").html(data.content.serviceList[0].name + " (" + data.content.serviceList[0].fuwuSonNames + ") ");
 					}else{
 						$("#zt_fwneirong").html(data.content.serviceList[0].name);
 					}
 					if(data.content.serviceList[0].yjfuwuTime != null && data.content.serviceList[0].yjfuwuTime != ""){
 						$("#zt_yjfwsc").html(data.content.serviceList[0].yjfuwuTime);
 					}
 				}
 			}
 			
 			//if(data.content.address != null && data.content.address != ""){
 				$("#zt_fwdizhi").html(data.content.address);
 			//}else{
 			//	if(data.content.older != null && data.content.older != ""){
 			//		$("#zt_fwdizhi").html(data.content.older.olderAddressName);
 			//	}
 			//}
 			if(data.content.serviceExpectTime != null && data.content.serviceExpectTime != ""){
 				$("#zt_yjfwshijian").val(formateTime3(data.content.serviceExpectTime));
 			}
 			if(data.content.serviceStartTime != null && data.content.serviceStartTime != ""){
 				$("#zt_fwshijianStart").val(formateTime3(data.content.serviceStartTime));
 			}else{
 				$("#zt_fwshijianStart").attr("placeholder","服务未开始");
 				$("#zt_fwshijianEnd").attr("placeholder","服务未开始");
 			}
 			if(data.content.serviceEndTime != null && data.content.serviceEndTime != ""){
 				$("#zt_fwshijianEnd").val(formateTime3(data.content.serviceEndTime));
 			}else{
 				if(data.content.serviceStartTime != null && data.content.serviceStartTime != ""){
 					$("#zt_fwshijianEnd").attr("placeholder","服务未结束");
 				}
 			}
 			
 			if(data.content.serviceTimeCount != null && data.content.serviceTimeCount != ""){
 				$("#zt_fwshijian").html(data.content.serviceTimeCount + "分钟");
 			}
 			
 			if(data.content.serviceTaskPhotoList != null && data.content.serviceTaskPhotoList != ""){
				jQuery.each(data.content.serviceTaskPhotoList, function(i, item) {
					$("#Fptphoto"+(i+1)).removeClass("TPhide");
					$("#Fptphoto"+(i+1)).attr("name","show");
					$("#ptphoto"+(i+1)).attr("src",item.photoUrl + "?random=" + Math.random());
					$("#hide_tupian"+(i+1)).val(item.photoUrl);
					$("#tpTitle"+(i+1)).html(item.title);
					
					if(item.des != null && item.des != ""){
						if(item.des.length > 25){
							$("#tpmiaoshu"+(i+1)).html(item.des.substr(0,25) + "...");
						}else{
							$("#tpmiaoshu"+(i+1)).html(item.des);
						}
					}
					$("#hide_tpmiaoshu"+(i+1)).val(item.des);
					
					$("#Bigptphoto"+(i+1)).attr("href", item.photoUrl + "?random=" + Math.random());//设置大图
					$("#bianjiTP"+(i+1)).attr("onclick","uploadPic2('" + (i+1) + "')");
					
					if(i == 5){
						$("#Fptphoto_add").attr("style","display:none;");
					}
					
				});
				tztpys();
			}
 			
 			//生理参数
 			if(data.content.physiologicalParametersHistoryList != null && data.content.physiologicalParametersHistoryList != ""){
 				jQuery.each(data.content.physiologicalParametersHistoryList, function(i, item) {
 					if(item.type == 6 ){
 						$("#zt_slcsTW").val(item.value);
 						$("#zt_slcsTWTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 1 ){
 						$("#zt_slcsxueya_di").val(item.value2);
 						$("#zt_slcsxueya_gao").val(item.value);
 						$("#zt_slcsxueyaTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 5 ){
 						$("#zt_slcsmaibo").val(item.value);
 						$("#zt_slcsmaiboTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 7 ){
 						$("#zt_slcshuxi").val(item.value);
 						$("#zt_slcshuxiTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 3 ){
 						$("#zt_slcsxuetang_cq").val(item.value);
 						$("#zt_xuetang_cqTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 4 ){
 						$("#zt_slcsxuetang_ch").val(item.value);
 						$("#zt_xuetang_chTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 8 ){
 						$("#zt_slcsxueyang").val(item.value);
 						$("#zt_slcsxueyangTime").val(formateTime3(item.createTime));
 					}
 					if(item.type == 9 ){
 						$("#zt_slcsgumidu").val(item.value);
 						$("#zt_slcsgumiduTime").val(formateTime3(item.createTime));
 					}
 				});
 				$("#zt_slcsmiaoshu").val(data.content.physiologicalParametersDes);
 			}
 			
 			//水肿情况
 			var html2 = "";
 			if(data.content.edemaConditionList != null && data.content.edemaConditionList != ""){
 				for(var i=0;i < data.content.edemaConditionList.length;i++){
 					html2 +="<tr>";
 					if(data.content.edemaConditionList[i].type == "-"){
 						html2 +="<td><select class=\"form-control\"><option value=\"+\">+</option><option value=\"-\" selected>-</option></select></td>";
 					}else{
						html2 +="<td><select class=\"form-control\"><option value=\"+\" selected>+</option><option value=\"-\">-</option></select></td>";
					}
					html2 +="<td><input value=\"" + data.content.edemaConditionList[i].edemaSite + "\" class=\"form-control\" ></td>";
					html2 +="<td><input class=\"form-control date datetime\" size=\"16\" value=\"" + formateTime3(data.content.edemaConditionList[i].createTime) + "\"  type=\"text\"></td>";
					html2 +="<td ><a class=\"label label-danger\" onclick=\"$(this).parent().parent().remove();\" ><i class=\"fa fa-times\"></i></a></td>";				
					html2 +="</tr>";
 				}
 				html2 +="<tr id=\"addshuizhong\">";
				html2 +="<td> </td>";
				html2 +="<td> </td>";
				html2 +="<td> </td>";
				html2 +="<td style=\"text-align:right\"><a class=\"label btn-primary \" onclick=\"addshuizhong();\"><i class=\"fa fa-plus\"></i></a> </td>";				
				html2 +="</tr>";
				$("#szqkLB").html(html2);
 			}
 			
 			//康复护理情况
			$("#zt_kfhlqk").val(data.content.nursingRecord);		
				
			//客户告知
			$("#zt_kfgz").val(data.content.customerInformed);								
 			
 			//回访
 			$("#zt_hfsj_hf").val(data.content.visitServiceTime);	
 			$("#zt_hftd_hf").val(data.content.visitServiceAttitude);	
 			$("#zt_hfzl_hf").val(data.content.visitServiceQuality);	
 			$("#zt_hfneirong_hf").val(data.content.visitRecord);	
 			
 			//服务日志
			var html3 = "";
			var html33 = "";
			if(data.content.serviceLogList != null && data.content.serviceLogList != ""){
				var i = data.content.serviceLogList.length;
				html3 += "<li>";
 				html3 += "<div class=\"cbp_tmicon \" style=\"background:#afdcf8;width:3px;height:3px;left:20%;margin-left:-7px;top:-11px\"></div>";
 				html3 += "</li>";
 				jQuery.each(data.content.serviceLogList, function(i, item) {
 					html33 += "<li>";
 					html33 += "<time class=\"cbp_tmtime\" datetime=\"" + formateTime3(item.createTime) + "\"></time>";
 					html33 += "<div class=\"cbp_tmicon \"><strong>" + i + "</strong></div>";
 					html33 += "<div class=\"cbp_tmlabel \">";
 					html33 += "<p><strong>" + formateTime3(item.createTime) + "</strong></p>";
 					html33 += "<p>" + item.createPerson + " " + item.type + "</p>";
 					html33 += "<p><strong>" + item.log + "</strong></p>";
 					html33 += "</div>";
 					html33 += "</li>";
 					html3 = html33 + html3;
 					html33 = "";
 					i--;
 				});
 				$("#zt_fuwuLog").html(html3);
 			}
 			
   		}
   	}	
   	
   	//收费类别
	function fwlbChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="医保";
  			break;
  			
			case 2:
  			name="市场";
  			break;
  			
  			default:
  			break;
		}
		return name;
	}
   		//获取当前时间return yyyymmddhhmmss
function getNowFormatDate2() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}

//到2016-08-08 12:12分的时间选择器转化YYYYMMDDhhmmss
function changeTime2(time){
	var times = "";
	times = String(time);
	if(times == null || times == ""){
		return;
	}
	times = times.split("-")[0] + times.split("-")[1] + String(times.split("-")[2]).substr(0,2) + String(times.split("-")[2]).substr(3,2) + String(times.split("-")[2]).substr(6,2) + "00";
	return times;
}

   	//保存编辑修改后的服务工单
   	function baocun(){
   		var name = getLoginName();
		if(name == ""){
			alert("当前用户非员工");
			return;
		}
		
   		//生理参数
   		var ifOk = addSLCSAll();
		if(ifOk == ""){
			return;
		}
   		var id = $("#hide_id").val();
   		var zt_yjfwshijian = $("#zt_yjfwshijian").val();//预计服务时间
   		
   		var zt_fwshijianStart = $("#zt_fwshijianStart").val();
   		var zt_fwshijianEnd = $("#zt_fwshijianEnd").val();
   		var zt_fwshijian = $("#zt_fwshijian").html();
   		if(zt_fwshijian == "暂无"){
   			zt_fwshijian = "";
   		}
 		var zt_slcsmiaoshu = $("#zt_slcsmiaoshu").val();//生理参数 其他事项
 		if (zt_slcsmiaoshu != null && zt_slcsmiaoshu != "") {
 			zt_slcsmiaoshu = JSON.stringify(zt_slcsmiaoshu);
			if(zt_slcsmiaoshu.length > 200){
				alert("生理参数其他事项最大字数限制200字");
				return;
			}
		}
		
		var	zt_kfhlqk = $("#zt_kfhlqk").val();//康复护理情况	
		var	zt_kfgz = $("#zt_kfgz").val();//客户告知
		if (zt_kfhlqk != null && zt_kfhlqk != "") {
			zt_kfhlqk = JSON.stringify(zt_kfhlqk);
			if(zt_kfhlqk.length > 500){
				alert("康复护理情况超过最大字数限制500字");
				return;
			}
		}
		if (zt_kfgz != null && zt_kfgz != "") {
			zt_kfgz = JSON.stringify(zt_kfgz);
			if(zt_kfgz.length > 200){
				alert("客户告知超过最大字数限制200字");
				return;
			}
		}
			
 		//回访
 		var	zt_hfsj_hf = $("#zt_hfsj_hf").val();	
 		var	zt_hftd_hf = $("#zt_hftd_hf").val();		
 		var	zt_hfzl_hf = $("#zt_hfzl_hf").val();	
 		var	zt_hfneirong_hf = $("#zt_hfneirong_hf").val();	
 		if (zt_hfneirong_hf != null && zt_hfneirong_hf != "") {
       		zt_hfneirong_hf = JSON.stringify(zt_hfneirong_hf);
       		if(zt_hfneirong_hf.length > 500){
				alert("回访记录超过最大字数限制500字");
				return;
			}
		}
 		
 		var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
 		
 		if(ifOk == "0"){
 			reqmsg += "\"physiologicalParametersHistoryList\":[{}],";
 		}else{
 			reqmsg += "\"physiologicalParametersHistoryList\":[" + ifOk + "],";
 		}
 		
		reqmsg += "\"id\":" + id + ",";
		if (zt_yjfwshijian != null && zt_yjfwshijian != "") {
        	reqmsg += "\"serviceExpectTime\":\"" + changeTime2(zt_yjfwshijian) + "\",";
		}else{
			reqmsg += "\"serviceExpectTime\":\"\",";
		}
		
		if (zt_fwshijianStart != null && zt_fwshijianStart != "") {
        	reqmsg += "\"serviceStartTime\":\"" + changeTime2(zt_fwshijianStart) + "\",";
		}else{
			reqmsg += "\"serviceStartTime\":\"\",";
		}
		if (zt_fwshijianEnd != null && zt_fwshijianEnd != "") {
        	reqmsg += "\"serviceEndTime\":\"" + changeTime2(zt_fwshijianEnd) + "\",";
		}else{
			reqmsg += "\"serviceEndTime\":\"\",";
		}
		if (zt_fwshijian != null && zt_fwshijian != "") {
			zt_fwshijian = String(zt_fwshijian).replace("分钟","");
        	reqmsg += "\"serviceTimeCount\":" + zt_fwshijian + ",";
		}else{
			reqmsg += "\"serviceTimeCount\":0,";
		}
		
		if (zt_slcsmiaoshu != null && zt_slcsmiaoshu != "") {
       		reqmsg += "\"physiologicalParametersDes\":" + zt_slcsmiaoshu + ",";
		}else{
			reqmsg += "\"physiologicalParametersDes\":\"\",";
		}
			
 		var szqkList = $("#szqkLB tr");
		if(szqkList.length > 1){//有水肿情况
			var szbuwei = "";
			var sztime = "";
			reqmsg += "\"edemaConditionList\":[";
			for(var i = 0;i<szqkList.length-1;i++){
				szbuwei = $("#szqkLB").find("tr:eq("+i+")").find("td:eq(1)").find("input").val();
				sztime = changeTime2($("#szqkLB").find("tr:eq("+i+")").find("td:eq(2)").find("input").val());
				if(szbuwei == "" || szbuwei == null || sztime == "" || sztime == null ){
					alert("请填写完整水肿情况");
					return;
				}
				reqmsg +="{\"type\":\"" + $("#szqkLB").find("tr:eq("+i+")").find("td:eq(0)").find("select").val() + "\",";
				reqmsg +="\"edemaSite\":\"" + szbuwei + "\",";
				reqmsg +="\"createTime\":\"" + sztime + "\",";
				reqmsg +="\"createPerson\":\"" + name + "\"},";
				szbuwei = "";
				sztime = "";
			}
			reqmsg +="],";	
		}
 		
 		if (zt_kfhlqk != null && zt_kfhlqk != "") {
       		reqmsg += "\"nursingRecord\":" + zt_kfhlqk + ",";
		}else{
			reqmsg += "\"nursingRecord\":\"\",";
		}
 		if (zt_kfgz != null && zt_kfgz != "") {
       		reqmsg += "\"customerInformed\":" + zt_kfgz + ",";
		}else{
			reqmsg += "\"customerInformed\":\"\",";
		}
		
		if (zt_hfsj_hf != null && zt_hfsj_hf != "") {
       		reqmsg += "\"visitServiceTime\":\"" + zt_hfsj_hf + "\",";
		}else{
			reqmsg += "\"visitServiceTime\":\"\",";
		}
		if (zt_hftd_hf != null && zt_hftd_hf != "") {
       		reqmsg += "\"visitServiceAttitude\":\"" + zt_hftd_hf + "\",";
		}else{
			reqmsg += "\"visitServiceAttitude\":\"\",";
		}
		if (zt_hfzl_hf != null && zt_hfzl_hf != "") {
       		reqmsg += "\"visitServiceQuality\":\"" + zt_hfzl_hf + "\",";
		}else{
			reqmsg += "\"visitServiceQuality\":\"\",";
		}
		if (zt_hfneirong_hf != null && zt_hfneirong_hf != "") {
       		reqmsg += "\"visitRecord\":" + zt_hfneirong_hf + ",";
		}else{
			reqmsg += "\"visitRecord\":\"\",";
		}
		
		var tupianFlag = 0;
		for(var i=1;i<7;i++){
			if($("#hide_tupian"+i).val() != null && $("#hide_tupian"+i).val() != ""){
				tupianFlag ++;
			}
		}
		if(tupianFlag != 0){
			tupianFlag = 1;
			reqmsg += "\"serviceTaskPhotoList\":[";
			for(var i=1;i<7;i++){
				if($("#hide_tupian"+i).val() != null && $("#hide_tupian"+i).val() != ""){
					reqmsg += "{\"photoUrl\":\"" + $("#hide_tupian"+i).val() + "\",";
					reqmsg += "\"title\":\"" + $("#tpTitle"+i).html() + "\",";
					reqmsg += "\"des\":\"" + $("#hide_tpmiaoshu"+i).val() + "\",";
					reqmsg += "\"createPerson\":\"" + name + "\",";
					reqmsg += "\"createTime\":\"" + getNowFormatDate2() + "\",";
					reqmsg += "\"showIndex\":" + tupianFlag + "},";
					tupianFlag++;
				}
			}
			reqmsg += "],";
		}else{
			reqmsg += "\"serviceTaskPhotoList\":[{}],";
		}
		
		reqmsg += "\"serviceLogList\":[" ;
		reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
		reqmsg += "\"createPerson\":\"" + name +"\",";
		reqmsg += "\"type\":\"修改工单\",";
		reqmsg += "\"log\":\"" + name + "修改了工单\"}";
		reqmsg += "],";
		
		reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:true,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	alert("修改成功");
              	var id=data.content.id;
              	var path="<%=request.getContextPath()%>";
              	var url=path+"/serviceTask.do?mainXQ&id="+id;
              	window.location.replace(url);
              }else if(data.des=="failure"){
                 alert("修改失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
 		
   	}
   	
   	//保存回访
   	function huifang(){
   		var name = getLoginName();
		if(name == ""){
			alert("当前用户非员工");
			return;
		}
		
   		var	zt_hfsj_hf = $("#zt_hfsj_hf").val();	
   		if(zt_hfsj_hf == null || zt_hfsj_hf == ""){
   			alert("请选择回访服务时间");
   			return;
   		}
 		var	zt_hftd_hf = $("#zt_hftd_hf").val();	
 		if(zt_hftd_hf == null || zt_hftd_hf == ""){
   			alert("请选择回访服务态度");
   			return;
   		}	
 		var	zt_hfzl_hf = $("#zt_hfzl_hf").val();
 		if(zt_hfzl_hf == null || zt_hfzl_hf == ""){
   			alert("请选择回访服务质量");
   			return;
   		}	
 		var	zt_hfneirong_hf = $("#zt_hfneirong_hf").val();
 		if(zt_hfneirong_hf == null || zt_hfneirong_hf == ""){
   			alert("请填写回访内容");
   			return;
   		}
   		zt_hfneirong_hf = JSON.stringify(zt_hfneirong_hf);
   		if(zt_hfneirong_hf.length > 200){
   			alert("回访内容超出字数限制200字");
   			return;
   		}
   		
 		var id = $("#hide_id").val();
 		
 		var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
 		
 		reqmsg += "\"id\":" + id + ",";
 		reqmsg += "\"status\":7,";
 		if (zt_hfsj_hf != null && zt_hfsj_hf != "") {
       		reqmsg += "\"visitServiceTime\":\"" + zt_hfsj_hf + "\",";
		}else{
			reqmsg += "\"visitServiceTime\":\"\",";
		}
		if (zt_hftd_hf != null && zt_hftd_hf != "") {
       		reqmsg += "\"visitServiceAttitude\":\"" + zt_hftd_hf + "\",";
		}else{
			reqmsg += "\"visitServiceAttitude\":\"\",";
		}
		if (zt_hfzl_hf != null && zt_hfzl_hf != "") {
       		reqmsg += "\"visitServiceQuality\":\"" + zt_hfzl_hf + "\",";
		}else{
			reqmsg += "\"visitServiceQuality\":\"\",";
		}
		if (zt_hfneirong_hf != null && zt_hfneirong_hf != "") {
       		reqmsg += "\"visitRecord\":" + zt_hfneirong_hf + ",";
		}else{
			reqmsg += "\"visitRecord\":\"\",";
		}
 		
 		reqmsg += "\"serviceLogList\":[" ;
		reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
		reqmsg += "\"createPerson\":\"" + name +"\",";
		reqmsg += "\"type\":\"回访工单\",";
		if(zt_hfneirong_hf != null && zt_hfneirong_hf != ""){
			reqmsg += "\"log\":" + zt_hfneirong_hf + "}";
		}else{
			reqmsg += "\"log\":\"" + name + "回访了工单\"}";
		}
		
		reqmsg += "],";
		
		reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:true,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	alert("回访成功");
              }else if(data.des=="failure"){
                 alert("回访失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
     
   	}
   	
   	//获取当前登陆员工姓名
	function getLoginName(){
    	  var userId_login = "<%=request.getAttribute("userId")%>";
		  var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"userId\":"+userId_login+"}}";
		  var name="";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	if(data.content.employeeList != null && data.content.employeeList.length == 1){
            	  	   name = data.content.employeeList[0].name;
            	  	   userName = data.content.employeeList[0].name;
            	  	   console.log(userName);
            	  	}
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
     	  return name;
	}
	//测量时间转化 yyyymmddhhmm
	function changeTime(time){
		time = time.split("-")[0] + time.split("-")[1] + time.split("-")[2];
		time = time.split(":")[0] + time.split(":")[1];
		time = time.replace(/\ +/g,"");
		return time;
	}
	//获取当前时间return yyyymmddhhmm
function getNowFormatDate() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes;
    return currentdate;
}
   	//保存生理参数信息道老人对应生理参数信息表
	function addSLCSAll(){
		var ifOk = "";
		
		var name = getLoginName();
		if(name == ""){
			alert("当前用户非员工");
			return ifOk;
		}
		var id = $("#hide_id").val();
 		var olderId = $("#hide_OldId").val();

		var flag = 0;
		var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
		var reg2 = new RegExp("^[0-9]+(.[0-9]{1,2})?$"); 
		
		var xueya_addAll_ssy = $("#zt_slcsxueya_gao").val();
		var xueya_addAll_szy = $("#zt_slcsxueya_di").val();
		var xueya_addAll_szy_time = $("#zt_slcsxueyaTime").val();
		if((xueya_addAll_ssy != null && xueya_addAll_ssy != "") || (xueya_addAll_szy != null && xueya_addAll_szy != "") || (xueya_addAll_szy_time != null && xueya_addAll_szy_time != "")){
		if(xueya_addAll_ssy != null && xueya_addAll_ssy != ""){
			if(!reg1.test(xueya_addAll_ssy)){ 
        		alert("请输入符合规范的收缩压!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			alert("收缩压,舒张压,测量时间是一起填写的!");
        	return ifOk;;	
		}
		if(xueya_addAll_szy != null && xueya_addAll_szy != ""){
			if(!reg1.test(xueya_addAll_szy)){ 
        		alert("请输入符合规范的舒张压!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			alert("收缩压,舒张压,测量时间是一起填写的!");
        	return ifOk;;	
		}
		if(xueya_addAll_szy_time != null && xueya_addAll_szy_time != ""){
			if(getNowFormatDate() < xueya_addAll_szy_time){
    		    alert("测量时间不能超过当前时间!");
        		return ifOk;;
    		}
			xueya_addAll_szy_time = changeTime(xueya_addAll_szy_time) + "00";
			flag++;
    	}else{
    		alert("收缩压,舒张压,测量时间是一起填写的!");
        	return ifOk;;
    	}
		}
		
		var xuetang_addAll_kf = $("#zt_slcsxuetang_cq").val();
		var xuetang_addAll_ch = $("#zt_slcsxuetang_ch").val();
		var xuetang_addAll_kf_time = $("#zt_xuetang_cqTime").val();
		var xuetang_addAll_ch_time = $("#zt_xuetang_chTime").val();
		if(xuetang_addAll_kf != null && xuetang_addAll_kf != ""){
			if(!reg2.test(xuetang_addAll_kf)){ 
        		alert("请输入符合规范的空腹血糖!");
        		return ifOk;;
    		}
    		if(xuetang_addAll_kf_time == null || xuetang_addAll_kf_time == ""){
    			alert("请选择空腹血糖测量时间!");
        		return ifOk;;
    		}else{
    			xuetang_addAll_kf_time = changeTime(xuetang_addAll_kf_time) + "00";
    		}
    		if(getNowFormatDate() < xuetang_addAll_kf_time){
    		    alert("空腹血糖测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(xuetang_addAll_kf_time != null && xuetang_addAll_kf_time != ""){
    			alert("请输入空腹血糖值!");
        		return ifOk;;
    		}
		}
		if(xuetang_addAll_ch != null && xuetang_addAll_ch != ""){
			if(!reg2.test(xuetang_addAll_ch)){ 
        		alert("请输入符合规范的餐后血糖!");
        		return ifOk;;
    		}
    		if(xuetang_addAll_ch_time == null || xuetang_addAll_ch_time == ""){
    			alert("请选择餐后血糖测量时间!");
        		return ifOk;;
    		}else{
    			xuetang_addAll_ch_time = changeTime(xuetang_addAll_ch_time) + "00";
    		}
    		if(getNowFormatDate() < xuetang_addAll_ch_time){
    		    alert("餐后血糖测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(xuetang_addAll_ch_time != null && xuetang_addAll_ch_time != ""){
    			alert("请输入餐后血糖值!");
        		return ifOk;;
    		}
		}
		
		var maibo_addAll = $("#zt_slcsmaibo").val();
		var maibo_addAll_time = $("#zt_slcsmaiboTime").val();
		if(maibo_addAll != null && maibo_addAll != ""){
			if(!reg1.test(maibo_addAll)){ 
        		alert("请输入符合规范的脉搏!");
        		return ifOk;;
    		}
    		if(maibo_addAll_time == null || maibo_addAll_time == ""){
    			alert("请选择脉搏测量时间!");
        		return ifOk;;
    		}else{
    			maibo_addAll_time = changeTime(maibo_addAll_time) + "00";
    		}
    		if(getNowFormatDate() < maibo_addAll_time){
    		    alert("脉搏测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(maibo_addAll_time != null && maibo_addAll_time != ""){
    			alert("请输入脉搏值!");
        		return ifOk;;
    		}
		}
		
		var tiwen_addAll = $("#zt_slcsTW").val();
		var tiwen_addAll_time = $("#zt_slcsTWTime").val();
		if(tiwen_addAll != null && tiwen_addAll != ""){
			if(!reg2.test(tiwen_addAll)){ 
        		alert("请输入符合规范的体温!");
        		return ifOk;;
    		}
    		if(tiwen_addAll_time == null || tiwen_addAll_time == ""){
    			alert("请选择体温测量时间!");
        		return ifOk;;
    		}else{
    			tiwen_addAll_time = changeTime(tiwen_addAll_time) + "00";
    		}
    		if(getNowFormatDate() < tiwen_addAll_time){
    		    alert("体温测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(tiwen_addAll_time != null && tiwen_addAll_time != ""){
    			alert("请输入体温值!");
        		return ifOk;;
    		}
		}
		
		var huxi_addAll = $("#zt_slcshuxi").val();
		var huxi_addAll_time = $("#zt_slcshuxiTime").val();
		if(huxi_addAll != null && huxi_addAll != ""){
			if(!reg1.test(huxi_addAll)){ 
        		alert("请输入符合规范的呼吸!");
        		return ifOk;;
    		}
    		if(huxi_addAll_time == null || huxi_addAll_time == ""){
    			alert("请选择呼吸测量时间!");
        		return ifOk;;
    		}else{
    			huxi_addAll_time = changeTime(huxi_addAll_time) + "00";
    		}
    		if(getNowFormatDate() < huxi_addAll_time){
    		    alert("呼吸测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(huxi_addAll_time != null && huxi_addAll_time != ""){
    			alert("请输入呼吸值!");
        		return ifOk;;
    		}
		}
		
		var xueyang_add = $("#zt_slcsxueyang").val();
		var xueyang_add_time = $("#zt_slcsxueyangTime").val();
		if(xueyang_add != null && xueyang_add != ""){
			if(!reg1.test(xueyang_add)){ 
        		alert("请输入符合规范的血氧!");
        		return ifOk;;
    		}
    		if(xueyang_add_time == null || xueyang_add_time == ""){
    			alert("请选择血氧测量时间!");
        		return ifOk;;
    		}else{
    			xueyang_add_time = changeTime(xueyang_add_time) + "00";
    		}
    		if(getNowFormatDate() < xueyang_add_time){
    		    alert("血氧测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(xueyang_add_time != null && xueyang_add_time != ""){
    			alert("请输入血氧值!");
        		return ifOk;;
    		}
		}
		
		var gumidu_add = $("#zt_slcsgumidu").val();
		var gumidu_add_time = $("#zt_slcsgumiduTime").val();
		var reg3 = new RegExp("^[0-9]+(.[0-9]{1,2})?$");
		if(gumidu_add != null && gumidu_add != ""){
			if(gumidu_add.substr(0,1) == "-"){
				var gumidu_add2 = gumidu_add.substr(1,gumidu_add.length-1);
				if(!reg3.test(gumidu_add2)){ 
        			alert("请输入符合规范的骨密度!");
        			return ifOk;;
    			}
			}else{
				if(!reg3.test(gumidu_add)){ 
        			alert("请输入符合规范的骨密度!");
        			return ifOk;;
    			}
			}
    		if(gumidu_add_time == null || gumidu_add_time == ""){
    			alert("请选择骨密度测量时间!");
        		return ifOk;;
    		}else{
    			gumidu_add_time = changeTime(gumidu_add_time) + "00";
    		}
    		if(getNowFormatDate() < gumidu_add_time){
    		    alert("骨密度测量时间不能超过当前时间!");
        		return ifOk;;
    		}
    		flag++;
		}else{
			if(gumidu_add_time != null && gumidu_add_time != ""){
    			alert("请输入骨密度值!");
        		return ifOk;;
    		}
		}
		
		if(flag == 0){
			ifOk = "0";
			return ifOk;
		}
		
		var reqmsg = "";
		if(xueya_addAll_ssy != null && xueya_addAll_ssy != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":1,";
			reqmsg += "\"value\":" + xueya_addAll_ssy + ",";
			reqmsg += "\"unit\":\"mmHg\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"value2\":" + xueya_addAll_szy + ",";
			reqmsg += "\"status2\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + xueya_addAll_szy_time + "\"},";
		}
		if(xuetang_addAll_kf != null && xuetang_addAll_kf != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":3,";
			reqmsg += "\"value\":" + xuetang_addAll_kf + ",";
			reqmsg += "\"unit\":\"mmol/L\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + xuetang_addAll_kf_time + "\"},";
		}
		if(xuetang_addAll_ch != null && xuetang_addAll_ch != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":4,";
			reqmsg += "\"value\":" + xuetang_addAll_ch + ",";
			reqmsg += "\"unit\":\"mmol/L\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + xuetang_addAll_ch_time + "\"},";
		}
		if(maibo_addAll != null && maibo_addAll != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":5,";
			reqmsg += "\"value\":" + maibo_addAll + ",";
			reqmsg += "\"unit\":\"次/分\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + maibo_addAll_time + "\"},";
		}
		if(tiwen_addAll != null && tiwen_addAll != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":6,";
			reqmsg += "\"value\":" + tiwen_addAll + ",";
			reqmsg += "\"unit\":\"℃\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + tiwen_addAll_time + "\"},";
		}
		if(huxi_addAll != null && huxi_addAll != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":7,";
			reqmsg += "\"value\":" + huxi_addAll + ",";
			reqmsg += "\"unit\":\"次/分\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + huxi_addAll_time + "\"},";
		}
		if(xueyang_add != null && xueyang_add != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":8,";
			reqmsg += "\"value\":" + xueyang_add + ",";
			reqmsg += "\"unit\":\"%\",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + xueyang_add_time + "\"},";
		}
		if(gumidu_add != null && gumidu_add != "" ){
			reqmsg += "{\"id\":" + id + ",";
			reqmsg += "\"olderId\":" + olderId + ",";
			reqmsg += "\"type\":9,";
			reqmsg += "\"value\":" + gumidu_add + ",";
			reqmsg += "\"unit\":\" \",";
			reqmsg += "\"status\":0,";
			reqmsg += "\"measurePerson\":\"" + name + "\",";
			reqmsg += "\"createTime\":\"" + gumidu_add_time + "\"},";
		}
		
		return reqmsg;
	}
   	
   	//根据服务开始结束时间计算服务时长
   	function jsSC(){
   		var start = $("#zt_fwshijianStart").val();
   		var end = $("#zt_fwshijianEnd").val();
   		var startTime = 0;
   		var endTime = 0;
   		if(start == null || start == "" || end == null || end == ""){
   			return;
   		}
   		startTime = start.split("-")[0] + start.split("-")[1] + start.split("-")[2].substr(0,2) + start.split("-")[2].substr(3,2) + start.split("-")[2].substr(6,2) + "00";
   		endTime = end.split("-")[0] + end.split("-")[1] + end.split("-")[2].substr(0,2) + end.split("-")[2].substr(3,2) + end.split("-")[2].substr(6,2) + "00";
   		if(startTime >= endTime){
   			alert("服务开始时间必须小于结束时间");
   			$("#zt_fwshijianStart").val("");
   			$("#zt_fwshijianEnd").val("");
   			return;
   		}
   		var date1=new Date(start);
   		var date2=new Date(end);
   		var date3 = date2.getTime()-date1.getTime();
   		//计算出相差天数
		var days=Math.floor(date3/(24*3600*1000));
		//计算出小时数
		var leave1=date3%(24*3600*1000);    //计算天数后剩余的毫秒数
		var hours=Math.floor(leave1/(3600*1000));
		//计算相差分钟数
		var leave2=leave1%(3600*1000);       //计算小时数后剩余的毫秒数
		var minutes=Math.floor(leave2/(60*1000));
		minutes = (days*24*60) + (hours*60) + minutes;
		$("#zt_fwshijian").html(minutes + "分钟");
   	}
   	
   	
   	
  //上传图片//////////////////////////////////////////
  //添加图片
	function addtupian(){
		var weizhi = 1;
		for(var i=1;i<7;i++){
			if($("#Fptphoto"+i).attr("name") == "hide"){
				weizhi = i;
				break;
			}
		}
		$("#weizhiId").val(weizhi);
		$("#pic4upload"+weizhi).val("");
		$("#pic4upload"+weizhi).click();

	}
	//上传图片
	function uploadPic2(weizhi) {
		$("#pic4upload"+weizhi).click();
	}
	 //上传图片
	function uploadPic(weizhi,flag) {
		$("#weizhiId").val(weizhi);
		var currPic = $("#pic4upload"+weizhi).val();
		if (currPic != null && currPic != "") {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						$("#srcPath").val(data); 
						//$("#touxiangId2").attr("src", data);  //将当前图片设为上传的图片
						if(flag == "flag"){
							openImagejsp(data,weizhi);
						}else{
							openImagejsp(data,'');
						}
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#picuploadform"+weizhi).ajaxSubmit(ajax_option);
		} else {
			//alert("请选择图片");
		}
	}
	//打开图片控件页面-此处需要多传递标题和描述的参数，图片页通过标记flag判断
	function openImagejsp(data,weizhi){
		if(weizhi != null && weizhi !=""){
			var tpTitle = $("#tpTitle" + weizhi).html();
			//var tpmiaoshu = $("#tpmiaoshu" + weizhi).html();
			var hide_tpmiaoshu = $("#hide_tpmiaoshu" + weizhi).val();
			window.open ("view/imageCut/jquery-image-cut/image.jsp?flag=jkbg&tpTitle=" + tpTitle +"&tpmiaoshu=" + hide_tpmiaoshu + "&" + data, "newwindow", "height=550, width=1100, top=200, left=450, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");
		}else{
			window.open ("view/imageCut/jquery-image-cut/image.jsp?flag=jkbg&"+data, "newwindow", "height=550, width=1100, top=200, left=450, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");
		}
	}
	 //上传裁剪后图片
	function uploadPic_cut() {
			var weizhi = $("#weizhiId").val();
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						var result = JSON.parse(data);
						$("#Fptphoto"+weizhi).removeClass("TPhide");
					 	$("#Fptphoto"+weizhi).attr("name","show");
						if(weizhi == 6){
							$("#Fptphoto_add").attr("style","display:none;");
						}
						$("#hide_tupian"+weizhi).val(result.base64);
						$("#ptphoto"+weizhi).attr("src", result.url);  //将当前图片设为上传的图片
						$("#Bigptphoto"+weizhi).attr("href", result.url);//设置大图
						
						$("#tpTitle"+weizhi).html($("#photoTitle").val());
						var photoDes = $("#photoDes").val();
						if(photoDes != null && photoDes != ""){
							if(photoDes.length > 25){
								$("#tpmiaoshu"+weizhi).html(photoDes.substr(0,25) + "...");
							}else{
								$("#tpmiaoshu"+weizhi).html(photoDes);
							}
						}
						$("#hide_tpmiaoshu"+weizhi).val(photoDes);
						
						$("#bianjiTP"+weizhi).attr("onclick","uploadPic('" + weizhi + "','flag')");
						
						var evObj = document.createEvent('HTMLEvents');
						evObj.initEvent('resize', true, true);
						window.dispatchEvent(evObj);
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#image_submit").ajaxSubmit(ajax_option);
	}
	//删除图片
	function deltupian(weizhi){
		$("#hide_tupian"+weizhi).val("");
		$("#ptphoto"+weizhi).attr("src", "");
		$("#Fptphoto"+weizhi).attr("name","hide");
		$("#Fptphoto"+weizhi).addClass("TPhide");
	}
	
	
	///日常生活问询//////////////////////////////////////
	var currentshownpage_history = 1;
	function selectAll_history() {
		if ($("#allselectchecker_history").is(':checked')) {
			$(".col_selector_history").prop("checked", true);
		} else {
			$(".col_selector_history").prop("checked", false);
		}
	}
	//查询日常生活问询列表信息
	function query_history(){
		go2page_history(1);
	}
	
	function go2page_history(pagenumber){
	var pagesize = $("#pageSizeSelector_history option:selected").val();
	var id = "<%=request.getAttribute("id")%>";
	var reqmsg="{'action':'QUERY_DAILY_LIFE_ASK_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
	reqmsg += "\"serviceTaskId\":" + id;
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "dailyLifeAsk.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData_history(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
	}

	function changeData_history(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.dailyLifeAskList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector_history\"></td>";
		    htmlcode += "<td>" + formateTime(item.createTime) + "</td>";			
		    htmlcode += "<td>" + item.createPerson + "</td>";				
		    htmlcode += "<td>" + item.dailyWater1 + "</td>";
		    htmlcode += "<td>" + item.dailyWater2 + "</td>";
		    htmlcode += "<td>" + item.dailyFood + "</td>";
		 	htmlcode += "<td>" + item.urine + "</td>";
		 	if(item.urineNum != null && item.urineNum != ""){
		 		htmlcode += "<td>" + item.urineNum + "ml</td>";
		 	}else{
		 		htmlcode += "<td></td>";
		 	}
		 	if(item.shit != null && item.shit != ""){
		 		htmlcode += "<td>" + item.shit + "次" + item.shitDay + "天</td>";
		 	}else{
		 		htmlcode += "<td></td>";
		 	}
		 	htmlcode += "<td>" + item.sleepHour + "</td>";
		 	htmlcode += "<td>" + item.sleepQuality + "</td>";
		 	htmlcode += "<td>" + item.morningSpirit + "</td>";
		 	htmlcode += "<td>" + item.other + "</td>";
		 	
		    htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			<c:if test="${site_queryXQ_opt_control != 'yes' or site_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"ckxq_history('" + item.id + "')\"><a href=\"###\">查看详情</a></li>";
			</c:if>	
			<c:if test="${site_del_opt_control != 'yes' or site_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del_history('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";				
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer_history").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml_history(data.page.pageno, data.page.pageCount);
	} else {
		genaratePaginateHtml_history(1, 1);
	}
	}
	
	/**
 * 生成分页信息
 * @method genaratePaginateHtml_history
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml_history(currentpage, totalpage, pagesize) {
	currentshownpage_history = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"###\" onclick=\"go2page_history('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"###\" onclick=\"go2page_history('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"###\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"###\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"###\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"###\" onclick=\"go2page_history('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"###\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"###\" onclick=\"go2page_history('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"###\" onclick=\"go2page_history('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"###\" onclick=\"go2page_history('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"###\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"###\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea_history").html(htmlcode);
}
//删除单个日常生活问询信息
function del_history(id){
	 if (confirm("是否确认删除?"))  { 
		jQuery.ajax({
			type:"post",
			url:"dailyLifeAsk.do?del",
			async:false,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				if (data.result == "success") {
					go2page_history(currentshownpage_history);
					alert(data.des);
				}else if(data.des=="failure"){
                 	alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	  }
}
//删除多个日常生活问询信息
function del_historyAll(){
	var selectedItemNumber = $("tbody .col_selector_history:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector_history:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
		
	 if (confirm("是否确认删除?"))  { 
		jQuery.ajax({
			type:"post",
			url:"dailyLifeAsk.do?del",
			async:false,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				if (data.result == "success") {
					go2page_history(currentshownpage_history);
					alert(data.des);
				}else if(data.des=="failure"){
                 	alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	  }
	} else {
		alert("请选择要删除的数据");
	}
}

//重置日常生活问询弹窗
function zhikong_rcshlsjl(){
	$("#rcshjl_id_hide").val("");
	$("#rcshjl_time").val("");
    $("#rcshjl_rshl").val("");
    $("#rcshjl_rsyll").val("");
    $("#rcshjl_rshlzs").val("");
    $("#rcshjl_xbcs").val("");
    $("#rcshjl_xbl").val("");
    $("#rcshjl_dbcs").val("");
    $("#rcshjl_dbts").val("");
    $("#rcshjl_smsj").val("");
    $("#rcshjl_smzj").val("");
    $("#rcshjl_jinshen").val("");
    $("#rcshjl_qitaqk").val("");
    var name = getLoginName();
    $("#rcshjl_pdr").val(name);
}
//保存日常生活问询
function save_rcshlsjl(){
	var flag = 0;
	var rcshjl_time = $("#rcshjl_time").val();
	if(rcshjl_time == null || rcshjl_time == ""){
    	alert("请选择记录时间!");
        return;
    }else{
    	rcshjl_time = changeTime(rcshjl_time);
    	if(getNowFormatDate() < rcshjl_time){
    		alert("记录时间不能超过当前时间!");
        	return;
    	}
    }
    rcshjl_time = rcshjl_time + "00";
    var rcshjl_pdr = $("#rcshjl_pdr").val();
    var rcshjl_rshl = $("#rcshjl_rshl").val();
    var rcshjl_rsyll = $("#rcshjl_rsyll").val();
    var rcshjl_rshlzs = $("#rcshjl_rshlzs").val();
    var rcshjl_xbcs = $("#rcshjl_xbcs").val();
    var rcshjl_xbl = $("#rcshjl_xbl").val();
    var rcshjl_dbcs = $("#rcshjl_dbcs").val();
    var rcshjl_dbts = $("#rcshjl_dbts").val();
    var rcshjl_smsj = $("#rcshjl_smsj").val();
    var rcshjl_smzj = $("#rcshjl_smzj").val();
    var rcshjl_jinshen = $("#rcshjl_jinshen").val();
    var rcshjl_qitaqk = $("#rcshjl_qitaqk").val();
    
    var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
    var reg2 = new RegExp("^[0-9]+(.[0-9]{1,2})?$");  
    if(rcshjl_rshl != null && rcshjl_rshl != ""){
    	if(!reg2.test(rcshjl_rshl)){ 
        	alert("请输入符合规范的日摄水量!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_rsyll != null && rcshjl_rsyll != ""){
    	if(!reg2.test(rcshjl_rsyll)){ 
        	alert("请输入符合规范的日摄饮料量!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_rshlzs != null && rcshjl_rshlzs != ""){
    	if(!reg2.test(rcshjl_rshlzs)){ 
        	alert("请输入符合规范的日摄食量 主食!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_xbcs != null && rcshjl_xbcs != ""){
    	if(!reg1.test(rcshjl_xbcs)){ 
        	alert("请输入符合规范的小便次数!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_xbl != null && rcshjl_xbl != ""){
    	if(!reg2.test(rcshjl_xbl)){ 
        	alert("请输入符合规范的小便量!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_dbcs != null && rcshjl_dbcs != ""){
    	if(!reg1.test(rcshjl_dbcs)){ 
        	alert("请输入符合规范的大便次数!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_dbts != null && rcshjl_dbts != ""){
    	if(!reg1.test(rcshjl_dbts)){ 
        	alert("请输入符合规范的大便天数!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_smsj != null && rcshjl_smsj != ""){
    	if(!reg1.test(rcshjl_smsj)){ 
        	alert("请输入符合规范的睡眠时间!");
        	return;
    	}
    	flag ++;
    }
    if(rcshjl_smzj != null && rcshjl_smzj != ""){
    	flag ++;
    }
    if(rcshjl_jinshen != null && rcshjl_jinshen != ""){
    	flag ++;
    }
    if(rcshjl_qitaqk != null && rcshjl_qitaqk != ""){
    	flag ++;
    }
    
    if(flag == 0){
    	alert("您还没有填写内容");
    	return;
    }
    
    if(((rcshjl_dbcs != null && rcshjl_dbcs != "") && (rcshjl_dbts == null || rcshjl_dbts == "")) || ((rcshjl_dbcs == null || rcshjl_dbcs == "") && (rcshjl_dbts != null && rcshjl_dbts != ""))){
    	alert("大便次数和天数是一起填写的");
    	return;
    }
    
   	var reqmsg="{'action':'ADD_DAILY_LIFE_ASK_INFO_REQUEST','content':{";
   	var serviceTaskId = "<%=request.getAttribute("id")%>";
   	reqmsg += "\"serviceTaskId\":" + serviceTaskId + ",";
	reqmsg += "\"createTime\":\"" + rcshjl_time + "\",";
	var oldId_hide = $("#oldId_hide").val();
	reqmsg += "\"oldId\":" + oldId_hide + ",";
	if(rcshjl_pdr != null && rcshjl_pdr != ""){
		reqmsg += "\"createPerson\":\"" + rcshjl_pdr + "\",";
	} 
	if(rcshjl_rshl != null && rcshjl_rshl != ""){
		reqmsg += "\"dailyWater1\":\"" + rcshjl_rshl + "\",";
	}
	if(rcshjl_rsyll != null && rcshjl_rsyll != ""){
		reqmsg += "\"dailyWater2\":\"" + rcshjl_rsyll + "\",";
	}
	if(rcshjl_rshlzs != null && rcshjl_rshlzs != ""){
		reqmsg += "\"dailyFood\":\"" + rcshjl_rshlzs + "\",";
	}
	if(rcshjl_xbcs != null && rcshjl_xbcs != ""){
		reqmsg += "\"urine\":\"" + rcshjl_xbcs + "\",";
	}
	if(rcshjl_xbl != null && rcshjl_xbl != ""){
		reqmsg += "\"urineNum\":\"" + rcshjl_xbl + "\",";
	}
	if(rcshjl_dbcs != null && rcshjl_dbcs != ""){
		reqmsg += "\"shit\":\"" + rcshjl_dbcs + "\",";
	}
	if(rcshjl_dbts != null && rcshjl_dbts != ""){
		reqmsg += "\"shitDay\":\"" + rcshjl_dbts + "\",";
	}
	if(rcshjl_smsj != null && rcshjl_smsj != ""){
		reqmsg += "\"sleepHour\":\"" + rcshjl_smsj + "\",";
	}
	if(rcshjl_smzj != null && rcshjl_smzj != ""){
		reqmsg += "\"sleepQuality\":\"" + rcshjl_smzj + "\",";
	}
	if(rcshjl_jinshen != null && rcshjl_jinshen != ""){
		reqmsg += "\"morningSpirit\":\"" + rcshjl_jinshen + "\",";
	}
	if(rcshjl_qitaqk != null && rcshjl_qitaqk != ""){
		reqmsg += "\"other\":\"" + rcshjl_qitaqk + "\",";
	}
	
	var rcshjl_id_hide = $("#rcshjl_id_hide").val();
	if(rcshjl_id_hide != null && rcshjl_id_hide != ""){//编辑
		reqmsg += "\"id\":" + rcshjl_id_hide + ",";
	}
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:false,
          url : "dailyLifeAsk.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  query_history();
            	  alert("添加或编辑成功");
              }else if(data.des=="failure"){
                  alert("添加失败");
              }
          },
          error:function(){
	           alert("error");
          }
    });
    $("#close_rcshlsjl").click();
}
   //转化日期2
   function riqiChange2(data){
   		var date_=data;
    	var date2=data.substr(0,4)+"-"+data.substr(4,2)+"-"+data.substr(6,2)+" "+data.substr(8,2)+":"+data.substr(10,2);
    	if(date2 == "--"){
    		date2 = "无";
    	}
    	return date2;
   }
//查询日常生活问询列表信息
function ckxq_history(id){
	var reqmsg="{'action':'QUERY_DAILY_LIFE_ASK_INFO_REQUEST','content':{";
	reqmsg += "\"id\":" + id + "}}";

	jQuery.ajax({
			type:"post",
			url:"dailyLifeAsk.do?handler",
			async:true,
			dataType:"json",
			data: {
               "reqmsg":reqmsg
          	},
			success:function(data) {
				if (data.des == "success") {
					if(data.content != null){
						$("#rcshjl_id_hide").val(data.content.id);
						$("#rcshjl_time").val(riqiChange2(data.content.createTime));
						$("#rcshjl_pdr").val(data.content.createPerson);
    					$("#rcshjl_rshl").val(data.content.dailyWater1);
    					$("#rcshjl_rsyll").val(data.content.dailyWater2);
    					$("#rcshjl_rshlzs").val(data.content.dailyFood);
    					$("#rcshjl_xbcs").val(data.content.urine);
    					$("#rcshjl_xbl").val(data.content.urineNum);
    					$("#rcshjl_dbcs").val(data.content.shit);
   						$("#rcshjl_dbts").val(data.content.shitDay);
   						$("#rcshjl_smsj").val(data.content.sleepHour);
    					$("#rcshjl_smzj").val(data.content.sleepQuality);
    					$("#rcshjl_jinshen").val(data.content.morningSpirit);
    					$("#rcshjl_qitaqk").val(data.content.other);
					}
				}else{
                 	alert("查询失败");
                }
			},
			error:function() {
				alert("error");
			}
		});

	$("#rcshlsjl_bj").click();
}

//取消工单，打开日志弹窗
function quxiao_qingkong(){
	$("#gdczTitle").html("取消操作日志");
	$("#model_caozuo").val("取消");
	$("#model_caozuo").attr("readonly","readonly");
	$("#model_quxiaobeizhu").val("");
}
//确认取消工单操作，或者记录日志操作
function sureQuxiao() {
	var name = getLoginName();
	if(name == ""){
		alert("当前用户非员工");
		return;
	}
	var gdczTitle = $("#gdczTitle").html();
	var model_caozuo = $("#model_caozuo").val();
	if(model_caozuo == null || model_caozuo == ""){
		alert("请填写操作类型");
		return;
	}
	var beizhu_input_quxiao = $("#model_quxiaobeizhu").val();
	if(beizhu_input_quxiao != null && beizhu_input_quxiao != ""){
		beizhu_input_quxiao = JSON.stringify(beizhu_input_quxiao);
		if(beizhu_input_quxiao.length > 200){
			alert("备注超出字数限制200字");
			return;
		}
		beizhu_input_quxiao = beizhu_input_quxiao.substr(1,beizhu_input_quxiao.length-2);
	}

	var hide_id = $("#hide_id").val();
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	if(gdczTitle == "取消操作日志"){
		reqmsg += "\"status\":1,";
	}

		reqmsg += "\"id\":" + hide_id + ",";
	
		reqmsg += "\"serviceLogList\":[" ;
		reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
		reqmsg += "\"createPerson\":\"" + name +"\",";
		reqmsg += "\"type\":\"" + model_caozuo + "\",";
		if(beizhu_input_quxiao == null || beizhu_input_quxiao == ""){
			reqmsg += "\"log\":\"\"}";
		}else{
			reqmsg += "\"log\":\"" + beizhu_input_quxiao + "\"}";
		}
		reqmsg += "],";
	
		reqmsg += "}}";
		
		jQuery.ajax({
         	 type : "post",
         	 async:false,
         	 url : "serviceTask.do?handler",
        	  dataType : "json",
        	  data: {
        	       "reqmsg":reqmsg
        	  },
         	 success : function(data){
         	     if(data.result == "100"){
         	     	if(gdczTitle == "取消操作日志"){
         	     		alert("取消工单成功");
         	     	}else{
         	     		alert("工单日志记录成功");
         	     	}
         	     	var id=data.content.id;
              		var path="<%=request.getContextPath()%>";
              		var url=path+"/serviceTask.do?mainXQ&id="+id;
              		window.location.replace(url);
         	     }else{
         	        alert("操作失败");
         	        $("#quxiao_tanchuang").click();
         	     }
         	 },
         	 error:function(){
	     	      alert("error");
          	}
     	});
}
//打开日志记录弹窗
function baocunrizhi(){
	$("#gdczTitle").html("日志记录");
	$("#model_caozuo").val("");
	$("#model_caozuo").removeAttr("readonly");
	$("#model_quxiaobeizhu").val("");
}

    </script>
    



  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
