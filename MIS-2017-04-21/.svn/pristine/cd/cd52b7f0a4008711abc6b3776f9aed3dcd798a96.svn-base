package fsk.parse.medNotice;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import com.framework.system.util.JsonUtil;

import javax.servlet.http.HttpServletRequest;
import com.framework.system.db.manager.DBManager;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.apache.log4j.Logger;
import fsk.entity.medNotice.MedNoticeEntity;



import fsk.entity.medPlan.MedPlanEntity;

import com.framework.system.util.JsonUtil;
import com.framework.system.db.query.OrderVO;
 /**   
 * @Title: Parse
 * @Description: 服药提醒解析器
 * @author feng.gu
 * @date 2016-10-19 16:11:44
 * @version V1.0   
 *
 */
public class MedNoticeParse {
	private static Logger logger = Logger.getLogger(MedNoticeParse.class);
	private static MedNoticeParse medNoticeParse;
	private DBManager dbManager = DBManager.getInstance();

	/**
	 * 获取实例
	 * 
	 * @return
	 */
	public static MedNoticeParse getInstance() {
		if (medNoticeParse == null) {
			medNoticeParse = new MedNoticeParse();
		}
		return medNoticeParse;
	}

	public Map<String, Object> parse(int type, String command,String reqStr,
			HttpServletRequest request) {
		// 定义返回参数
		Map<String, Object> parseMap = new HashMap<String, Object>();
		if (type == 1) {
			// json
			parseMap = this.parseByJson(command,reqStr, request);
		} else if (type == 2) {
			// xml
			parseMap = this.parseByXml(command,reqStr, request);
		}
		return parseMap;
	}

	private Map<String, Object> parseByJson(String command,String reqStr,
			HttpServletRequest request) {
		// 定义返回参数
		Map<String, Object> parseMap = new HashMap<String, Object>();
		try {
			String actionReturn = null;
			MedNoticeEntity medNoticeReturn = null;
			List<MedNoticeEntity> medNoticeListReturn = null;
			Integer idReturn = null;			
			Map<String, Object> queryMapReturn = null;
			int pagenoReturn = 1;
			int pagesizeReturn = 10;
			List<OrderVO> orderListReturn = null;
			
															Boolean medPlanShowReturn = false;
			Boolean delMedPlanReturn = false;
															
			//json
			Map reqParams = JsonUtil.getMap4Json(reqStr);
			JSONObject contentreq = (JSONObject)reqParams.get("content");
			if ("ADD_MED_NOTICE_INFO_REQUEST".equals(command)) {
				actionReturn = "save";
				medNoticeReturn = new MedNoticeEntity();
				if(true){
					if(contentreq!=null){
												    						    Integer id = (Integer)contentreq.get("id");
	                		if(id!=null){
	                		    	                		    medNoticeReturn  = (MedNoticeEntity)dbManager.getById(id, MedNoticeEntity.class);	                		    
	                		    			                	medNoticeReturn.setId(id);
			                }
						    												    						    String noticeTime = (String)contentreq.get("noticeTime");
	                		if(noticeTime!=null){
	                		    			                	medNoticeReturn.setNoticeTime(noticeTime);
			                }
						    												    						    String noticeContent = (String)contentreq.get("noticeContent");
	                		if(noticeContent!=null){
	                		    			                	medNoticeReturn.setNoticeContent(noticeContent);
			                }
						    												    						    Integer medPlanId = (Integer)contentreq.get("medPlanId");
	                		if(medPlanId!=null){
	                		    			                	medNoticeReturn.setMedPlanId(medPlanId);
			                }
						    											}					
				}
																				if(true){
					Object medPlan = contentreq.get("medPlan");
					if(medPlan!=null){
						JSONObject obj = (JSONObject)medPlan;
						if(obj!=null){
							MedPlanEntity entity = new MedPlanEntity();						
																						    Integer id = (Integer)obj.get("id");
		                		if(id!=null){
				                	entity.setId(id);
				                }
							    																						    String planNum = (String)obj.get("planNum");
		                		if(planNum!=null){
				                	entity.setPlanNum(planNum);
				                }
							    																						    Integer olderId = (Integer)obj.get("olderId");
		                		if(olderId!=null){
				                	entity.setOlderId(olderId);
				                }
							    																						    String olderName = (String)obj.get("olderName");
		                		if(olderName!=null){
				                	entity.setOlderName(olderName);
				                }
							    																						    Integer status = (Integer)obj.get("status");
		                		if(status!=null){
				                	entity.setStatus(status);
				                }
							    																						    String startime = (String)obj.get("startime");
		                		if(startime!=null){
				                	entity.setStartime(startime);
				                }
							    																						    String endtime = (String)obj.get("endtime");
		                		if(endtime!=null){
				                	entity.setEndtime(endtime);
				                }
							    																						    String noticeWechat = (String)obj.get("noticeWechat");
		                		if(noticeWechat!=null){
				                	entity.setNoticeWechat(noticeWechat);
				                }
							    																						    String noticeEmployee = (String)obj.get("noticeEmployee");
		                		if(noticeEmployee!=null){
				                	entity.setNoticeEmployee(noticeEmployee);
				                }
							    																						    String createTime = (String)obj.get("createTime");
		                		if(createTime!=null){
				                	entity.setCreateTime(createTime);
				                }
							    																						    String createPerson = (String)obj.get("createPerson");
		                		if(createPerson!=null){
				                	entity.setCreatePerson(createPerson);
				                }
							    														medNoticeReturn.setMedPlan(entity);
						}						
					}
				}
																			} else if ("QUERY_MED_NOTICE_INFO_REQUEST".equals(command)) {
				actionReturn = "getById";
				if(true){
					if(contentreq!=null){
						idReturn = (Integer)contentreq.get("id");
					        																												String medPlanShow = (String)contentreq.get("medPlanShow");
							if("true".equals(medPlanShow)){
								medPlanShowReturn = true;
							}
																																	}	
				}
			} else if ("QUERY_MED_NOTICE_LIST_REQUEST".equals(command)) {
				actionReturn = "getListByCondition";
				if(true){
					if(contentreq!=null){
						queryMapReturn = new HashMap<String, Object>();
																		Integer id_gt = (Integer)contentreq.get("id_gt");
						Integer id_ge = (Integer)contentreq.get("id_ge");
						Integer id_lt = (Integer)contentreq.get("id_lt");
						Integer id_le = (Integer)contentreq.get("id_le");
						String id_in = (String)contentreq.get("id_in");
						Integer id = (Integer)contentreq.get("id");
                        if(id_gt!=null){
                        	queryMapReturn.put("id_gt", id_gt);
						}
						if(id_ge!=null){
                        	queryMapReturn.put("id_ge", id_ge);
						}
						if(id_lt!=null){
                        	queryMapReturn.put("id_lt", id_lt);
						}
						if(id_le!=null){
                        	queryMapReturn.put("id_le", id_le);
						}
						if(id_in!=null){
                        	queryMapReturn.put("id_in", id_in);
						}
						if(id!=null){
                        	queryMapReturn.put("id", id);
						}		
																																String noticeTime_gt = (String)contentreq.get("noticeTime_gt");
							String noticeTime_ge = (String)contentreq.get("noticeTime_ge");
							String noticeTime_lt = (String)contentreq.get("noticeTime_lt");
							String noticeTime_le = (String)contentreq.get("noticeTime_le");
	                        if(noticeTime_gt!=null){
	                        	queryMapReturn.put("noticeTime_gt", noticeTime_gt);
							}
							if(noticeTime_ge!=null){
	                        	queryMapReturn.put("noticeTime_ge", noticeTime_ge);
							}
							if(noticeTime_lt!=null){
	                        	queryMapReturn.put("noticeTime_lt", noticeTime_lt);
							}
							if(noticeTime_le!=null){
	                        	queryMapReturn.put("noticeTime_le", noticeTime_le);
							} 
																																							String noticeContent_like = (String)contentreq.get("noticeContent_like");
							String noticeContent_isNull = (String)contentreq.get("noticeContent_isNull");
							String noticeContent_isNotNull = (String)contentreq.get("noticeContent_isNotNull");
							String noticeContent_in = (String)contentreq.get("noticeContent_in");
							String noticeContent = (String)contentreq.get("noticeContent");
							if(noticeContent_like!=null){
	                        	queryMapReturn.put("noticeContent_like", noticeContent_like);
							}
							if(noticeContent_isNull!=null){
	                        	queryMapReturn.put("noticeContent_isNull", noticeContent_isNull);
							}
							if(noticeContent_isNotNull!=null){
	                        	queryMapReturn.put("noticeContent_isNotNull", noticeContent_isNotNull);
							}
							if(noticeContent_in!=null){
	                        	queryMapReturn.put("noticeContent_in", noticeContent_in);
							}
							if(noticeContent!=null){
	                        	queryMapReturn.put("noticeContent", noticeContent);
							}						           
																															Integer medPlanId_gt = (Integer)contentreq.get("medPlanId_gt");
						Integer medPlanId_ge = (Integer)contentreq.get("medPlanId_ge");
						Integer medPlanId_lt = (Integer)contentreq.get("medPlanId_lt");
						Integer medPlanId_le = (Integer)contentreq.get("medPlanId_le");
						String medPlanId_in = (String)contentreq.get("medPlanId_in");
						Integer medPlanId = (Integer)contentreq.get("medPlanId");
                        if(medPlanId_gt!=null){
                        	queryMapReturn.put("medPlanId_gt", medPlanId_gt);
						}
						if(medPlanId_ge!=null){
                        	queryMapReturn.put("medPlanId_ge", medPlanId_ge);
						}
						if(medPlanId_lt!=null){
                        	queryMapReturn.put("medPlanId_lt", medPlanId_lt);
						}
						if(medPlanId_le!=null){
                        	queryMapReturn.put("medPlanId_le", medPlanId_le);
						}
						if(medPlanId_in!=null){
                        	queryMapReturn.put("medPlanId_in", medPlanId_in);
						}
						if(medPlanId!=null){
                        	queryMapReturn.put("medPlanId", medPlanId);
						}		
															
						    																												
																																			String medPlanShow = (String)contentreq.get("medPlanShow");
							if("true".equals(medPlanShow)){
								medPlanShowReturn = true;
							}
																																	}
					JSONObject pagereq = (JSONObject)reqParams.get("page");
				    if (pagereq != null) {
				    String pagenotemp = (String)pagereq.get("pageno");
				    String pagesizetemp = (String)pagereq.get("pagesize");
				    if ((pagenotemp != null) && (!"".equals(pagenotemp.trim()))) {
				          pagenoReturn = Integer.valueOf(pagenotemp).intValue();
				    }
				    if ((pagesizetemp != null) && (!"".equals(pagesizetemp.trim()))) {
				          pagesizeReturn = Integer.valueOf(pagesizetemp).intValue();
				        }
				    }
				    Object orderreq = (Object) reqParams.get("order");
					if (orderreq != null) {
						JSONArray order = (JSONArray)orderreq;
						orderListReturn = new ArrayList<OrderVO>();
						for(int i=0;i<order.size();i++){
							JSONObject obj = order.getJSONObject(i);
							OrderVO orderVO = new OrderVO();
							orderVO.setName((String)obj.get("column"));
							orderVO.setOrderType((String)obj.get("type"));
							orderListReturn.add(orderVO);
						}						
					}
				}
			} else if ("DEL_MED_NOTICE_INFO_REQUEST".equals(command)) {
				actionReturn = "del";
				if(true){
					if(contentreq!=null){
						idReturn = (Integer)contentreq.get("id");	
						    																												String delMedPlan = (String)contentreq.get("delMedPlan");
							if("true".equals(delMedPlan)){
								delMedPlanReturn = true;
							}
																																	}	
				}
			} else if ("DEL_MED_NOTICE_LIST_REQUEST".equals(command)) {
				actionReturn = "delList";
				if(true){
					if(contentreq!=null){
						queryMapReturn = new HashMap<String, Object>();
																		Integer id_gt = (Integer)contentreq.get("id_gt");
						Integer id_ge = (Integer)contentreq.get("id_ge");
						Integer id_lt = (Integer)contentreq.get("id_lt");
						Integer id_le = (Integer)contentreq.get("id_le");
						String id_in = (String)contentreq.get("id_in");
						Integer id = (Integer)contentreq.get("id");
                        if(id_gt!=null){
                        	queryMapReturn.put("id_gt", id_gt);
						}
						if(id_ge!=null){
                        	queryMapReturn.put("id_ge", id_ge);
						}
						if(id_lt!=null){
                        	queryMapReturn.put("id_lt", id_lt);
						}
						if(id_le!=null){
                        	queryMapReturn.put("id_le", id_le);
						}
						if(id_in!=null){
                        	queryMapReturn.put("id_in", id_in);
						}
						if(id!=null){
                        	queryMapReturn.put("id", id);
						}		
																																String noticeTime_gt = (String)contentreq.get("noticeTime_gt");
							String noticeTime_ge = (String)contentreq.get("noticeTime_ge");
							String noticeTime_lt = (String)contentreq.get("noticeTime_lt");
							String noticeTime_le = (String)contentreq.get("noticeTime_le");
	                        if(noticeTime_gt!=null){
	                        	queryMapReturn.put("noticeTime_gt", noticeTime_gt);
							}
							if(noticeTime_ge!=null){
	                        	queryMapReturn.put("noticeTime_ge", noticeTime_ge);
							}
							if(noticeTime_lt!=null){
	                        	queryMapReturn.put("noticeTime_lt", noticeTime_lt);
							}
							if(noticeTime_le!=null){
	                        	queryMapReturn.put("noticeTime_le", noticeTime_le);
							} 
																																							String noticeContent_like = (String)contentreq.get("noticeContent_like");
							String noticeContent_isNull = (String)contentreq.get("noticeContent_isNull");
							String noticeContent_isNotNull = (String)contentreq.get("noticeContent_isNotNull");
							String noticeContent_in = (String)contentreq.get("noticeContent_in");
							String noticeContent = (String)contentreq.get("noticeContent");
							if(noticeContent_like!=null){
	                        	queryMapReturn.put("noticeContent_like", noticeContent_like);
							}
							if(noticeContent_isNull!=null){
	                        	queryMapReturn.put("noticeContent_isNull", noticeContent_isNull);
							}
							if(noticeContent_isNotNull!=null){
	                        	queryMapReturn.put("noticeContent_isNotNull", noticeContent_isNotNull);
							}
							if(noticeContent_in!=null){
	                        	queryMapReturn.put("noticeContent_in", noticeContent_in);
							}
							if(noticeContent!=null){
	                        	queryMapReturn.put("noticeContent", noticeContent);
							}						           
																															Integer medPlanId_gt = (Integer)contentreq.get("medPlanId_gt");
						Integer medPlanId_ge = (Integer)contentreq.get("medPlanId_ge");
						Integer medPlanId_lt = (Integer)contentreq.get("medPlanId_lt");
						Integer medPlanId_le = (Integer)contentreq.get("medPlanId_le");
						String medPlanId_in = (String)contentreq.get("medPlanId_in");
						Integer medPlanId = (Integer)contentreq.get("medPlanId");
                        if(medPlanId_gt!=null){
                        	queryMapReturn.put("medPlanId_gt", medPlanId_gt);
						}
						if(medPlanId_ge!=null){
                        	queryMapReturn.put("medPlanId_ge", medPlanId_ge);
						}
						if(medPlanId_lt!=null){
                        	queryMapReturn.put("medPlanId_lt", medPlanId_lt);
						}
						if(medPlanId_le!=null){
                        	queryMapReturn.put("medPlanId_le", medPlanId_le);
						}
						if(medPlanId_in!=null){
                        	queryMapReturn.put("medPlanId_in", medPlanId_in);
						}
						if(medPlanId!=null){
                        	queryMapReturn.put("medPlanId", medPlanId);
						}		
																		
																														String delMedPlan = (String)contentreq.get("delMedPlan");
						if("true".equals(delMedPlan)){
							delMedPlanReturn = true;
						}
																													}
					JSONObject pagereq = (JSONObject)reqParams.get("page");
				    if (pagereq != null) {
				    String pagenotemp = (String)pagereq.get("pageno");
				    String pagesizetemp = (String)pagereq.get("pagesize");
				    if ((pagenotemp != null) && (!"".equals(pagenotemp.trim()))) {
				          pagenoReturn = Integer.valueOf(pagenotemp).intValue();
				    }
				    if ((pagesizetemp != null) && (!"".equals(pagesizetemp.trim()))) {
				          pagesizeReturn = Integer.valueOf(pagesizetemp).intValue();
				        }
				    }
				}
			}

			if (actionReturn != null && !"".equals(actionReturn)) {
				parseMap.put("action", actionReturn);
			}
			if (medNoticeReturn != null) {
				parseMap.put("medNotice", medNoticeReturn);
			}
			if (medNoticeListReturn != null && medNoticeListReturn.size() > 0) {
				parseMap.put("medNoticeList", medNoticeListReturn);
			}
			if (idReturn != null) {
				parseMap.put("id", idReturn);
			}	
			if (orderListReturn != null && orderListReturn.size() > 0) {
				parseMap.put("orderList", orderListReturn);
			}		
			if (queryMapReturn != null) {
				parseMap.put("queryMap", queryMapReturn);
			}
			if (pagenoReturn > 0) {
				parseMap.put("pageno", pagenoReturn);
			}
			if (pagesizeReturn > 0) {
				parseMap.put("pagesize", pagesizeReturn);
			}
			
			
															if (medPlanShowReturn != null) {
				parseMap.put("medPlanShow", medPlanShowReturn);
			}
			if (delMedPlanReturn != null) {
				parseMap.put("delMedPlan", delMedPlanReturn);
			}
															
			
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			logger.error(e);
		}
		return parseMap;
	}

	private Map<String, Object> parseByXml(String command,String reqStr,
			HttpServletRequest request) {
		// TODO Auto-generated method stub
		return null;
	}
}
