<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="images/logo.png">

    <title>充值/消费明细</title>
  
    <!-- Bootstrap core CSS -->
    <link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
	    <link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

  <link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
	<link rel="stylesheet" type="text/css" href="js/intro.js/introjs.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <style type="text/css">
      .timeTip{width:220px;height:80px;background:#f3f9ff;border:2px solid #dadada;z-index:10;}
      .timeTip div{margin:20px 30px}
      .hideAndShow{display:none;}
      
 .hideul{position:absolute;top:33px;z-index:200;right:15px;left:15px;display:none}
.hideul ul{ border:1px solid #ccc;width:100%;background:#f4f4f4;padding-left:0}
.hideul ul li{ list-style-type:none;text-indent:20px}
.hideul ul li:hover{ background:#ddd}
  </style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>
<body style="opacity: 1; margin-left: 0px;">
	<div style="width: 100%; height: 100%;">
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2>充值/消费明细</h2>
				<ol class="breadcrumb">
					<li>内部管理</li>
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
					<li class="active">充值/消费明细</li>
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->

		<div class="cl-mcont">
			<div class="row">
				<div class="col-md-12">
					<div class="block-flat">
						<div class="content">
							<div class="table-responsive">
								<div class="dataTables_wrapper form-inline">
								    <!-- 查询框开始 -->
									<div class="row">
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>老人</label>
										</div>
										<div class="col-sm-4" style="margin-bottom:10px;">
											<div class="input-group " >
												<input class="form-control"  type="text" id="older" oninput="getOlderName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
												<input type="hidden" type="text" id="olderId" value="0">
												<span class="input-group-btn"><button class="btn btn-primary"  onclick="getOlderName()" type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
												<ul id="hideul_nei1">
				
												</ul>
											</div>
										</div>
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>流水号</label>
										</div>
										
										<div class="col-sm-4 "  style="margin-bottom:10px;">
											<input class="form-control" type="text" style="width: 100%" id="serialNumber">
										</div>
										<div class="col-sm-12" style="padding:0px">
											<div class="col-sm-2  col-md-2" style="vertical-align: middle; height: 34px; line-height: 34px;">
												<label>金额区间</label>
											</div>
											<div class="col-sm-2 "  style="margin-bottom:10px;">
												<input class="form-control" type="text" style="width: 100%" id="minMoney" placeholder="最小金额" onpaste="return false;" onkeypress="keyPress()">
											</div>
											<div class="col-sm-2 "  style="margin-bottom:10px;">
												<input class="form-control" type="text" style="width: 100%" id="maxMoney" placeholder="最大金额" onpaste="return false;" onkeypress="keyPress()">
											</div>
											<div class="col-sm-2  col-md-2" style="vertical-align: middle; height: 34px; line-height: 34px;">
											<label>时间区间</label>
											</div>
											<div class="col-sm-2 col-md-2" style="margin-bottom:10px;">
												<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
													<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
													<input class="form-control" size="16" value="" readonly="" type="text" id="time_input_start" placeholder="开始时间">
													<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
												</div>
											</div>
											<div class="col-sm-2 col-md-2" style="margin-bottom:10px;">
												<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
													<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
													<input class="form-control" size="16" value="" readonly="" type="text" id="time_input_end" placeholder="结束时间">
													<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
												</div>
											</div>
										</div>
										
										<div class="col-sm-2   " style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>关联项目</label>
										</div>
										<div class="col-sm-4" style="margin-bottom:10px;">
											<div class="input-group " >
												<input class="form-control"  type="text" id="relevanceProject" oninput="getglxmName()" onmouseout="javascript:$('#hideul-2').hide();" onmouseover="javascript:$('#hideul-2').show();">
												<input type="hidden" type="text" id="relevanceProjectId" value="0">
												<span class="input-group-btn"><button class="btn btn-primary "  onclick="getglxmName()" type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-2"  onmouseover="javascript:$('#hideul-2').show();" onmouseout="javascript:$('#hideul-2').hide();">
												<ul id="hideul_nei2">
				
												</ul>
											</div>
										</div>
										<div class="col-sm-2   " style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>服务站点</label>
										</div>
										<div class="col-sm-4" style="margin-bottom:10px;">
											<div class="input-group " >
												<input class="form-control"  type="text" id="serviceSite" oninput="getfwzdName()" onmouseout="javascript:$('#hideul-3').hide();" onmouseover="javascript:$('#hideul-3').show();">
												<input type="hidden" type="text" id="serviceSiteId" value="0">
												<span class="input-group-btn"><button class="btn btn-primary "  onclick="getfwzdName()"  type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-3"  onmouseover="javascript:$('#hideul-3').show();" onmouseout="javascript:$('#hideul-3').hide();">
												<ul id="hideul_nei3">
				
												</ul>
											</div>
										</div>	
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>充值/消费类别</label>
										</div>
										<div class="col-sm-4 "  style="margin-bottom:10px;">
											<select id="type" class="form-control" style="width:100%">
              									<option value="" selected="selected"></option>
              									<option value="1">充值</option>
              									<option value="2">消费</option>
            								</select>
										</div>
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>方式</label>
										</div>
										<div class="col-sm-4 "  style="margin-bottom:10px;">
											<select id="way" class="form-control" style="width:100%">
             									<option value="" selected="selected"></option>
              									<option value="1">自动扣款</option>
              									<option value="2">前台扣款</option>
             									<option value="3">微信充值</option>
              									<option value="4">前台充值</option>
              									<option value="5">其他充值</option>
              									<option value="6">其他扣款</option>
            								</select>
										</div>						
									</div>
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									<div class="row">
										<div class="col-sm-12">
											
										    <c:if test="${recharge_query_btn_control != 'yes' or recharge_query_btn_show == 'yes'}">
												<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query()">查询</button>
										    </c:if>
											<c:if test="${recharge_daochu_btn_control != 'yes' or recharge_daochu_btn_show == 'yes'}">
											<button type="button" id="daochuanniu" class="btn btn-primary btn-flat  md-trigger" style="display:none;" data-modal="Export-daochu">
											<button type="button" class="btn btn-primary btn-flat" style="float: right;"  onclick="exportxls();">
                        						<span><i class="fa fa-upload" style="margin-right:5px;"></i>导出</span>
                     						</button>
                     						<form action="recharge.do?exportxls"  method="post" style="display:none;">  <!-- 导出功能 form不可见 -->
	                    						<input type="text" name="olderId" value="" id="">
	                    						<input type="text" name="serialNumber" value="" id="">
	                    						<input type="text" name="type" value="" id="">
	                    						<input type="text" name="minMoney" value="" id="">
	                    						<input type="text" name="maxMoney" value="" id="">
	                    						<input type="text" name="time_input_start" value="" id="">
	                    						<input type="text" name="time_input_end" value="" id="">
	                    						<input type="text" name="relevanceProjectId" value="" id="">
	                    						<input type="text" name="serviceSiteId" value="" id="">
	                    						<input type="text" name="way" value="" id="">
	                    						<input type="submit" value="Submit" id="SubmitButton" />
                    						</form>
                     						</c:if>
										</div>
									</div>
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
									<div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serialNumber')"><strong>流水号</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_olderName')"><strong>老人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'type')"><strong>类型</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'amount')"><strong>金额</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serviceTaskCode')"><strong>关联工单</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_serviceSiteName')"><strong>服务站点</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_rechargeEmployeeName')"><strong>充值人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'rechargeMethod')"><strong>方式</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'createTime')"><strong>时间</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 -->
								    <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="datatable2_length">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector" class="form-control" aria-controls="datatable2" size="1" name="datatable2_length" onchange="query()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
							</div>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</div>
	
	<!-- Nifty Modal -->

		<div class="md-modal md-effect-1" id="Import-confi" >  <!-- 导入配置模态框 -->
				<div class="md-content">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>导入配置</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					<div style="margin-bottom:25px;margin-top:15px;text-align:center">
                 <button type="button" class="btn btn-default btn-lg">
                  		输入excel文件，导入员工信息
                  </button>
                  </div>
				</div>  
			</div> <!-- 导入配置 结束-->
			
		<div class="md-modal md-effect-1" id="Export-daochu" >  <!-- 导出提示框  开始-->
				<div class="md-content">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>正在导出，请稍后...</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                  </div>
		</div> <!-- 导出 结束-->
	
	<div class="md-overlay"></div> <!-- Nifty Modal的遮罩层-->
	
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
<script type="text/javascript" src="js/behaviour/general.js"></script>
<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
<script src="js/skycons/skycons.js" type="text/javascript"></script>
<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
<script src="js/intro.js/intro.js" type="text/javascript"></script> 
<script src="js/behaviour/voice-commands.js"></script>
<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
<script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page(currentshownpage);
}

		//只能输入数字0-9
        function keyPress(event) {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        } 
        
	var currentshownpage = 1;
      
	$(document).ready(function(){
		query();
		$(".deleteThisTime").click(function(){               //清除日期框中的值
 	       $(this).parent().prev()[0].value = "";
 		});
    	App.init();
    	$(".md-trigger").modalEffects();
	
	});


function query() {
	go2page(1);
}


	function go2page(pagenumber){
		var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
		
		var olderId = $("#olderId").val();
		var older = $("#older").val();
		if(older == null || older == ""){
			olderId = "0";
			$("#olderId").val("0");
		}
		
		var pagesize = $("#pageSizeSelector option:selected").val();
		var serialNumber = $("#serialNumber").val();//流水号
		var type = $("#type").val();//消费充值类型
		var minMoney = $("#minMoney").val();//最小金额
		if(minMoney != null && minMoney != ""){
			if(!reg1.test(minMoney)){ 
				alert("最小金额为整数");
	        	return;  
			}
		}
		var maxMoney = $("#maxMoney").val();//最大金额
		if(maxMoney != null && maxMoney != ""){
			if(!reg1.test(maxMoney)){ 
				alert("最大金额为整数");
	        	return;  
			}
		}
		if(minMoney != null && minMoney != "" && maxMoney != null && maxMoney != ""){
			if(parseInt(minMoney) > parseInt(maxMoney)){
				alert("最小金额不能大于最大金额");
	        	return; 
			}
		}
		var time_input_start = $("#time_input_start").val();//开始时间
		var time_input_end = $("#time_input_end").val();//结束时间
		if (time_input_start != null && time_input_start != "") {
	   		time_input_start = time_input_start.substring(0, 4) + time_input_start.substring(5, 7) + time_input_start.substring(8, 10) + "000001";
		}
		if (time_input_end != null && time_input_end != "") {
			time_input_end = time_input_end.substring(0, 4) + time_input_end.substring(5, 7) + time_input_end.substring(8, 10) + "235959";
		}
		if (time_input_start != null && time_input_start != "" && time_input_end != null && time_input_end != "") {
			if(time_input_start > time_input_end){
				alert("开始时间不能大于结束时间");
				return;
			}
		}
		
		var relevanceProjectId = $("#relevanceProjectId").val();
		var relevanceProject = $("#relevanceProject").val();
		if(relevanceProject == null || relevanceProject == ""){
			relevanceProjectId = "0";
			$("#relevanceProjectId").val("0");
		}
		
		var serviceSiteId = $("#serviceSiteId").val();
		var serviceSite = $("#serviceSite").val();
		if(serviceSite == null || serviceSite == ""){
			serviceSiteId = "0";
			$("#serviceSiteId").val("0");
		}
		var way = $("#way").val();//方式
		
		
		var reqmsg = "{\"action\":\"QUERY_RECHARGE_LIST_REQUEST\",";
		
		var sortType = $("#sortType").val();
		var sortColumn = $("#sortColumn").val();
		if(sortType != null && sortType != ""){
			reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
		}
		
		reqmsg += "\"page\":{\"pageno\":\"" + pagenumber + "\",\"pagesize\":\"" + pagesize + "\"},\"content\":{";
		
		if (olderId != null && olderId != "" && olderId != "0") {
			reqmsg += "\"olderId\":" + olderId + ",";
		}
		if (serialNumber != null && serialNumber != "") {
			reqmsg += "\"serialNumber_like\":\"" + serialNumber + "\",";
		}
		if (type != null && type != "") {
			reqmsg += "\"type\":" + type + ",";
		}
		if (minMoney != null && minMoney != "") {
			reqmsg += "\"amount_ge\":" + minMoney + ",";
		}
		if (maxMoney != null && maxMoney != "") {
			reqmsg += "\"amount_le\":" + maxMoney + ",";
		}
		if (time_input_start != null && time_input_start != "") {
			reqmsg += "\"createTime_ge\":\"" + time_input_start + "\",";
		}
		if (time_input_end != null && time_input_end != "") {
			reqmsg += "\"createTime_le\":\"" + time_input_end + "\",";
		}
		
		if (relevanceProjectId != null && relevanceProjectId != "" && relevanceProjectId != "0") {
			reqmsg += "\"serviceId\":" + relevanceProjectId + ",";
		}
		if (serviceSiteId != null && serviceSiteId != "" && serviceSiteId != "0") {
			reqmsg += "\"serviceSiteId\":" + serviceSiteId + ",";
		}
		if (way != null && way != "") {
			reqmsg += "\"rechargeMethod\":" + way + ",";
		}
		
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:true,
	          url : "recharge.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  changeData(data);
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}

function changeData(data){
		var htmlCode = "";
		if (data.content != null) {
			if(data.content.rechargeList != null){
					jQuery.each(data.content.rechargeList, function(i, item) {
						htmlCode += "<tr>";	
						htmlCode += "<td>" + item.serialNumber + "</td>";	
						htmlCode += "<td>" + item.olderName + " " + item.olderMemberNum + "</td>";	
						htmlCode += "<td>" + changeType(item.type) + "</td>";
						htmlCode += "<td>" + item.amount + "</td>";	
						htmlCode += "<td>" + item.serviceTaskCode + " " + item.serviceName + "</td>";	
						htmlCode += "<td>" + item.serviceSiteName + "</td>";	
						htmlCode += "<td>" + item.rechargeEmployeeName + " " + item.rechargeEmployeeIndexNum + "</td>";	
						htmlCode += "<td>" + chongzhiWay(item.rechargeMethod)+ "</td>";	
						htmlCode += "<td>" + formateTime(item.createTime) + "</td>";
						htmlCode += "</tr>";
					});
			}
		}
		$("#datacontainer").html(htmlCode);
		if (data.page != null) {
			genaratePaginateHtml(data.page.pageno, data.page.pageCount);
			genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
				
		} else {
			genaratePaginateHtml(1, 1);
			genarateRecordNumberHtml(1, 10, 0);
				
		}
	}

/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8);
	} else {
		return time;
	}
}


/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";	
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}

//类型
function changeType(type){
	var typeName = "";
	switch(type){
		case 1:
			typeName = "充值";
			break;
			
		case 2:
			typeName = "消费";
			break;
		
		default:
			typeName = "未知";
			break;
	}
	return typeName;
}

//充值扣款方式
function chongzhiWay(rechargeMethod){
		var name = "未知";
     	switch (rechargeMethod)
		{
			case 1:
  			name = "自动扣款";
  			break;
  			
			case 2:
  			name = "前台扣款";
  			break;
  			
  			case 3:
  			name = "微信充值";
  			break;
  			
  			case 4:
  			name = "前台充值";
  			break;
  			
  			case 5:
  			name = "其他充值";
  			break;
  			
  			case 6:
  			name = "其他扣款";
  			break;
  			
  			default:
  			break;
		}
		return name;
}

	//实时获取老人姓名
	function getOlderName(){
		var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
		var name = $.trim($("#older").val());
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\"";
		}else{
			$("#hideul_nei1").html("");
			$("#hideul-1").hide();
			return;
		}
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "older.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.olderList != null){
	            	  		jQuery.each(data.content.olderList, function(i, item) {
	            	  			if(item != null){
			    					htmlcode += "<li onclick=\"olderNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "</li>";
	            	  			}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei1").html(htmlcode);
			    	  $("#hideul-1").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	//老人姓名赋值
	function olderNamefuzhi(name,id){
		$("#older").val(name);
		$("#olderId").val(id);
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
	}
	
	
	//实时获取关联项目名
	function getglxmName(){
		var reqmsg = "{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
		reqmsg += "\"deleted\":0,";
		var name = $("#relevanceProject").val();
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\"";
		}else{
			$("#hideul_nei2").html("");
			$("#hideul-2").hide();
			return;
		}
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "service.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.serviceList != null){
	            	  		jQuery.each(data.content.serviceList, function(i, item) {
	            	  			if(item != null){
			    					htmlcode += "<li onclick=\"glxmNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "</li>";	
	            	  			}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei2").html(htmlcode);
			    	  $("#hideul-2").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	//关联项目名赋值
	function glxmNamefuzhi(name,id){
		$("#relevanceProject").val(name);
		$("#relevanceProjectId").val(id);
		$("#hideul_nei2").html("");
		$("#hideul-2").hide();
	}
	
	
	//实时获取服务站点名
	function getfwzdName(){
		var reqmsg = "{\"action\":\"QUERY_SITE_LIST_REQUEST\",\"page\":{\"pageno\":\"1\",\"pagesize\":\"5\"},\"content\":{";
		var name = $.trim($("#serviceSite").val());
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\",";
		}else{
			$("#hideul_nei3").html("");
			$("#hideul-3").hide();
			return;
		}
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "site.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.siteList != null){
	            	  		jQuery.each(data.content.siteList, function(i, item) {
	            	  			if(item != null){
			    					htmlcode += "<li onclick=\"fwzdNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "</li>";	
	            	  			}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei3").html(htmlcode);
			    	  $("#hideul-3").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	//服务站点名赋值
	function fwzdNamefuzhi(name,id){
		$("#serviceSite").val(name);
		$("#serviceSiteId").val(id);
		$("#hideul_nei3").html("");
		$("#hideul-3").hide();
	}




//导出
function exportxls(){
	if (confirm("是否确认导出?"))  { 
	
	var olderId = $("#olderId").val();//姓名
	var older = $("#older").val();
	if(older == null || older == ""){
		olderId = "0";
		$("#olderId").val("0");
	}
	
	var serialNumber = $("#serialNumber").val();//流水号
	var type = $("#type").val();//消费充值类型
	var minMoney = $("#minMoney").val();//最小金额
	var maxMoney = $("#maxMoney").val();//最大金额
	var time_input_start = $("#time_input_start").val();//开始时间
	var time_input_end = $("#time_input_end").val();//结束时间
	
	var relevanceProjectId = $("#relevanceProjectId").val();//服务项目
	var relevanceProject = $("#relevanceProject").val();
	if(relevanceProject == null || relevanceProject == ""){
		relevanceProjectId = "0";
		$("#relevanceProjectId").val("0");
	}
	
	var serviceSiteId = $("#serviceSiteId").val();//服务站点
	var serviceSite = $("#serviceSite").val();
	if(serviceSite == null || serviceSite == ""){
		serviceSiteId = "0";
		$("#serviceSiteId").val("0");
	}
	
	var way = $("#way").val();//方式
	
	if (time_input_start != null && time_input_start != "") {
	   	time_input_start = time_input_start.substring(0, 4) + time_input_start.substring(5, 7) + time_input_start.substring(8, 10) + "000001";
	}
	if (time_input_end != null && time_input_end != "") {
		time_input_end = time_input_end.substring(0, 4) + time_input_end.substring(5, 7) + time_input_end.substring(8, 10) + "235959";
	}
		
	$("[name=olderId]").val(olderId);
	$("[name=serialNumber]").val(serialNumber);
	$("[name=type]").val(type);
	$("[name=minMoney]").val(minMoney);
	$("[name=maxMoney]").val(maxMoney);
	$("[name=time_input_start]").val(time_input_start);
	$("[name=time_input_end]").val(time_input_end);
	$("[name=relevanceProjectId]").val(relevanceProjectId);
	$("[name=serviceSiteId]").val(serviceSiteId);
	$("[name=way]").val(way);
	$("#SubmitButton").click();
	$("#daochuanniu").click();
   	}
}
</script>
  </body>
</html>