package fsk.socket.ECGStick;

import java.net.ServerSocket;
import java.net.Socket;
import java.text.SimpleDateFormat;
import java.util.Date;
import fsk.init.SystemInit;

import org.apache.log4j.Logger;

/*
 * 云心电贴数据监听
 */
public class ECGStickTCPListener extends Thread {
	private static Logger logger = Logger.getLogger(ECGStickTCPListener.class);
	public static final int SERVERPORT = 8350;
	private SimpleDateFormat formater1 = new SimpleDateFormat(
			"yyyy-MM-dd HH:mm:ss");

	public void run() {
		try {
			logger.debug("云心电贴数据信息监听：开始监听...");
			ServerSocket serverSocket = new ServerSocket(8350);
			while (true) {
				Socket client = serverSocket.accept();
				client.setSoTimeout(1000 * 60); /* 这里设置 read() 函数的超时时间 */
				Date datestart = new Date();
				logger.debug(this.formater1.format(datestart)
						+ "ECGStick data:");
				try {
					// ECGStickDoHandlerThread jtwgDoHandlerThread = new
					// ECGStickDoHandlerThread(client.getInputStream(),
					// client.getOutputStream(), this.systemService);
					// ECGStickDoHandlerThread.start();
					SystemInit.cachedThreadPool
							.execute(new ECGStickDoHandlerThread(client
									.getInputStream(), client.getOutputStream()));
				} catch (Exception e) {
					logger.error(e.toString());
					e.printStackTrace();
					if (client != null) {
						client.close();
						client = null;
					}
				}
			}
		} catch (Exception e) {
			logger.error(e.toString());
			e.printStackTrace();
		}
	}
}
