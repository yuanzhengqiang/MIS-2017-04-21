<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ page import="fsk.init.SystemInit" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%
	String nickname = (String) session.getAttribute("nickname");
	if (nickname == null) {
		nickname = "";
	}
	String photourlMR = SystemInit.photourl;
	String header = SystemInit.header;
	String headerImage = SystemInit.headerImage;
%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>新增员工</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  <link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  <link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
<style>
.accordion .panel,.accordion .panel:first-child{border-top:1px solid #ECECEC;border-bottom:1px solid #ECECEC;}
.checkbox-inline{padding-left:0;padding-right:30px;}
 .checkbox-inline + .checkbox-inline{margin-left:0;}
 
.hideul{position:absolute;top:33px;z-index:200;right:15px;left:15px;display:none}
.hideul ul{ border:1px solid #ccc;width:100%;background:#f4f4f4;padding-left:0}
.hideul ul li{ list-style-type:none;text-indent:20px}
.hideul ul li:hover{ background:#ddd}
</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>

<!-- 上侧栏开始 -->
    <div id="head-nav" class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="fa fa-gear"></span>
          </button>
          <a class="navbar-brand" href="#"  style="width:auto;background: url(images/<%=headerImage %>) no-repeat 0 10px;"><span><%=header %>/新增员工</span></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right user-nav">
            <li class="dropdown profile_menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="images/avatar2.jpg"/>
                <span id="accountNickname"><%=nickname %></span>
<!--                 <b class="caret"></b> -->
              </a>
<!--               <ul class="dropdown-menu"> -->
<!--                 <li><a href="#" class="md-trigger" data-modal="md-scale3">密码修改</a></li> -->
<!--                 <li class="divider"></li> -->
<!--                 <li><a href="systemLogin.do?logout">退出登录</a></li> -->
<!--               </ul> -->
            </li>
          </ul>
        </div><!--/.nav-collapse animate-collapse -->
      </div>
    </div>  <!-- 上侧栏结束 -->

	
<div id="cl-wrapper" style="padding-top:0">	
<div class="container-fluid" id="pcont">
	<div class="cl-mcont">

    
    <div class="row">
      <div class="col-sm-12">
        <div class="tab-container" >

          <div class="tab-content" >
            <div id="olderBasicInfo" class="tab-pane  cont active" ><!-- 基本信息开始 -->
				
					<div class="panel-group accordion accordion-semi" id="accordion1-1" style="margin-top:20px;">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a data-toggle="collapse" data-parent="#accordion1-1" href="#ac1-1">
								<i class="fa fa-angle-right"></i>基本信息
							</a>
						  </h4>
						</div>
						<div id="ac1-1" class="panel-collapse collapse in">
						  <div class="panel-body form-horizontal">
								 <div class="form-group">
								 
								 	<form style="display:none;" id="image_submit" action="position.do?pic2" method="post"  enctype="multipart/form-data">
               							<input type="hidden" name="srcPath" id="srcPath" value="" />
               							<input type="hidden" name="type" id="type" value="employeePhoto_" />
  										<input type="hidden" name="x1" id="x1" value="0" />
  										<input type="hidden" name="y1" id="y1" value="0" />
  										<input type="hidden" name="x2" id="x2" value="0" />
  										<input type="hidden" name="y2" id="y2" value="0" />
		 							</form>  
								 	<input type="hidden" id="hide_employeeTupian" value="" /> 
								 	<button type="button" class="btn btn-primary btn-flat" style="display:none;" id="sure_SC" onclick="uploadPic_cut()">确定</button> 
								 	<input id="quedintupian" style="display:none;" type="button" value="确定" onclick="uploadPic()">
								 	
									<label class="col-sm-2 control-label" for="nick">上传头像</label>
									<div class="col-sm-10"> 
									  <div class="avatar-upload">
										<img src="photos/av.jpg" id="touxiangId" style="height:150px;width:150px" class="profile-avatar img-thumbnail"/>
										<form id="picuploadform1" class="secondcol" action="position.do?pic1" method="post" enctype="multipart/form-data">
                							<input id="pic4upload1" name="pic4upload" type="file" onchange="javascript:$('#quedintupian').click()" accept="image/*">
             				 			</form>
									  </div>
									</div>
								 </div>
		 						
								<div class="form-group">
								  <label class="col-sm-2 control-label">姓名<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="name_input" >
								  </div>
								  <label  class="col-sm-2 control-label">性别</label>
								  <div class="col-sm-4">
									<select class="form-control" id="gender_input"><option value="男">男</option><option value="女">女</option></select>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">身份证号<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="idNumber_input" >
								  </div>
								  <label  class="col-sm-2 control-label">联系方式<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="telephone_input" >
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">出生日期</label>
								  <div class="col-sm-4">
									<div class="input-group " style="margin-bottom:0;">
										<input class="form-control datetime " size="16" type="text" id="birthday_input" value="" data-date-format="yyyy-mm-dd" data-min-view="2"  placeholder="日期格式：yyyy-mm-dd"  >
										<span class="input-group-addon btn btn-primary" ><span class="glyphicon glyphicon-th"></span></span>
									</div>
								  </div>
								  <label class="col-sm-2 control-label">账号名<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="zhanghaoId_input" >
								  </div>
								</div>
								<!-- <div class="form-group">
								  <label class="col-sm-2 control-label">员工编号<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="yuangongBH_input" >
								  </div>
								</div> -->
						  </div>
						</div>
					  </div>
					</div>	
					<div class="panel-group accordion accordion-semi" id="accordion1-2" >
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a class="" data-toggle="collapse" data-parent="#accordion1-2" href="#ac1-2">
							  <i class="fa fa-angle-right"></i>服务信息
							</a>
						  </h4>
						</div>
						<div id="ac1-2" class="panel-collapse collapse in">
						  <div class="panel-body">
							  <form class="form-horizontal" >
								<div class="form-group">
								  <label class="col-sm-2 control-label">角色<span style="color:red">*</span></label>
								  <div class="col-sm-2 control-label" style="text-align:left" id="juese_input">
																
								  </div>
								  <div class="col-sm-2" style="text-align:right" onclick="xiugaijuese()">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editRole" value="修改">
								  </div>
								  <label  class="col-sm-2 control-label">员工职称</label>
								  <div class="col-sm-2" id="ygzc_input">
									
								  </div>
								  <div class="col-sm-2" style="text-align:right">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editZhicheng" value="修改">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">组长</label>
								  <div class="col-sm-4">
									<div class="input-group " >
										<input type="hidden" id="zuzhanginputId_search" value="0">
										<input class="form-control"  type="text" id="zuzhanginput_search" onclick="getzuzhangName()" oninput="getzuzhangName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
										<ul id="hideul_nei1">
							
										</ul>
									</div>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">员工星级</label>
								  <div class="col-sm-4">
									<select class="form-control" id="yuangongxj_input">
									<option value=""></option>
									<option value="1">一星</option>
									<option value="2">二星</option>
									<option value="3">三星</option>
									<option value="4">四星</option>
									<option value="5">五星</option>
									</select>
								  </div>
								  <label class="col-sm-2 control-label">所属站点</label>
								  <div class="col-sm-2 control-label" style="text-align:left" id="sszhandian_input">
																
								  </div>
								  <div class="col-sm-2" style="text-align:right" onclick="xiugaisite()">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editSite" value="修改">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">所属部门1</label>
								  <div class="col-sm-4">
									<select class="form-control" id="ssbumen_input">
									
									</select>
								  </div>
								  <label class="col-sm-2 control-label">所属部门2</label>
								  <div class="col-sm-4">
									<select class="form-control" id="ssbumen_input2">
									
									</select>
								  </div>
								</div>
							</form>
						  </div>
						</div>
					  </div>
					</div>
					<div class="panel-group accordion accordion-semi" id="accordion1-3" >
					
					<div class="row"><div class="col-sm-12" style=
					"text-align:center;"><button class="btn btn-flat btn-rad  btn-success md-trigger" data-modal="saveAllBasicHeal" onclick="saveAdd()">保存</button></div></div>
			
        			</div>    
        

      </div>
      

    </div>

	</div>
	
</div> 
	
</div> <!-- 主页面结束 -->
                <!-- 模态框开始：可服务项目 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="Emergency-contact">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>可服务项目添加或修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        <div class="form-group">
                          <label>名称</label> <input type="text" class="form-control" >
                        </div>
                        <div class="form-group">
                          <label>地点</label> <input type="text" class="form-control" >
                        </div>
						<div class="form-group">
                          <label>时间</label> <input type="text" class="form-control" >
                        </div> 
						<div class="form-group">
                          <label>价格</label> <input type="text" class="form-control" >
                        </div>  						
						</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
				 <!-- 角色修改 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="editRole">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>员工角色修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					   <div class="modal-body form">
                      <form class="form-horizontal" >
							<div class="form-group" style="margin-left:20px;margin-right:20px;">									
									<div class="col-sm-12" id="guanlian-juesechoose">
									<!-- （多选:站长、值班人员、护理员、医师、管理员等 -->
<!-- 									  <label class="checkbox-inline" > <input type="checkbox" name="rad15" checked="" class="icheck"  >&nbsp;站长</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck"  >&nbsp;值班人员</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck"  >&nbsp;护理员</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;医师</label> -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;管理员</label> -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;其他</label>  -->
									</div>
							</div> 
<!-- 							<div class="form-group" style="margin-left:5px;"> -->
<!--                           		<label>其他</label> <input type="text" class="form-control" > -->
<!--                         	</div>							 -->
						</form></div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="savejuese()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
                
                 <!-- 所属站点修改 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="editSite">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>所属站点修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					   <div class="modal-body form">
                      <form class="form-horizontal" >
							<div class="form-group" style="margin-left:20px;margin-right:20px;">									
									<div class="col-sm-12" id="guanlian-sitechoose">
									
									</div>
							</div> 
						</form></div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="saveSite()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>


  				<!-- 编辑职称-->
                <div class="md-modal colored-header md-effect-9" style="width:60%;max-width:60%" id="editZhicheng">
                    <div class="md-content">
                      <div class="modal-header">
                        <h4 style="display:inline;">编辑职称</h4>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        				
							<table class=" table-bordered  mytable" >
								<thead>
								     <tr>
										<th style="border-right:0">请选择:
										<select class="form-control" id="zhicheng1_input" style="width: 100%" >
										
										</select>
										</th>
										
										<th style="border-left:0;border-right:0">
										<select class="form-control" id="zhicheng2_input" style="width: 100%" >
										
										</select>
										</th>
										<th style="text-align:center"><span onclick="addNewZhiCheng()"><i class="fa fa-plus" ></i></span></th>
									</tr>
									<tr >
										<th><strong>职称名称</strong></th>
										<th><strong>职称等级</strong></th>
										<th><strong>点击撤销</strong></th>
									</tr>
								</thead>
								<tbody id="tbodyhtml" >		
								  <!-- <tr class="whitebg" > 
                                    <td style="width:25%"><input id="zhichengmc_1" style="border-style:none" readonly="readonly" type="text"></td>
                                    <td style="width:25%"><input id="zhichengmc_1" style="border-style:none" readonly="readonly" type="text"></td>                                  
                                    <td style="text-align:center;width:10%"><span onclick="$(this).parent().parent().remove();"><i class="fa fa-minus" ></i></span></td>                                    
                                  </tr>	 -->
                                  <tr class="whitebg" style="display:none;" id="qitashuoming"> 
                                    <td style="width:60%" colspan="3"></td>
                                  </tr>																												
								</tbody>
							</table>
						
					  </div>
                      <div class="modal-footer" style="padding-top:0;border:0">
                        <button type="button" class="btn btn-primary btn-flat md-close"  onclick="baocunZC()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" onclick="quxiaoZC()">取消</button>
                      </div>
                    </div>
                </div>
                
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
    function addNewZhiCheng(){ //新增一个职称行
    	var zhicheng1_input = $("#zhicheng1_input").val();
    	var zhicheng1_inputName = $("#zhicheng1_input").find("option:selected").text();
    	var zhicheng2_input = $("#zhicheng2_input").val();
    	var zhicheng2_inputName = $("#zhicheng2_input").find("option:selected").text();
    	var bodys = $("#tbodyhtml").find("tr");
    	if(bodys.length > 1){
    	    for(var i=0;i<bodys.length-1;i++){
    			if($("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(0)").find("input:eq(0)").val() == zhicheng1_input){
    				if($("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(0)").val() == zhicheng2_input){
    					alert("此条职称已添加!");
    					return;
    				}
    			}
    		}
    	}
    	var tbodyhtml = "<tr class=\"whitebg\" ><td style=\"width:25%\"><input style=\"display:none\" value=\"" + zhicheng1_input + "\" type=\"hidden\"><input style=\"border-style:none\" readonly=\"readonly\" value=\"" + zhicheng1_inputName + "\" type=\"text\"></td><td style=\"width:25%\"><input style=\"display:none\" value=\"" + zhicheng2_input + "\" type=\"hidden\"><input style=\"border-style:none\" value=\"" + zhicheng2_inputName + "\" readonly=\"readonly\" type=\"text\"></td><td style=\"text-align:center;width:10%\"><span onclick=\"$(this).parent().parent().remove();\"><i class=\"fa fa-minus\" ></i></span></td></tr>";
    	$(tbodyhtml).insertBefore("#qitashuoming"); //在其他说明前插入空的一行
    }
    
    //保存职称模态框信息到主页面
    function baocunZC(){
		var html="";
    	var bodys = $("#tbodyhtml").find("tr");
    	if(bodys.length > 1){
    		 for(var i=0;i<bodys.length-1;i++){
    			   html +="<span style=\"margin-right:10px\" id=\"zhicheng"+i+"\">"+ $("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(1)").val() +"</span><input id=\"zhichengId"+i+"\" type=\"hidden\" value=\""+$("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(0)").val()+"\">";
    		 }
    	}
    	$("#ygzc_input").html(html);
    }
    //关闭职称模态框
    function quxiaoZC(){
    	$("#tbodyhtml").html("<tr class=\"whitebg\" style=\"display:none;\" id=\"qitashuoming\"><td style=\"width:60%\" colspan=\"3\"></td></tr>");
    }
  
      //获取职称信息
      function getzhicheng1(){
        var result = new Array();
    	result = getAddresses(4921);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng1_input").html(html);
      }
      
      //获取职称信息
      function getzhicheng2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng2_input").html(html);
      }
    
    //获取部门1信息
      function getbumen1(){
        var result = new Array();
    	result = getAddresses(4945);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input").html(html);
      }
      
      //获取部门2信息
      function getbumen2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input2").html(html);
      }
    
      $(document).ready(function(){
    	var homeUrl = "<%=request.getContextPath()%>" + "/welcome.do?main";
    	$(".navbar-brand").attr("href",homeUrl);
        //initialize the javascript
        App.init(); 
        getzhicheng1();
		getzhicheng2($("#zhicheng1_input").val());
		getbumen1();
		//getbumen2(4946);
		var buxuan = "<option value=\"\"></option>";
		var bumen1 = $("#ssbumen_input").html();
		$("#ssbumen_input").html(buxuan + bumen1);
		var bumen2 = $("#ssbumen_input2").html();
		$("#ssbumen_input2").html(buxuan + bumen2);
		
		$("#zhicheng1_input").change(function(e){
        	getzhicheng2($("#zhicheng1_input").val());
    	});
    	$("#ssbumen_input").change(function(e){
    		if($("#ssbumen_input").val() == ""){
				$("#ssbumen_input2").html("<option value=\"\"></option>");
			}else{
        		getbumen2($("#ssbumen_input").val());
        	}
    	});
    	
	  });		
		
		//修改关联站点
		function xiugaisite(){
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getzhandian",
	          dataType : "json",
	          data: {
	               "zhandian":"站点"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	html=html+"<label class=\"checkbox-inline\" style=\" margin-left:20px;\"> <input type=\"checkbox\" name=\"rad16\" value=\""+name[i]+"\" class=\"icheck\" id=\""+id[i]+"\" >&nbsp;"+name[i]+"</label>";
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#guanlian-sitechoose").html(html);
		}
		//保存关联站点
		function saveSite(){
			var html="";
 			var boxes = document.getElementsByName("rad16");
 			if(boxes != null){
			for(i=0;i<boxes.length;i++){
					if(boxes[i].checked == true){
						html+="<span style=\"margin-right:10px\" id=\"site"+i+"\">"+boxes[i].value+"</span><input id=\"siteId"+i+"\" type=\"hidden\" value=\""+boxes[i].id+"\">";
					}
			}
			}
			$("#sszhandian_input").html(html);
		}
		
		//修改关联角色
		function xiugaijuese(){
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getRoleName",
	          dataType : "json",
	          data: {
	               "RoleName":"角色"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	if("老人".indexOf(name[i]) == -1){
	            	  		html=html+"<label class=\"checkbox-inline\" style=\" margin-left:20px;\"> <input type=\"checkbox\" name=\"rad15\" value=\""+name[i]+"\" class=\"icheck\" id=\""+id[i]+"\" >&nbsp;"+name[i]+"</label>";
	            	  	}
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#guanlian-juesechoose").html(html);
		}
		//保存关联角色
		function savejuese(){
			var html="";
 			var boxes = document.getElementsByName("rad15");
 			if(boxes != null){
			for(i=0;i<boxes.length;i++){
					if(boxes[i].checked == true){
						html+="<span style=\"margin-right:10px\" id=\"juse"+i+"\">"+boxes[i].value+"</span><input id=\"juseId"+i+"\" type=\"hidden\" value=\""+boxes[i].id+"\">";
					}
			}
			}
			$("#juese_input").html(html);
		}
//保存员工
function saveAdd(){
	var touxiangSrc=$("#hide_employeeTupian").val();//头像
	if(touxiangSrc == null || touxiangSrc == ""){
		touxiangSrc = "<%=photourlMR %>" + "/photos/av.jpg";
	}
	
	var name_input = $("#name_input").val();//姓名
	if($.trim(name_input) == ""){
	 	alert("姓名必填");
	 	return;
	}
	var gender_input = $("#gender_input").val();//性别
	var identityId_input = $("#idNumber_input").val();//身份证
	if($.trim(identityId_input) == ""){
	 	alert("身份证必填");
	 	return;
	}
	
	var reg = /(^\d{15}$)|(^\d{17}([0-9]|X)$)/; 
	if(!reg.test(identityId_input)){  
        alert("身份证格式错误"); 
        return; 
    }
	var telephone_input = $("#telephone_input").val();//联系方式
	var birthDay_input="";//出身年月
	if($("#birthday_input").val() != ""){
	 	birthDay_input=$("#birthday_input").val();
	 	birthDay_input=birthDay_input.split("-")[0]+birthDay_input.split("-")[1]+birthDay_input.split("-")[2];
	}
	
	var zhanghaoId_input = $("#zhanghaoId_input").val();//账号名
	if($.trim(zhanghaoId_input) == ""){
	 	alert("账号名必填");
	 	return;
	}
	
	//var yuangongBH_input = $("#yuangongBH_input").val();//员工编号
	//if($.trim(yuangongBH_input) == ""){
	// 	alert("员工编号必填");
	// 	return;
	//}
	
	var jueseinput=$("#juese_input input");
	var juese="";//角色
	if(jueseinput != null && jueseinput.length>0){
		for(var i=0;i<jueseinput.length;i++){
			juese=juese+$("#juese_input").find("input:eq("+i+")").val()+",";
		}
		if(juese != ""){
			juese=juese.substr(0,juese.length-1);
		}
	}
	if(juese == ""){
		alert("请选择角色");
	 	return;
	}
	
	var yuangongxj_input = $("#yuangongxj_input").val();//员工星级
	var ssbumen_input = $("#ssbumen_input").val();//所属部门1
	var ssbumen_input2 = $("#ssbumen_input2").val();//所属部门2

	var reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{";
	
	var siteinput=$("#sszhandian_input input");//站点
	if(siteinput != null && siteinput.length>0){
		reqmsg += "\"employee_site_list\":[";
		for(var i=0;i<siteinput.length;i++){
			reqmsg += "{\"siteId\":" + $("#sszhandian_input").find("input:eq("+i+")").val() + "},";
		}
		reqmsg += "],";
	}
	
	var zcinput=$("#ygzc_input input");//职称
	if(zcinput != null && zcinput.length>0){
		reqmsg += "\"employee_dataDic_list\":[";
		for(var i=0;i<zcinput.length;i++){
			reqmsg += "{\"dataDicId\":" + $("#ygzc_input").find("input:eq("+i+")").val() + "},";
		}
		reqmsg += "],";
	}
	
	var zuzhanginputId_search = $("#zuzhanginputId_search").val();//组长
	var zuzhanginput_search = $.trim($("#zuzhanginput_search").val());//组长
	if(zuzhanginput_search == null || zuzhanginput_search == ""){
		zuzhanginputId_search = "0";
		$("#zuzhanginputId_search").val("0");
	}else{
		if(zuzhanginputId_search == "0"){
			alert("所选组长不存在");
			return;
		}
	}
	reqmsg += "\"leaderEmployeeId\":" + zuzhanginputId_search + ",";
	
	if (zhanghaoId_input != null && zhanghaoId_input != "") {
        reqmsg += "\"zhanghaoId\":\"" + zhanghaoId_input + "\",";
	}
	if (touxiangSrc != null && touxiangSrc != "") {
        reqmsg += "\"mainPhoto\":\"" + touxiangSrc + "\",";
	}
    if (name_input != null && name_input != "") {
        reqmsg += "\"name\":\"" + name_input + "\",";
	}
    if (gender_input != null && gender_input != "") {
        reqmsg += "\"gender\":\"" + gender_input + "\",";
	}
    if (identityId_input != null && identityId_input != "") {
        reqmsg += "\"idnumber\":\"" + identityId_input + "\",";
	}
    if (telephone_input != null && telephone_input != "") {
        reqmsg += "\"mobileTel\":\"" + telephone_input + "\",";
	}else{
		alert("联系方式不能为空!");
		return;
	}
    if (birthDay_input != null && birthDay_input != "") {
        reqmsg += "\"birthdate\":\"" + birthDay_input + "\",";
	}
    if (juese != null && juese != "") {
        reqmsg += "\"roleIds\":\"" + juese + "\",";
	}
    if (yuangongxj_input != null && yuangongxj_input != "") {
        reqmsg += "\"starLevel\":" + yuangongxj_input + ",";
	}
	if (ssbumen_input != null && ssbumen_input != "") {
        reqmsg += "\"department\":" + ssbumen_input + ",";
	}else{
		reqmsg += "\"department\":0,";
	}
	if (ssbumen_input2 != null && ssbumen_input2 != "") {
        reqmsg += "\"secondDepartmentId\":" + ssbumen_input2 + ",";
	}else{
		reqmsg += "\"secondDepartmentId\":0,";
	}
	//if (yuangongBH_input != null && yuangongBH_input != "") {
    //    reqmsg += "\"indexNum\":\"" + yuangongBH_input + "\",";
	//}

	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:true,
          url : "addEmployee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	alert("保存成功");
              	var id=data.content.id;
              	var path="<%=request.getContextPath()%>";
              	var url=path+"/daeEmployee.do?main&employeeId="+id;
              	window.location.replace(url);
              }else if(data.des=="failure"){
                 alert("保存失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
     }
     
    //上传图片
	function uploadPic() {
		var currPic = $("#pic4upload1").val();
		if (currPic != null && currPic != "") {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						$("#srcPath").val(data); 
						//$("#touxiangId2").attr("src", data);  //将当前图片设为上传的图片
						openImagejsp(data);
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#picuploadform1").ajaxSubmit(ajax_option);
		} else {
			//alert("请选择图片");
		}
	}
	function openImagejsp(data){
		window.open ("view/imageCut/jquery-image-cut/image.jsp?"+data, "newwindow", "height=550, width=1100, top=200, left=450, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");
	}
	 //上传裁剪后图片
	function uploadPic_cut() {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						var result = JSON.parse(data);
						$("#hide_employeeTupian").val(result.base64);
						$("#touxiangId").attr("src", result.url);  //将当前图片设为上传的图片
						
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#image_submit").ajaxSubmit(ajax_option);
	}
//根据角色名获取id
function getIdByRoleName(name){
		var id="0";
		 jQuery.ajax({
          type : "post",
          async:false,
          url : "addEmployee.do?getIdByRoleName",
          dataType : "json",
          data: {
               "RoleName":name
          },
          success : function(data){
              if(data.des=="success"){
              		id = data.id;
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
		return id;
}
//实时获取组长姓名
function getzuzhangName(){
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $.trim($("#zuzhanginput_search").val());
	var roleIds = getIdByRoleName("组长");
	reqmsg += "\"roleIds\":\"" + roleIds + "\",";
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"zuzhangNamefuzhi(" + item.id + ",'" + item.name + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//分配人姓名赋值
function zuzhangNamefuzhi(id,name){
	$("#zuzhanginputId_search").val(id);
	$("#zuzhanginput_search").val(name);
	$("#hideul_nei1").html("");
	$("#hideul-1").hide();
}
    </script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
