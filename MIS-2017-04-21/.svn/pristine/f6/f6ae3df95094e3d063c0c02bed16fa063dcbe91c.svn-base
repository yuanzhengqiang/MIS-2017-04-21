<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<%@ page import="fsk.init.SystemInit" %>
<%
	String nickname = (String) session.getAttribute("nickname");
	if (nickname == null) {
		nickname = "";
	}
	String header = SystemInit.header;
	String headerImage = SystemInit.headerImage;
%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>设备详情</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  <link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  <link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
<style>
.accordion .panel,.accordion .panel:first-child{border-top:1px solid #ECECEC;border-bottom:1px solid #ECECEC;}
.checkbox-inline{padding-left:0;padding-right:30px;}
 .checkbox-inline + .checkbox-inline{margin-left:0;}
 .hideul{position:absolute;top:33px;z-index:200;right:15px;left:15px;display:none}
	.hideul ul{ border:1px solid #ccc;width:100%;background:#f4f4f4;padding-left:0}
	.hideul ul li{ list-style-type:none;text-indent:20px}
	.hideul ul li:hover{ background:#ddd}
	 .BMap_cpyCtrl{ display:none; } 
	.BMap_bubble_content td{border:0 !important}
 </style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>
	<!-- 上侧栏开始 -->
<div class="navbar-fixed-top">
	<div class="navbar navbar-default" style="margin-bottom: 0;">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="fa fa-gear"></span>
          </button>
          <a class="navbar-brand" href="#"  style="width:auto;background: url(images/<%=headerImage %>) no-repeat 0 10px;"><span><%=header %>/设备详情</span></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right user-nav">
            <li class="dropdown profile_menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="images/avatar2.jpg"/>
                <span id="accountNickname"><%=nickname %></span>
<!--                 <b class="caret"></b> -->
              </a>
<!--               <ul class="dropdown-menu"> -->
<!--                 <li><a href="#" class="md-trigger" data-modal="md-scale3">密码修改</a></li> -->
<!--                 <li class="divider"></li> -->
<!--                 <li><a href="systemLogin.do?logout">退出登录</a></li> -->
<!--               </ul> -->
            </li>
          </ul>
        </div><!--/.nav-collapse animate-collapse -->
      </div>
    </div>  <!-- 上侧栏结束 -->
    <div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
		<div class="page-head">
			<input type="hidden" id="head_devtype_hide" value="">
			<h2 id="head_devtype">未知</h2>
			<p id="head_devOld">未知</p>				
		</div>
	</div>
</div>
		<!-- 头部结束 -->
<div id="cl-wrapper"  style="padding: 0px;padding-top:170px">	
	<div class="cl-mcont">
    <div class="row" style="margin-top:0">
      <div class="col-sm-12">
        <div class="tab-container" >
          <ul class="nav nav-tabs">
            <li id="" class="active" onclick="changeMap('1')"><a data-toggle="tab" href="#tab1">基本信息</a></li>
            <li id="" onclick="dev_Getset()"><a data-toggle="tab" href="#tab2">设备配置</a></li>      
            <li id="" onclick="changeMap('2')"><a data-toggle="tab" href="#tab3">报警历史</a></li>
          </ul>
          <div class="tab-content" >
            <div id="tab1" class="tab-pane active" ><!-- 基本信息开始 -->
						<input type="hidden" value="保存全部二次确定假按钮" class="md-trigger" data-modal="saveAllBasicHeal1" id="fake-saveAllBasicHeal1">	
						<div class="row">
							<div class="col-sm-12" id="editBasicInfo">
								<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit()">编辑信息</button>
						</div></div>
						<div class="panel-group accordion accordion-semi"  style="margin-top:20px;">
					 	 <div class="panel panel-default">
							<div class="panel-heading">
							  <h4 class="panel-title">
							<a >基本信息</a>
						  </h4>
						</div>
						
						<div  class="panel-collapse collapse in">
						  <div class="panel-body">
							<form class="form-horizontal" >
								<div class="form-group">
								  <label class="col-sm-2 control-label">设备编号</label>
								  <div class="col-sm-4" style="padding-top:7px" id="dev_bianhao">
									无						
								  </div>
								  <label  class="col-sm-2 control-label">绑定老人</label>
								  <input type="hidden" class="form-control" id="oldinput_searchId" value="">
								  <div class="col-sm-4 "  style="position:relative">
										<div class="input-group " >
											<input class="form-control"  type="text" readonly tag="spring" value="" id="oldinput_search" onclick="getolderName()" oninput="getolderName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
											<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
										</div>
										<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
											<ul id="hideul_nei1">
						
											</ul>
										</div>
								  </div>
								</div>
								<div class="form-group">
								  <label  class="col-sm-2 control-label">设备类型</label>
								  <div class="col-sm-4" style="padding-top:7px" id="dev_type" >
									无
								  </div>
								  <label  class="col-sm-2 control-label">设备电话</label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" readonly tag="spring" id="dev_telephone" onkeypress="keyPress()">	
								  </div>
								</div>
								<div class="form-group">
								   <label  class="col-sm-2 control-label">设备名称</label>
								   <div class="col-sm-4">
									   <input type="text" class="form-control" readonly tag="spring" id="dev_name" >									
								   </div>
								</div>
							</form>
						  </div>
						</div>
					  </div>
					</div>	
					<div class="panel-group accordion accordion-semi"  >
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a >安装位置<span id="headlantiao_address"></span></a>
							<input type="hidden" class="form-control" id="txt_EleCrawlSS" value="0">
							<input type="hidden" class="form-control" id="dev_posLong" value="0">	
							<input type="hidden" class="form-control" id="dev_posLat" value="0">
						  </h4>
						</div>
						<div  class="panel-collapse collapse in" >
						  <div class="panel-body form-horizontal">		
								<div class="form-group">
								 <label  class="col-sm-2 control-label">地址搜索</label>								   
								  <div class="col-sm-4 " style="padding-right:20px">										<div class="input-group " >
											<input class="form-control easyui-textbox-simple" type="text" id="searchplace" readonly tag="spring">
											<span class="input-group-btn easyui-linkbutton" id="s_p_search_btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
										</div>										
								</div>	
								</div>									
								  <div class="col-sm-6" style="position:relative">
								  		<p>当前位置经纬度：<span id="lng-lat"></span></p>		
								  	<div id="BaiduDitu" style="height:500px;" >								  	
								  	</div>	
								  	<div style="position:absolute;height:530px;width:100%;z-index:222;left:0;top:0"  id="covermask"></div>									
								  </div>
								
									<input type="hidden" id="searchlistNum" value="0">
								  	<div style="display:none;" id="searchlist_hideForChoose"></div>
									<div class="col-sm-3" style="padding-top: 33px" id="searchlist" onclick="listclick()">															
								    </div>
									
								
								
						  </div>
						</div>
					  </div>
					</div>
					
			</div>

    
            <div id="tab2" class="tab-pane"><!-- 设备配置 -->
           		 <input type="hidden" value="保存全部二次确定假按钮" class="md-trigger" data-modal="saveshenghuo" id="fake-saveshenghuo">	
				<div class="row" id="lrdwqbjxx">
					<div class="col-sm-12" id="deviceConfig_lrdwq"><button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit2_lrdwq()">编辑信息</button></div>
				</div>
				<div class="row" id="ahbbjxx">
					<div class="col-sm-12" id="deviceConfig_ahb"><button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit2_ahb()">编辑信息</button></div>
				</div>
				<div class="panel-group accordion accordion-semi" style="margin-top:20px;" id="ahbbq1">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a>门磁感应</a>
							<input type="hidden" value="1" id="mcIfSure">
						  </h4>
						</div>
						<div class="panel-collapse collapse in">
						  <div class="panel-body form-horizontal">
								 <div class="form-group">
								  <div class="col-sm-12">设备编号</div>
								  <div class="col-sm-6">
									 <input  type="text" id="MCSBBH" readonly tag="summer" value="" class="form-control"  style="text-align: right;margin-bottom:10px"/>						
								  </div>
								  <div class="col-sm-12">报警阈值</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeHour1" value="" onpaste="return false;" onkeypress="keyPress()" maxlength="2" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeMin1" value="" onpaste="return false;" onkeypress="keyPress()" onmouseout="MCcheckValueMin('1')" onchange="MCcheckValueMin('1')" oninput="MCcheckValueMin('1')" maxlength="2" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
                                <div class="col-sm-12">报警开始时间</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeHour2" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="MCcheckValueHour('2')" onchange="MCcheckValueHour('2')" oninput="MCcheckValueHour('2')" id="MCAlarmTimeHour2" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeMin2" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="MCcheckValueMin('2')" onchange="MCcheckValueMin('2')" oninput="MCcheckValueMin('2')" id="MCAlarmTimeMin2" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
                                
                                <div class="col-sm-12">报警结束时间</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeHour3" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="MCcheckValueHour('3')" onchange="MCcheckValueHour('3')" oninput="MCcheckValueHour('3')" id="MCAlarmTimeHour3" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="MCAlarmTimeMin3" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="MCcheckValueMin('3')" onchange="MCcheckValueMin('3')" oninput="MCcheckValueMin('3')" id="MCAlarmTimeMin3" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
                                
								</div>

						  </div>
						</div>
					  </div>
				</div>
				<div class="panel-group accordion accordion-semi" id="ahbbq2">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a>红外感应</a>
							<input type="hidden" value="1" id="hwIfSure">
						  </h4>
						</div>
						<div class="panel-collapse collapse in">
						  <div class="panel-body form-horizontal">
								 <div class="form-group">
								  <div class="col-sm-12">设备编号</div>
								  <div class="col-sm-6">
									 <input  type="text" id="HWSBBH" readonly tag="summer" value="" class="form-control"  style="text-align: right;margin-bottom:10px"/>						
								  </div>
								  <div class="col-sm-12">报警阈值</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeHour1" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()"  readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeMin1" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="HWcheckValueMin('1')" onchange="HWcheckValueMin('1')" oninput="HWcheckValueMin('1')" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
                                <div class="col-sm-12">报警开始时间</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeHour2" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="HWcheckValueHour('2')" onchange="HWcheckValueHour('2')" oninput="HWcheckValueHour('2')" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeMin2" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="HWcheckValueMin('2')" onchange="HWcheckValueMin('2')" oninput="HWcheckValueMin('2')" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
                                
                                <div class="col-sm-12">报警结束时间</div>
                                  <div class="col-sm-6">
                                      <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeHour3" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="HWcheckValueHour('3')" onchange="HWcheckValueHour('3')" oninput="HWcheckValueHour('3')" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">时</span></div></div>
                                  
                                  <div class="col-sm-6"> <div class="input-group">
                                      <input  type="text" id="HWAlarmTimeMin3" value="" maxlength="2" onpaste="return false;" onkeypress="keyPress()" onmouseout="HWcheckValueMin('3')" onchange="HWcheckValueMin('3')" oninput="HWcheckValueMin('3')" readonly tag="summer" class="form-control"  style="text-align: right;"/><span class="input-group-addon">分</span></div></div>
                                  
								</div>
						  </div>
						</div>
					  </div>
				</div>
				<div class="panel-group accordion accordion-semi" id="lrdwqbq">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a>老人定位器</a>
							<input id="txt_centerLongHide"  type="hidden" value="0" />
                            <input id="txt_centerTalHide"  type="hidden" value="0"/>
                            <input id="txt_mapLevelHide"  type="hidden" />
						  </h4>
						</div>
						<div class="panel-collapse collapse in">
						  <div class="panel-body form-horizontal">
								 <div class="form-group">
								  <div class="col-sm-12">紧急模式（ 当开启紧急模式后，定位周期为5分钟，因此可能提高功耗，不需要时请保持关闭）</div>
								  <div class="col-sm-12">
									 <div class="switch switch-small" id="dop1" onclick="changeModeSer()">
                                          <input type="checkbox" name="op1" id="op1"  disabled/></div>
                                                    					
								  </div>
								  <div class="col-sm-12" style="margin-top:10px"> 电子围栏范围（当前围栏中点经纬度：
								  						<span>
                                                            <input readonly="readonly" style="color: Gray; width: 75px; border: 0;" type="text"
                                                                id="weilanLong" value="0" />
                                                        </span>&nbsp,&nbsp <span>
                                                            <input readonly="readonly" style="color: Gray; width: 70px; border: 0;" type="text"
                                                                id="weilanWei" value="0" />
                                                        </span>
                                                                                           ）</div>
                                  <div class="col-sm-6">
                                     <div class="input-group">
                                      <input type="text" readonly tag="summer" class="form-control"  value="0" style="text-align: right;" id="txt_EleCrawl" onmouseout="checkValue()" onpaste="return false;" onkeypress="keyPress()" onchange="checkValue()" oninput="checkValue()"/>
                                      <span class="input-group-addon">米</span></div></div>

								<div class="col-sm-6">
									<button type="button" class="btn btn-default btn-twitter" disabled tag="summer" onclick="AddVal()"><i class="fa fa-plus"></i></button>
									<button type="button" class="btn btn-default btn-twitter" disabled tag="summer" onclick="MinusVal()"><i class="fa fa-minus"></i></button>
									
								</div>
								</div>
								<div class="form-group">
								  <div class="col-sm-12"  style="margin-top:-20px">地址搜索</div>						   
								  <div class="col-sm-6 ">
										<div class="input-group " >
											<input class="form-control easyui-textbox-simple" type="text" id="searchplace2" readonly tag="summer">
											<span class="input-group-btn easyui-linkbutton" id="s_p_search_btn2"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
										</div>										
								  </div>	
								</div>	
								<div class="col-sm-6"  id="hideMap" style="display:none;position:relative;">		
								  	<div id="ElcMap" style="height:500px;margin-left:-15px" >								  	
								  	</div>	
								  	<div style="position:absolute;height:530px;width:100%;z-index:222;left:0;top:0"  id="covermask1"></div>										
								</div>
								<div class="form-group">
									<input type="hidden" id="searchlistNum2" value="0">
								  	<div class="col-sm-3" style="display:none;" id="searchlist_hideForChoose2">															
								    </div>
									<div class="col-sm-3" id="searchlist2" onclick="listclick2()">															
								    </div>
								</div>
						</div>
					  </div>
				</div>
				</div>

            </div>
            
        	<div id="tab3" class="tab-pane">
        							<div class="row">
								 	<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>报警类别</label>
										</div>
										<div class="col-sm-4 "  style="margin-bottom:10px;">
											<select class="select2" multiple id="list_alarmType">
												<option value="21">门磁未接入网络</option>
												<option value="22">门磁电量不足</option>
												<option value="25">门磁门未关</option>
												<option value="33">腕带紧急求助</option>
												<option value="41">生命感应器未接入网络</option>
												<option value="42">生命感应器电量不足</option>
												<option value="43">生命感应器区域内无人</option>
												<option value="81">定位器SOS报警</option>
												<option value="82">定位器低电量</option>
												<option value="83">定位器摔倒报警</option>
												<option value="84">定位器越界报警</option>
                      						</select>
										</div>
										<div style="clear:both"></div>
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>报警时间区间</label>
										</div>
										<div class="col-md-4" >
                   						 	<div class="input-group">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>                    
					                     		 <input class="form-control datetime" id="list_alarmtTimeStart" size="16" type="text"  readonly/>
					                      		 <span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
					                       </div>
               							 </div>
										<div style="float:left">
											~
										</div>
										<div class="col-sm-4 "  style="margin-bottom:10px;">
											<div class="input-group">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>                    
					                     		 <input class="form-control datetime" id="list_alarmtTimeEnd" size="16" type="text"  readonly/>
					                      		 <span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
					                       </div>
										</div>
										
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-bottom:10px">	
											<button class="btn btn-primary" style="height: 34px;margin-left:0;" onclick="query_alarm()">查询</button>										
										</div>								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info_alarm">
												<thead>
													<tr role="row">
														<th><strong>报警时间</strong></th>
														<th><strong>绑定老人</strong></th>
														<th><strong>报警内容</strong></th>
														<th><strong>报警位置</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer_alarm" role="alert" aria-live="polite" aria-relevant="all">	
													<!-- <tr>
														<td>1</td>
														<td>1</td>
														<td>1</td>
														<td onclick="$('#fakeMapModal').click()">点击弹出地图</td>
													</tr> -->																		
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 --
									<!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info_alarm" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
									<input type="hidden" id="fakeMapModal" class="md-trigger" data-modal="fakeMap">
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector_alarm"   size="1"  onchange="query_alarm()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea_alarm" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
        	</div>
        </div>    
        
   
      


	</div>
	
</div> </div> </div> 
	
</div> <!-- 主页面结束 -->

    <!-- 模态框开始-->
    	<!-- 模态框 查看详情 -->
	   
		<div class="md-modal colored-header  md-effect-9 " id="fakeMap">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>报警位置详情</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">×</button>
                      </div>
                      <div class="modal-body " id="erciquerenxinxi">
                      	<div class="row" style="margin-top:10px;">位置信息:
							<span>
                                <input readonly="readonly" style="color: Gray; width:550px; border: 0;" type="text" id="tc_jwd" value="未知" />
                            </span>
                        </div>
                      	<div class="row form"  id="baiduMap3" style="min-height:300px;margin-top:10px;">
                      	
                      	</div>
                      </div>
                    </div>
                </div>
               
	<div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>
<script type="text/javascript" src="js/highcharts.js"></script>

<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=TbEPXcQbr7UROaKUR1zzKGoB"></script>
      <!--加载鼠标绘制工具-->
	<script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
	<link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
	<!--加载检索信息窗口-->
	<script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.js"></script>
	<link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.css" />
<script type="text/javascript">
			//基本信息地图初始化
    		var map = window.map;
    		$(function(){
                 var map = new BMap.Map("BaiduDitu");    // 创建Map实例
                 map.centerAndZoom('上海市',14);//设定地图的中心点和坐标，将地图显示在地图容器中
                 
                 window.map = map;//将map变量存储在全局
				 //map.addControl(new BMap.ScaleControl());  //比例尺
				 //map.scaleControlEnabled(false);
				 map.enableScrollWheelZoom();     //开启鼠标滚轮缩放
				 map.enableKeyboard();//启用键盘上下左右键移动地图
				 
				 map.enableInertialDragging();
				 map.enableContinuousZoom();
			     var size = new BMap.Size(10, 20);
				 map.addControl(new BMap.CityListControl({
    				anchor: BMAP_ANCHOR_TOP_LEFT,
    				offset: size,
    				// 切换城市之间事件
    				// onChangeBefore: function(){
    				//    alert('before');
    				// },
    				// 切换城市之后事件
    				// onChangeAfter:function(){
    				//   alert('after');
    				// }
				 }));
				
				 ///点击获取坐标位置
    			 var geoc = new BMap.Geocoder();
				 map.addEventListener("click",function(e){		
				 	 var pt = e.point;
					 geoc.getLocation(pt, function (rs) {
            		 	var addComp = rs.addressComponents;
            			var vAddress = addComp.province + addComp.city + addComp.district + addComp.street + addComp.streetNumber;
						$("#searchplace").val(vAddress);//设备地址
						$("#headlantiao_address").html("：" + vAddress);
						
						$("#dev_posLong").val(e.point.lng);//设备经度
					    $("#dev_posLat").val(e.point.lat);//设备纬度
            			$("#lng-lat").text(e.point.lng + "," + e.point.lat);
            			
				        map.clearOverlays();
            			var point22 = new BMap.Point(e.point.lng, e.point.lat);
            			var marker22 = new BMap.Marker(point22);
            			var radius2 = $("#txt_EleCrawlSS").val();
            			var circle2 = new BMap.Circle(point22, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆
						map.addOverlay(circle2); //添加实时位置圆
            			map.addOverlay(marker22);
            			
    					//$("#searchlist").html("");
        			 });
				 });
				 
              	 createSearch();
                 $("#s_p_search_btn").click(function () {
                    searchPlace($("#searchplace").val());
                 });
                 
                 $("#s_p_search_btn2").click(function () {
                    searchPlace2($("#searchplace2").val());
                 });
                 
                 $("#searchplace").keydown(function() { //焦点在搜索框时，按回车，搜索
					if (event.keyCode == 13) {
						$("#s_p_search_btn").click();
						return;
					}
				 });
				 
				 $("#searchplace2").keydown(function() { //焦点在搜索框时，按回车，搜索
					if (event.keyCode == 13) {
						$("#s_p_search_btn2").click();
						return;
					}
				 });
            });
			
			//基本信息搜索列表初始化
            function createSearch() {
                var local = new BMap.LocalSearch(map,
                    {
                        renderOptions: { map: map, panel: "searchlist" },
                        
                        onSearchComplete: function(results){
							// 判断状态是否正确
							if (local.getStatus() == BMAP_STATUS_SUCCESS){
								var html = "";
								for (var i = 0; i < results.getCurrentNumPois(); i ++){
									html += "<div id=\"dtlb_" + i + "\"><input type=\"hidden\" id=\"name_" + i + "\" value=\"" + results.getPoi(i).address + "\"><input type=\"hidden\" id=\"poilng_" + i + "\" value=\"" + results.getPoi(i).point.lng + "\"><input type=\"hidden\" id=\"poilat_" + i + "\" value=\"" + results.getPoi(i).point.lat + "\"></div>";
								}
								$("#searchlistNum").val(results.getCurrentNumPois());
								$("#searchlist_hideForChoose").html(html);
							}
						}
                    });
                window.local = local;
            }
            
            //基本信息地图列表搜索
            function searchPlace(value) {
                window.local.search(value);              
            }
            
            //设备配置页地图列表搜索
            function searchPlace2(value) {
                var local2 = new BMap.LocalSearch(map3,
                    {
                        renderOptions: { map: map3, panel: "searchlist2" },
                        
                        onSearchComplete: function(results){
							// 判断状态是否正确
							if (local2.getStatus() == BMAP_STATUS_SUCCESS){
								var html = "";
								for (var i = 0; i < results.getCurrentNumPois(); i ++){
									html += "<div id=\"dtlb2_" + i + "\"><input type=\"hidden\" id=\"name2_" + i + "\" value=\"" + results.getPoi(i).address + "\"><input type=\"hidden\" id=\"poilng2_" + i + "\" value=\"" + results.getPoi(i).point.lng + "\"><input type=\"hidden\" id=\"poilat2_" + i + "\" value=\"" + results.getPoi(i).point.lat + "\"></div>";
								}
								$("#searchlistNum2").val(results.getCurrentNumPois());
								$("#searchlist_hideForChoose2").html(html);
							}
						}
                    }); 
                    
                local2.search(value);             
            }
            
            
            //基本信息操作列表区域后添加地图点
            function listclick(){
            //zoom: 1; overflow: hidden; padding: 0px 5px;
            //zoom: 1; overflow: hidden; padding: 0px 5px; background-color: rgb(240, 240, 240);
            	var style = "";
            	var id = 0;
            	var searchlistNum = $("#searchlistNum").val();
            	
            	setTimeout(function(){
            		for(var i = 0;i < searchlistNum; i++){
            	 		style = $("#searchlist").find("div").find("div:eq(0)").find("ol").find("li:eq(" + i + ")").find("div").attr("style");
            	 		if(style.indexOf("background-color") != -1){//包含,百度地图控件被点击了
            	 			id = i;
            	 			break;
            	 		}
            		}
            		$("#searchplace").val($("#name_"  + id).val());//设备地址
            		$("#headlantiao_address").html("：" + $("#name_"  + id).val());
            		
					$("#dev_posLong").val($("#poilng_"  + id).val());//设备经度
					$("#dev_posLat").val($("#poilat_"  + id).val());//设备纬度
            		$("#lng-lat").text($("#poilng_"  + id).val() + "," + $("#poilat_"  + id).val());
            		
            		map.clearOverlays();
            		var point33 = new BMap.Point($("#poilng_"  + id).val(), $("#poilat_"  + id).val());
            		var marker33 = new BMap.Marker(point33);
            		var radius33 = $("#txt_EleCrawlSS").val();
            		var circle33 = new BMap.Circle(point33, parseInt(radius33), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆
					map.addOverlay(circle33); //添加实时位置圆
					map.addOverlay(marker33);
					map.centerAndZoom(point33,14);
					
            	},500);
            }
            
            //设备配置操作列表区域后添加地图点
            function listclick2(){
            //zoom: 1; overflow: hidden; padding: 0px 5px;
            //zoom: 1; overflow: hidden; padding: 0px 5px; background-color: rgb(240, 240, 240);
            	var style = "";
            	var id = 0;
            	var searchlistNum = $("#searchlistNum2").val();
            	
            	setTimeout(function(){
            		for(var i = 0;i < searchlistNum; i++){
            	 		style = $("#searchlist2").find("div").find("div:eq(0)").find("ol").find("li:eq(" + i + ")").find("div").attr("style");
            	 		if(style.indexOf("background-color") != -1){//包含,百度地图控件被点击了
            	 			id = i;
            	 			break;
            	 		}
            		}
            		$("#searchplace2").val($("#name2_"  + id).val());//设备地址
            		
					$("#weilanLong").val($("#poilng2_"  + id).val());//设备经度
					$("#weilanWei").val($("#poilat2_"  + id).val());//设备纬度
            		
            		var point2 = new BMap.Point($("#poilng2_"  + id).val(), $("#poilat2_"  + id).val());
            		map3.clearOverlays();
            		
        			var x3 = document.getElementById("dev_posLong").value;
        			var y3 = document.getElementById("dev_posLat").value;


        			var radius = document.getElementById("txt_EleCrawl").value;
        			var radius2 = document.getElementById("txt_EleCrawlSS").value;
            		
            		//设置实时位置点
            		var point3 = new BMap.Point(x3, y3);
        			var marker = new BMap.Marker(point3);
        			var icons = "images/weizhi.png"; //这个是你要显示坐标的图片的相对路径 
        			var icon = new BMap.Icon(icons, new BMap.Size(40, 40)); //显示图标大小 
        			marker.setIcon(icon);
        			marker.addEventListener("mouseover", function () {
            			var label = new BMap.Label("实时位置", { offset: new BMap.Size(20, -10) });
            			label.setStyle({
                			"border-color": "Gray"
            			});
            			marker.setLabel(label);
        			});
        			var circle2 = new BMap.Circle(point3, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆

        			//设置围栏点
        			var marker2 = new BMap.Marker(point2);
        			var icons2 = "images/mapcenter.png"; //这个是你要显示坐标的图片的相对路径 
        			var icon2 = new BMap.Icon(icons2, new BMap.Size(20, 20)); //显示图标大小 
        			marker2.setIcon(icon2);
        			//  marker.enableDragging(); //点可拖拽
        			marker2.addEventListener("mouseover", function () {
            			var label2 = new BMap.Label("围栏基点", { offset: new BMap.Size(20, -10) });
            			label2.setStyle({
                			"border-color": "Gray"
            			});
            			marker2.setLabel(label2);
        			});

        			var circle = new BMap.Circle(point2, parseInt(radius), { strokeColor: "#0d5980", fillColor: "#19b1fc", strokeWeight: 1, fillOpacity: 0.3, strokeOpacity: 0.3 }); //创建圆
        			//添加覆盖物
        			map3.addOverlay(circle2); //添加实时位置圆
        			map3.addOverlay(marker); //添加实时位置点
        			map3.addOverlay(circle); //添加圆
        			map3.addOverlay(marker2); //添加围栏点
        			
        			map3.centerAndZoom(point2, 16); 
					
            	},500);
            }
</script>

<script type="text/javascript">
	//操作页签后，重置数据和地图信息
	function changeMap(flag) {
        $("#hideMap").attr("style", "display:none;");
        $("#ElcMap").html("");
        if(flag == "1"){
			$("#searchlistNum").val("");
			$("#searchlist").html("");
			$("#searchlist_hideForChoose").html("");
        	setTimeout("queryDev()",800);
        }else{
        	query_alarm();
        }
    }
    
    $(document).ready(function(){
    	var homeUrl = "<%=request.getContextPath()%>" + "/welcome.do?main";
  		$(".navbar-brand").attr("href",homeUrl);
      	queryDev();
      	setTimeout("queryDev()",800);
		//ElcMap();
      	
		App.init();
		$(".md-trigger").modalEffects();
    	$(".deleteThisTime").click(function(){               //清除日期框中的值
    	       $(this).parent().prev()[0].value = "";
    	});        

	});
		
function able2edit(){ //页签1的编辑开
	$('input[tag=spring]').removeAttr("readonly");//去掉input的
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-success md-trigger" data-modal="saveAllBasicHeal" onclick="save1();" >保存全部</button><button class="btn btn-default btn-flat btn-rad" style="margin-left:30px" onclick="disabled2edit()">取消修改</button>';
	$('#editBasicInfo').html(buttonHTML);
	$("#covermask").css("display","none");
}
function disabled2edit(){ //页签1的编辑关
	queryDev();
	$('input[tag=spring]').attr("readonly","readonly");//去掉input的
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit()">编辑信息</button>';
	$('#editBasicInfo').html(buttonHTML);
	$("#covermask").css("display","block");
}


//老人定位器
function able2edit2_lrdwq(){//页签2的编辑开
	$('input[tag=summer]').removeAttr("readonly");//去掉input的
	$('#dop1').bootstrapSwitch('setActive', true);  // true || false
 
	$('button[tag=summer]').removeAttr("disabled");//去掉+ - 按钮的
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-success md-trigger" data-modal="saveAllBasicHeal" onclick="save_devset_lrdwq()">保存全部</button><button class="btn btn-default btn-flat btn-rad" style="margin-left:30px" onclick="disabled2edit2_lrdwq()">取消修改</button>';
	$('#deviceConfig_lrdwq').html(buttonHTML);
	$("#covermask1").css("display","none");
}
function disabled2edit2_lrdwq(){ //页签2的编辑关
	query_devset_lrdwq();
	$('input[tag=summer]').attr("readonly","readonly");
	$('#dop1').bootstrapSwitch('setActive', false);  // true || false
	$('button[tag=summer]').attr("disabled","disabled");
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit2_lrdwq()">编辑信息</button>';
	$('#deviceConfig_lrdwq').html(buttonHTML);
	$("#searchplace2").val("");
	$("#searchlistNum2").val("");
	$("#searchlist2").html("");
	$("#searchlist_hideForChoose2").html("");
	$("#covermask1").css("display","block");
}

//安护宝
function able2edit2_ahb(){//页签2的编辑开
	$('input[tag=summer]').removeAttr("readonly");//去掉input的
	$('#dop1').bootstrapSwitch('setActive', true);  // true || false
 
	$('button[tag=summer]').removeAttr("disabled");//去掉+ - 按钮的
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-success md-trigger" data-modal="saveAllBasicHeal" onclick="save_devset();">保存全部</button><button class="btn btn-default btn-flat btn-rad" style="margin-left:30px" onclick="disabled2edit2_ahb()">取消修改</button>';
	$('#deviceConfig_ahb').html(buttonHTML);
}
function disabled2edit2_ahb(){ //页签2的编辑关
	query_devset();
	$('input[tag=summer]').attr("readonly","readonly");
	$('#dop1').bootstrapSwitch('setActive', false);  // true || false
	$('button[tag=summer]').attr("disabled","disabled");
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit2_ahb()">编辑信息</button>';
	$('#deviceConfig_ahb').html(buttonHTML);

}
</script>

<script type="text/javascript">
	//查询设备信息
	function queryDev(){
		var devId = "<%=request.getAttribute("devId")%>";

		var reqmsg="{'action':'QUERY_DEV_INFO_REQUEST','content':{\"olderShow\":\"true\",\"id\":"+devId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "dev.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    	 });
	}
	function changeData(data){
		if (data.content != null) {
			if(data.content.type == 1){
				$("#ahbbq1").hide();
				$("#ahbbq2").hide();
				$("#ahbbjxx").hide();
				$("#head_devtype").html("老人定位器 （" + data.content.code + "）");
				$("#dev_type").html("老人定位器");
				$("#head_devtype_hide").val("1");
			}else if(data.content.type == 2){
				$("#lrdwqbq").hide();
				$("#lrdwqbjxx").hide();
				$("#head_devtype").html("安护宝 （" + data.content.code + "）");
				$("#dev_type").html("安护宝");
				$("#head_devtype_hide").val("2");
			}
			if(data.content.olderId == null || data.content.olderId == "" || data.content.olderId == "0"){
				$("#head_devOld").html("未绑定");
				$("#oldinput_search").val("");
				$("#oldinput_searchId").val("0");
			}else{
				if (data.content.older != null) {
					$("#head_devOld").html("绑定老人：" + data.content.older.name + "（" + data.content.older.memberNum + "）");
					$("#oldinput_search").val(data.content.older.name + " " + data.content.older.memberNum);
					$("#oldinput_searchId").val(data.content.older.id);
				}
			}
			$("#dev_bianhao").html(data.content.code);
			
			$("#dev_telephone").val(data.content.devPhone);
			
			$("#dev_name").val(data.content.name);
			
			$("#searchplace").val(data.content.address);
			if(data.content.address != null && data.content.address != ""){
				$("#headlantiao_address").html("：" + data.content.address);
			}else{
				$("#headlantiao_address").html("");
			}
			
			$("#txt_EleCrawlSS").val(data.content.deviation);
			
			if(data.content.posLong != null && data.content.posLong != "" && data.content.posLat != null && data.content.posLat != ""){
				$("#dev_posLong").val(data.content.posLong);
				$("#dev_posLat").val(data.content.posLat);
				$("#lng-lat").text(data.content.posLong + "," + data.content.posLat);
				
    			var pointquery = new BMap.Point(data.content.posLong, data.content.posLat);
				var markerquery = new BMap.Marker(pointquery);
				map.clearOverlays();
    			var radiusquery = $("#txt_EleCrawlSS").val();
    			var circlequery = new BMap.Circle(pointquery, parseInt(radiusquery), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆
    			map.addOverlay(circlequery); //添加实时位置圆

   				map.addOverlay(markerquery);
   				map.centerAndZoom(pointquery, 18);
   				window.map = map;
			}
			if (data.content.flong == "0" || data.content.flat == "0" || data.content.flong == null || data.content.flat == null){
				$("#weilanLong").val($("#dev_posLong").val());
				$("#weilanWei").val($("#dev_posLat").val());
			}else{
				$("#weilanLong").val(data.content.flong);//电子围栏经度
				$("#weilanWei").val(data.content.flat);//电子围栏纬度
			}
			if(data.content.fradius != null && data.content.fradius != ""){
				$("#txt_EleCrawl").val(data.content.fradius);
			}else{
				$("#txt_EleCrawl").val("0");
			}
			if(data.content.locationStatus == "1"){
				$("#op1").attr("checked","checked");
			}else{
				$("#op1").attr("checked","");
			}
			
			$("#searchlist_hideForChoose").html("");
			$("#searchlist").html("");
			$("#searchlistNum").val("0");
			
		}
	}
	//保存设备基本信息
	function save1(){
		var devId = "<%=request.getAttribute("devId")%>";
		var dev_name = $.trim($("#dev_name").val());//设备名称
		if(dev_name.length > 50){
			alert("设备名称过长");
			return;
		}
		var oldinput_search = $.trim($("#oldinput_search").val());//绑定老人
		var oldinput_searchId = $.trim($("#oldinput_searchId").val());//绑定老人Id
		if(oldinput_search != null && oldinput_search != ""){
			if(oldinput_searchId == null || oldinput_searchId == "" || oldinput_searchId == "0"){
				alert("请选择绑定老人");
				return;
			}
		}else{
			oldinput_searchId = "0";
		}
	
		var dev_posLong = $.trim($("#dev_posLong").val());//设备经度
		var dev_posLat = $.trim($("#dev_posLat").val());//设备纬度
		var searchplace = $.trim($("#searchplace").val());//设备地址
		if(searchplace == null && searchplace == ""){
			dev_posLong = "";
			dev_posLat = "";
		}
		var dev_telephone = $.trim($("#dev_telephone").val());//设备电话
		if(dev_telephone != null && dev_telephone != ""){
	 		if(dev_telephone.length > 19){
				alert("请输入正确的设备电话");
				return;
			}
			var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
			if(!reg1.test(dev_telephone)){ 
        		alert("请输入正确的设备电话");
				return;
    		}
		}
		
		var head_devtype_hide = $("#head_devtype_hide").val();//设备类型
	
		var reqmsg="{'action':'ADD_DEV_INFO_REQUEST','content':{";
		
		reqmsg += "\"type\":" + head_devtype_hide + ",";
		reqmsg += "\"id\":" + devId + ",";
		reqmsg += "\"name\":\"" + dev_name + "\",";
		reqmsg += "\"olderId\":" + oldinput_searchId + ",";
	
		if(oldinput_searchId != "" && oldinput_searchId != null && oldinput_searchId != 0){
			reqmsg += "\"status\":\"设备绑定\",";
		}else{
			reqmsg += "\"status\":\"设备解绑\",";
		}
		reqmsg += "\"addTime\":\"" + getNowFormatDate() + "\",";
		reqmsg += "\"address\":\"" + searchplace + "\",";
		reqmsg += "\"posLong\":" + dev_posLong + ",";
		reqmsg += "\"posLat\":" + dev_posLat + ",";
		reqmsg += "\"devPhone\":\"" + dev_telephone + "\",";
	
		reqmsg=reqmsg.substr(0,reqmsg.length-1);
		reqmsg += "}}";
		
		jQuery.ajax({
          	type : "post",
          	async:false,
          	url : "dev.do?handler",
          	dataType : "json",
          	data: {
               	"reqmsg":reqmsg
          	},
          	success : function(data){
              	if(data.des=="success"){
              		alert("修改成功");
              		disabled2edit();
              	}else if(data.des=="failure"){
                 	alert("修改失败");
              	}else{
              		alert(data.des);
              	}
          	},
          	error:function(){
	           	alert("error");
          	}
     	});
	}
	
	
	//只能输入数字0-9
    function keyPress() {
        var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
    } 
       
//获取当前时间return yyyymmddhhmmss
function getNowFormatDate() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}

//实时获取老人姓名
function getolderName(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $.trim($("#oldinput_search").val());
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"olderNamefuzhi('" + item.name + " " + item.memberNum + "'," + item.id + ")\">" + item.name + " " + item.memberNum + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi(name,id){
	$("#oldinput_searchId").val(id);
	$("#oldinput_search").val(name);
	$("#hideul_nei1").html("");
	$("#hideul-1").hide();
}


		//设备配置
		function dev_Getset(){
			var type = $("#head_devtype_hide").val();
			if(type == "1"){//老人定位器
				$("#hideMap").attr("style", "display:block;");
				query_devset_lrdwq();
				$("#searchplace2").val("");
				$("#searchlistNum2").val("");
				$("#searchlist2").html("");
				$("#searchlist_hideForChoose2").html("");
			}else if(type == "2"){//安护宝
				query_devset();
			}
		}
		//老人定位器
		//加
        function AddVal() {
            var fradius = document.getElementById("txt_EleCrawl").value.toString();
            document.getElementById("txt_EleCrawl").value = (parseInt(fradius) + 20).toString();
            setFradius(document.getElementById("txt_EleCrawl").value);
        }

        //减
        function MinusVal() {
            var fradius = document.getElementById("txt_EleCrawl").value.toString();
            if (parseInt(fradius) <= 20) {
                document.getElementById("txt_EleCrawl").value = "0";
            } else {
                document.getElementById("txt_EleCrawl").value = (parseInt(fradius) - 20).toString();
            }
            setFradius(document.getElementById("txt_EleCrawl").value);
        }
        //检查围栏值是否正确
        function checkValue() {
            if (document.getElementById("txt_EleCrawl").value == "") {
                document.getElementById("txt_EleCrawl").value = "0";
            } else {
                if (document.getElementById("txt_EleCrawl").value.toString().length > 1) {
                    if (document.getElementById("txt_EleCrawl").value.toString().substr(0, 1) == "0") {
                        document.getElementById("txt_EleCrawl").value = document.getElementById("txt_EleCrawl").value.toString().substr(1, parseInt(document.getElementById("txt_EleCrawl").value.toString().length))
                    }
                }
            }
            setFradius(document.getElementById("txt_EleCrawl").value);
        }
        //设备配置页签切换模式
        function changeModeSer(){
        	var dop1IfEdit = $("#dop1").attr("class");
        	if(dop1IfEdit.indexOf("deactivate") != -1){
        		return;
        	}
        	
        	var dop1 = $("#dop1").find("div").attr("class");
        	var state = "0";
	        if(dop1.indexOf("switch-on") != -1){//包含---打开
	        	state = "1";
	        }
	        
	        var head_devtype_hide = $("#head_devtype_hide").val();
	        var reqmsg="{'action':'ADD_DEV_INFO_REQUEST','content':{";
			
			var devId = "<%=request.getAttribute("devId")%>";
			reqmsg += "\"id\":" + devId + ",";
			reqmsg += "\"type\":" + head_devtype_hide + ",";
			reqmsg += "\"locationStatus\":" + state + ",";
			
			reqmsg=reqmsg.substr(0,reqmsg.length-1);
			reqmsg += "}}";

			jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "dev.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsg
          		},
          		success : function(data){
              		if(data.des=="success"){
              			if(state == "1"){
              				alert("切换到紧急模式成功");
              			}else{
              				alert("切换到普通模式成功");
              			}
              		}else if(data.des=="failure"){
                 		if(state == "1"){
              				alert("切换到紧急模式失败");
              			}else{
              				alert("切换到普通模式失败");
              			}
              		}else{
              			alert(data.des);
              		}
          		},
          		error:function(){
	           		alert("error");
          		}
     		});
        }
    //查询老人定位器设备配置信息
	function query_devset_lrdwq(){
		var devId = "<%=request.getAttribute("devId")%>";

		var reqmsg="{'action':'QUERY_DEV_INFO_REQUEST','content':{\"olderShow\":\"true\",\"id\":"+devId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "dev.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	 if (data.content != null) {
					if(data.content.posLong != null && data.content.posLong != "" && data.content.posLat != null && data.content.posLat != ""){
						$("#dev_posLong").val(data.content.posLong);
						$("#dev_posLat").val(data.content.posLat);
						$("#lng-lat").text(data.content.posLong + "," + data.content.posLat);
					}else{
						$("#dev_posLong").val("0");
						$("#dev_posLat").val("0");
						$("#lng-lat").text(",");
					}
					if (data.content.flong == "0" || data.content.flat == "0" || data.content.flong == null || data.content.flat == null){
						$("#weilanLong").val($("#dev_posLong").val());
						$("#weilanWei").val($("#dev_posLat").val());
					}else{
						$("#weilanLong").val(data.content.flong);//电子围栏经度
						$("#weilanWei").val(data.content.flat);//电子围栏纬度
					}
					if(data.content.fradius != null && data.content.fradius != ""){
						$("#txt_EleCrawl").val(data.content.fradius);
					}else{
						$("#txt_EleCrawl").val("0");
					}
					$("#txt_centerLongHide").val("0");
					$("#txt_centerTalHide").val("0");
					$("#txt_mapLevelHide").val("");
					setTimeout("ElcMap()",300);
				}
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    	 });	
	}
		//保存老人定位器设备配置信息
		function save_devset_lrdwq(){
			var txt_EleCrawl = $.trim($("#txt_EleCrawl").val());
			var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
			if(!reg1.test(parseInt(txt_EleCrawl))){
				alert("围栏范围错误");
				return;
			}
			
			var weilanLong = $("#weilanLong").val();
			var weilanWei = $("#weilanWei").val();
			var head_devtype_hide = $("#head_devtype_hide").val();
			
			var reqmsg="{'action':'ADD_DEV_INFO_REQUEST','content':{";
			
			var devId = "<%=request.getAttribute("devId")%>";
			reqmsg += "\"id\":" + devId + ",";
			reqmsg += "\"fradius\":" + txt_EleCrawl + ",";
			reqmsg += "\"type\":" + head_devtype_hide + ",";
			reqmsg += "\"flong\":" + weilanLong + ",";
			reqmsg += "\"flat\":" + weilanWei + ",";
			
			reqmsg=reqmsg.substr(0,reqmsg.length-1);
			reqmsg += "}}";

			jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "dev.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsg
          		},
          		success : function(data){
              		if(data.des=="success"){
              			alert("配置成功");
              			disabled2edit2_lrdwq();
              		}else if(data.des=="failure"){
                 		alert("配置失败");
              		}else{
              			alert(data.des);
              		}
          		},
          		error:function(){
	           		alert("error");
          		}
     		});
		}
		
	//老人定位器地图
	function ElcMap() {
		map3 = new BMap.Map("ElcMap");
        var x = document.getElementById("dev_posLong").value; //实时位置
        var y = document.getElementById("dev_posLat").value; //实时位置
        var x2 = document.getElementById("weilanLong").value;
        var y2 = document.getElementById("weilanWei").value;

        var point = new BMap.Point(x, y);

        var radius = document.getElementById("txt_EleCrawl").value;
        var radius2 = document.getElementById("txt_EleCrawlSS").value;
 
        if (parseInt(radius) <= 85) {
            map3.centerAndZoom(point, 19); //定位中心点和地图级别
        } else if (parseInt(radius) > 85 && parseInt(radius) <= 170) {
            map3.centerAndZoom(point, 18); //定位中心点和地图级别
        } else if (parseInt(radius) > 170 && parseInt(radius) <= 340) {
            map3.centerAndZoom(point, 17); //定位中心点和地图级别
        } else if (parseInt(radius) > 340 && parseInt(radius) <= 680) {
            map3.centerAndZoom(point, 16); //定位中心点和地图级别
        } else if (parseInt(radius) > 680 && parseInt(radius) <= 1350) {
            map3.centerAndZoom(point, 15); //定位中心点和地图级别
        } else if (parseInt(radius) > 1350 && parseInt(radius) <= 2700) {
            map3.centerAndZoom(point, 14); //定位中心点和地图级别
        } else if (parseInt(radius) > 2700 && parseInt(radius) <= 5400) {
            map3.centerAndZoom(point, 13); //定位中心点和地图级别
        } else if (parseInt(radius) > 5400 && parseInt(radius) <= 10900) {
            map3.centerAndZoom(point, 12); //定位中心点和地图级别
        } else if (parseInt(radius) > 10900 && parseInt(radius) <= 21500) {
            map3.centerAndZoom(point, 11); //定位中心点和地图级别
        } else if (parseInt(radius) > 21500 && parseInt(radius) <= 43000) {
            map3.centerAndZoom(point, 10); //定位中心点和地图级别
        } else if (parseInt(radius) > 43000 && parseInt(radius) <= 85000) {
            map3.centerAndZoom(point, 9); //定位中心点和地图级别
        } else if (parseInt(radius) > 85000 && parseInt(radius) <= 173000) {
            map3.centerAndZoom(point, 8); //定位中心点和地图级别
        } else if (parseInt(radius) > 173000 && parseInt(radius) <= 340000) {
            map3.centerAndZoom(point, 7); //定位中心点和地图级别
        } else if (parseInt(radius) > 340000 && parseInt(radius) <= 670000) {
            map3.centerAndZoom(point, 6); //定位中心点和地图级别
        } else if (parseInt(radius) > 670000 && parseInt(radius) <= 1300000) {
            map3.centerAndZoom(point, 5); //定位中心点和地图级别
        } else if (parseInt(radius) > 1300000 && parseInt(radius) <= 2400000) {
            map3.centerAndZoom(point, 4); //定位中心点和地图级别
        } else if (parseInt(radius) > 2400000 && parseInt(radius) <= 4000000) {
            map3.centerAndZoom(point, 3); //定位中心点和地图级别
        } else {
            map3.centerAndZoom(point, 2); //定位中心点和地图级别
        }

        //设置实时位置点
        var marker = new BMap.Marker(point);
        var icons = "images/weizhi.png"; //这个是你要显示坐标的图片的相对路径 
        var icon = new BMap.Icon(icons, new BMap.Size(40, 40)); //显示图标大小 
        marker.setIcon(icon);
        marker.addEventListener("mouseover", function () {
            var label = new BMap.Label("实时位置", { offset: new BMap.Size(20, -10) });
            label.setStyle({
                "border-color": "Gray"
            });
            marker.setLabel(label);
        });
        var circle2 = new BMap.Circle(point, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆

        //设置围栏点
        var point2 = new BMap.Point(x2, y2);
        var marker2 = new BMap.Marker(point2);
        var icons2 = "images/mapcenter.png"; //这个是你要显示坐标的图片的相对路径 
        var icon2 = new BMap.Icon(icons2, new BMap.Size(20, 20)); //显示图标大小 
        marker2.setIcon(icon2);
        //  marker.enableDragging(); //点可拖拽
        marker2.addEventListener("mouseover", function () {
            var label2 = new BMap.Label("围栏基点", { offset: new BMap.Size(20, -10) });
            label2.setStyle({
                "border-color": "Gray"
            });
            marker2.setLabel(label2);
        });

        var circle = new BMap.Circle(point2, parseInt(radius), { strokeColor: "#0d5980", fillColor: "#19b1fc", strokeWeight: 1, fillOpacity: 0.3, strokeOpacity: 0.3 }); //创建圆
        //添加覆盖物
        map3.addOverlay(circle2); //添加实时位置圆
        map3.addOverlay(marker); //添加实时位置点
        map3.addOverlay(circle); //添加圆
        map3.addOverlay(marker2); //添加围栏点


        map3.addControl(new BMap.NavigationControl());  ///放大缩小
        map3.addControl(new BMap.ScaleControl());
        map3.addControl(new BMap.OverviewMapControl());
        map3.enableScrollWheelZoom();
        map3.addEventListener("zoomend", function (evt) {
            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("zoomend", function (evt) { });
        });
        map3.addEventListener("dragend", function (evt) {
            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("dragend", function (evt) { });
        });
        map3.addEventListener("click", function (e) {
            document.getElementById("weilanLong").value = e.point.lng;
            document.getElementById("weilanWei").value = e.point.lat;

            //   mapClick();
            map3.clearOverlays();
            //设置实时位置点
            var marker3 = new BMap.Marker(point);
            var icons3 = "images/weizhi.png"; //这个是你要显示坐标的图片的相对路径 
            var icon3 = new BMap.Icon(icons3, new BMap.Size(40, 40)); //显示图标大小 
            marker3.setIcon(icon3);
            marker3.addEventListener("mouseover", function () {
                var label = new BMap.Label("实时位置", { offset: new BMap.Size(20, -10) });
                label.setStyle({
                    "border-color": "Gray"
                });
                marker3.setLabel(label);
            });

            var circle5 = new BMap.Circle(point, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆

            //设置围栏点
            var x4 = document.getElementById("weilanLong").value;
            var y4 = document.getElementById("weilanWei").value;
            var point4 = new BMap.Point(x4, y4);
            var marker4 = new BMap.Marker(point4);
            var icons4 = "images/mapcenter.png"; //这个是你要显示坐标的图片的相对路径 
            var icon4 = new BMap.Icon(icons4, new BMap.Size(20, 20)); //显示图标大小 
            marker4.setIcon(icon4);
            //  marker.enableDragging(); //点可拖拽
            marker4.addEventListener("mouseover", function () {
                var label2 = new BMap.Label("围栏基点", { offset: new BMap.Size(20, -10) });
                label2.setStyle({
                    "border-color": "Gray"
                });
                marker4.setLabel(label2);
            });

            var circle4 = new BMap.Circle(point4, parseInt(radius), { strokeColor: "#0d5980", fillColor: "#19b1fc", strokeWeight: 1, fillOpacity: 0.3, strokeOpacity: 0.3 }); //创建圆
            //添加覆盖物
            map3.addOverlay(circle5); //添加实时位置圆
            map3.addOverlay(marker3); //添加实时位置点
            map3.addOverlay(circle4); //添加圆
            map3.addOverlay(marker4); //添加围栏点

            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("click", function (evt) { });
        });

        var distence = map3.getDistance(point, point2).toFixed(2);
        distence = parseInt(distence / 4);
        if (distence <= 20) {
            map3.centerAndZoom(point, 19); //定位中心点和地图级别
        } else if (distence > 20 && distence <= 50) {
            map3.centerAndZoom(point, 18); //定位中心点和地图级别
        } else if (distence > 50 && distence <= 100) {
            map3.centerAndZoom(point, 17); //定位中心点和地图级别
        } else if (distence > 100 && distence <= 200) {
            map3.centerAndZoom(point, 16); //定位中心点和地图级别
        } else if (distence > 200 && distence <= 500) {
            map3.centerAndZoom(point, 15); //定位中心点和地图级别
        } else if (distence > 500 && distence <= 1000) {
            map3.centerAndZoom(point, 14); //定位中心点和地图级别
        } else if (distence > 1000 && distence <= 2000) {
            map3.centerAndZoom(point, 13); //定位中心点和地图级别
        } else if (distence > 2000 && distence <= 5000) {
            map3.centerAndZoom(point, 12); //定位中心点和地图级别
        } else if (distence > 5000 && distence <= 10000) {
            map3.centerAndZoom(point, 11); //定位中心点和地图级别
        } else if (distence > 10000 && distence <= 20000) {
            map3.centerAndZoom(point, 10); //定位中心点和地图级别
        } else if (distence > 20000 && distence <= 25000) {
            map3.centerAndZoom(point, 9); //定位中心点和地图级别
        } else if (distence > 25000 && distence <= 50000) {
            map3.centerAndZoom(point, 8); //定位中心点和地图级别
        } else if (distence > 50000 && distence <= 100000) {
            map3.centerAndZoom(point, 7); //定位中心点和地图级别
        } else if (distence > 100000 && distence <= 200000) {
            map3.centerAndZoom(point, 6); //定位中心点和地图级别
        } else if (distence > 200000 && distence <= 500000) {
            map3.centerAndZoom(point, 5); //定位中心点和地图级别
        } else if (distence > 500000 && distence <= 1000000) {
            map3.centerAndZoom(point, 4); //定位中心点和地图级别
        } else if (distence > 1000000 && distence <= 2000000) {
            map3.centerAndZoom(point, 3); //定位中心点和地图级别
        }
    }
	
    var map3 = new BMap.Map("ElcMap");
	function setFradius(radius) {
		map3 = new BMap.Map("ElcMap");
        var radius2 = document.getElementById("txt_EleCrawlSS").value;
        var x = document.getElementById("dev_posLong").value; //实时位置
        var y = document.getElementById("dev_posLat").value; //实时位置
        var x2 = document.getElementById("weilanLong").value;
        var y2 = document.getElementById("weilanWei").value;

        var point = new BMap.Point(x, y);
        var point2 = new BMap.Point(x2, y2);

        if (document.getElementById("txt_centerLongHide").value.toString() == "0") {
            var distence = map3.getDistance(point, point2).toFixed(2);
            distence = parseInt(distence / 4);
            if (distence <= 20) {
                map3.centerAndZoom(point, 19); //定位中心点和地图级别
            } else if (distence > 20 && distence <= 50) {
                map3.centerAndZoom(point, 18); //定位中心点和地图级别
            } else if (distence > 50 && distence <= 100) {
                map3.centerAndZoom(point, 17); //定位中心点和地图级别
            } else if (distence > 100 && distence <= 200) {
                map3.centerAndZoom(point, 16); //定位中心点和地图级别
            } else if (distence > 200 && distence <= 500) {
                map3.centerAndZoom(point, 15); //定位中心点和地图级别
            } else if (distence > 500 && distence <= 1000) {
                map3.centerAndZoom(point, 14); //定位中心点和地图级别
            } else if (distence > 1000 && distence <= 2000) {
                map3.centerAndZoom(point, 13); //定位中心点和地图级别
            } else if (distence > 2000 && distence <= 5000) {
                map3.centerAndZoom(point, 12); //定位中心点和地图级别
            } else if (distence > 5000 && distence <= 10000) {
                map3.centerAndZoom(point, 11); //定位中心点和地图级别
            } else if (distence > 10000 && distence <= 20000) {
                map3.centerAndZoom(point, 10); //定位中心点和地图级别
            } else if (distence > 20000 && distence <= 25000) {
                map3.centerAndZoom(point, 9); //定位中心点和地图级别
            } else if (distence > 25000 && distence <= 50000) {
                map3.centerAndZoom(point, 8); //定位中心点和地图级别
            } else if (distence > 50000 && distence <= 100000) {
                map3.centerAndZoom(point, 7); //定位中心点和地图级别
            } else if (distence > 100000 && distence <= 200000) {
                map3.centerAndZoom(point, 6); //定位中心点和地图级别
            } else if (distence > 200000 && distence <= 500000) {
                map3.centerAndZoom(point, 5); //定位中心点和地图级别
            } else if (distence > 500000 && distence <= 1000000) {
                map3.centerAndZoom(point, 4); //定位中心点和地图级别
            } else if (distence > 1000000 && distence <= 2000000) {
                map3.centerAndZoom(point, 3); //定位中心点和地图级别
            }
        } else {
            var cenX = document.getElementById("txt_centerLongHide").value;
            var cenY = document.getElementById("txt_centerTalHide").value;
            var cenPoint = new BMap.Point(cenX, cenY);
            map3.centerAndZoom(cenPoint, parseInt(document.getElementById("txt_mapLevelHide").value.toString()));
        }

        //设置实时位置点
        var marker = new BMap.Marker(point);
        var icons = "images/weizhi.png"; //这个是你要显示坐标的图片的相对路径 
        var icon = new BMap.Icon(icons, new BMap.Size(40, 40)); //显示图标大小 
        marker.setIcon(icon);
        marker.addEventListener("mouseover", function () {
            var label = new BMap.Label("实时位置", { offset: new BMap.Size(20, -10) });
            label.setStyle({
                "border-color": "Gray"
            });
            marker.setLabel(label);
        });

        var circle2 = new BMap.Circle(point, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆

        //设置围栏点
        var point2 = new BMap.Point(x2, y2);
        var marker2 = new BMap.Marker(point2);
        var icons2 = "images/mapcenter.png"; //这个是你要显示坐标的图片的相对路径 
        var icon2 = new BMap.Icon(icons2, new BMap.Size(20, 20)); //显示图标大小 
        marker2.setIcon(icon2);
      
        marker2.addEventListener("mouseover", function () {
            var label2 = new BMap.Label("围栏基点", { offset: new BMap.Size(20, -10) });
            label2.setStyle({
                "border-color": "Gray"
            });
            marker2.setLabel(label2);
        });

        var circle = new BMap.Circle(point2, parseInt(radius), { strokeColor: "#0d5980", fillColor: "#19b1fc", strokeWeight: 1, fillOpacity: 0.3, strokeOpacity: 0.3 }); //创建圆
        //添加覆盖物
        map3.addOverlay(circle2); //添加实时位置圆
        map3.addOverlay(marker); //添加实时位置点
        map3.addOverlay(circle); //添加圆
        map3.addOverlay(marker2); //添加围栏点


        map3.addControl(new BMap.NavigationControl());  ///放大缩小
        map3.addControl(new BMap.ScaleControl());
        map3.addControl(new BMap.OverviewMapControl());
        map3.enableScrollWheelZoom();

        map3.addEventListener("zoomend", function (evt) {
            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("zoomend", function (evt) { });
        });
        map3.addEventListener("dragend", function (evt) {
            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("dragend", function (evt) { });
        });
        map3.addEventListener("click", function (e) {
            document.getElementById("weilanLong").value = e.point.lng;
            document.getElementById("weilanWei").value = e.point.lat;
            //   mapClick();
            map3.clearOverlays();
            //设置实时位置点
            var marker3 = new BMap.Marker(point);
            var icons3 = "images/weizhi.png"; //这个是你要显示坐标的图片的相对路径 
            var icon3 = new BMap.Icon(icons3, new BMap.Size(40, 40)); //显示图标大小 
            marker3.setIcon(icon3);
            marker3.addEventListener("mouseover", function () {
                var label = new BMap.Label("实时位置", { offset: new BMap.Size(20, -10) });
                label.setStyle({
                    "border-color": "Gray"
                });
                marker3.setLabel(label);
            });

            var circle5 = new BMap.Circle(point, parseInt(radius2), { strokeColor: "#80460d", fillColor: "#fc8b19", strokeWeight: 1, fillOpacity: 0.2, strokeOpacity: 0.2 }); //创建实时位置圆

            //设置围栏点
            var x4 = document.getElementById("weilanLong").value;
            var y4 = document.getElementById("weilanWei").value;
            var point4 = new BMap.Point(x4, y4);
            var marker4 = new BMap.Marker(point4);
            var icons4 = "images/mapcenter.png"; //这个是你要显示坐标的图片的相对路径 
            var icon4 = new BMap.Icon(icons4, new BMap.Size(20, 20)); //显示图标大小 
            marker4.setIcon(icon4);
            //  marker.enableDragging(); //点可拖拽
            marker4.addEventListener("mouseover", function () {
                var label2 = new BMap.Label("围栏基点", { offset: new BMap.Size(20, -10) });
                label2.setStyle({
                    "border-color": "Gray"
                });
                marker4.setLabel(label2);
            });

            var circle4 = new BMap.Circle(point4, parseInt(radius), { strokeColor: "#0d5980", fillColor: "#19b1fc", strokeWeight: 1, fillOpacity: 0.3, strokeOpacity: 0.3 }); //创建圆
            //添加覆盖物
            map3.addOverlay(circle5); //添加实时位置圆
            map3.addOverlay(marker3); //添加实时位置点
            map3.addOverlay(circle4); //添加圆
            map3.addOverlay(marker4); //添加围栏点

            var pt = map3.getBounds().getCenter();
            document.getElementById("txt_centerLongHide").value = pt.lng.toString();
            document.getElementById("txt_centerTalHide").value = pt.lat.toString();
            document.getElementById("txt_mapLevelHide").value = map3.getZoom();
            map3.removeEventListener("click", function (evt) { });
        });

    }
		
		
		//安护宝
		//门磁小时检查
        function MCcheckValueHour(vtip) {
            var v = document.getElementById("MCAlarmTimeHour" + vtip).value;
            if (v == "") {
                //  document.getElementById("MCHour_" + vtip).value = "";
            } else {
                if (parseInt(v) > 24) {
                    //  document.getElementById("MCHour_" + vtip).value = "小时不能超过24";
                    document.getElementById("MCAlarmTimeHour" + vtip).value = v.substr(0, 1);
                }else {
                    //    document.getElementById("MCHour_" + vtip).value = "";
                }
            }
            if (v == "24") {
                document.getElementById("MCAlarmTimeMin" + vtip).value = "00";
            }
            MCcheckBtn();
        }
        //门磁分钟检查
        function MCcheckValueMin(vtip) {
            var v = document.getElementById("MCAlarmTimeMin" + vtip).value;
            var vh = document.getElementById("MCAlarmTimeHour" + vtip).value;
            if (v == "") {
                //   document.getElementById("MCMin_" + vtip).value = "";
            } else {
            if (vh != "" && vh == "24") {
                document.getElementById("MCAlarmTimeMin" + vtip).value = "00";
            } else {
                if (parseInt(v) > 59) {
                    // document.getElementById("MCMin_" + vtip).value = "分钟不能超过59";
                    document.getElementById("MCAlarmTimeMin" + vtip).value = v.substr(0, 1);
                } else {
                    //    document.getElementById("MCMin_" + vtip).value = "";
                }
            }
            }
            MCcheckBtn();
        }
        //门磁确定按钮是否能生效检查
        function MCcheckBtn() {
            var t1 = document.getElementById("MCAlarmTimeHour1").value;
            var t2 = document.getElementById("MCAlarmTimeMin1").value;
            var t3 = document.getElementById("MCAlarmTimeHour2").value;
            var t4 = document.getElementById("MCAlarmTimeMin2").value;
            var t5 = document.getElementById("MCAlarmTimeHour3").value;
            var t6 = document.getElementById("MCAlarmTimeMin3").value;
            if (parseInt(t1) > 24 || parseInt(t2) > 60 || parseInt(t3) > 24 || parseInt(t4) > 60 || parseInt(t5) > 24 || parseInt(t6) > 60) {
                $("#mcIfSure").val("0");
            } else {
                $("#mcIfSure").val("1");
            }
        }
        //红外小时检查
        function HWcheckValueHour(vtip) {
            var v = document.getElementById("HWAlarmTimeHour" + vtip).value;
            if (v == "") {
                //  document.getElementById("HWHour_" + vtip).value = "";
            } else {
                if (parseInt(v) < 0 || parseInt(v) > 24) {
                    //     document.getElementById("HWHour_" + vtip).value = "小时不能超过24";
                    document.getElementById("HWAlarmTimeHour" + vtip).value = v.substr(0, 1);
                } else {
                    //      document.getElementById("HWHour_" + vtip).value = "";
                }
            }
            if (v == "24") {
                document.getElementById("HWAlarmTimeMin" + vtip).value = "00";
            }
            HWcheckBtn();
        }
        //红外分钟检查
        function HWcheckValueMin(vtip) {
            var v = document.getElementById("HWAlarmTimeMin" + vtip).value;
            var vh = document.getElementById("HWAlarmTimeHour" + vtip).value;
            if (v == "") {
                //   document.getElementById("HWMin_" + vtip).value = "";
            } else {
            if (vh != "" && vh == "24") {
                document.getElementById("HWAlarmTimeMin" + vtip).value = "00";
            } else {
                if (parseInt(v) < 0 || parseInt(v) > 59) {
                    //     document.getElementById("HWMin_" + vtip).value = "分钟不能超过59";
                    document.getElementById("HWAlarmTimeMin" + vtip).value = v.substr(0, 1);
                } else {
                    //     document.getElementById("HWMin_" + vtip).value = "";
                }
            }
            }
            HWcheckBtn();
        }
        //门磁确定按钮是否能生效检查
        function HWcheckBtn() {
            var t1 = document.getElementById("HWAlarmTimeHour1").value;
            var t2 = document.getElementById("HWAlarmTimeMin1").value;
            var t3 = document.getElementById("HWAlarmTimeHour2").value;
            var t4 = document.getElementById("HWAlarmTimeMin2").value;
            var t5 = document.getElementById("HWAlarmTimeHour3").value;
            var t6 = document.getElementById("HWAlarmTimeMin3").value;
            if (parseInt(t1) > 24 || parseInt(t2) > 60 || parseInt(t3) > 24 || parseInt(t4) > 60 || parseInt(t5) > 24 || parseInt(t6) > 60) {
                $("#hwIfSure").val("0");
            } else {
                $("#hwIfSure").val("1");
            }
        }
        //检查时间，补0
    	function checkTime(time)
    	{
        	if (time == "")
        	{
            	return "00";
        	}
        	else if (time.length == 1)
        	{
            	return "0" + time;
        	}
        	else
        	{
            	return time;
        	}
    	}
    	//查询安护宝设备配置信息
    	function query_devset(){
		    var devId = "<%=request.getAttribute("devId")%>";
		
			var reqmsg="{'action':'QUERY_DEV_INFO_REQUEST','content':{\"olderShow\":\"true\",\"id\":"+devId+"}}";
		  	jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "dev.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsg
          		},
          		success : function(data){
              		if(data.des=="success"){
            	  		if(data.content != null){
            	  			if(data.content.doorCode != null && data.content.doorCode != ""){
								$("#MCSBBH").val(data.content.doorCode);
							}
							if(data.content.doorAlarmDelay != null && data.content.doorAlarmDelay != ""){
								$("#MCAlarmTimeHour1").val(data.content.doorAlarmDelay.substr(0,2));
								$("#MCAlarmTimeMin1").val(data.content.doorAlarmDelay.substr(2,2));
							}else
                			{
                				$("#MCAlarmTimeHour1").val("00");
								$("#MCAlarmTimeMin1").val("10");
                			}
							if(data.content.doorAlarmStart != null && data.content.doorAlarmStart != ""){
								$("#MCAlarmTimeHour2").val(data.content.doorAlarmStart.substr(0,2));
								$("#MCAlarmTimeMin2").val(data.content.doorAlarmStart.substr(2,2));
							}else
                			{
                				$("#MCAlarmTimeHour2").val("00");
								$("#MCAlarmTimeMin2").val("00");
                			}
							if(data.content.doorAlarmEnd != null && data.content.doorAlarmEnd != ""){
								$("#MCAlarmTimeHour3").val(data.content.doorAlarmEnd.substr(0,2));
								$("#MCAlarmTimeMin3").val(data.content.doorAlarmEnd.substr(2,2));
							}else
                			{
                				$("#MCAlarmTimeHour3").val("24");
								$("#MCAlarmTimeMin3").val("00");
                			}
                			
                			if(data.content.irCode != null && data.content.irCode != ""){
								$("#HWSBBH").val(data.content.irCode);
							}
							if(data.content.irAlarmDelay != null && data.content.irAlarmDelay != ""){
								$("#HWAlarmTimeHour1").val(data.content.irAlarmDelay.substr(0,2));
								$("#HWAlarmTimeMin1").val(data.content.irAlarmDelay.substr(2,2));
							}else
                			{
                				$("#HWAlarmTimeHour1").val("12");
								$("#HWAlarmTimeMin1").val("00");
                			}
							if(data.content.irAlarmStart != null && data.content.irAlarmStart != ""){
								$("#HWAlarmTimeHour2").val(data.content.irAlarmStart.substr(0,2));
								$("#HWAlarmTimeMin2").val(data.content.irAlarmStart.substr(2,2));
							}else
                			{
                				$("#HWAlarmTimeHour2").val("00");
								$("#HWAlarmTimeMin2").val("00");
                			}
							if(data.content.irAlarmEnd != null && data.content.irAlarmEnd != ""){
								$("#HWAlarmTimeHour3").val(data.content.irAlarmEnd.substr(0,2));
								$("#HWAlarmTimeMin3").val(data.content.irAlarmEnd.substr(2,2));
							}else
                			{
                				$("#HWAlarmTimeHour3").val("24");
								$("#HWAlarmTimeMin3").val("00");
                			}
            	  		}
              		}else if(data.des=="failure"){
                 		alert("查询失败");
              		}
          		},
          		error:function(){
	           		alert("error");
          		}
    	 	});	
    	}
    	//保存安护宝设备配置信息
        function save_devset(){
        	var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
        	//门磁时间
        	var MCSBBH = $.trim($("#MCSBBH").val());
        	if(MCSBBH.length > 50){
        		alert("门磁设备编号过长");
        		return;
        	}
        	var mc1 = $.trim($("#MCAlarmTimeHour1").val());
            var mc2 = $.trim($("#MCAlarmTimeMin1").val());
            var mc3 = $.trim($("#MCAlarmTimeHour2").val());
            var mc4 = $.trim($("#MCAlarmTimeMin2").val());
            var mc5 = $.trim($("#MCAlarmTimeHour3").val());
            var mc6 = $.trim($("#MCAlarmTimeMin3").val());
            var MCAlarmTime1 = "";
        	if (mc1 != "" && mc2 != "")
        	{
            	MCAlarmTime1 = checkTime(mc1) + checkTime(mc2);
            	if(!reg1.test(parseInt(MCAlarmTime1))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
        	var MCAlarmTime2 = "";
        	if (mc3 != "" && mc4 != "")
        	{
            	MCAlarmTime2 = checkTime(mc3) + checkTime(mc4);
            	if(!reg1.test(parseInt(MCAlarmTime2))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
        	var MCAlarmTime3 = "";
	        if (mc5 != "" && mc6 != "")
        	{
            	MCAlarmTime3 = checkTime(mc5) + checkTime(mc6);
            	if(!reg1.test(parseInt(MCAlarmTime3))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
       		if(MCAlarmTime1 != "" || MCAlarmTime2 != "" || MCAlarmTime3 != ""){
        		if(MCSBBH == ""){
        			alert("请填写门磁设备编号");
        			return
        		}
        		var mcIfSure = $("#mcIfSure").val();
        		if(mcIfSure == "0"){
        			alert("请输入符合规范的门磁参数");
        			return;
        		}
        	}
        	
       		//红外时间
       		var HWSBBH = $.trim($("#HWSBBH").val());
       		if(HWSBBH.length > 50){
        		alert("红外设备编号过长");
        		return;
        	}
       		var hw1 = $.trim($("#HWAlarmTimeHour1").val());
            var hw2 = $.trim($("#HWAlarmTimeMin1").val());
            var hw3 = $.trim($("#HWAlarmTimeHour2").val());
            var hw4 = $.trim($("#HWAlarmTimeMin2").val());
            var hw5 = $.trim($("#HWAlarmTimeHour3").val());
            var hw6 = $.trim($("#HWAlarmTimeMin3").val());
            var HWAlarmTime1 = "";
        	if (hw1 != "" && hw2 != "")
        	{
            	HWAlarmTime1 = checkTime(hw1) + checkTime(hw2);
            	if(!reg1.test(parseInt(HWAlarmTime1))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
        	var HWAlarmTime2 = "";
        	if (hw3 != "" && hw4 != "")
        	{
            	HWAlarmTime2 = checkTime(hw3) + checkTime(hw4);
            	if(!reg1.test(parseInt(HWAlarmTime2))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
        	var HWAlarmTime3 = "";
	        if (hw5 != "" && hw6 != "")
        	{
            	HWAlarmTime3 = checkTime(hw5) + checkTime(hw6);
            	if(!reg1.test(parseInt(HWAlarmTime3))){ 
        			alert("请输入符合规范的参数!");
        			return;
    			}
        	}
        	if(HWAlarmTime1 != "" || HWAlarmTime2 != "" || HWAlarmTime3 != ""){
        		if(HWSBBH == ""){
        			alert("请填写红外设备编号");
        			return
        		}
        		var hwIfSure = $("#hwIfSure").val();
        		if(hwIfSure == "0"){
        			alert("请输入符合规范的红外参数");
        			return;
        		}
        	}
        	
        	var head_devtype_hide = $("#head_devtype_hide").val();
        	
			var reqmsg="{'action':'ADD_DEV_INFO_REQUEST','content':{";
			
			reqmsg += "\"type\":" + head_devtype_hide + ",";
			if(MCSBBH != ""){
				reqmsg += "\"doorCode\":\"" + MCSBBH + "\",";
				if(MCAlarmTime1 != ""){
					reqmsg += "\"doorAlarmDelay\":\"" + MCAlarmTime1 + "\",";
				}
				if(MCAlarmTime2 != ""){
					reqmsg += "\"doorAlarmStart\":\"" + MCAlarmTime2 + "\",";
				}
				if(MCAlarmTime3 != ""){
					reqmsg += "\"doorAlarmEnd\":\"" + MCAlarmTime3 + "\",";
				}
			}
			
			if(HWSBBH != ""){
				reqmsg += "\"irCode\":\"" + HWSBBH + "\",";
				if(HWAlarmTime1 != ""){
					reqmsg += "\"irAlarmDelay\":\"" + HWAlarmTime1 + "\",";
				}
				if(HWAlarmTime2 != ""){
					reqmsg += "\"irAlarmStart\":\"" + HWAlarmTime2 + "\",";
				}
				if(HWAlarmTime3 != ""){
					reqmsg += "\"irAlarmEnd\":\"" + HWAlarmTime3 + "\",";
				}
			}
			
			var devId = "<%=request.getAttribute("devId")%>";
			reqmsg += "\"id\":" + devId + ",";
			
			reqmsg=reqmsg.substr(0,reqmsg.length-1);
			reqmsg += "}}";

			jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "dev.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsg
          		},
          		success : function(data){
              		if(data.des=="success"){
              			alert("配置成功");
              			disabled2edit2_ahb();
              		}else if(data.des=="failure"){
                 		alert("配置失败");
              		}else{
              			alert(data.des);
              		}
          		},
          		error:function(){
	           		alert("error");
          		}
     		});
        }
        
        
/////报警历史///////////////////////////////////////////
var currentshownpage_alarm = 1;
function query_alarm() {
	go2page_alarm(1);
}
function go2page_alarm(pagenumber){
	var pagesize = $("#pageSizeSelector_alarm option:selected").val();
	var list_alarmType = $("#list_alarmType").val();
	var list_alarmtTimeStart = $("#list_alarmtTimeStart").val();
	var list_alarmtTimeEnd = $("#list_alarmtTimeEnd").val();
	var devId = "<%=request.getAttribute("devId")%>";

	var reqmsg="{'action':'QUERY_DEV_ALARM_LIST_REQUEST','order':[{'column':'alarmTime','type':'desc'}],'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"olderShow\":\"true\",";
	
	reqmsg += "\"devId\":" + devId + ",";
	if (list_alarmType != null && list_alarmType != "") {
		reqmsg += "\"alarmType_in\":\"" + list_alarmType + "\",";
	}
	if (list_alarmtTimeStart != null && list_alarmtTimeStart != "") {
	    list_alarmtTimeStart = list_alarmtTimeStart.substring(0, 4) + list_alarmtTimeStart.substring(5, 7) + list_alarmtTimeStart.substring(8, 10) + list_alarmtTimeStart.substring(11, 13) + list_alarmtTimeStart.substring(14, 16) + "01";
		reqmsg += "\"alarmTime_ge\":\"" + list_alarmtTimeStart + "\",";
	}
	if (list_alarmtTimeEnd != null && list_alarmtTimeEnd != "") {
	    list_alarmtTimeEnd = list_alarmtTimeEnd.substring(0, 4) + list_alarmtTimeEnd.substring(5, 7) + list_alarmtTimeEnd.substring(8, 10) + list_alarmtTimeEnd.substring(11, 13) + list_alarmtTimeEnd.substring(14, 16) + "59";
		reqmsg += "\"alarmTime_le\":\"" + list_alarmtTimeEnd + "\",";
	}
	if(list_alarmtTimeStart != null && list_alarmtTimeStart != "" && list_alarmtTimeEnd != null && list_alarmtTimeEnd != ""){
		if(list_alarmtTimeStart > list_alarmtTimeEnd){
			alert("开始时间不得大于结束时间");
			return;
		}
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "devAlarm.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData_alarm(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
function changeData_alarm(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.devAlarmList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\">";		
		    htmlcode += "<td>" + formateTime(item.alarmTime) + "</td>";	
		    htmlcode += "<td>" + item.olderName + "</td>";	
		    htmlcode += "<td>" + item.alarmContent + "</td>";
		    
		    if(item.address != null && item.address != ""){
		    	htmlcode += "<td onclick=\"bjlsMapTip(" + item.id + ")\"><a href=\"###\">" + item.address + "</a></td>";		
		    }else{
		    	 if(item.posLong != null && item.posLong != ""){
		    	 	htmlcode += "<td onclick=\"bjlsMapTip(" + item.id + ")\"><a href=\"###\">" + item.posLong + " , " + item.posLat + "</a></td>";
		    	 }else{
		    	 	htmlcode += "<td onclick=\"bjlsMapTip(" + item.id + ")\"><a href=\"###\">未知</a></td>";
		    	 }
		    }
		    
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer_alarm").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml_alarm(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml_alarm(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml_alarm(1, 1);
		genarateRecordNumberHtml_alarm(1, 10, 0);
	}
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml_alarm
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml_alarm(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info_alarm").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml_alarm
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml_alarm(currentpage, totalpage, pagesize) {
	currentshownpage_alarm = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_alarm('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_alarm('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_alarm('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_alarm('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_alarm('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_alarm('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea_alarm").html(htmlcode);
}
//报警历史页签历史数据报警位置地图
function bjlsMapTip(id){
	$("#tc_jwd").val("未知");
	$("#baiduMap3").html("");
	var reqmsg="{'action':'QUERY_DEV_ALARM_INFO_REQUEST','content':{";
	
	if (id != null && id != "") {
		reqmsg += "\"id\":" + id + ",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "devAlarm.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	  if (data.content.address != null && data.content.address != "") {
            	  	  	   if (data.content.posLong != null && data.content.posLong != "") {
            	  	  	   	   $("#tc_jwd").val("地址：" + data.content.address + "  经纬度：" + data.content.posLong + " , " + data.content.posLat);
            	  	  	   
            	  	  	   		var map_tc = new BMap.Map("baiduMap3");    // 创建Map实例
            	  	  	   		var point_tc = new BMap.Point(data.content.posLong, data.content.posLat);
            	  	  	   		map_tc.centerAndZoom(point_tc, 18);
            	  	  	   		var marker_tc = new BMap.Marker(point_tc);
            	  	  	   		map_tc.addOverlay(marker_tc);
            	  	  	   }else{
	            	  	  	   $("#tc_jwd").val("地址：" + data.content.address + "  经纬度：未知");
            	  	  	   }
            	  	  }else{
            	  	  	   if (data.content.posLong != null && data.content.posLong != "") {
            	  	  	   	   $("#tc_jwd").val("地址：未知  经纬度：" + data.content.posLong + " , " + data.content.posLat);
            	  	  	   
            	  	  	   		var map_tc = new BMap.Map("baiduMap3");    // 创建Map实例
            	  	  	   		var point_tc = new BMap.Point(data.content.posLong, data.content.posLat);
            	  	  	   		map_tc.centerAndZoom(point_tc, 18);
            	  	  	   		var marker_tc = new BMap.Marker(point_tc);
            	  	  	   		map_tc.addOverlay(marker_tc);
            	  	  	   }
            	  	  }
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
     
	$('#fakeMapModal').click();
}



/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 8) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8);
	} else if(time != null && time.length == 14){
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}
</script>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
