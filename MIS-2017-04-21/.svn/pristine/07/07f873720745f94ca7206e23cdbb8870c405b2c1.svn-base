<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>工单管理</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  	<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  	<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>
<style>
.hideAndShow{display:none;}
.no-bg-border{background-color:#fff;border:none}

.hideul{position:absolute;top:33px;z-index:200;right:15px;left:15px;display:none}
.hideul ul{ border:1px solid #ccc;width:100%;background:#f4f4f4;padding-left:0}
.hideul ul li{ list-style-type:none;text-indent:20px}
.hideul ul li:hover{ background:#ddd}
.mytablenopadding>tr>td{padding-top:0 !important;padding-bottom:0 !important;}
.mytablenopadding>tr>td:nth-child(2){padding-top:7px !important;padding-bottom:7px !important;text-align:right}
.mytablenopadding>tr{background:#fff !important;}
.mytablenopadding input,.mytablenopadding select{border:0}

</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>	
<div id="cl-wrapper" style="padding-top:0px">	
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2>工单管理</h2>
				<ol class="breadcrumb">
					<li>服务管理</li>
					<li class="active">工单管理</li>
					<input type="hidden" id="addUserName" value="">
					<input type="hidden" id="addUserSites" value="">
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->
	<div class="cl-mcont">
    <div class="block-flat">
						<div class="row">
									
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>老人姓名</label>
										</div>
										<div class="col-sm-4 "  style="position:relative">
											<div class="input-group " >
												<input class="form-control"  type="text" id="oldinput_search" onclick="getolderName()" oninput="getolderName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
												<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
												<ul id="hideul_nei1">
							
												</ul>
											</div>
										</div>
										
										<div class="col-sm-2 " style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>服务项目</label>
										</div>
										<div class="col-sm-4 "  style="position:relative">
											<div class="input-group " >
												<input type="hidden" value="" id="fwxminput_Id"> 
												<input class="form-control"  type="text" id="fwxminput_search" onclick="getFWXM()" oninput="getFWXM()" onmouseout="javascript:$('#hideul-2').hide();" onmouseover="javascript:$('#hideul-2').show();">
												<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-2"  onmouseover="javascript:$('#hideul-2').show();" onmouseout="javascript:$('#hideul-2').hide();">
												<ul id="hideul_nei2">
							
												</ul>
											</div>
										</div>
										
										<div class="col-sm-2 hideAndShow" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>工单编号</label>
										</div>
										<div class="col-sm-4 hideAndShow" style="margin-bottom:10px;">
											<input class="form-control" type="text" style="width: 100%" id="fuwugdbh_input">
										</div>
										
										<div class="col-sm-2  col-md-2 hideAndShow" style="vertical-align: middle; height: 34px; line-height: 34px;">
											<label>服务状态</label>
										</div>
										<div class="col-sm-4 col-md-4 hideAndShow" style="margin-bottom:10px;">
											<select id="fuwustate_input" class="select2" multiple>
                      							<option value="1">取消</option>
                       							<option value="2">待排班</option>
                       							<option value="3">待审核</option>
                       							<option value="4">审核通过</option>
                       							<option value="5">服务开始</option>
                       							<option value="6">服务结束</option>
                       							<option value="7">回访结束</option>
                  	  						</select>
										</div>
										<div class="col-sm-2  col-md-2 hideAndShow" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>收费类别</label>
										</div>
										<div class="col-sm-4 col-md-4 hideAndShow" style="margin-bottom:10px;">
											<select id="fuwutype_input" class="select2">
                      							<option value="">全部</option>
                       							<option value="1">医保</option>
                       							<option value="2">市场</option>
                  	  						</select>
										</div>
										<div class="col-sm-2  col-md-2 hideAndShow" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>负责人</label>
										</div>
										<div class="col-sm-4 col-md-4 hideAndShow" style="position:relative">
											<div class="input-group " >
												<input type="hidden" value="" id="pgrinputId">
												<input class="form-control"  type="text" id="pgrinput_search" onclick="getepgrName()" oninput="getepgrName()" onmouseout="javascript:$('#hideul-25').hide();" onmouseover="javascript:$('#hideul-25').show();">
												<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-25"  onmouseover="javascript:$('#hideul-25').show();" onmouseout="javascript:$('#hideul-25').hide();">
												<ul id="hideul_nei25">
							
												</ul>
											</div>
										</div>
					<div class="col-sm-2  col-md-2 hideAndShow" style="padding-top:5px">
						 <strong>预计服务时间</strong>
					</div>
					<div class="col-sm-4 col-md-4 hideAndShow" style="">						
                		<div class="input-group">
                		<input class="datetime form-control"  size="10" type="text" id="yjfwsjstart_input" readonly="" data-min-view="2" data-date-format="yyyy-mm-dd" placeholder="YYYY-MM-DD"/>
                		<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
                		<span class="input-group-addon no-bg-border">~</span>
                		<input class="datetime form-control"   size="10" type="text" id="yjfwsjend_input" readonly="" data-min-view="2" data-date-format="yyyy-mm-dd" placeholder="YYYY-MM-DD"/>
                		<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
                		</div>
					</div>
					<div class="col-sm-2  col-md-2 hideAndShow" style="padding-top:5px">
						 <strong>结束服务时间</strong>
					</div>
					<div class="col-sm-4 col-md-4 hideAndShow" style="">						
                		<div class="input-group">
                		<input class="datetime form-control"  size="10" type="text" id="jsfwsjstart_input" readonly="" data-min-view="2" data-date-format="yyyy-mm-dd" placeholder="YYYY-MM-DD"/>
                		<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
                		<span class="input-group-addon no-bg-border">~</span>
                		<input class="datetime form-control"   size="10" type="text" id="jsfwsjend_input" readonly="" data-min-view="2" data-date-format="yyyy-mm-dd" placeholder="YYYY-MM-DD"/>
                		<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
                		</div>
					</div>
										
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-top:20px">	
											<c:if test="${serviceTask_query_btn_control != 'yes' or serviceTask_query_btn_show == 'yes'}">	
												<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query()">查询</button>
											</c:if>	
											<a style="cursor:pointer;text-decoration:underline;vertical-align:bottom;" onclick="$('.hideAndShow').toggle();">更多查询条件</a>
											<div class="btn-group" style="margin-top:5px;float:right;margin-right:0">
												 <c:if test="${serviceTask_add_btn_control != 'yes' or serviceTask_add_btn_show == 'yes'}">
						  						 <button type="button" class="btn btn-primary dropdown-toggle  md-trigger" data-toggle="dropdown" data-modal="servicegongdan_add" onclick="qingkongXZ()">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
						 						 </button>
						 						 </c:if>	
						 						 <c:if test="${serviceTask_del_btn_control != 'yes' or serviceTask_del_btn_show == 'yes'}">
						 						 <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown"  style="margin-left:5px;margin-right:0" onclick="doDel()">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>删除</span>
						 						 </button>
												 </c:if>	
												 <c:if test="${serviceTask_qx_btn_control != 'yes' or serviceTask_qx_btn_show == 'yes'}">
												  <button type="button" class="btn btn-danger dropdown-toggle  md-trigger" data-toggle="dropdown" style="display:none;" data-modal="servicegongdan_quxiao" id="quxiao_open"></button>
						 						  <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" onclick="quxiao_qingkong()" style="margin-left:5px;margin-right:0">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>取消</span>
						 						  </button>
												 </c:if>	
										 	</div>
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th style="width:2%;"><input id="allselectchecker" type="checkbox" class="col_selector" onclick="selectAll();"></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serviceCode')"><strong>服务工单编号</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_olderName')"><strong>老人</strong></th>
														<th><strong>服务项目</strong></th>
														<th><strong>负责人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'status')"><strong>工单状态</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_healthInsurance')"><strong>收费类别</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serviceExpectTime')"><strong>预计服务时间</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serviceEndTime')"><strong>结束服务时间</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">	
																															
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 --
									<!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector"   size="1"  onchange="query()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
								</div>

							</div> 
	
					</div> <!-- 主页面结束 -->

    <!-- 模态框开始-->
               
               <!-- 新增服务工单 -->
               <div class="md-modal md-effect-1" id="servicegongdan_add"  style="min-width:550px">
				<div class="md-content" style="height:800px;overflow-y:scroll">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>新增服务工单</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        <div class="form-group" style="margin-bottom:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">老人</div> 
                         		<div class="col-sm-4 col-xs-8"  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="olderId_hide" value="">
										<input class="form-control"  type="text" id="oldinput_search2" onclick="getolderName2()" oninput="getolderName2()" onmouseout="javascript:$('#hideul-12').hide();" onmouseover="javascript:$('#hideul-12').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-12"  onmouseover="javascript:$('#hideul-12').show();" onmouseout="javascript:$('#hideul-12').hide();">
										<ul id="hideul_nei12">
							
										</ul>
									</div>
								</div> 
								<div class="col-sm-2 col-xs-4">联系人</div> 
                         		<div class="col-sm-4 col-xs-8">
									<input type="text" class="form-control" id="oldinput_contentName"     style="margin-bottom: 15px;">
								</div>
								<div class="col-sm-2 col-xs-4">联系电话</div> 
                         		<div class="col-sm-4 col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentTel" style="margin-bottom: 15px;">
								</div> 
							</div>
                        </div>
                        <div class="form-group" style="margin-bottom:0;margin-top:0">
                        	<div class="row">
								<div class="col-sm-2 col-xs-4" >联系地址</div> 
                         		<div class="col-sm-10 col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentAddress" style="margin-bottom: 15px;">
								</div> 
							</div>
                        </div>
                        <div class="form-group" style="margin-bottom:0;margin-top:0">
                        	<div class="row">
								<div class="col-sm-2 col-xs-4">负责人</div> 
                         		<div class="col-sm-10  col-xs-8"  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="fuzerenId_hide" value="">
										<input type="hidden" id="fuzerenName_hide" value="">
										<input type="hidden" id="fuzerenRole_hide" value="">
										<input type="hidden" id="fuzerenBH_hide" value="">
										<input type="hidden" id="fuzerenSiteId_hide" value="">
										<input type="hidden" id="fuzerenSiteName_hide" value="">
										<input class="form-control"  type="text" id="fprinput_search" onclick="getefprName()" oninput="getefprName()" onmouseout="javascript:$('#hideul-3').hide();" onmouseover="javascript:$('#hideul-3').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-3"  onmouseover="javascript:$('#hideul-3').show();" onmouseout="javascript:$('#hideul-3').hide();">
										<ul id="hideul_nei3">
								
										</ul>
									</div>
								</div> 
                        	</div>
                        </div>
                		<div class="form-group" style="margin-top:0">
                			<div class="row">
                			<div class="col-sm-2 col-xs-4">参与人</div>
                			<div class="col-sm-10 col-xs-8" >
                  				<select class="select2" id="cyrinput_search" multiple>
                       			
                  				</select>
               			    </div>
               			    </div>
             		    </div>
                        <div class="form-group" style="margin-bottom:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">服务内容</div> 
                         		<div class="col-sm-10 col-xs-8"  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="fwxminput_Id4_hide" value="">
										<input type="hidden" id="fwxminput_SCPRICE4_hide" value="">
										<input type="hidden" id="fwxminput_YBPRICE4_hide" value="">
										<input class="form-control"  type="text" id="fwxminput_search4" onclick="getFWXM4()" oninput="getFWXM4()" onmouseout="javascript:$('#hideul-24').hide();" onmouseover="javascript:$('#hideul-24').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-24"  onmouseover="javascript:$('#hideul-24').show();" onmouseout="javascript:$('#hideul-24').hide();">
										<ul id="hideul_nei24">
							
										</ul>
									</div>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">服务子项</div> 
                         		<div class="col-sm-10 col-xs-8 " >
									<select class="select2" id="fuwuzixianginput_search" multiple>
                       			
                  					</select>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">预计服务时长</div> 
                         		<div class="col-sm-4 col-xs-8 " >
									<div class="input-group" ><input type="text" class="form-control" id="yjfwsc" onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">分钟</span></div>
								</div> 
								<div class="col-sm-2 col-xs-4"  style="padding-top:5px">收费类型</div> 
                         		<div class="col-sm-4 col-xs-8" >
									<select id="fuwusflx_search" class="form-control" onchange="getFWXM_jiage()">
                       					<option value="医保">医保</option>
                       					<option value="市场">市场</option>
                  					</select>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">价格</div> 
                         		<div class="col-sm-10 col-xs-8" id="fuwusfjg_search">
                         		暂无
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group">
                        	<div class="row">
                        	<div class=" col-sm-12">
                         		<table class="table no-border " >
								<thead class="no-border">
									<tr>										
										<th ><strong>&nbsp;&nbsp;预计服务时间</strong></th>									
																		
										<th style="text-align:right;" ><strong>操作</strong></th>
									</tr>
								</thead>
								<tbody class="no-border-y mytablenopadding" id="yujiFWDate">
									<!-- <tr>
										<td >
											<input class="form-control datetime" size="16" type="text" value="" />
										</td>															
										<td > <a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td>
									</tr> -->									
									<tr id="addshuizhong">								
										<td> </td>
										<td style="text-align:right"><a class="label btn-primary " onclick="addshuizhong();"><i class="fa fa-plus"></i></a> </td>
									</tr>
								</tbody>
							</table>
                         		</div>
                        	</div>
                        </div> 
                        
                                      
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn  btn-primary btn-flat" id="model_sure" onclick="saveMany()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="closeAll" onclick="qingkongXZ()">取消</button>
                      </div>
				</div>  
			  </div> 
  				
  				<!-- 工单取消-->
                <div class="md-modal colored-header custom-width md-effect-9" id="servicegongdan_quxiao">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>取消操作日志</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <input type="hidden" id="idForQX" value="">
                      </div>
                      <div class="modal-body form form-horizontal">
                     <!--  <form class="" > -->
						<div class="form-group" id="hyIfxianshi">
						    <label class="col-sm-4 control-label">备注</label>
						<div class="col-sm-6 " >
							<textarea class="form-control" id="beizhu_input_quxiao"></textarea>		
						</div>
                        </div>
                        <!-- </form> -->	
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat" data-dismiss="modal" onclick="sureQuxiao()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="quxiao_tanchuang">取消</button>
                      </div>
                    </div>
                </div>
                
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page(currentshownpage);
}

	   //只能输入数字0-9
        function keyPress() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        }
        
	$(document).ready(function(){
		var status="<%=request.getAttribute("status")%>";
      	if(status != null && status != ""){
      		var html = new Array();
			if(status == "2"){
				html.push("2");
				$("#fuwustate_input").val(html).trigger("change");
			}
			if(status == "3"){
				html.push("3");
				$("#fuwustate_input").val(html).trigger("change");
			}
			var time_start="<%=request.getAttribute("time_start")%>";
			var time_end="<%=request.getAttribute("time_end")%>";
			if(status == "4,5"){
				html.push("4");
				html.push("5");
				$("#fuwustate_input").val(html).trigger("change");
				$("#yjfwsjend_input").val(time_end.substring(0, 4) + "-" + time_end.substring(4, 6) + "-" + time_end.substring(6, 8));
			}
			if(status == "6,7"){
				html.push("6");
				html.push("7");
				$("#fuwustate_input").val(html).trigger("change");
				$("#jsfwsjstart_input").val(time_start.substring(0, 4) + "-" + time_start.substring(4, 6) + "-" + time_start.substring(6, 8));
				$("#jsfwsjend_input").val(time_end.substring(0, 4) + "-" + time_end.substring(4, 6) + "-" + time_end.substring(6, 8));
			}
		}
		
		var type="<%=request.getAttribute("type")%>";
      	if(type != null && type != ""){
      		var name="<%=request.getAttribute("name")%>";
      		var id="<%=request.getAttribute("id")%>";
      		if(type == "fzr"){
      			$("#pgrinputId").val(id);
      			$("#pgrinput_search").val(name);
      		}
      		if(type == "older"){
      			$("#oldinput_search").val(name);
      		}
      	}
		
		query();
		getLoginName();
        getcyrName();
		
		$(".deleteThisTime").click(function(){               //清除日期框中的值
    	      $(this).parent().prev()[0].value = "";
    	      // $(this).parent().siblings("input").val("");
    	});
    	    
    	App.init();
    	$(".md-trigger").modalEffects();
    	
    	$("#oldinput_search2").keydown(function() { //焦点在弹窗第一个时，按回车，焦点跳转到第二个
			if (event.keyCode == 13) {
				$("#oldinput_contentName").focus();
				return;
			}
		});
		$("#oldinput_contentName").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentTel").focus();
				return;
			}
		});
		$("#oldinput_contentTel").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentAddress").focus();
				return;
			}
		});
		$("#oldinput_contentAddress").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fprinput_search").focus();
				return;
			}
		});
		$("#fprinput_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#cyrinput_search").focus();
				return;
			}
		});
		$("#cyrinput_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fwxminput_search4").focus();
				return;
			}
		});
		$("#fwxminput_search4").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwuzixianginput_search").focus();
				return;
			}
		});
		$("#fuwuzixianginput_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#yjfwsc").focus();
				return;
			}
		});
		$("#yjfwsc").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwusflx_search").focus();
				return;
			}
		});
		$("#fuwusflx_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwusfjg_search").focus();
				return;
			}
		});
		$("#fuwusfjg_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#model_sure").focus();
				return;
			}
		});
		
		
	});
	function addshuizhong(){
   		var addhtml = '<tr><td ><input class="form-control datetime" size="16"  type="text"></td><td><a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td></tr>';
   		$(addhtml).insertBefore("#addshuizhong"); 
   	  var config = {dateTime:true};  //初始化新增的datepicker，不会导致格式错乱
      $( ".ui-datepicker" ).datepicker();
     if(config.dateTime){
     $(".datetime").datetimepicker({autoclose: true});
   }
   }
   var currentshownpage = 1;
   function selectAll() {
		if ($("#allselectchecker").is(':checked')) {
			$(".col_selector").prop("checked", true);
		} else {
			$(".col_selector").prop("checked", false);
		}
	}
	
	//查询服务工单列表信息-过滤微信工单
	function query() {
		go2page(1);
	}
	function go2page(pagenumber){
	var pagesize = $("#pageSizeSelector option:selected").val();
	var oldinput_search = $.trim($("#oldinput_search").val());
	var fwxminput_Id = $("#fwxminput_Id").val();
	var fwxminput_search = $("#fwxminput_search").val();
	var fuwustate_input = $("#fuwustate_input").val();
	var fuwutype_input = $("#fuwutype_input").val();
	var fuwugdbh_input = $("#fuwugdbh_input").val();
	
	var pgrinputId = $("#pgrinputId").val();
	if($.trim($("#pgrinput_search").val()) == ""){
		$("#pgrinputId").val("");
		pgrinputId = "";
	}
	
	var yjfwsjstart_input = $("#yjfwsjstart_input").val();
	var yjfwsjend_input = $("#yjfwsjend_input").val();
	var jsfwsjstart_input = $("#jsfwsjstart_input").val();
	var jsfwsjend_input = $("#jsfwsjend_input").val();
	if(yjfwsjstart_input !="" && yjfwsjend_input !="" && yjfwsjstart_input > yjfwsjend_input){
		alert("预计服务开始时间不能大于结束时间");
		return;
	}
	if(jsfwsjstart_input !="" && jsfwsjend_input !="" && jsfwsjstart_input > jsfwsjend_input){
		alert("结束服务开始时间不能大于结束时间");
		return;
	}
	
	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"serviceListShow\":\"true\",\"serviceEmployeeListShow\":\"true\",";
	
	reqmsg += "\"source_isNull\":\"null\",";
	if (oldinput_search != null && oldinput_search != "") {
		reqmsg += "\"olderName_like\":\"" + oldinput_search + "\",";
	}
	if (fwxminput_Id != null && fwxminput_Id != "") {
		reqmsg += "\"serviceId\":" + fwxminput_Id + ",";
	}
	if((fwxminput_search != "" && fwxminput_search != null) && (fwxminput_Id == "" || fwxminput_Id == null)){
		reqmsg += "\"serviceId\":0,";
	}
	if (fuwustate_input != null && fuwustate_input != "") {
		reqmsg += "\"status_in\":\"" + fuwustate_input + "\",";
	}
	if (fuwutype_input != null && fuwutype_input != "") {
		reqmsg += "\"healthInsurance\":" + fuwutype_input + ",";
	}
	if (fuwugdbh_input != null && fuwugdbh_input != "") {
		reqmsg += "\"serviceCode\":\"" + fuwugdbh_input + "\",";
	}
	if (pgrinputId != null && pgrinputId != "") {
		reqmsg += "\"chargeEmployeeId\":" + pgrinputId + ",";
	}
	if (yjfwsjstart_input != null && yjfwsjstart_input != "") {
		reqmsg += "\"serviceExpectTime_ge\":\"" + yjfwsjstart_input.substring(0, 4) + yjfwsjstart_input.substring(5, 7) + yjfwsjstart_input.substring(8, 10) + "000001" + "\",";
	}
	if (yjfwsjend_input != null && yjfwsjend_input != "") {
		reqmsg += "\"serviceExpectTime_le\":\"" + yjfwsjend_input.substring(0, 4) + yjfwsjend_input.substring(5, 7) + yjfwsjend_input.substring(8, 10) + "235959" + "\",";
	}
	if (jsfwsjstart_input != null && jsfwsjstart_input != "") {
		reqmsg += "\"serviceEndTime_gt\":\"" + jsfwsjstart_input.substring(0, 4) + jsfwsjstart_input.substring(5, 7) + jsfwsjstart_input.substring(8, 10) + "000001" + "\",";
	}
	if (jsfwsjend_input != null && jsfwsjend_input != "") {
		reqmsg += "\"serviceEndTime_le\":\"" + jsfwsjend_input.substring(0, 4) + jsfwsjend_input.substring(5, 7) + jsfwsjend_input.substring(8, 10) + "235959" + "\",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12);
	} else {
		return time;
	}
}

function changeData(data){
	var htmlcode = "";
	if (data.content != null) {
		var fwxm = "";
		var fzrName = "";
		if (data.content.serviceTaskList != null) {
		jQuery.each(data.content.serviceTaskList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector\"></td>";		
		    htmlcode += "<td>" + item.serviceCode + "</td>";
		    htmlcode += "<td>" + item.olderName + "</td>";
		    fwxm = "";
		    jQuery.each(item.serviceList, function(j, item2) {
		    	fwxm += item2.name + ",";
		    });
		    if(fwxm != ""){
		    	fwxm = fwxm.substr(0,fwxm.length-1);
		    }
		    htmlcode += "<td>" + fwxm + "</td>";
		    
		    jQuery.each(item.serviceEmployeeList, function(z, item3) {
		    	if(item3.type == "1"){
		    		fzrName = item3.name;
		    	}
		    });
		    htmlcode += "<td>" + fzrName + "</td>";
		    fzrName = "";
		    
		    htmlcode += "<td>" + fwstateChange(item.status) + "</td>";				
		    htmlcode += "<td>" + fwlbChange(item.healthInsurance) + "</td>";
		    htmlcode += "<td>" + formateTime(item.serviceExpectTime) + "</td>";
		    htmlcode += "<td>" + formateTime(item.serviceEndTime) + "</td>";
		   
			htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${serviceTask_queryXQ_opt_control != 'yes' or serviceTask_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/serviceTask.do?mainXQ&id="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${serviceTask_del_opt_control != 'yes' or serviceTask_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			<c:if test="${serviceTask_qx_opt_control != 'yes' or serviceTask_qx_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"quxiao_qingkong2('" + item.id + "')\"><a href=\"###\">取消</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
			htmlcode += "</tr>";
		});
		}
	}
	$("#datacontainer").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml(1, 1);
		genarateRecordNumberHtml(1, 10, 0);
	}
}
	//服务状态
	function fwstateChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="取消";
  			break;
  			
			case 2:
  			name="待排班";
  			break;
  			
  			case 3:
  			name="待审核";
  			break;
  			
  			case 4:
  			name="审核通过";
  			break;
  			
  			case 5:
  			name="服务开始";
  			break;
  			
  			case 6:
  			name="服务结束";
  			break;
  			
  			case 7:
  			name="回访结束";
  			break;
  			
  			case 8:
  			name="已下单";
  			break;
  			
  			default:
  			break;
		}
		return name;
	}
	
	//收费类别
	function fwlbChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="医保";
  			break;
  			
			case 2:
  			name="市场";
  			break;
  			
  			default:
  			break;
		}
		return name;
	}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}

//批量删除多条服务工单信息
function doDel() {
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"serviceTask.do?del",
			async:true,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
		}
	} else {
		alert("请选择要删除的数据");
	}
}
//删除单个服务工单信息
function del2(id) {
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"serviceTask.do?del",
			async:true,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	}
}

//实时获取老人姓名
function getolderName(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $.trim($("#oldinput_search").val());
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"olderNamefuzhi('" + item.name + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi(name){
	$("#oldinput_search").val(name);
	$("#hideul_nei1").html("");
	$("#hideul-1").hide();
}

//实时获取服务项目
function getFWXM(){
	var reqmsg="{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	//reqmsg += "\"status\":1,";
	reqmsg += "\"deleted\":0,";
	var name = $("#fwxminput_search").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei2").html("");
		$("#hideul-2").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceList != null){
            	  		jQuery.each(data.content.serviceList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"fwxmNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei2").html(htmlcode);
		    	  $("#hideul-2").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//服务项目名称赋值
function fwxmNamefuzhi(name,id){
	$("#fwxminput_Id").val(id);
	$("#fwxminput_search").val(name);
	$("#hideul_nei2").html("");
	$("#hideul-2").hide();
}

//实时获取老人姓名
function getolderName2(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{\"olderAddressListShow\":\"true\",";
	var name = $("#oldinput_search2").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei12").html("");
		$("#hideul-12").hide();
		return;
	}
	reqmsg += "}}";

	var address = "";
    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  			if(item != null){
            	  				if(item.olderAddressList != null){
 									jQuery.each(item.olderAddressList, function(j, item2) {//居住地
 										if(item2.addressType == 0){
 											if(item2.address != "" && item2.address != null){
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId)+","+item2.address;
 											}else{
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId);
 											}
 										}
 									});
 								}
		    					htmlcode += "<li onclick=\"olderNamefuzhi2(" + item.id + ",'" + item.name + "  " + item.memberNum + "','" + item.memberSource + "','" + item.name + "','" + item.mobileTel + "','" + address + "')\">" + item.name + "  " + item.memberNum + "</li>";		
            	  			}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei12").html(htmlcode);
		    	  $("#hideul-12").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi2(id,namememberNum,memberSource,name,mobileTel,address){
	var oldinput_contentName = $.trim($("#oldinput_contentName").val());
	var oldinput_contentTel = $.trim($("#oldinput_contentTel").val());
	var oldinput_contentAddress = $.trim($("#oldinput_contentAddress").val());
	if(oldinput_contentName != "" || oldinput_contentTel != "" || oldinput_contentAddress != ""){
		if (confirm("是否需要覆盖老人联系人信息"))  {  
 			$("#oldinput_contentName").val(name);
 			$("#oldinput_contentTel").val(mobileTel);
 			$("#oldinput_contentAddress").val(address);
 		}
	}else{
		$("#oldinput_contentName").val(name);
 		$("#oldinput_contentTel").val(mobileTel);
 		$("#oldinput_contentAddress").val(address);
	}
	
	$("#olderId_hide").val(id);
	$("#oldinput_search2").val(namememberNum);
	$("#hideul_nei12").html("");
	$("#hideul-12").hide();
	if(memberSource == "医保"){
        $("#fuwusflx_search").val("医保");
    }else{
        $("#fuwusflx_search").val("市场");
    }
	getFWXM_jiage();
}

//实时获取负责人姓名
function getefprName(){
	var siteIds = $("#addUserSites").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{\"siteListShow\":\"true\",";
	var name = $("#fprinput_search").val();
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei3").html("");
		$("#hideul-3").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<li onclick=\"fprNamefuzhi(" + item.id + ",'" + item.name + "  " + item.indexNum + "','" + item.name + "','" + item.roleNames +"','" + item.indexNum +"')\">" + item.name + "  " + item.indexNum + "</li>";		
            	  			}
            	  			if(item.siteList != null && item.siteList.length > 0){
            	  				$("#fuzerenSiteId_hide").val(item.siteList[0].id);
            	  				$("#fuzerenSiteName_hide").val(item.siteList[0].name);
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei3").html(htmlcode);
		    	  $("#hideul-3").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//负责人姓名赋值
function fprNamefuzhi(id,nameindexNum,name,roleNames,bianhao){
	$("#fuzerenId_hide").val(id);
	$("#fprinput_search").val(nameindexNum);
	$("#fuzerenName_hide").val(name);
	$("#fuzerenRole_hide").val(roleNames);
	$("#fuzerenBH_hide").val(bianhao);
	$("#hideul_nei3").html("");
	$("#hideul-3").hide();
}

//实时获取参与人姓名
function getcyrName(){
	var siteIds = $("#addUserSites").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{";
	//var name = $("#cyrinput_search").val();
	//if (name != null && name != "") {
	//	reqmsg += "\"name_like\":\"" + name + "\"";
	//}else{
	//	$("#cyrinput_search").val("");
	//	return;
	//}
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	
	reqmsg += "}}";
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<option value=\"" + item.id + "\">" + item.name + "  " + item.indexNum + "</option>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#cyrinput_search").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//获取服务项目价格
function getFWXM_jiage(){
	var reqmsg="{'action':'QUERY_SERVICE_INFO_REQUEST','content':{";
	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
	var name = $("#fwxminput_search4").val();
	if (name == null || name == "") {
		return;
	}
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
		reqmsg += "\"id\":" + fwxminput_Id4_hide + ",";
	}else{
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
            	  	if($("#fuwusflx_search").val() == "医保"){
            	  		$("#fuwusfjg_search").html(data.content.medicalPrice);
            	  	}else if($("#fuwusflx_search").val() == "市场"){
            	  		$("#fuwusfjg_search").html(data.content.marketPrice);
            	  	}
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//实时获取服务项目
function getFWXM4(){
	$("#fuwuzixianginput_search").html("");
	$("#fuwuzixianginput_search").val("").trigger("change");
	var reqmsg="{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	reqmsg += "\"status\":1,";
	reqmsg += "\"deleted\":0,";
	var name = $("#fwxminput_search4").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei24").html("");
		$("#hideul-24").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceList != null){
            	  		jQuery.each(data.content.serviceList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<li onclick=\"fwxmNamefuzhi4('" + item.name + "','" + item.id + "'," + item.marketPrice + "," + item.medicalPrice + ")\">" + item.name + "</li>";		
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei24").html(htmlcode);
		    	  $("#hideul-24").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//服务项目名称赋值4
function fwxmNamefuzhi4(name,id,marketPrice,medicalPrice){	
    if($("#fuwusflx_search").val() == "医保"){
        $("#fuwusfjg_search").html(medicalPrice);
    }else if($("#fuwusflx_search").val() == "市场"){
        $("#fuwusfjg_search").html(marketPrice);
    }
	$("#fwxminput_Id4_hide").val(id);
	$("#fwxminput_search4").val(name);
	$("#fwxminput_SCPRICE4_hide").val(marketPrice);
	$("#fwxminput_YBPRICE4_hide").val(medicalPrice);
	$("#hideul_nei24").html("");
	$("#hideul-24").hide();
	
	var reqmsg="{'action':'QUERY_SERVICE_CHILD_LIST_REQUEST','page':{'pageno':'1','pagesize':'1000'},'content':{";
	reqmsg += "\"serviceId\":" + id + ",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceChild.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceChildList != null){
            	  		jQuery.each(data.content.serviceChildList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<option value=\"" + item.name + "\">" + item.name + "</option>";		
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#fuwuzixianginput_search").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

//获取老人基本信息
function getOlderJBXX(olderId){
	var olderData = "";
	var reqmsg="{'action':'QUERY_OLDER_INFO_REQUEST','content':{\"olderAddressListShow\":\"true\",\"id\":"+olderId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "daeOlder.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if(data.content != null){
            	  	olderData = JSON.stringify(data.content);
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    });
    return olderData;
}
 	//获取当前登陆员工姓名
	function getLoginName(){
    	  var userId_login = "<%=request.getAttribute("userId")%>";
		  var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"siteListShow\":\"true\",\"userId\":"+userId_login+"}}";

		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	    var siteIds = "";
            	  	if(data.content.employeeList != null && data.content.employeeList.length == 1){
            	  		if(data.content.employeeList[0] != null && data.content.employeeList[0] != ""){
            	  			var name = data.content.employeeList[0].name;
            	  			$("#addUserName").val(name);
            	  			if (data.content.employeeList[0].siteList != null && data.content.employeeList[0].siteList.length > 0) {//所属站点
            	  				jQuery.each(data.content.employeeList[0].siteList, function(j, item2) {
									siteIds += item2.id + ",";
								});
								if(siteIds != ""){
									siteIds = siteIds.substring(0, siteIds.length-1);
								}
								$("#addUserSites").val(siteIds);
            	  			}
            	  		}
            	  	}
				}
			}else if(data.des=="failure"){
                 alert("查询失败");
            }
          },
          error:function(){
	           alert("error");
          }
     	  });
	}
	//获取参与人姓名角色
	function getcyrNameRole(id){
		  var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"id\":"+id+"}}";
		  var nameroles = "";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	   nameroles = data.content.name + "||" + data.content.roleNames + "||" + data.content.indexNum;
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
     	  return nameroles;
	}
//获取当前时间return yyyymmddhhmmss
function getNowFormatDate2() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}

//到2016-08-08 12:12分的时间选择器转化YYYYMMDDhhmmss
function changeTime(time){
	var times = "";
	times = String(time);
	if(times == null || times == ""){
		return;
	}
	times = times.split("-")[0] + times.split("-")[1] + String(times.split("-")[2]).substr(0,2) + String(times.split("-")[2]).substr(3,2) + String(times.split("-")[2]).substr(6,2) + "00";
	return times;
}
	//新增服务工单转到save正式保存，此处逻辑判断
	function saveMany(){
		var yujiFWDateList = $("#yujiFWDate tr");
		var time = "";
		var flag = 0;
		var olderId = $("#olderId_hide").val();
		if(olderId == null || olderId == ""){
			alert("请选择老人");
			return;
		}
		var contactName = $.trim($("#oldinput_contentName").val());
		var contactTel = $.trim($("#oldinput_contentTel").val());
		var address = $.trim($("#oldinput_contentAddress").val());
		if(contactName == null || contactName == ""){
			alert("请填写联系人");
			return;
		}
		if(contactTel == null || contactTel == ""){
			alert("请填写联系电话");
			return;
		}
		if(address == null || address == ""){
			alert("请填写联系地址");
			return;
		}
		var fuzerenId_hide = $("#fuzerenId_hide").val();
		if(fuzerenId_hide == null || fuzerenId_hide == ""){
			alert("请选择负责人");
			return;
		}
		var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
		if(fwxminput_Id4_hide == "" || fwxminput_Id4_hide == null){
			alert("请选择服务内容");
			return;
		}
		//var fuwuzixianginput_search = $("#fuwuzixianginput_search").val();
		//if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		//	alert("请选择服务子项");
		//	return;
		//}
		var yjfwsc = $("#yjfwsc").val();
		var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
		if(!reg1.test(yjfwsc)){ 
       		alert("请输入符合规范的预计服务时长!");
       		return;
   	 	}
	if(yujiFWDateList.length > 1){//有时间
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			if(time == null || time == ""){
				alert("请选择时间");
				return;
			}
		}
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			flag = save(time);
		}
		if(flag == 1){
			$("#closeAll").click();
            alert("新增成功");
            query();
		}else{
			alert("新增失败");
		}
	}else{
		//演示逻辑
		//flag = save('');
		//if(flag == 1){
		//	$("#closeAll").click();
        //    alert("新增成功");
        //    query();
		//}else{
		//	alert("新增失败");
		//}
		alert("请选择预计服务时间");
		return;
	}
}
//有多少个预计服务时间就新增多少服务工单
function save(yujiFWDate){
	var olderId = $("#olderId_hide").val();
	var flag = 0;
	var olderData = getOlderJBXX(olderId);
	var olderMemberNum = "";
	var olderName = "";
	var olderBirthdate = "";
	var serviceAreaId = 0;
	var serviceStreetId = 0;
	var contactName = $.trim($("#oldinput_contentName").val());
	var contactTel = $.trim($("#oldinput_contentTel").val());
	var address = $.trim($("#oldinput_contentAddress").val());
	if(olderData != ""){
		var obj = JSON.parse(olderData);
		olderMemberNum = obj.memberNum;
		olderName = obj.name;
		olderBirthdate = obj.birthdate;
		serviceAreaId = obj.serviceAreaId;
		serviceStreetId = obj.serviceStreetId;
		/*contactName = obj.name;
		contactTel = obj.mobileTel;
		if(obj.olderAddressList != null){
 			jQuery.each(obj.olderAddressList, function(i, item) {//居住地
 				if(item.addressType == 0){
 					if(item.address != "" && item.address != null){
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId)+","+item.address;
 					}else{
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId);
 					}
 				}
 			});
 		} */
	}
	
	var fuzerenSiteId_hide = $("#fuzerenSiteId_hide").val();
	var fuzerenSiteName_hide = $("#fuzerenSiteName_hide").val();

	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
	var fwxminput_SCPRICE4_hide = $("#fwxminput_SCPRICE4_hide").val();
	var fwxminput_YBPRICE4_hide = $("#fwxminput_YBPRICE4_hide").val();
	
	var fuwuzixianginput_search = $("#fuwuzixianginput_search").val();
	if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		fuwuzixianginput_search = "";
	}
	
	var yjfwsc = $("#yjfwsc").val();
	
	var fuzerenId_hide = $("#fuzerenId_hide").val();
	var fuzerenName_hide = $("#fuzerenName_hide").val();
	var fuzerenRole_hide = $("#fuzerenRole_hide").val();
	var fuzerenBH_hide = $("#fuzerenBH_hide").val();
	
	var cyrinput_search = $("#cyrinput_search").val();
	var canyurenArray = null;
	if(cyrinput_search != null && cyrinput_search !=""){
		canyurenArray = String(cyrinput_search).split(",");
	}
	
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	if (olderId != null && olderId != "") {
        reqmsg += "\"olderId\":" + olderId + ",";
	}
	if (olderMemberNum != null && olderMemberNum != "") {
        reqmsg += "\"olderMemberNum\":\"" + olderMemberNum + "\",";
	}
	if (olderName != null && olderName != "") {
        reqmsg += "\"olderName\":\"" + olderName + "\",";
	}
	if (olderBirthdate != null && olderBirthdate != "") {
        reqmsg += "\"olderBirthdate\":\"" + olderBirthdate + "\",";
	}
	if (serviceAreaId != null && serviceAreaId != 0) {
        reqmsg += "\"serviceAreaId\":" + serviceAreaId + ",";
	}
	if (serviceStreetId != null && serviceStreetId != 0) {
        reqmsg += "\"serviceStreetId\":" + serviceStreetId + ",";
	}
	if (contactName != null && contactName != "") {
        reqmsg += "\"contactName\":\"" + contactName + "\",";
	}
	if (contactTel != null && contactTel != "") {
        reqmsg += "\"contactTel\":\"" + contactTel + "\",";
	}
	if (address != null && address != "") {
        reqmsg += "\"address\":\"" + address + "\",";
	}
	
	if (yujiFWDate != null && yujiFWDate != "") {
        reqmsg += "\"serviceExpectTime\":\"" + yujiFWDate + "\",";
	}
	//else{//下次删除
	//	reqmsg += "\"status\":2,";
	//}
    reqmsg += "\"status\":4,";

	if (fuzerenSiteId_hide != null && fuzerenSiteId_hide != "") {
        reqmsg += "\"siteId\":" + fuzerenSiteId_hide + ",";
	}
	if (fuzerenSiteName_hide != null && fuzerenSiteName_hide != "") {
        reqmsg += "\"siteName\":\"" + fuzerenSiteName_hide + "\",";
	}
	
	var fuwusflx_search = $("#fuwusflx_search").val();
	if(fuwusflx_search == "医保"){
		reqmsg += "\"healthInsurance\":1,";
		reqmsg += "\"price\":" + fwxminput_YBPRICE4_hide + ",";
	}else{
		reqmsg += "\"healthInsurance\":2,";
		reqmsg += "\"price\":" + fwxminput_SCPRICE4_hide + ",";
	}
	

	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	reqmsg += "\"addPerson\":\"" + name + "\",";
	reqmsg += "\"addTime\":\"" + getNowFormatDate2() + "\",";
	
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
        reqmsg += "\"serviceTask_service_list\":[{";
        reqmsg += "\"serviceId\":" + fwxminput_Id4_hide + "," ;
        reqmsg += "\"fuwuSonNames\":\"" + fuwuzixianginput_search + "\",";
        reqmsg += "\"yjfuwuTime\":\"" + yjfwsc + "分钟\",";
        reqmsg += "}]," ;
	}
	
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "\"chargeEmployeeId\":" + fuzerenId_hide +",";
	}
	
	reqmsg += "\"serviceEmployeeList\":[" ;
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "{\"employeeId\":" + fuzerenId_hide +",";
		reqmsg += "\"name\":\"" + fuzerenName_hide +"\",";
		reqmsg += "\"employeeCode\":\"" + fuzerenBH_hide +"\",";
		reqmsg += "\"role\":\"" + fuzerenRole_hide +"\",";
		reqmsg += "\"type\":1},";
	}
	if(canyurenArray != null && canyurenArray != ""){
		for(var i = 0;i < canyurenArray.length;i++){
			var nameroles = getcyrNameRole(canyurenArray[i]);
			reqmsg += "{\"employeeId\":" + canyurenArray[i] +",";
			if(nameroles.split("||").length == 3){
				reqmsg += "\"name\":\"" + nameroles.split("||")[0] +"\",";
				reqmsg += "\"role\":\"" + nameroles.split("||")[1] +"\",";
				reqmsg += "\"employeeCode\":\"" + nameroles.split("||")[2] +"\",";
			}
			reqmsg += "\"type\":2},";
		}
	}
	reqmsg += "],";
	
	reqmsg += "\"serviceLogList\":[" ;
	reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
	reqmsg += "\"createPerson\":\"" + name +"\",";
	reqmsg += "\"type\":\"新增工单\",";
	reqmsg += "\"log\":\"" + name + "新增了工单\"}";
	reqmsg += "],";
	
	reqmsg=reqmsg.substr(0,reqmsg.length-1);
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	flag = 1;
              	//alert("保存成功");
              }else if(data.des=="failure"){
                 alert("保存失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
     return flag;
}
//重置新增服务工单的弹窗信息
function qingkongXZ(){
	$("#olderId_hide").val("");
	$("#oldinput_search2").val("");
	$("#oldinput_contentName").val("");
	$("#oldinput_contentTel").val("");
	$("#oldinput_contentAddress").val("");
	
	$("#fuzerenId_hide").val("");
	$("#fuzerenSiteId_hide").val("");
	$("#fuzerenSiteName_hide").val("");
	$("#fuzerenName_hide").val("");
	$("#fuzerenRole_hide").val("");
	$("#fuzerenBH_hide").val("");
	
	$("#fprinput_search").val("");
	
	$("#cyrinput_search").val("").trigger("change");
	
	$("#fwxminput_search4").val("");
	$("#fwxminput_Id4_hide").val("");
	$("#fwxminput_SCPRICE4_hide").val("");
	$("#fwxminput_YBPRICE4_hide").val("");
	
	var html = "";
	html += "<tr id=\"addshuizhong\">";			
	html += "<td> </td>";					
	html += "<td style=\"text-align:right\"><a class=\"label btn-primary \" onclick=\"addshuizhong();\"><i class=\"fa fa-plus\"></i></a> </td>";								
	html += "</tr>";								
	$("#yujiFWDate").html(html);	
	
	$("#fuwuzixianginput_search").html("");
	$("#fuwuzixianginput_search").val("").trigger("change");
	$("#yjfwsc").val("");	
	$("#fuwusflx_search").val("医保");	
	$("#fuwusfjg_search").html("暂无");				
}

//取消多个服务工单
function quxiao_qingkong(){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	$("#beizhu_input_quxiao").val("");
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber < 1) {
		alert("请选择要取消的数据");
		return;
	}else{
		$("#idForQX").val("");
		$("#quxiao_open").click();
	}
}
//取消单个服务工单
function quxiao_qingkong2(id){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	$("#beizhu_input_quxiao").val("");
	$("#quxiao_open").click();
	$("#idForQX").val(id);
}
//填写备注日志后确认取消工单
function sureQuxiao() {
	var beizhu_input_quxiao = $("#beizhu_input_quxiao").val();
	if(beizhu_input_quxiao != null && beizhu_input_quxiao != ""){
		if(beizhu_input_quxiao.length > 200){
			alert("备注超出字数限制200字");
			return;
		}
	}
	var name = $("#addUserName").val();
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	var idForQX = $("#idForQX").val();
	if(idForQX != null && idForQX != ""){//单个
		 reqmsg += "\"id\":" + idForQX + ",";
	}else{
		var selectedItemNumber = $("tbody .col_selector:checked").length;
		if (selectedItemNumber >= 1) {
			var ids2del = "";
			$("tbody .col_selector:checked").each(function() {
				ids2del += $(this).val() + ",";
			});
			if (ids2del != "") {
				ids2del = ids2del.substring(0, ids2del.length - 1);
			}
		  
			if (ids2del != null && ids2del != "") {
        		reqmsg += "\"ids2del\":\"" + ids2del + "\",";
			}
		} else {
			alert("请选择要取消的数据");
			return;
		}
	}
	
		reqmsg += "\"status\":1,";
	
		reqmsg += "\"serviceLogList\":[" ;
		reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
		reqmsg += "\"createPerson\":\"" + name +"\",";
		reqmsg += "\"type\":\"取消工单\",";
		if(beizhu_input_quxiao == null || beizhu_input_quxiao == ""){
			reqmsg += "\"log\":\"" + name + "取消了工单\"}";
		}else{
			reqmsg += "\"log\":\"" + beizhu_input_quxiao + "\"}";
		}
		reqmsg += "],";
	
		reqmsg += "}}";
		
		jQuery.ajax({
         	 type : "post",
         	 async:false,
         	 url : "serviceTask.do?handler",
        	  dataType : "json",
        	  data: {
        	       "reqmsg":reqmsg
        	  },
         	 success : function(data){
         	     if(data.result == "100"){
         	     	go2page(currentshownpage);
         	     	alert("取消工单成功");
         	     	$("#quxiao_tanchuang").click();
         	     }else{
         	        alert("取消工单失败");
         	        $("#quxiao_tanchuang").click();
         	     }
         	 },
         	 error:function(){
	     	      alert("error");
          	}
     	});
}

//实时获取负责人姓名
function getepgrName(){
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $("#pgrinput_search").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei25").html("");
		$("#hideul-25").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"pgrNamefuzhi('" + item.name + "'," + item.id + ")\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei25").html(htmlcode);
		    	  $("#hideul-25").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//负责人姓名赋值
function pgrNamefuzhi(name,id){
	$("#pgrinputId").val(id);
	$("#pgrinput_search").val(name);
	$("#hideul_nei25").html("");
	$("#hideul-25").hide();
}
    </script>
    



  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
