<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="images/logo.png">


<!-- Bootstrap core CSS -->

<link rel="stylesheet" type="text/css"
	href="js/jquery.gritter/css/jquery.gritter.css" />

<link rel="stylesheet"
	href="fonts/font-awesome-4/css/font-awesome.min.css">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
<link rel="stylesheet" type="text/css"
	href="js/jquery.nanoscroller/nanoscroller.css" />

<link rel="stylesheet" type="text/css"
	href="js/bootstrap.switch/bootstrap-switch.css" />
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
<link rel="stylesheet" type="text/css"
	href="js/jquery.select2/select2.css" />
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.slider/css/slider.css" />
<link rel="stylesheet" type="text/css"
	href="js/jquery.niftymodals/css/component.css" />
<link rel='stylesheet' type='text/css'
	href='js/jquery.fullcalendar/fullcalendar/fullcalendar.css' />
<link rel='stylesheet' type='text/css'
	href='js/jquery.fullcalendar/fullcalendar/fullcalendar.print.css'
	media='print' />
<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="css/style.css" rel="stylesheet" />
<script type="text/javascript" src="js/addressJS.js"></script>
<style>
.label0 {
	padding: 6px 0 0 15px
}

.label1 {
	margin-bottom: 5px
}

textarea {
	resize: vertical
}

.ppppp span {
	margin-right: 15px
}

.ppppp .rednotice {
	color: red;
}

.yiwancheng {
	background-color: #60C060;
}

.yiwancheng:hover {
	background-color: #65ca65;
}

.daifenpei {
	background-color: #FF9900;
}

.daifenpei:hover {
	background-color: #ffa800;
}

.daishenhe {
	background-color: #5BC0DE;
}

.daishenhe:hover {
	background-color: #5fc8e7;
}

.hideul {
	position: absolute;
	top: 33px;
	z-index: 200;
	right: 15px;
	left: 15px;
	display: none
}

.hideul ul {
	border: 1px solid #ccc;
	width: 100%;
	background: #f4f4f4;
	padding-left: 0
}

.hideul ul li {
	list-style-type: none;
	text-indent: 20px
}

.hideul ul li:hover {
	background: #ddd
}

.mytablenopadding>tr>td{padding-top:0 !important;padding-bottom:0 !important;}
.mytablenopadding>tr>td:nth-child(2){padding-top:7px !important;padding-bottom:7px !important;text-align:right}
.mytablenopadding>tr{background:#fff !important;}
.mytablenopadding input,.mytablenopadding select{border:0}
</style>
</head>

<body>
	<div id="head-nav" class="navbar-fixed-top">
		<div class="block-flat">
			<div class="row">
				<div class="page-head col-xs-6"
					style="padding-bottom:0;padding-top:0;border:0;">
					<h3>排班审核</h3>
					<ol class="breadcrumb">
						<li>服务管理</li>
						<li class="active">排班审核</li>
						<input type="hidden" id="userId_login" value="">
						<input type="hidden" id="OlderId_choose" value="">
						<input type="hidden" id="yuangongId_choose" value="">
						<input type="hidden" id="riqi_choose" value="">
						<input type="hidden" id="LoginName" value="">
						<input type="hidden" id="rl_viewname" value="month">
						<input type="hidden" id="rl_viewSXF" value="">
						<input type="hidden" id="rl_viewXXF" value="">
						<input type="hidden" id="rl_viewbiaoji1" value="">
						<input type="hidden" id="rl_viewbiaoji2" value="">
					</ol>
				</div>
				<c:if test="${servicePaibanSH_shtg_btn_control != 'yes' or servicePaibanSH_shtg_btn_show == 'yes'}">
				<div class="col-xs-6" style="text-align:right;padding-top:25px">
					<button class="btn btn-success" onclick="shenhetongguo()">审核通过</button>
            	</div>
            	</c:if>
			</div>
		</div>

	</div>


	<div id="cl-wrapper1" style="overflow:hidden">


		<div class="container-fluid" id="pcont">

			<div class="cl-mcont">
				<div class="row">
					<div class="col-md-9">
						<div class="block-flat">
							<div class="header">
								<h4>
								<c:if test="${servicePaibanSH_queryOld_btn_control != 'yes' or servicePaibanSH_queryOld_btn_show == 'yes'}">
									<button type="button" class="btn btn-primary md-trigger"
										data-modal="choose-oldder" onclick="query()">选择老人</button>
								</c:if>	
								<c:if test="${servicePaibanSH_queryEmploy_btn_control != 'yes' or servicePaibanSH_queryEmploy_btn_show == 'yes'}">
									<button type="button" class="btn btn-primary md-trigger"
										data-modal="choose-yuangong" onclick="query2()">选择员工</button>
								</c:if>	
									<span style="margin-left:50px" id="selectOlderZT"></span>

									<div class='input-group date form_date pull-right'
										style="width:150px">
										<input name="" id="datetimepicker" type='text'
											class="form-control " readonly="readonly" placeholder="选择月份" onchange="query_gdlb_zuoshangjiao()"/>
										<span class="input-group-addon "> <span
											class="glyphicon glyphicon-calendar"></span> </span>
									</div>
								</h4>
							</div>
							<div class="content">
								<div id='calendar'></div>
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="block-flat">
							<div class="header">
								<h4 style="line-height:34px;margin-bottom:3px;overflow:hidden">
									<span id="gdlb_right">任务列表</span>
									<c:if test="${servicePaibanSH_addService_btn_control != 'yes' or servicePaibanSH_addService_btn_show == 'yes'}">
										<button type="button" class="btn btn-default pull-right  md-trigger" data-modal="servicegongdan_add" onclick="qingkongXZ()" id="xinzenggogndanId">新建工单</button>
									</c:if>	
									</h4>
							</div>
							<div class="content">
								<P style="margin-bottom:0">
									<input type='checkbox' id='rad-11' name="rad-1"
										onclick="adjusttasklist()" /> <label for='rad-11'
										style="margin-right:10px;color:#54A754">审核通过</label> <input
										type='checkbox' id='rad-12' name="rad-1"
										onclick="adjusttasklist()" /> <label for='rad-12'
										style="margin-right:10px;color:#28a1c4">待审核</label> <input
										type='checkbox' id='rad-13' name="rad-1"
										onclick="adjusttasklist()" /> <label for='rad-13'
										style="color:#E38800">待分配</label>
								</p>
								<div id='external-events'>
									<!--<div class='external-event yiwancheng'>1手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event yiwancheng'>2手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event yiwancheng'>2手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event yiwancheng'>2手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daifenpei'>3手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daifenpei'>4手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daifenpei'>4手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>5手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>6手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>6手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>6手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>6手足部清洁和护理（包括123456。。。）</div>
									<div class='external-event daishenhe'>6手足部清洁和护理（包括123456。。。）</div>-->
									<!--  <p>
                  <input type='checkbox' id='drop-remove' /> <label for='drop-remove'>拖动后从此处删除</label>
                </p>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!-- Nifty Modal -->



	<!-- Nifty Modal -->
	
	<div class="md-modal md-effect-9" id="choose-oldder"
		style="width:80%;max-width:80%;margin-top:-130px;">
		<div class="md-content">
			<div class="modal-header"
				style="padding-bottom:0;padding-top:10px;height:30px">
                <button type="button" id="close_xzlr" style="display:none;" class="btn btn-default btn-flat md-close" data-dismiss="modal">关闭</button>
				<button type="button" class="close md-close" data-dismiss="modal"
					aria-hidden="true" style="font-size:30px">&times;</button>
			</div>
			<div class="modal-body form">
				<div class="row">
					<div class="col-xs-2 col-sm-1 label0">姓名</div>
					<div class="col-xs-4 col-sm-2 label1" style="position:relative">
						<div class="input-group ">
							<input class="form-control" type="text" id="oldinput_search"
								onclick="getolderName()" oninput="getolderName()"
								onmouseout="javascript:$('#hideul-1').hide();"
								onmouseover="checkOlderName()"> <span
								class="input-group-btn"><button class="btn btn-primary "
									type="button">
									<span class="fa fa-search"></span>
								</button>
							</span>
						</div>
						<div class="hideul" id="hideul-1"
							onmouseover="javascript:$('#hideul-1').show();"
							onmouseout="javascript:$('#hideul-1').hide();">
							<ul id="hideul_nei1">

							</ul>
						</div>
					</div>
					<div class="col-xs-2  col-sm-1 label0">是否存在未审核通过的工单</div>
					<div class="col-xs-4 col-sm-2 label1">
						<select id="ifweishenhe" class="form-control " onchange="query()">
							<option value="">全部</option>
							<option value="2,3">是</option>
							<option value="4,5,6,7">否</option>
						</select>
					</div>
					<div class="col-xs-6  col-sm-2">
						<button type="button" class="btn btn-primary pull-right"
							onclick="allOlder()">全部老人</button>
					</div>
					<div class="col-xs-6  col-sm-2">
						<button type="button" class="btn btn-primary pull-right"
							onclick="xuanzeOlder()">确定</button>
					</div>
					<div class="col-xs-6  col-sm-2" id="dqyfChoose">
						
					</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<h4>老人列表</h4>
						<input type="hidden" id="id2">
						<input type="hidden" id="hname2">
						<input type="hidden" id="allchooseId2">
                        <input type="hidden" id="allchooseName2">
					</div>
					<div class="col-sm-12">
						<table class="table table-bordered  hover" id="">
							<thead>
								<tr>
									<th style="width:2%;"><input id="firstcheckbox" type="checkbox" class="col_selector" onclick="selectAll();"></th>
									<th><strong>姓名</strong>
									</th>
									<th><strong>本月已完成</strong>
									</th>
									<th><strong>待分配</strong>
									</th>
									<th><strong>本月待审核</strong>
									</th>
								</tr>
							</thead>
							<tbody id="datacontainer" role="alert" aria-live="polite"
								aria-relevant="all">
								<!-- <tr>
									<td ><button type="button" class="btn btn-primary btn-xs" >选择</button></td>
									<td>老王3</td>
									<td>0</td>
									<td>0</td>
									<td>6</td>
									</tr>	 -->
							</tbody>
						</table>
					</div>

					<div class="col-sm-4">
						<div class="" id="">
							每页 <select id="pageSizeSelector" size="1"
								name="datatable2_length" onchange="query()"><option
									selected="selected" value="10">10</option>
								<option value="25">25</option>
								<option value="50">50</option>
								<option value="100">100</option>
							</select> 条</label>
						</div>
					</div>
					<div class="col-sm-8">
						<div class="pull-right">
							<div class="">
								<ul id="paginationArea" class="pagination" style="margin-top:0">
									<li class="prev disabled"><a href="#"><span
											class="fa fa-angle-left"></span>&nbsp;上一页</a>
									</li>
									<li class="active"><a href="#">1</a>
									</li>
									<li class="next"><a href="#">下一页&nbsp;<span
											class="fa fa-angle-right"></span>
									</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="md-modal md-effect-9" id="choose-yuangong"
		style="width:80%;max-width:80%;margin-top:30px;">
		<div class="md-content">
			<div class="modal-header"
				style="padding-bottom:0;padding-top:10px;height:30px">
                <button type="button" id="close_xzyg" style="display:none;" class="btn btn-default btn-flat md-close" data-dismiss="modal">关闭</button>
				<button type="button" class="close md-close" data-dismiss="modal"
					aria-hidden="true" style="font-size:30px">&times;</button>
			</div>
			<div class="modal-body form">
				<div class="row">
					<div class="col-xs-2 col-sm-1 label0">姓名</div>
					<div class="col-xs-4 col-sm-2 label1" style="position:relative">
						<div class="input-group ">
							<input class="form-control" type="text" id="yginput_search"
								onclick="getYGName()" oninput="getYGName()"
								onmouseout="javascript:$('#hideul-2').hide();"
								onmouseover="checkYGName()"> <span
								class="input-group-btn"><button class="btn btn-primary "
									type="button">
									<span class="fa fa-search"></span>
								</button>
							</span>
						</div>
						<div class="hideul" id="hideul-2"
							onmouseover="javascript:$('#hideul-2').show();"
							onmouseout="javascript:$('#hideul-2').hide();">
							<ul id="hideul_nei2">

							</ul>
						</div>
					</div>
					<div class="col-xs-2  col-sm-1 label0">是否存在未审核通过的工单</div>
					<div class="col-xs-4 col-sm-2 label1">
						<select id="ifweishenhe2" class="form-control " onchange="query2()">
							<option value="">全部</option>
							<option value="2,3">是</option>
							<option value="4,5,6,7">否</option>
						</select>
					</div>
					<div class="col-xs-6  col-sm-2">
						<button type="button" class="btn btn-primary pull-right"
							onclick="allYG()">全部员工</button>
					</div>
					<div class="col-xs-6  col-sm-2" id="dqyfChoose2">
						
					</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<h4>员工列表</h4>
					</div>
					<div class="col-sm-12">
						<table class="table table-bordered  hover" id="">
							<thead>
								<tr>
									<th style="width:10%"></th>
									<th><strong>姓名</strong>
									</th>
									<th><strong>本月已完成</strong>
									</th>
									<th><strong>待分配</strong>
									</th>
									<th><strong>本月待审核</strong>
									</th>
								</tr>
							</thead>
							<tbody id="datacontainer2" role="alert" aria-live="polite"
								aria-relevant="all">
								<!-- <tr>
									<td ><button type="button" class="btn btn-primary btn-xs" >选择</button></td>
									<td>老王3</td>
									<td>0</td>
									<td>0</td>
									<td>6</td>
									</tr>	 -->
							</tbody>
						</table>
					</div>

					<div class="col-sm-4">
						<div class="" id="">
							每页 <select id="pageSizeSelector2" size="1"
								name="datatable2_length" onchange="query2()"><option
									selected="selected" value="10">10</option>
								<option value="25">25</option>
								<option value="50">50</option>
								<option value="100">100</option>
							</select> 条</label>
						</div>
					</div>
					<div class="col-sm-8">
						<div class="pull-right">
							<div class="">
								<ul id="paginationArea2" class="pagination" style="margin-top:0">
									<li class="prev disabled"><a href="#"><span
											class="fa fa-angle-left"></span>&nbsp;上一页</a>
									</li>
									<li class="active"><a href="#">1</a>
									</li>
									<li class="next"><a href="#">下一页&nbsp;<span
											class="fa fa-angle-right"></span>
									</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<input type="hidden" class="   md-trigger" data-modal="shenhe" value="工单信息弹出框" id="gongdanxinxi_tck">
	<div class="md-modal md-effect-9" id="shenhe">
		<div class="md-content">
			<div class="modal-body form">
				<div class="row ">
					<input type="hidden" id="gdtcId_hide" value="">
					<label class="form-group col-md-3 col-sm-3  col-xs-3 "> 负责人
					</label>
					<div class="form-group col-md-8 col-sm-9  col-xs-9 " id="gdxx_model_fzr"></div>
				</div>
				<div class="row ">
					<label class="form-group col-md-3 col-sm-3  col-xs-3 "> 参与人
					</label>
					<div class="form-group col-md-8 col-sm-9  col-xs-9 " id="gdxx_model_cyr"></div>
				</div>
				<div class="row ">
					<label class="form-group col-md-3 col-sm-3  col-xs-3 "> 老人
					</label>
					<div class="form-group col-md-8 col-sm-9  col-xs-9 " id="gdxx_model_old"></div>
				</div>
				<div class="row ">
					<label class="form-group col-md-3 col-sm-3  col-xs-3 ">
						服务内容 </label>
					<div class="form-group col-md-8 col-sm-9  col-xs-9 ">
						<textarea class="form-control" id="gdxx_model_fwnr"></textarea>
					</div>
				</div>
				<div class="row no-margin-y">
					<label class="form-group col-md-3 col-sm-3  col-xs-4 ">
						预计服务时间 </label>
					<div class="form-group col-md-8 col-sm-9  col-xs-9 no-margin">
						<div class="input-group">
							<input class="form-control" size="30" type="text"
								readonly="readonly" placeholder="YYYY-MM-DD HH:mm" id="gdxx_model_yujiTime" />
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer" style="text-align:center;">
				<button type="button" class="btn btn-danger btn-flat " onclick="quxiaogd()">取消</button>
                <button type="button" class="btn btn-warning btn-flat md-trigger"  data-modal="bohui" id="bohuiSelfgdId">驳回</button>
                <button type="button" class="btn btn-success btn-flat md-close" data-dismiss="modal" id="tongguoSelfgdId" onclick="tongguoSelfgd()">通过</button>
                <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="closegdxx">关闭</button>
            </div>
		</div>
	</div>
	
	<div class="md-modal colored-header  md-effect-9" id="bohui">
                    <div class="md-content">
                      <div class="modal-header">
                        <h4 style="text-align:center;margin:0">驳回工单意见</h4>                        
                      </div>
                      <div class="modal-body form">
                        <div class="form-group">
                          <textarea class="form-control" id="bohuiyijian"></textarea>
                        </div>
                        
                        
                      </div>
                      <div class="modal-footer" style="text-align:center;">
                      	<button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="bohuigdSelf()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                        
                      </div>
                    </div>
                </div>
				
	
<input type="hidden" class="   md-trigger" data-modal="shenhe2" value="审核信息弹出框" id="shenheyijian">
	 <div class="md-modal md-effect-9" id="shenhe2" >
                    <div class="md-content">
                      <div class="modal-body form">
                      <p class="ppppp"><span>是否通过</span><span id="sheheTime"></span><span>当前视图下的待审核工单的时间安排</span></p>
                        <div class="row ">
                          <label class="form-group col-md-2 col-sm-3  col-xs-3 ">
                          		审核意见
                          </label>
                          <div class="form-group col-md-10 col-sm-9  col-xs-9 ">
                          <textarea class="form-control" id="sheheyijianTC"></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="modal-footer" style="text-align:center;">
                        <button type="button" class="btn btn-success btn-flat" data-dismiss="modal" onclick="saveShenhe()">通 过</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="close_shenhe">关 闭</button>
                      </div>
                    </div>
                </div>


 <!-- 新增服务工单 -->
               <div class="md-modal md-effect-1" id="servicegongdan_add" style="margin-top:50px;min-width:550px">
				<div class="md-content"  style="height:700px;overflow-y:scroll">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>新增服务工单</h3>
                        <input type="hidden" id="xzfwgd_time_hide" value="">
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        <div class="form-group" style="margin-bottom:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">老人</div> 
                         		<div class="col-sm-4 col-xs-8"  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="olderId_hide5" value="">
										<input class="form-control"  type="text" id="oldinput_search25" onclick="getolderName25()" oninput="getolderName25()" onmouseout="javascript:$('#hideul-125').hide();" onmouseover="javascript:$('#hideul-125').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-125"  onmouseover="javascript:$('#hideul-125').show();" onmouseout="javascript:$('#hideul-125').hide();">
										<ul id="hideul_nei125">
							
										</ul>
									</div>
								</div>
                         		<div class="col-sm-2  col-xs-4">联系人</div> 
                         		<div class="col-sm-4 col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentName" style="margin-bottom: 15px;">
								</div>
                         		<div class="col-sm-2 col-xs-4">联系电话</div> 
                         		<div class="col-sm-4 col-xs-8 ">
									<input type="text" class="form-control" id="oldinput_contentTel" style="margin-bottom: 15px;">
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-bottom:0;margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">联系地址</div> 
                         		<div class="col-sm-10  col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentAddress" style="margin-bottom: 15px;">
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-bottom:0;margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">负责人</div> 
                         		<div class="col-sm-10  col-xs-8 "  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="fuzerenId_hide5" value="">
										<input type="hidden" id="fuzerenName_hide5" value="">
										<input type="hidden" id="fuzerenRole_hide5" value="">
										<input type="hidden" id="fuzerenBH_hide5" value="">
										<input type="hidden" id="fuzerenSiteId_hide5" value="">
										<input type="hidden" id="fuzerenSiteName_hide5" value="">
										<input class="form-control"  type="text" id="fprinput_search5" onclick="getefprName5()" oninput="getefprName5()" onmouseout="javascript:$('#hideul-35').hide();" onmouseover="javascript:$('#hideul-35').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-35"  onmouseover="javascript:$('#hideul-35').show();" onmouseout="javascript:$('#hideul-35').hide();">
										<ul id="hideul_nei35">
								
										</ul>
									</div>
								</div>
	                			<div class="col-sm-2 col-xs-4">参与人</div>
	                			<div class="col-sm-10  col-xs-8">
	                  				<select class="select2" id="cyrinput_search5" multiple>
	                       			
	                  				</select>
	               			    </div>
	               			 </div>
	               		</div>
	               		<div class="form-group" >
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">服务内容</div> 
                         		<div class="col-sm-10  col-xs-8 "  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="fwxminput_Id4_hide5" value="">
										<input type="hidden" id="fwxminput_SCPRICE4_hide5" value="">
										<input type="hidden" id="fwxminput_YBPRICE4_hide5" value="">
										<input class="form-control"  type="text" id="fwxminput_search45" onclick="getFWXM45()" oninput="getFWXM45()" onmouseout="javascript:$('#hideul-245').hide();" onmouseover="javascript:$('#hideul-245').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-245"  onmouseover="javascript:$('#hideul-245').show();" onmouseout="javascript:$('#hideul-245').hide();">
										<ul id="hideul_nei245">
							
										</ul>
									</div>
								</div> 
                         		<div class="col-sm-2 col-xs-4">服务子项</div> 
                         		<div class="col-sm-10  col-xs-8 " >
									<select class="select2" id="fuwuzixianginput_search5" multiple>
                       			
                  					</select>
								</div> 
                        	</div>
                        </div> 
                         <div class="form-group">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">预计服务时长</div> 
                         		<div class="col-sm-4 col-xs-8 " >
									<div class="input-group" ><input type="text" class="form-control" id="yjfwsc5" onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">分钟</span></div>
								</div>
                         		<div class="col-sm-2 col-xs-4" style="padding-top:5px">收费类型</div> 
                         		<div class="col-sm-4 col-xs-8 " >
									<select id="fuwusflx_search" class="form-control" onchange="getFWXM_jiage()">
                       					<option value="医保">医保</option>
                       					<option value="市场">市场</option>
                  					</select>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">价格</div> 
                         		<div class="col-sm-10 col-xs-8 " id="fuwusfjg_search">
                         		暂无
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group">
                        	<div class="row">
                        	<div class=" col-sm-12">
                         		<table class="table no-border " >
								<thead class="no-border">
									<tr>										
										<th ><strong>&nbsp;&nbsp;预计服务时间</strong></th>									
																		
										<th style="text-align:right;" ><strong>操作</strong></th>
									</tr>
								</thead>
								<tbody class="no-border-y mytablenopadding" id="yujiFWDate">
									<!-- <tr>
										<td >
											<input class="form-control datetime" size="16" type="text" value="" />
										</td>															
										<td > <a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td>
									</tr> -->									
									<tr id="addshuizhong">								
										<td> </td>
										<td style="text-align:right"><a class="label btn-primary " onclick="addshuizhong();"><i class="fa fa-plus"></i></a> </td>
									</tr>
								</tbody>
							</table>
                         		</div>
                        	</div>
                        </div> 
                        
                                      
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn  btn-primary btn-flat" id="model_sure" onclick="saveMany()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="closeAll" onclick="qingkongXZ()">取消</button>
                      </div>
				</div>  
			  </div> 


	<div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript"
		src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript"
		src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript"
		src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript"
		src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript"
		src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript"
		src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js"
		type="text/javascript"></script>
	<script type="text/javascript"
		src="js/jquery.gritter/js/jquery.gritter.js"></script>
	<script type="text/javascript"
		src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>

	<script type="text/javascript">
    $(document).ready(function(){
    	getcyrName5();
    
    //选择年月的    startView: 3,   minView: 3, format: 'yyyy-mm',  
      $('#datetimepicker').datetimepicker({  
              format: 'yyyy-mm',  
               weekStart: 1,  
               autoclose: true,  
               startView: 3,  
               minView: 3,  
               forceParse: false,  
               language: 'zh-CN'  
      }); 
      
      getLoginName();
	  query_gdlb_chushihua();//初始化

      $('#external-events div.external-event').each(function() {
      
        var eventObject = {
          title: $.trim($(this).text()) ,// use the element's text as the event title
          color: $(this).css("background-color"),
          textColor: $(this).css("color")
        };
        
        $(this).data('eventObject', eventObject);
        
		
        	$(this).draggable({
          		zIndex: 999,
          		revert: true,      // will cause the event to go back to its
          		revertDuration: 0  //  original position after the drag
        	});
        
        
        
      });
      
     
	  $(".yiwancheng").show();
	  $(".daifenpei").show();
	  $(".daishenhe").show();
	  $("input[name=rad-1]").attr("checked","checked");
			
      //initialize the javascript
      App.init();
      $('.md-trigger').modalEffects();
      $(".deleteThisTime").click(function(){               //清除日期框中的值
	      $(this).parent().prev()[0].value = "";
	      // $(this).parent().siblings("input").val("");
	  });
	    
	    $("#oldinput_search25").keydown(function() { //焦点在弹窗第一个时，按回车，焦点跳转到第二个
			if (event.keyCode == 13) {
				$("#oldinput_contentName").focus();
				return;
			}
		});
		$("#oldinput_contentName").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentTel").focus();
				return;
			}
		});
		$("#oldinput_contentTel").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentAddress").focus();
				return;
			}
		});
		$("#oldinput_contentAddress").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fprinput_search5").focus();
				return;
			}
		});
		$("#fprinput_search5").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#cyrinput_search5").focus();
				return;
			}
		});
		$("#cyrinput_search5").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fwxminput_search45").focus();
				return;
			}
		});
		$("#fwxminput_search45").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwuzixianginput_search5").focus();
				return;
			}
		});
		$("#fuwuzixianginput_search5").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#yjfwsc5").focus();
				return;
			}
		});
		$("#yjfwsc5").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwusflx_search").focus();
				return;
			}
		});
		$("#fuwusflx_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwusfjg_search").focus();
				return;
			}
		});
		$("#fuwusfjg_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#model_sure").focus();
				return;
			}
		});
	  
    });
    
    	//只能输入数字0-9
        function keyPress() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        } 
    
    //根据控件值计算日期类型一   
    function jisuanRQ(){//riqi_choose 8月 2016 /  8月 1 — 7 2016 / 8月 1 — 7 2016		/ 周一, 8月 1, 2016 
    	var riqi = $(".fc-header-title").find("h2").html();
    	var riqi1 = riqi.split(",");
    	var year = "";
    	var month = "";
    	if(riqi1.length == 3){
    		year = $.trim(riqi1[2]);
    		month = $.trim(riqi1[1].split("月")[0]);
    		if (month >= 1 && month <= 9) {
        		month = "0" + month;
   			}
    	}else{
    		riqi = $.trim(riqi);
    		year = riqi.substr(riqi.length-4);
    		month = $.trim(riqi.split("月")[0]);
    		if (month >= 1 && month <= 9) {
        		month = "0" + month;
   			}
    	}
    	return year+month;
    }
    //根据控件值计算日期类型二
    function jisuanRQ2(){//riqi_choose 8月 2016 /  8月 1 — 7 2016 / 8月 1 — 7 2016		/ 周一, 8月 1, 2016 
    	var riqi = $(".fc-header-title").find("h2").html();
    	var riqi1 = riqi.split(",");
    	var year = "";
    	var month = "";
    	if(riqi1.length == 3){
    		year = $.trim(riqi1[2]);
    		month = $.trim(riqi1[1].split("月")[0]);
    		if (month >= 1 && month <= 9) {
        		month = "0" + month;
   			}
    	}else{
    		riqi = $.trim(riqi);
    		year = riqi.substr(riqi.length-4);
    		month = $.trim(riqi.split("月")[0]);
    		if (month >= 1 && month <= 9) {
        		month = "0" + month;
   			}
    	}
    	return year + "-" + month;
    }
    
    //获取当前时间return yyyymmddhhmmss
function getNowFormatDate2() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}
    //时间格式化return yyyymmddhhmmss
function formateTimeFromDate(date) {
    var date = new Date(date);
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds + "";
    return currentdate;
}
  </script>
	<script type='text/javascript'
		src='js/jquery.fullcalendar/fullcalendar/fullcalendar.js'></script>
	<script type="text/javascript">
/**
 * 格式化时间
 * @method formateTime3
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm)
 */
function formateTime3(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12);
	} else {
		return time;
	}
}

//打开工单信息弹出框
function openliebiaoTC(id){
	riliKuaiData(id);
	$("#gongdanxinxi_tck").click();
}
	//查询工单基本信息-弹出框
	function riliKuaiData(id){
		var reqmsg="{'action':'QUERY_SERVICE_TASK_INFO_REQUEST','content':{\"serviceListShow\":\"true\",\"serviceEmployeeListShow\":\"true\",";
		reqmsg += "\"id\":" + id + ",";
   
		reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	if(data.content != null){
              		if(data.content.status == "3"){
              			$("#tongguoSelfgdId").show();
              			$("#bohuiSelfgdId").show();
              		}else{
              			$("#tongguoSelfgdId").hide();
              			$("#bohuiSelfgdId").hide();
              		}
              		$("#gdtcId_hide").val(data.content.id);
              		var fzrName = "";
              		var cyrNames = "";
            	 	$("#gdxx_model_old").html(data.content.olderName + " " + data.content.olderMemberNum);
            	 	$("#gdxx_model_yujiTime").val(formateTime3(data.content.serviceExpectTime));
            	 	if(data.content.serviceList != null){
            	 		$("#gdxx_model_fwnr").val(data.content.serviceList[0].name + " 包括: " + data.content.serviceList[0].fuwuSonNames);
            	 	}
            	 	if(data.content.serviceEmployeeList != null){
            	 		jQuery.each(data.content.serviceEmployeeList, function(i, item) {
            	 			if(item.type == 1){
            	 				fzrName = item.name + "  " + item.employeeCode;
            	 			}else{
								cyrNames += item.name + "  " + item.employeeCode + ",";
								cyrNames.replace(",,",",");
							}
						});
						if(cyrNames != ""){
							cyrNames = cyrNames.substr(0,cyrNames.length-1);
						}
            	 		$("#gdxx_model_fzr").html(fzrName);
            	 		$("#gdxx_model_cyr").html(cyrNames);
            	 	}
            	}
              }else{
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
	}
	
	//加载图片控件
    function calender(yy,mm){
      var date = new Date();
      var d = date.getDate();
      var m = date.getMonth();
      var y = date.getFullYear();
	  
	  if(yy != 0 && yy != null){
        	y = yy;
      }
      if(mm != 0 && mm != null){
        	m = parseInt(mm) - 1;
      }
      var rl_viewname = $("#rl_viewname").val();
      if(rl_viewname == "agendaWeek" || rl_viewname == "agendaDay"){
      		var rl_viewSXF = $("#rl_viewSXF").val();
      	    y = rl_viewSXF.substr(0,4);
      	    m = parseInt(rl_viewSXF.substr(4,2)) - 1;
      	    d = rl_viewSXF.substr(6,2);
      }
      if($("#rl_viewname").val() == "month"){
      	 d=28;
      }
      
     // alert(y+"||"+m+"||"+d);
     $("#calendar").fullCalendar({
    	    eventClick: function(calEvent, jsEvent, view) {  //点击日程触发事件
    	    	 var id = calEvent.id;
    	    	 riliKuaiData(id);
				$("#gongdanxinxi_tck").click();
    	    //打开模态框，修改相应信息提交后，重新获取加载calendar
    	    },
    	    dayClick: function(date, allDay, jsEvent, view) {   
                //var selDate =$.fullCalendar.formatDate(date,'yyyy-MM-dd HH:mm');//格式化日期   
                var time2 = formateTimeFromDate(date);
        		var hybTime2 = time2.substr(8,6);
        		if(hybTime2 == "000000"){//月视图
        			time2 = time2.substr(0,8) + "090000";
        		}
                $("#xzfwgd_time_hide").val(time2);
                $("#xinzenggogndanId").click();
               	//console.log(selDate);
                //var selDate_1 = selDate + " 00:00";
                //var selDate_2 = selDate + " 1:00";
                //$("#startTime1").val(selDate);
                //$("#endTime1").val(selDate);
                //$("#addevent").click(); //点击日历空白处打开模态框，添加相应信息提交后，重新获取加载calendar
            } ,
    	year:y,
    	month:m,
    	date:d,
		allDayText: '全天',
		//firstHour: 6,
		slotMinutes: 30, //周、日视图时，最小间隔30min
		defaultEventMinutes: 60,		
		timeFormat: {
			agenda: 'H:mm{ - H:mm}'
		},
    	axisFormat: 'H:mm',
    	// timeFormat: 'H:mm' ,
        header: {
          left: 'title',
          center: '',
          right: 'month,agendaWeek,agendaDay,today, prev,next',
        },
		
		defaultView:rl_viewname,
		viewDisplay: function (view) {
        		$("#rl_viewname").val(view.name);
        		$("#rl_viewSXF").val(formateTimeFromDate(view.visStart));
        		$("#rl_viewXXF").val(formateTimeFromDate(view.visEnd));
        		//console.log(formateTimeFromDate(view.visStart) + "|||" + formateTimeFromDate(view.visEnd));
        		$("#rl_viewbiaoji2").val($(".fc-header-title").find("h2").html());
        		//console.log($("#rl_viewbiaoji1").val() + "|||" + $("#rl_viewbiaoji2").val());
        		if($("#rl_viewbiaoji1").val() != $("#rl_viewbiaoji2").val()){
        			$("#rl_viewbiaoji1").val($("#rl_viewbiaoji2").val());
        			query_gdlb_daitiaojian();
        		}
        		
        		$('#external-events div.external-event').each(function() {
                		var eventObject = {
                  		title: $.trim($(this).text()) ,// use the element's text as the event title
                  		color: $(this).css("background-color"),
                  		textColor: $(this).css("color")
                		};
                
                		$(this).data('eventObject', eventObject);
                
		        		var flag2 = this.id;
						flag2 = flag2.split("-")[0];
        				if(flag2 != "tongguo"){
        					$(this).draggable({
          						zIndex: 999,
          						revert: true,      // will cause the event to go back to its
          						revertDuration: 0  //  original position after the drag
        					});
        				}
              	 }); 
        		
               // console.log(view.name);//获得当前视图时 month、agendaWeek、agendaDay
				//if (viewname != view.name){
				 //alert("视图改变了！");//
				 //viewname = view.name;
				//}
                //console.log(formateTimeFromDate(view.visStart));//获得当前视图的开始时间
                //console.log(view.visStart);
                //console.log(formateTimeFromDate(view.visEnd));//获得当前视图的结束时间的后一天
        },
		
        monthNames: ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"],
        monthNamesShort: ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"],
        dayNames: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
        dayNamesShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
        today: ["今天"],
        firstDay: 1,
        buttonText: {
        	 today: '今天',
        	 month: '月',
        	 week: '周',
        	 day: '日',
        	 prev: '<<上翻',
        	 next: '下翻>>'
        	 },
        editable: true,
        events: function(start, end, timezone, callback) {
            $("#calendar").fullCalendar('removeEvents'); //Removes events from the calendar.清除日历上所有事件

			for(var i=0;i<tubiao_dateArray.length;i++){
				//console.log(JSON.parse(tubiao_dateArray[i]));
				$('#calendar').fullCalendar('renderEvent', JSON.parse(tubiao_dateArray[i]), false); // 将此event添加进日历
			}
         },
         
         eventDrop:function( event, delta, revertFunc, jsEvent, ui, view ) {
        	//console.log(event.start);  //新时间
        	//console.log(event.id);  //事件id
        	var id = event.id;
        	var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
	
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	var time = formateTimeFromDate(event.start);
        	var hybTime = time.substr(8,6);
        	if(hybTime == "000000"){//月视图
        		time = time.substr(0,8) + "090000";
        		reqmsgs += "\"timeChange\":\"" + time + "\",";
        	}else{
        		reqmsgs += "\"serviceExpectTime\":\"" + time + "\",";
        	}
        	
        	reqmsgs += "\"id\":" + id + ",";
        	reqmsgs += "\"status\":4,";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"工单审核\",";
			reqmsgs += "\"log\":\"" + name + "审核了工单\"}";
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
			
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.des=="success"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	alert("审核工单成功");
              }else{
                 alert("审核工单失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 
     		 
     		 $('#external-events div.external-event').each(function() {
                var eventObject = {
                  title: $.trim($(this).text()) ,// use the element's text as the event title
                  color: $(this).css("background-color"),
                  textColor: $(this).css("color")
                };
                
                $(this).data('eventObject', eventObject);
                
		        var flag2 = this.id;
				flag2 = flag2.split("-")[0];
        		if(flag2 != "tongguo"){
        			$(this).draggable({
          				zIndex: 999,
          				revert: true,      // will cause the event to go back to its
          				revertDuration: 0  //  original position after the drag
        			});
        		}
                
              }); 
        },
        
        droppable: true, // 右边的排班拖进来
        drop: function(date) { // this function is called when something is dropped\
        	
        	var id = this.id;
        	var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
	
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	var time = formateTimeFromDate(date);
        	var hybTime = time.substr(8,6);
        	if(hybTime == "000000"){//月视图
        		time = time.substr(0,8) + "090000";
        		reqmsgs += "\"timeChange\":\"" + time + "\",";
        	}else{
        		reqmsgs += "\"serviceExpectTime\":\"" + time + "\",";
        	}
        	
        	reqmsgs += "\"id\":" + id + ",";
        	reqmsgs += "\"status\":4,";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"工单审核\",";
			reqmsgs += "\"log\":\"" + name + "审核了工单\"}";
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
			
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.des=="success"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	alert("审核工单成功");
              }else{
                 alert("审核工单失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 
        	
        	
        	
        	
             $('#external-events div.external-event').each(function() {
                var eventObject = {
                  title: $.trim($(this).text()) ,// use the element's text as the event title
                  color: $(this).css("background-color"),
                  textColor: $(this).css("color")
                };
                
                $(this).data('eventObject', eventObject);
                
                
        			$(this).draggable({
          				zIndex: 999,
          				revert: true,      // will cause the event to go back to its
          				revertDuration: 0  //  original position after the drag
        			});
        		
                
              }); 
        
        
        
        
          // retrieve the dropped element's stored Event Object
         // var originalEventObject = $(this).data('eventObject');
          
       //   // we need to copy it, so that multiple events don't have a reference to the same object
         // var copiedEventObject = $.extend({}, originalEventObject);
          
          // assign it the date that was reported
       //   copiedEventObject.id = xxx;
       //   copiedEventObject.title = xxx;
        //  copiedEventObject.start = date;
       //   copiedEventObject.allDay = allDay;  
          //相应ajax操作保存此条信息
          
         // $('#calendar').fullCalendar('renderEvent', copiedEventObject, false);         

          
        }
      });
    }
  </script>
	<script type="text/javascript">
	function adjusttasklist(){ //三种状态切换选择
		if($("input[name=rad-1]:checked").length == 3){
			$(".yiwancheng").show();
			$(".daifenpei").show();
			$(".daishenhe").show();
		}else{
			if($("#rad-11").is(":checked")){
				$(".yiwancheng").show();
			}else{
				$(".yiwancheng").hide();
			}
			if($("#rad-12").is(":checked")){
				$(".daishenhe").show();
			}else{
				$(".daishenhe").hide();
			}
			if($("#rad-13").is(":checked")){
				$(".daifenpei").show();
			}else{
				$(".daifenpei").hide();
			}
		}
	}
</script>

	<script type="text/javascript">
	//获取当前登陆员工姓名
	function getLoginName(){
    	  var userId_login = "<%=request.getAttribute("userId")%>";
		  var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"userId\":"+userId_login+"}}";
		  var name="";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	if(data.content.employeeList != null && data.content.employeeList.length == 1){
            	  	   name = data.content.employeeList[0].name;
            	  	   $("#LoginName").val(name);
            	  	   $("#gdlb_right").html(name + " 任务列表");
            	  	   $("#userId_login").val(data.content.employeeList[0].id);
            	  	}
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
	}
	
//实时获取老人姓名
function getolderName(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $("#oldinput_search").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<li onclick=\"olderNamefuzhi('" + item.name + "')\">" + item.name + "</li>";		
            	  			}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
     query();
}
//老人姓名赋值
function olderNamefuzhi(name){
	$("#oldinput_search").val(name);
	$("#hideul_nei1").html("");
	$("#hideul-1").hide();
}

//老人弹窗列表
function checkOlderName(){
	$('#hideul-1').show();
	if($.trim($("#oldinput_search").val()) == ""){
		query();
	}
}
var currentshownpage = 1;
function query() {
	$("#datetimepicker").val("");
	var time = jisuanRQ2();
	$("#dqyfChoose").html("当前为" + time.split("-")[0] + "年" + time.split("-")[1] + "月");
	go2page(1);
	
	document.getElementById("id2").value = "";
	document.getElementById("hname2").value = "";
}
function go2page(pagenumber){
	var time = jisuanRQ();
	var pagesize = $("#pageSizeSelector option:selected").val();
	var oldinput_search = $("#oldinput_search").val();
	var ifweishenhe = $("#ifweishenhe").val();
	var userId_login = $("#userId_login").val();
	
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
	
	if (oldinput_search != null && oldinput_search != "") {
		reqmsg += "\"name_like\":\"" + oldinput_search + "\",";
	}
	if (ifweishenhe != null && ifweishenhe != "") {
		reqmsg += "\"status_in\":\"" + ifweishenhe + "\",";
	}
	
    if(time != null && time != ""){
    	reqmsg += "\"serviceExpectTime_ge\":\"" + time + "01000000" + "\",";
    	reqmsg += "\"serviceExpectTime_le\":\"" + time + "31235959" + "\",";
    }
    
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
function changeData(data){
	var htmlcode = "";
	if (data.content != null) {
		var allchooseId2="";
		var allchooseName2="";
		jQuery.each(data.content.tcOlderCount, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\">";
			htmlcode += "<td><input id=\""+item.olderId+"\" value=\""+item.olderName+"\" name=\"index2\" type=\"checkbox\" onclick=\"selectOne2("+item.olderId+",'"+item.olderName+"')\" class=\"col_selector_t2\"></td>";
			//htmlcode += "<tr><td ><button type=\"button\" class=\"btn btn-primary btn-xs md-close\" onclick=\"xuanzeOlder(" + item.olderId + ",'"+ item.olderName +"')\">选择</button></td>";		
			
			allchooseId2 += item.olderId+",";
			allchooseId2.replace(",,",",");
			allchooseName2 += item.olderName+",";
			allchooseName2.replace(",,",",");
			
		    htmlcode += "<td>" + item.olderName + "</td>";	
		    htmlcode += "<td>" + item.yiwancheng + "</td>";	
		    htmlcode += "<td>" + item.daifenpei + "</td>";	
		    htmlcode += "<td>" + item.daishenhe + "</td>";	
			htmlcode += "</tr>";
		});
		
		if(allchooseId2 != ""){
			allchooseId2 = allchooseId2.substr(0,allchooseId2.length-1);
		}
		$("#allchooseId2").val(allchooseId2);
		if(allchooseName2 != ""){
			allchooseName2 = allchooseName2.substr(0,allchooseName2.length-1);
		}
		$("#allchooseName2").val(allchooseName2);
		
	}
	$("#datacontainer").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml(data.page.pageno, data.page.pageCount);
	} else {
		genaratePaginateHtml(1, 1);
	}
	checkSelect2();
}
function xuanzeOlder(){
	var id2 = document.getElementById("id2").value;
	var hname2 = document.getElementById("hname2").value;
	if (id2 == "" || hname2 == "") {
		alert("还未选中老人!");
		return;
	}
	if(hname2.length > 20){
		hname2 = hname2.substr(0,20) + "...";
	}
	$("#selectOlderZT").html(hname2);
	$("#OlderId_choose").val(id2);
	
	$("#yuangongId_choose").val("");
	query_gdlb_daitiaojian();
	$("#close_xzlr").click();
}
function selectAll() {//全选框判断
            if (document.getElementById("firstcheckbox").checked) {
            	document.getElementById("id2").value = $("#allchooseId2").val();
                document.getElementById("hname2").value = $("#allchooseName2").val();
                var checklist = document.getElementsByName("index2");
                for (var i = 0; i < checklist.length; i++) {
                    checklist[i].checked = 1;
                }
            }else {
            	document.getElementById("id2").value = "";
                document.getElementById("hname2").value = "";
                var checklist = document.getElementsByName("index2");
                for (var i = 0; i < checklist.length; i++) {
                    checklist[i].checked = 0;
                }
            }
	}
	function selectOne2(id, name) {//单框
			var haveChooseid2 = document.getElementById("id2").value.toString();
  			var haveChoose2id2 = haveChooseid2.split(",");
  			var haveChoose = document.getElementById("hname2").value.toString();
  			var haveChoose2 = haveChoose.split(",");
  			var flag = 0;
            if (document.getElementById(id).checked) {
            	for(var i = 0;i < haveChoose2.length;i++){
            		if(name == haveChoose2[i]){
            			flag = 1;
            		}
            	}
            	if(flag == 0){
            		if(haveChoose == ""){
            			document.getElementById("id2").value = id;
            			document.getElementById("hname2").value = name;
            		}else{
            			document.getElementById("id2").value =  haveChooseid2 + "," + id;
            			document.getElementById("hname2").value = haveChoose + "," + name;
            		}
            	}
            } else {
            	var qudiaoId = 0;
                for(var i = 0;i < haveChoose2.length;i++){
            		if(name == haveChoose2[i]){
            			qudiaoId = i;
            		}
            	}
            	haveChooseid2 = "";
            	haveChoose = "";
            	for(var i = 0;i < haveChoose2.length;i++){
            		if(i != qudiaoId){
            			haveChooseid2 += haveChoose2id2[i] + ",";
            			haveChooseid2.replace(",,",",");
            			haveChoose += haveChoose2[i] + ",";
            			haveChoose.replace(",,",",");
            		}
            	}
            	if(haveChooseid2 != ""){
					haveChooseid2 = haveChooseid2.substr(0,haveChooseid2.length-1);
				}
            	if(haveChoose != ""){
					haveChoose = haveChoose.substr(0,haveChoose.length-1);
				}
				document.getElementById("id2").value = haveChooseid2;
				document.getElementById("hname2").value = haveChoose;
            }
            document.getElementById("firstcheckbox").checked = false;
   }
  function checkSelect2() {//检查所有复选框
            var haveChoose = document.getElementById("hname2").value;
            var haveChoose2 = haveChoose.split(",");
            var checklist = document.getElementsByName("index2");
            for (var i = 0; i < checklist.length; i++) {
                for (var j = 0; j < haveChoose2.length; j++) {
                    if (checklist[i].value == haveChoose2[j]) {
                        checklist[i].checked = 1;
                    }
                }
            }
            if(haveChoose == ""){
            	 for (var i = 0; i < checklist.length; i++) {
            	 	checklist[i].checked = 0;
            	 }
            }
  }
function allOlder(){
	$("#selectOlderZT").html("");
	$("#yuangongId_choose").val("");
	$("#OlderId_choose").val("");
	query_gdlb_daitiaojian();
	$("#close_xzlr").click();
	
	document.getElementById("id2").value = "";
	document.getElementById("hname2").value = "";
}
/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}


//实时获取员工姓名
function getYGName(){
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $("#yginput_search").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei2").html("");
		$("#hideul-2").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<li onclick=\"ygNamefuzhi('" + item.name + "')\">" + item.name + "</li>";		
            	  			}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
     query2();
}
//员工姓名赋值
function ygNamefuzhi(name){
	$("#yginput_search").val(name);
	$("#hideul_nei2").html("");
	$("#hideul-2").hide();
}

//员工弹窗列表
function checkYGName(){
	$('#hideul-2').show();
	if($.trim($("#yginput_search").val()) == ""){
		query2();
	}
}
var currentshownpage2 = 1;
function query2() {
	$("#datetimepicker").val("");
	var time = jisuanRQ2();
	$("#dqyfChoose2").html("当前为" + time.split("-")[0] + "年" + time.split("-")[1] + "月");
	go2page2(1);
}
function go2page2(pagenumber){
	var time = jisuanRQ();
	var pagesize = $("#pageSizeSelector2 option:selected").val();
	var yginput_search = $("#yginput_search").val();
	var ifweishenhe2 = $("#ifweishenhe2").val();
	var userId_login = $("#userId_login").val();
	
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
	
	if (yginput_search != null && yginput_search != "") {
		reqmsg += "\"name_like\":\"" + yginput_search + "\",";
	}
	if (ifweishenhe2 != null && ifweishenhe2 != "") {
		reqmsg += "\"status_in\":\"" + ifweishenhe2 + "\",";
	}
	
    if(time != null && time != ""){
    	reqmsg += "\"serviceExpectTime_ge\":\"" + time + "01000000" + "\",";
    	reqmsg += "\"serviceExpectTime_le\":\"" + time + "31235959" + "\",";
    }
    
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData2(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
function changeData2(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.tcFzrCount, function(i, item) {
			htmlcode += "<tr><td ><button type=\"button\" class=\"btn btn-primary btn-xs md-close\" onclick=\"xuanzeYG(" + item.fzrId + ",'"+ item.fzrName +"')\">选择</button></td>";		
		    htmlcode += "<td>" + item.fzrName + "</td>";	
		    htmlcode += "<td>" + item.yiwancheng + "</td>";	
		    htmlcode += "<td>" + item.daifenpei + "</td>";	
		    htmlcode += "<td>" + item.daishenhe + "</td>";	
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer2").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml2(data.page.pageno, data.page.pageCount);
	} else {
		genaratePaginateHtml2(1, 1);
	}
}
function xuanzeYG(fzrId,fzrName){
	$("#selectOlderZT").html(fzrName);
	$("#OlderId_choose").val("");
	$("#yuangongId_choose").val(fzrId);
	query_gdlb_daitiaojian();
	$("#close_xzyg").click();
}
function allYG(){
	$("#selectOlderZT").html("");
	$("#OlderId_choose").val("");
	$("#yuangongId_choose").val("");
	query_gdlb_daitiaojian();
	$("#close_xzyg").click();
}
/**
 * 生成分页信息
 * @method genaratePaginateHtml2
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml2(currentpage, totalpage, pagesize) {
	currentshownpage2 = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page2('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page2('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page2('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page2('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page2('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page2('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea2").html(htmlcode);
}





/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}
/**
 * 格式化时间
 * @method formateTime2
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD)
 */
function formateTime2(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8);
	} else {
		return time;
	}
}

//获取工单列表
var tubiao_dateArray = new Array();
function query_gdlb_chushihua(){
	$("#calendar").html("");
	tubiao_dateArray = new Array();

	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{\"serviceEmployeeListShow\":\"true\",\"serviceListShow\":\"true\",";
	var year = 0;
	var month = 0;
	
	var daten = new Date();
	var monthn = daten.getMonth() + 1;
	if (monthn >= 1 && monthn <= 9) {
        monthn = "0" + monthn;
    }
	reqmsg += "\"serviceExpectTime_ge\":\"" + daten.getFullYear() + monthn + "01000000" + "\",";
    reqmsg += "\"serviceExpectTime_le\":\"" + daten.getFullYear() + monthn + "31235959" + "\",";

	reqmsg += "\"status_in\":\"3,4,5,6,7\",";
	
	reqmsg += "\"source_isNull\":\"null\",";
	
	reqmsg += "}}";

	var html = "";
	
	var tubiao_date = "";
	query_gdlb2();
	
	var externalEvents = $("#external-events").html();
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              		if(data.content != null){
            	 	 if(data.content.serviceTaskList != null){
            	 	 	var xmName = "未知";
            	 	 	var peopleName = "未知";
            	  		jQuery.each(data.content.serviceTaskList, function(i, item) {
            	  			if(item.serviceList[0] != null){
            	  				xmName = item.serviceList[0].name;
            	  			}
            	  			if($("#OlderId_choose").val() != null && $("#OlderId_choose").val() != ""){
            	  				jQuery.each(item.serviceEmployeeList, function(j, item2) {
            	  					if(item2.type == "1"){
            	  						peopleName = item2.name;
            	  					}
            	  				});
            	  			}else{
            	  				peopleName = item.olderName;
            	  			}
            	  			if(item.status == 2){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daifenpei' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 3){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daishenhe' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 4){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 5 || item.status == 6 || item.status == 7){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"tongguo-" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}
            	  			tubiao_date += "{\"id\":" + item.id + ",";
            	  			tubiao_date += "\"title\":\"" + peopleName + " " + xmName + "\",";
            	  			tubiao_date += "\"start\":\"" + formateTime(item.serviceExpectTime) + "\",";
            	  			if(item.status == 2){
        	  					tubiao_date += "\"color\":\"#FF9900\",";
        	  				}else if(item.status == 3){
        	  					tubiao_date += "\"color\":\"#5BC0DE\",";
        	  				}else if(item.status == 4){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  				}else if(item.status == 5 || item.status == 6 || item.status == 7){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  					tubiao_date += "\"editable\":false,";
        	  				}
            				tubiao_date += "\"textColor\":\"#FFF\",";
            				tubiao_date += "\"allDay\":false}";
            				
            				tubiao_dateArray.push(tubiao_date);
            				tubiao_date = "";
            				xmName = "未知";
            				peopleName = "未知";
            	  		});
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}else{
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}
            	  }else{
            	  	$("#external-events").html(externalEvents + html);
            	  	calender(year,month);
            	  }
              }else if(data.des=="failure"){
              	 $("#external-events").html("");
              	 calender(year,month);
                 alert("查询失败");
              }
          },
          error:function(){
          	   $("#external-events").html("");
          	   calender(year,month);
	           alert("error");
          }
     });
}
function getthedate(dd,dadd)
{
	var a = new Date(dd);
	a = a.valueOf();
	a = a + dadd * 24 * 60 * 60 * 1000;
	a = new Date(a);
	var m = a.getMonth() + 1;
	if(m.toString().length == 1){
	    m='0'+m;
	}
	var d = a.getDate();
	if(d.toString().length == 1){
	    d='0'+d;
	}
	return a.getFullYear() + "-" + m + "-" + d;
}
function query_gdlb_daitiaojian() {
	$("#calendar").html("");
	tubiao_dateArray = new Array();

	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{\"serviceEmployeeListShow\":\"true\",\"serviceListShow\":\"true\",";
	var year = 0;
	var month = 0;
	
	var rl_viewSXF = $("#rl_viewSXF").val();
	var rl_viewXXF = $("#rl_viewXXF").val();
	var rl_viewname = $("#rl_viewname").val();
	reqmsg += "\"serviceExpectTime_ge\":\"" + rl_viewSXF + "\",";
	reqmsg += "\"serviceExpectTime_le\":\"" + rl_viewXXF + "\",";
	
	if(rl_viewname == "month"){
		var newriqi = getthedate(rl_viewSXF.substr(0,4) + "-" + rl_viewSXF.substr(4,2) + "-" + rl_viewSXF.substr(6,2),15);
		year = newriqi.substr(0,4);
		month = newriqi.substr(5,2);
	}else{
		year = rl_viewSXF.substr(0,4);
    	month = rl_viewSXF.substr(4,2);
	}
	
	reqmsg += "\"source_isNull\":\"null\",";
	
	reqmsg += "\"status_in\":\"3,4,5,6,7\",";
	
    var OlderId_choose = $("#OlderId_choose").val();
    if (OlderId_choose != null && OlderId_choose != "") {
    	reqmsg += "\"olderId_in\":\"" + OlderId_choose + "\",";
    }
    var yuangongId_choose = $("#yuangongId_choose").val();
    if (yuangongId_choose != null && yuangongId_choose != "") {
    	reqmsg += "\"fzrId\":" + yuangongId_choose + ",";
    }
    
	reqmsg += "}}";

	var html = "";
	
	var tubiao_date = "";
	query_gdlb2();
	
	var externalEvents = $("#external-events").html();
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              		if(data.content != null){
            	 	 if(data.content.serviceTaskList != null){
            	 	 	var xmName = "未知";
            	 	 	var peopleName = "未知";
            	  		jQuery.each(data.content.serviceTaskList, function(i, item) {
            	  			if(item.serviceList[0] != null){
            	  				xmName = item.serviceList[0].name;
            	  			}
            	  			if($("#OlderId_choose").val() != null && $("#OlderId_choose").val() != ""){
            	  				jQuery.each(item.serviceEmployeeList, function(j, item2) {
            	  					if(item2.type == "1"){
            	  						peopleName = item2.name;
            	  					}
            	  				});
            	  			}else{
            	  				peopleName = item.olderName;
            	  			}
            	  			if(item.status == 2){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daifenpei' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 3){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daishenhe' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 4){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 5 || item.status == 6 || item.status == 7){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"tongguo-" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}
            	  			tubiao_date += "{\"id\":" + item.id + ",";
            	  			tubiao_date += "\"title\":\"" + peopleName + " " + xmName + "\",";
            	  			tubiao_date += "\"start\":\"" + formateTime(item.serviceExpectTime) + "\",";
            	  			if(item.status == 2){
        	  					tubiao_date += "\"color\":\"#FF9900\",";
        	  				}else if(item.status == 3){
        	  					tubiao_date += "\"color\":\"#5BC0DE\",";
        	  				}else if(item.status == 4){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  				}else if(item.status == 5 || item.status == 6 || item.status == 7){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  					tubiao_date += "\"editable\":false,";
        	  				}
            				tubiao_date += "\"textColor\":\"#FFF\",";
            				tubiao_date += "\"allDay\":false}";
            				
            				tubiao_dateArray.push(tubiao_date);
            				tubiao_date = "";
            				xmName = "未知";
            				peopleName = "未知";
            	  		});
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}else{
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}
            	  }else{
            	  	$("#external-events").html(externalEvents + html);
            	  	calender(year,month);
            	  }
              }else if(data.des=="failure"){
              	 $("#external-events").html("");
              	 calender(year,month);
                 alert("查询失败");
              }
          },
          error:function(){
          	   $("#external-events").html("");
          	   calender(year,month);
	           alert("error");
          }
     });
}
function query_gdlb_zuoshangjiao(){
	$("#calendar").html("");
	tubiao_dateArray = new Array();

	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{\"serviceEmployeeListShow\":\"true\",\"serviceListShow\":\"true\",";
	var year = 0;
	var month = 0;
	
	var time = $("#datetimepicker").val();
	if(time != null && time != ""){
		reqmsg += "\"serviceExpectTime_ge\":\"" + time.split("-")[0] + time.split("-")[1] + "01000000" + "\",";
    	reqmsg += "\"serviceExpectTime_le\":\"" + time.split("-")[0] + time.split("-")[1] + "31235959" + "\",";
    	year = time.split("-")[0];
    	month = time.split("-")[1];
	}
	$("#rl_viewbiaoji1").val("");
	$("#rl_viewbiaoji2").val("");
    $("#rl_viewSXF").val(time.split("-")[0] + time.split("-")[1] + "01000000");
	$("#rl_viewXXF").val(time.split("-")[0] + time.split("-")[1] + "31235959");
	$("#rl_viewname").val("month");
	
	reqmsg += "\"status_in\":\"3,4,5,6,7\",";
	
	reqmsg += "\"source_isNull\":\"null\",";
	
    var OlderId_choose = $("#OlderId_choose").val();
    if (OlderId_choose != null && OlderId_choose != "") {
    	reqmsg += "\"olderId_in\":\"" + OlderId_choose + "\",";
    }
    var yuangongId_choose = $("#yuangongId_choose").val();
    if (yuangongId_choose != null && yuangongId_choose != "") {
    	reqmsg += "\"fzrId\":" + yuangongId_choose + ",";
    }
    
	reqmsg += "}}";

	var html = "";
	
	var tubiao_date = "";
	query_gdlb2();
	
	var externalEvents = $("#external-events").html();
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              		if(data.content != null){
            	 	 if(data.content.serviceTaskList != null){
            	 	 	var xmName = "未知";
            	 	 	var peopleName = "未知";
            	  		jQuery.each(data.content.serviceTaskList, function(i, item) {
            	  			if(item.serviceList[0] != null){
            	  				xmName = item.serviceList[0].name;
            	  			}
            	  			if($("#OlderId_choose").val() != null && $("#OlderId_choose").val() != ""){
            	  				jQuery.each(item.serviceEmployeeList, function(j, item2) {
            	  					if(item2.type == "1"){
            	  						peopleName = item2.name;
            	  					}
            	  				});
            	  			}else{
            	  				peopleName = item.olderName;
            	  			}
            	  			if(item.status == 2){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daifenpei' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 3){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daishenhe' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 4){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 5 || item.status == 6 || item.status == 7){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"tongguo-" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}
            	  			tubiao_date += "{\"id\":" + item.id + ",";
            	  			tubiao_date += "\"title\":\"" + peopleName + " " + xmName + "\",";
            	  			tubiao_date += "\"start\":\"" + formateTime(item.serviceExpectTime) + "\",";
            	  			if(item.status == 2){
        	  					tubiao_date += "\"color\":\"#FF9900\",";
        	  				}else if(item.status == 3){
        	  					tubiao_date += "\"color\":\"#5BC0DE\",";
        	  				}else if(item.status == 4){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  				}else if(item.status == 5 || item.status == 6 || item.status == 7){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  					tubiao_date += "\"editable\":false,";
        	  				}
            				tubiao_date += "\"textColor\":\"#FFF\",";
            				tubiao_date += "\"allDay\":false}";
            				
            				tubiao_dateArray.push(tubiao_date);
            				tubiao_date = "";
            				xmName = "未知";
            				peopleName = "未知";
            	  		});
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}else{
            	  		$("#external-events").html(externalEvents + html);
            	  		calender(year,month);
            	  	}
            	  }else{
            	  	$("#external-events").html(externalEvents + html);
            	  	calender(year,month);
            	  }
              }else if(data.des=="failure"){
              	 $("#external-events").html("");
              	 calender(year,month);
                 alert("查询失败");
              }
          },
          error:function(){
          	   $("#external-events").html("");
          	   calender(year,month);
	           alert("error");
          }
     });
}

function query_gdlb2() {
	var html = "";
	//var tubiao_date = "";
	
	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST','page':{'pageno':'1','pagesize':'20000000'},'content':{\"serviceListShow\":\"true\",";
	
	reqmsg += "\"status_in\":\"2\",";
	
    var OlderId_choose = $("#OlderId_choose").val();
    if (OlderId_choose != null && OlderId_choose != "") {
    	reqmsg += "\"olderId_in\":\"" + OlderId_choose + "\",";
    }
    
    var yuangongId_choose = $("#yuangongId_choose").val();
    if (yuangongId_choose != null && yuangongId_choose != "") {
    	reqmsg += "\"fzrId\":" + yuangongId_choose + ",";
    }
	
	reqmsg += "\"source_isNull\":\"null\",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              		if(data.content != null){
            	 	 if(data.content.serviceTaskList != null){
            	  		var xmName = "未知";
            	  		jQuery.each(data.content.serviceTaskList, function(i, item) {
            	  			if(item.serviceList[0] != null){
            	  				xmName = item.serviceList[0].name;
            	  			}
            	  			if(item.status == 2){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daifenpei' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + item.olderName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 3){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event daishenhe' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + item.olderName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 4){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}else if(item.status == 5 || item.status == 6 || item.status == 7){
            	  				html += "<div onclick=\"openliebiaoTC(" + item.id + ")\" class='external-event yiwancheng' id=\"tongguo-" + item.id + "\">" + formateTime2(item.serviceExpectTime) + " " + peopleName + " " + xmName + "</div></br>";
            	  			}
            	  			/* tubiao_date += "{\"id\":" + item.id + ",";
            	  			tubiao_date += "\"title\":\"" + item.olderName + " " + xmName + "\",";
            	  			tubiao_date += "\"start\":\"" + formateTime(item.serviceExpectTime) + "\",";
            	  			if(item.status == 2){
        	  					tubiao_date += "\"color\":\"#FF9900\",";
        	  				}else if(item.status == 3){
        	  					tubiao_date += "\"color\":\"#5BC0DE\",";
        	  				}else if(item.status == 4){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  				}else if(item.status == 5 || item.status == 6 || item.status == 7){
        	  					tubiao_date += "\"color\":\"#60C060\",";
        	  					tubiao_date += "\"editable\":false,";
        	  				}
            				tubiao_date += "\"textColor\":\"#FFF\",";
            				tubiao_date += "\"allDay\":false}";
            				
            				tubiao_dateArray.push(tubiao_date);
            				tubiao_date = ""; */
            				xmName = "未知";
            	  		});
            	  		$("#external-events").html(html);
            	  	}else{
            	  		$("#external-events").html(html);
            	  	}
            	  }else{
            	  	$("#external-events").html(html);
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
     
     //return tubiao_date;
}


//审核
function shenhetongguo(){
    //var yuangongId_choose = $("#yuangongId_choose").val();
    //var selectOlderZT = $("#selectOlderZT").html();
	//if(yuangongId_choose == "" || yuangongId_choose == null){
		
	//}
	//var yuefen = jisuanRQ2();
	//yuefen = yuefen.split("-")[1];
	//$("#sheheTime").html(selectOlderZT + "  ");
	$("#sheheyijianTC").val("");
	$("#shenheyijian").click();
}
//保存审核
function saveShenhe(flag){
			var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
			var yuangongId_choose = $("#yuangongId_choose").val();
			
			var timeStart = "";
			var timeEnd = "";
			var rl_viewname = $("#rl_viewname").val();
			if(rl_viewname != "month"){
				timeStart = $("#rl_viewSXF").val();
				timeEnd = $("#rl_viewXXF").val();
			}else{
				var time2 = $("#rl_viewbiaoji2").val();
	    		time2 = $.trim(time2);
	    		var dayStart = "01000000";
	    		var dayend = "31235959";
	    		//console.log(time2);
    			var year = time2.substr(time2.length-4);
    			var month = $.trim(time2.split("月")[0]);
    			if(month.split(",").length > 1){
    				month = $.trim(month.split(",")[1]);
    			}
    			if (month >= 1 && month <= 9) {
        			month = "0" + month;
   				}
   				if(time2.split(",").length == 3){
   					dayStart = $.trim(time2.split(",")[1].split("月")[1]);
   					if (dayStart >= 1 && dayStart <= 9) {
        				dayStart = "0" + dayStart;
   					}
   					dayend = $.trim(time2.split(",")[1].split("月")[1]);
   					if (dayend >= 1 && dayend <= 9) {
        				dayend = "0" + dayend;
   					}
   					dayStart += "000000";
   					dayend += "235959";
   				}
   				if(time2.split("—").length == 2){
   					dayStart = $.trim(time2.split("—")[0].split("月")[1]);
   					if (dayStart >= 1 && dayStart <= 9) {
        				dayStart = "0" + dayStart;
   					}
   					dayend = $.trim(time2.split("—")[1].split(year)[0]);
   					if (dayend >= 1 && dayend <= 9) {
        				dayend = "0" + dayend;
   					}
   					dayStart += "000000";
   					dayend += "235959";
   				}
				timeStart = year + month + dayStart;
				timeEnd = year + month + dayend;
			}
			
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	reqmsgs += "\"timeStart\":\"" + timeStart + "\"," ;
        	reqmsgs += "\"timeEnd\":\"" + timeEnd + "\"," ;
        	
        	reqmsgs += "\"status\":4,";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"工单审核\",";
			reqmsgs += "\"log\":\"" + name + "审核了工单\"}";
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
			
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.result=="100"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	$("#close_shenhe").click();
              	alert("审核成功");
              }else{
              	$("#close_shenhe").click();
                 alert("审核失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 
}

//新建工单///////////////////////////////////////

function qingkongXZ(){
	$("#olderId_hide5").val("");
	$("#oldinput_search25").val("");
	$("#oldinput_contentName").val("");
	$("#oldinput_contentTel").val("");
	$("#oldinput_contentAddress").val("");
	
	$("#fuzerenId_hide5").val("");
	$("#fuzerenSiteId_hide5").val("");
	$("#fuzerenSiteName_hide5").val("");
	$("#fuzerenName_hide5").val("");
	$("#fuzerenRole_hide5").val("");
	$("#fuzerenBH_hide5").val("");
	
	$("#fprinput_search5").val("");
	
	$("#cyrinput_search5").val("").trigger("change");
	
	$("#fwxminput_search45").val("");
	$("#fwxminput_Id4_hide5").val("");
	$("#fwxminput_SCPRICE4_hide5").val("");
	$("#fwxminput_YBPRICE4_hide5").val("");
	
	$("#fuwuzixianginput_search5").html("");
	$("#fuwuzixianginput_search5").val("").trigger("change");
	$("#yjfwsc5").val("");	
	
	var html = "";
	var xzfwgd_time_hide = $("#xzfwgd_time_hide").val();
	if(xzfwgd_time_hide != null && xzfwgd_time_hide != ""){
		var xzfwgd_time_hide = formateTime3(xzfwgd_time_hide);
		html += "<tr>";
		html += "<td ><input class=\"form-control datetime\" size=\"16\"  type=\"text\" value=\"" + xzfwgd_time_hide + "\"></td>";
		html += "<td><a class=\"label label-danger\" onclick=\"$(this).parent().parent().remove();\" ><i class=\"fa fa-times\"></i></a></td>";
		html += "</tr>";
	}
	
	html += "<tr id=\"addshuizhong\">";			
	html += "<td> </td>";					
	html += "<td style=\"text-align:right\"><a class=\"label btn-primary \" onclick=\"addshuizhong();\"><i class=\"fa fa-plus\"></i></a> </td>";								
	html += "</tr>";		
		
					
	$("#yujiFWDate").html(html);	
	$("#xzfwgd_time_hide").val("");
	var config = {dateTime:true};  //初始化新增的datepicker，不会导致格式错乱
    $( ".ui-datepicker" ).datepicker();
    if(config.dateTime){
     	$(".datetime").datetimepicker({autoclose: true});
   	}	
   	
   	$("#fuwusflx_search").val("医保");	
	$("#fuwusfjg_search").html("暂无");							
}
//到2016-08-08 12:12分的时间选择器转化YYYYMMDDhhmmss
function changeTime(time){
	var times = "";
	times = String(time);
	if(times == null || times == ""){
		return;
	}
	times = times.split("-")[0] + times.split("-")[1] + String(times.split("-")[2]).substr(0,2) + String(times.split("-")[2]).substr(3,2) + String(times.split("-")[2]).substr(6,2) + "00";
	return times;
}
function saveMany(){
	var yujiFWDateList = $("#yujiFWDate tr");
	var time = "";
	var flag = 0;
		var olderId = $("#olderId_hide5").val();
		if(olderId == null || olderId == ""){
			alert("请选择老人");
			return;
		}
		var contactName = $.trim($("#oldinput_contentName").val());
		var contactTel = $.trim($("#oldinput_contentTel").val());
		var address = $.trim($("#oldinput_contentAddress").val());
		if(contactName == null || contactName == ""){
			alert("请填写联系人");
			return;
		}
		if(contactTel == null || contactTel == ""){
			alert("请填写联系电话");
			return;
		}
		if(address == null || address == ""){
			alert("请填写联系地址");
			return;
		}
		var fuzerenId_hide = $("#fuzerenId_hide5").val();
		if(fuzerenId_hide == null || fuzerenId_hide == ""){
			alert("请选择负责人");
			return;
		}
		var fwxminput_Id4_hide = $("#fwxminput_Id4_hide5").val();
		if(fwxminput_Id4_hide == "" || fwxminput_Id4_hide == null){
			alert("请选择服务内容");
			return;
		}
		//var fuwuzixianginput_search = $("#fuwuzixianginput_search5").val();
		//if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		//	alert("请选择服务子项");
		//	return;
		//}
		var yjfwsc = $("#yjfwsc5").val();
		var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
		if(!reg1.test(yjfwsc)){ 
       		alert("请输入符合规范的预计服务时长!");
       		return;
   	 	}
	if(yujiFWDateList.length > 1){//有时间
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			if(time == null || time == ""){
				alert("请选择时间");
				return;
			}
		}
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			flag = save(time);
		}
		if(flag == 1){
			$("#closeAll").click();
            alert("新增成功");
            $("#calendar").fullCalendar('removeEvents');
            query_gdlb_daitiaojian();
            $("#closegdxx").click();
		}else{
			alert("新增失败");
		}
	}else{
		//演示逻辑
		//flag = save('');
		//if(flag == 1){
			//$("#closeAll").click();
            //alert("新增成功");
            //query();
		//}else{
			//alert("新增失败");
		//}
		alert("请选择预计服务时间");
		return;
	}
}
//获取老人基本信息
function getOlderJBXX(olderId){
	var olderData = "";
	var reqmsg="{'action':'QUERY_OLDER_INFO_REQUEST','content':{\"olderAddressListShow\":\"true\",\"id\":"+olderId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "daeOlder.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if(data.content != null){
            	  	olderData = JSON.stringify(data.content);
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    });
    return olderData;
}
//获取参与人姓名角色
	function getcyrNameRole(id){
		  var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"id\":"+id+"}}";
		  var nameroles = "";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	   nameroles = data.content.name + "||" + data.content.roleNames + "||" + data.content.indexNum;
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
     	  return nameroles;
	}
function save(yujiFWDate){
	var olderId = $("#olderId_hide5").val();
	
	var flag = 0;
	var olderData = getOlderJBXX(olderId);
	var olderMemberNum = "";
	var olderName = "";
	var olderBirthdate = "";
	var serviceAreaId = 0;
	var serviceStreetId = 0;
	var contactName = $.trim($("#oldinput_contentName").val());
	var contactTel = $.trim($("#oldinput_contentTel").val());
	var address = $.trim($("#oldinput_contentAddress").val());
	if(olderData != ""){
		var obj = JSON.parse(olderData);
		olderMemberNum = obj.memberNum;
		olderName = obj.name;
		olderBirthdate = obj.birthdate;
		serviceAreaId = obj.serviceAreaId;
		serviceStreetId = obj.serviceStreetId;
		/* contactName = obj.name;
		contactTel = obj.mobileTel;
		if(obj.olderAddressList != null){
 			jQuery.each(obj.olderAddressList, function(i, item) {//居住地
 				if(item.addressType == 0){
 					if(item.address != "" && item.address != null){
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId)+","+item.address;
 					}else{
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId);
 					}
 				}
 			});
 		} */
	}
	
	var fuzerenSiteId_hide = $("#fuzerenSiteId_hide5").val();
	var fuzerenSiteName_hide = $("#fuzerenSiteName_hide5").val();

	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide5").val();
	var fwxminput_SCPRICE4_hide = $("#fwxminput_SCPRICE4_hide5").val();
	var fwxminput_YBPRICE4_hide = $("#fwxminput_YBPRICE4_hide5").val();
	
	var fuwuzixianginput_search = $("#fuwuzixianginput_search5").val();
	if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		fuwuzixianginput_search = "";
	}
	
	var yjfwsc = $("#yjfwsc5").val();
	
	var fuzerenId_hide = $("#fuzerenId_hide5").val();
	var fuzerenName_hide = $("#fuzerenName_hide5").val();
	var fuzerenRole_hide = $("#fuzerenRole_hide5").val();
	var fuzerenBH_hide = $("#fuzerenBH_hide5").val();
	
	var cyrinput_search = $("#cyrinput_search5").val();
	var canyurenArray = null;
	if(cyrinput_search != null && cyrinput_search !=""){
		canyurenArray = String(cyrinput_search).split(",");
	}
	
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	if (olderId != null && olderId != "") {
        reqmsg += "\"olderId\":" + olderId + ",";
	}
	if (olderMemberNum != null && olderMemberNum != "") {
        reqmsg += "\"olderMemberNum\":\"" + olderMemberNum + "\",";
	}
	if (olderName != null && olderName != "") {
        reqmsg += "\"olderName\":\"" + olderName + "\",";
	}
	if (olderBirthdate != null && olderBirthdate != "") {
        reqmsg += "\"olderBirthdate\":\"" + olderBirthdate + "\",";
	}
	if (serviceAreaId != null && serviceAreaId != 0) {
        reqmsg += "\"serviceAreaId\":" + serviceAreaId + ",";
	}
	if (serviceStreetId != null && serviceStreetId != 0) {
        reqmsg += "\"serviceStreetId\":" + serviceStreetId + ",";
	}
	if (contactName != null && contactName != "") {
        reqmsg += "\"contactName\":\"" + contactName + "\",";
	}
	if (contactTel != null && contactTel != "") {
        reqmsg += "\"contactTel\":\"" + contactTel + "\",";
	}
	if (address != null && address != "") {
        reqmsg += "\"address\":\"" + address + "\",";
	}
	
	if (yujiFWDate != null && yujiFWDate != "") {
        reqmsg += "\"serviceExpectTime\":\"" + yujiFWDate + "\",";
	}
	
	if (fuzerenSiteId_hide != null && fuzerenSiteId_hide != "") {
        reqmsg += "\"siteId\":" + fuzerenSiteId_hide + ",";
	}
	if (fuzerenSiteName_hide != null && fuzerenSiteName_hide != "") {
        reqmsg += "\"siteName\":\"" + fuzerenSiteName_hide + "\",";
	}
	
	var fuwusflx_search = $("#fuwusflx_search").val();
	if(fuwusflx_search == "医保"){
		reqmsg += "\"healthInsurance\":1,";
		reqmsg += "\"price\":" + fwxminput_YBPRICE4_hide + ",";
	}else{
		reqmsg += "\"healthInsurance\":2,";
		reqmsg += "\"price\":" + fwxminput_SCPRICE4_hide + ",";
	}
	
	reqmsg += "\"status\":4,";
	var name = $("#LoginName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	reqmsg += "\"addPerson\":\"" + name + "\",";
	reqmsg += "\"addTime\":\"" + getNowFormatDate2() + "\",";
	
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
        reqmsg += "\"serviceTask_service_list\":[{";
        reqmsg += "\"serviceId\":" + fwxminput_Id4_hide + "," ;
        reqmsg += "\"fuwuSonNames\":\"" + fuwuzixianginput_search + "\",";
        reqmsg += "\"yjfuwuTime\":\"" + yjfwsc + "分钟\",";
        reqmsg += "}]," ;
	}
	
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "\"chargeEmployeeId\":" + fuzerenId_hide +",";
	}
	
	reqmsg += "\"serviceEmployeeList\":[" ;
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "{\"employeeId\":" + fuzerenId_hide +",";
		reqmsg += "\"name\":\"" + fuzerenName_hide +"\",";
		reqmsg += "\"employeeCode\":\"" + fuzerenBH_hide +"\",";
		reqmsg += "\"role\":\"" + fuzerenRole_hide +"\",";
		reqmsg += "\"type\":1},";
	}
	if(canyurenArray != null && canyurenArray != ""){
		for(var i = 0;i < canyurenArray.length;i++){
			var nameroles = getcyrNameRole(canyurenArray[i]);
			reqmsg += "{\"employeeId\":" + canyurenArray[i] +",";
			if(nameroles.split("||").length == 3){
				reqmsg += "\"name\":\"" + nameroles.split("||")[0] +"\",";
				reqmsg += "\"role\":\"" + nameroles.split("||")[1] +"\",";
				reqmsg += "\"employeeCode\":\"" + nameroles.split("||")[2] +"\",";
			}
			reqmsg += "\"type\":2},";
		}
	}
	reqmsg += "],";
	
	reqmsg += "\"serviceLogList\":[" ;
	reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
	reqmsg += "\"createPerson\":\"" + name +"\",";
	reqmsg += "\"type\":\"新增工单\",";
	reqmsg += "\"log\":\"" + name + "新增了工单\"}";
	reqmsg += "],";
	
	reqmsg=reqmsg.substr(0,reqmsg.length-1);
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	flag = 1;
              	//alert("保存成功");
              }else if(data.des=="failure"){
                 alert("保存失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
     return flag;
}

//实时获取老人姓名
function getolderName25(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{\"olderAddressListShow\":\"true\",";
	var name = $("#oldinput_search25").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei125").html("");
		$("#hideul-125").hide();
		return;
	}
	reqmsg += "}}";

	var address = "";
    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  			if(item != null){
            	  				if(item.olderAddressList != null){
 									jQuery.each(item.olderAddressList, function(j, item2) {//居住地
 										if(item2.addressType == 0){
 											if(item2.address != "" && item2.address != null){
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId)+","+item2.address;
 											}else{
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId);
 											}
 										}
 									});
 								}
		    					htmlcode += "<li onclick=\"olderNamefuzhi25(" + item.id + ",'" + item.name + "  " + item.memberNum + "','" + item.memberSource + "','" + item.name + "','" + item.mobileTel + "','" + address + "')\">" + item.name + "  " + item.memberNum + "</li>";	
            	  			}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei125").html(htmlcode);
		    	  $("#hideul-125").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi25(id,namememberNum,memberSource,name,mobileTel,address){
	var oldinput_contentName = $.trim($("#oldinput_contentName").val());
	var oldinput_contentTel = $.trim($("#oldinput_contentTel").val());
	var oldinput_contentAddress = $.trim($("#oldinput_contentAddress").val());
	if(oldinput_contentName != "" || oldinput_contentTel != "" || oldinput_contentAddress != ""){
		if (confirm("是否需要覆盖老人联系人信息"))  {  
 			$("#oldinput_contentName").val(name);
 			$("#oldinput_contentTel").val(mobileTel);
 			$("#oldinput_contentAddress").val(address);
 		}
	}else{
		$("#oldinput_contentName").val(name);
 		$("#oldinput_contentTel").val(mobileTel);
 		$("#oldinput_contentAddress").val(address);
	}
	
	$("#olderId_hide5").val(id);
	$("#oldinput_search25").val(name);
	$("#hideul_nei125").html("");
	$("#hideul-125").hide();
	if(memberSource == "医保"){
        $("#fuwusflx_search").val("医保");
    }else{
        $("#fuwusflx_search").val("市场");
    }
    getFWXM_jiage();
}

//实时获取负责人姓名
function getefprName5(){
	var siteIds = $("#addUserSites5").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{\"siteListShow\":\"true\",";
	var name = $("#fprinput_search5").val();
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei35").html("");
		$("#hideul-35").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<li onclick=\"fprNamefuzhi5(" + item.id + ",'" + item.name + "  " + item.indexNum + "','" + item.name + "','" + item.roleNames +"','" + item.indexNum +"')\">" + item.name + "  " + item.indexNum + "</li>";		
            	  			}
            	  			if(item.siteList != null && item.siteList.length > 0){
            	  				$("#fuzerenSiteId_hide5").val(item.siteList[0].id);
            	  				$("#fuzerenSiteName_hide5").val(item.siteList[0].name);
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei35").html(htmlcode);
		    	  $("#hideul-35").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//负责人姓名赋值
function fprNamefuzhi5(id,nameindexNum,name,roleNames,bianhao){
	$("#fuzerenId_hide5").val(id);
	$("#fprinput_search5").val(nameindexNum);
	$("#fuzerenName_hide5").val(name);
	$("#fuzerenRole_hide5").val(roleNames);
	$("#fuzerenBH_hide5").val(bianhao);
	$("#hideul_nei35").html("");
	$("#hideul-35").hide();
}

//实时获取参与人姓名
function getcyrName5(){
	var siteIds = $("#addUserSites5").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{";
	//var name = $("#cyrinput_search").val();
	//if (name != null && name != "") {
	//	reqmsg += "\"name_like\":\"" + name + "\"";
	//}else{
	//	$("#cyrinput_search").val("");
	//	return;
	//}
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	
	reqmsg += "}}";
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<option value=\"" + item.id + "\">" + item.name + "  " + item.indexNum + "</option>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#cyrinput_search5").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function getFWXM_jiage(){
	var reqmsg="{'action':'QUERY_SERVICE_INFO_REQUEST','content':{";
	var fwxminput_Id4_hide5 = $("#fwxminput_Id4_hide5").val();
	var name = $("#fwxminput_search45").val();
	if (name == null || name == "") {
		return;
	}
	if (fwxminput_Id4_hide5 != null && fwxminput_Id4_hide5 != "") {
		reqmsg += "\"id\":" + fwxminput_Id4_hide5 + ",";
	}else{
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
            	  	if($("#fuwusflx_search").val() == "医保"){
            	  		$("#fuwusfjg_search").html(data.content.medicalPrice);
            	  	}else if($("#fuwusflx_search").val() == "市场"){
            	  		$("#fuwusfjg_search").html(data.content.marketPrice);
            	  	}
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	  	      alert("error");
          }
     });
}

//实时获取服务项目
function getFWXM45(){
	$("#fuwuzixianginput_search5").html("");
	$("#fuwuzixianginput_search5").val("").trigger("change");
	var reqmsg = "{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	reqmsg += "\"deleted\":0,";
	reqmsg += "\"status\":1,";
	var name = $("#fwxminput_search45").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei245").html("");
		$("#hideul-245").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceList != null){
            	  		jQuery.each(data.content.serviceList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"fwxmNamefuzhi45('" + item.name + "','" + item.id + "'," + item.marketPrice + "," + item.medicalPrice + ")\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei245").html(htmlcode);
		    	  $("#hideul-245").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//服务项目名称赋值
function fwxmNamefuzhi45(name,id,marketPrice,medicalPrice){
	if($("#fuwusflx_search").val() == "医保"){
        $("#fuwusfjg_search").html(medicalPrice);
    }else if($("#fuwusflx_search").val() == "市场"){
        $("#fuwusfjg_search").html(marketPrice);
    }
	$("#fwxminput_Id4_hide5").val(id);
	$("#fwxminput_search45").val(name);
	$("#fwxminput_SCPRICE4_hide5").val(marketPrice);
	$("#fwxminput_YBPRICE4_hide5").val(medicalPrice);
	$("#hideul_nei245").html("");
	$("#hideul-245").hide();
	
	var reqmsg="{'action':'QUERY_SERVICE_CHILD_LIST_REQUEST','page':{'pageno':'1','pagesize':'1000'},'content':{";
	reqmsg += "\"serviceId\":" + id + ",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceChild.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceChildList != null){
            	  		jQuery.each(data.content.serviceChildList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<option value=\"" + item.name + "\">" + item.name + "</option>";		
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#fuwuzixianginput_search5").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function addshuizhong(){
   		var addhtml = '<tr><td ><input class="form-control datetime" size="16"  type="text"></td><td><a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td></tr>';
   		$(addhtml).insertBefore("#addshuizhong"); 
   	  var config = {dateTime:true};  //初始化新增的datepicker，不会导致格式错乱
      $( ".ui-datepicker" ).datepicker();
     if(config.dateTime){
     $(".datetime").datetimepicker({autoclose: true});
   }
}

function quxiaogd(){
	var id = $("#gdtcId_hide").val();
	
	var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
	
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	reqmsgs += "\"id\":" + id + ",";
        	reqmsgs += "\"status\":1,";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"取消工单\",";
			reqmsgs += "\"log\":\"" + name + "取消了工单\"}";
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
		
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.des=="success"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	$("#closegdxx").click();
              	alert("取消成功");
              }else{
                 alert("取消失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 
}

function tongguoSelfgd(){
	var id = $("#gdtcId_hide").val();
	
	var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
	
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	reqmsgs += "\"id\":" + id + ",";
        	reqmsgs += "\"status\":4,";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"工单审核\",";
			reqmsgs += "\"log\":\"" + name + "审核了工单\"}";
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
		
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.des=="success"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	$("#closegdxx").click();
              	alert("审核成功");
              }else{
                 alert("审核失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 
}

function bohuigdSelf(){
	var id = $("#gdtcId_hide").val();
	var bohuiyijian = $("#bohuiyijian").val();
	var name = $("#LoginName").val();
        	if(name == "" || name == null){
				alert("当前非员工,无法操作");
				return;
			}
	
        	var reqmsgs="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
        	
        	reqmsgs += "\"id\":" + id + ",";
        	reqmsgs += "\"status\":2,";
        	reqmsgs += "\"serviceExpectTime\":\"\",";
        	
        	reqmsgs += "\"serviceLogList\":[" ;
			reqmsgs += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
			reqmsgs += "\"createPerson\":\"" + name +"\",";
			reqmsgs += "\"type\":\"驳回工单\",";
			if(bohuiyijian == null || bohuiyijian == ""){
				reqmsgs += "\"log\":\"" + name + "驳回了工单\"}";
			}else{
				reqmsgs += "\"log\":\"" + bohuiyijian + "\"}";
			}
			
			reqmsgs += "],";
        	
        	reqmsgs=reqmsgs.substr(0,reqmsgs.length-1);
			reqmsgs += "}}";
		
        	 jQuery.ajax({
          		type : "post",
          		async:false,
          		url : "serviceTask.do?handler",
          		dataType : "json",
          		data: {
               		"reqmsg":reqmsgs
          		},
          	 success : function(data){
              if(data.des=="success"){
              	$("#calendar").fullCalendar('removeEvents');
              	query_gdlb_daitiaojian();
              	$("#closegdxx").click();
              	alert("驳回成功");
              }else{
                 alert("驳回失败");
              }
         	 },
         	 error:function(){
	      		alert("error");
          	 }
     		 }); 

}


</script>
	<!-- Bootstrap core JavaScript
================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="js/behaviour/voice-commands.js"></script>
	<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
	<script type="text/javascript"
		src="js/jquery.flot/jquery.flot.resize.js"></script>
	<script type="text/javascript"
		src="js/jquery.flot/jquery.flot.labels.js"></script>
</body>
</html>
