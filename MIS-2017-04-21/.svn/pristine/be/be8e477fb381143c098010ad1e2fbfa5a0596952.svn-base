<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>服务管理</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  	<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  	<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>
<style>

</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>	
<div id="cl-wrapper" style="padding-top:0px">	
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2>服务项目</h2>
				<ol class="breadcrumb">
					<li>服务管理</li>
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
					<li class="active">服务项目</li>
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->
	<div class="cl-mcont">
    <div class="block-flat">
						<div class="row">
									
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>项目名称</label>
										</div>
										<div class="col-sm-4 " style="margin-bottom:10px;">
											<input class="form-control" type="text"  id="xm_name_input" >
										</div>
										
										
										<div class="col-sm-2 " style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>项目类别</label>
										</div>
										<div class="col-sm-4 " style="margin-bottom:10px;">
											<select class="form-control" id="xm_leibie_input" >
												
											</select>
								  
										</div>
										

									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-top:20px">	
											<c:if test="${serviceList_query_btn_control != 'yes' or serviceList_query_btn_show == 'yes'}">	
												<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query()">查询</button>
											</c:if>	
											<div class="btn-group" style="margin-top:5px;float:right;margin-right:0">
												 <c:if test="${serviceList_add_btn_control != 'yes' or serviceList_add_btn_show == 'yes'}">
						  						 <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"  onclick="doAdd()">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
						 						 </button>
						 						 <a href="<%=request.getContextPath()%>/service.do?mainXQ" id="addA" target="_blank" style="display:none;">新增</a>
						 						 </c:if>	
						 						 <c:if test="${serviceList_del_btn_control != 'yes' or serviceList_del_btn_show == 'yes'}">
						 						 <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown"  style="margin-left:5px;margin-right:0" onclick="doDel()">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>删除</span>
						 						 </button>
												 </c:if>	
												
										 	</div>
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th style="width:2%;"><input id="allselectchecker" type="checkbox" class="col_selector" onclick="selectAll();"></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_name')"><strong>项目名称</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'typeId')"><strong>项目类别</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'medicalPrice')"><strong>医保单价(元)</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'marketPrice')"><strong>市场单价(元)</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_unit')"><strong>单位</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">	
													<%-- <tr>
							                          <td><input type="checkbox" class="col_selector"></td>
							                          <td>项目名1</td>
							                          <td>项目类1</td>
							                          <td>354</td>
							                          <td>364</td>							                          
							                          <td>次</td>							                          
							                          <td>
							                            <div class="btn-group">
							                              <button class="btn btn-default btn-xs" type="button">操作</button>
							                              <button data-toggle="dropdown" class="btn btn-xs btn-primary dropdown-toggle" type="button">
							                                <span class="caret"></span><span class="sr-only">Toggle Dropdown</span>
							                              </button>
							                              <ul role="menu" class="dropdown-menu pull-right">
							                                <li><a href="<%=request.getContextPath()%>/service.do?mainXQ" target="_blank">查看详情</a></li>
							                                <li><a href="##">删除</a></li>
							                              </ul>
							                            </div>
							                          </td>
							                        </tr>	 --%>																				
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 --
									<!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector"   size="1"  onchange="query()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
								</div>

							</div> 
	
					</div> <!-- 主页面结束 -->

    <!-- 模态框开始-->
               
  				
                
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
	//根据排序规则重新查询
	function queryBySort(par,column){
		var classFlag = listSortClickEvent(par);
		var type = judgmentChinese(column);
		if(type != null && type != ""){
			classFlag = type + classFlag;
			column = column.substr(8,column.length);
		}
		$("#sortType").val(classFlag);
		$("#sortColumn").val(column);
		go2page(currentshownpage);
	}

	  //获取服务项目类别信息
      function getfuwuxmlb(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#xm_leibie_input").html(html);
      }
      
	$(document).ready(function(){
		query();
		
		//获取默认服务项目类别
        getfuwuxmlb(5187);
        
    	App.init();
    	$(".md-trigger").modalEffects();
	});
	
//服务项目跳转新增页
function doAdd() {
	document.getElementById("addA").click();
}

   var currentshownpage = 1;
   function selectAll() {
		if ($("#allselectchecker").is(':checked')) {
			$(".col_selector").prop("checked", true);
		} else {
			$(".col_selector").prop("checked", false);
		}
	}
	
	//查询服务项目列表信息
	function query() {
		go2page(1);
	}
	function go2page(pagenumber){
	var pagesize = $("#pageSizeSelector option:selected").val();
	var xm_name_input = $("#xm_name_input").val();
	var xm_leibie_input = $("#xm_leibie_input").val();
	
	var reqmsg="{'action':'QUERY_SERVICE_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
	
	if (xm_name_input != null && xm_name_input != "") {
		reqmsg += "\"name_like\":\"" + xm_name_input + "\",";
	}
	if (xm_leibie_input != null && xm_leibie_input != "") {
		reqmsg += "\"typeId\":" + xm_leibie_input + ",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function changeData(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.serviceList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector\"></td>";		
		    htmlcode += "<td>" + item.name + "</td>";
		    htmlcode += "<td>" + getNameById(item.typeId) + "</td>";
		    htmlcode += "<td>" + item.medicalPrice + "</td>";		
		    htmlcode += "<td>" + item.marketPrice + "</td>";				
		    htmlcode += "<td>" + item.unit + "</td>";
		   
			htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${serviceList_queryXQ_opt_control != 'yes' or serviceList_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/service.do?mainXQ&id="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${serviceList_del_opt_control != 'yes' or serviceList_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml(1, 1);
		genarateRecordNumberHtml(1, 10, 0);
	}
}

/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}

//删除多个服务项目
function doDel() {
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"service.do?del",
			async:true,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
		}
	} else {
		alert("请选择要删除的数据");
	}
}
//删除单个服务项目
function del2(id) {
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"service.do?del",
			async:true,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	}
}

    </script>
    



  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
