<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>编辑老人</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  	<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  	<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
    <script type="text/javascript" src="js/sortListTool.js"></script>
<style>
.accordion .panel,.accordion .panel:first-child{border-top:1px solid #ECECEC;border-bottom:1px solid #ECECEC;}
.checkbox-inline{padding-left:0;padding-right:30px;}
 .checkbox-inline + .checkbox-inline{margin-left:0;}
  .whitebg td{background:#fff;}
.whitebg td textarea{width:100%;height:100%;border:0;resize:vertical}
.whitebg .fa-minus{color:#df4b33;cursor:pointer}
.mytable .fa-plus{color:#4cae4c;cursor:pointer}

#olderPhysiological .myheader {background:#4D90FD;color:#fff;overflow:hidden;margin-bottom:15px}
#olderPhysiological .myheader button{background:transparent;color:#fff;float:right;border-color:#fff}
#olderPhysiological .myheader i{margin-left:5px;margin-right:20px}
#olderPhysiological .myrow div{text-indent:15px}
#olderPhysiological .panel-heading{border:1px solid #ccc}
#olderPhysiological .panel-heading a{padding:10px 16px}
#olderPhysiological .panel-default{margin-top:15px;margin-bottom:40px}
#olderPhysiological #piliang .form-group{margin-bottom:10px}
#olderPhysiological .panel-body{padding-left:0;padding-right:0}
#olderPhysiological .modal-body > div{font-size:13px}
#olderPhysiological .block{box-shadow:none}
</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>
<div id="cl-wrapper" style="padding-top:0;background:#fff;">	
	<input type="hidden" value="" id="sortType">
	<input type="hidden" value="" id="sortColumn">
	<div class="cl-mcont" style="background:#fff;">
    <div class="row" >
      <div class="col-sm-12">
        
			<div id="olderAssessment"><!-- 健康评估 -->
						<div class="row">
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>评估时间</label>
										</div>
										<div class="col-sm-5 col-md-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="pgsj_input_start" placeholder="开始时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										<div class="col-sm-5 col-md-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="pgsj_input_end" placeholder="结束时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										
										<div class="col-sm-2 col-md-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>评估类型</label>
										</div>
										<div class="col-sm-4 col-md-4" style="margin-bottom:10px;">
											<select class="form-control" id="pglx_input" ><option value="全部">全部</option><option value="1">康复评估</option><option value="2">护理评估</option><option value="3">混合健康评估</option></select>
								  
										</div>
										
										
										<div class="col-sm-2  col-md-2" style="vertical-align: middle; height: 34px; line-height: 34px;">
											<label>评估状态</label>
										</div>
										<div class="col-sm-4 col-md-4" style="margin-bottom:10px;">
											<select class="form-control" id="pgzt_input" ><option value="全部">全部</option><option value="1">未完成</option><option value="2">已完成</option></select>
								  
										</div>
										<div class="col-sm-2  col-md-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>评估人</label>
										</div>
										<div class="col-sm-4 col-md-4" style="margin-bottom:10px;">
											<input class="form-control" type="text"  id="pgr_input" >
										</div>

									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-top:20px;margin-bottom:10px;">	
											<c:if test="${older_queryjkpg_btn_control != 'yes' or older_queryjkpg_btn_show == 'yes'}">
												<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query11()">查询</button>
											</c:if>	
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info11">
												<thead>
													<tr role="row">
														<th><strong>会员姓名</strong></th>
														<th><strong>会员号码</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'employeeId')"><strong>评估人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'status')"><strong>评估状态</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'type')"><strong>评估类别</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'assessmentTime')"><strong>评估时间</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer11" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
									 <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info11" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="datatable2_length">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector11" aria-controls="datatable2" size="1" name="datatable2_length" onchange="query11()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea11" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
							
            </div>
            
    
      

    </div>

	</div>
	
</div> 
	<div id="getHeight"></div>
</div> <!-- 主页面结束 -->

    <!-- 模态框开始-->
    
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>
<script type="text/javascript" src="js/highcharts.js"></script>

    <script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page11(currentshownpage11);
}

    	//iframe内嵌页面设置高度
    	function reset() {
  			window.parent.reset();
		}
		
		
      $(document).ready(function(){
        //initialize the javascript
        query11();
       
    	$(".deleteThisTime").click(function(){               //清除日期框中的值
    	       $(this).parent().prev()[0].value = "";
    	    });
        App.init();
		$('div[class="icheckbox_square-blue checkbox checked disabled"]').removeClass("disabled");//美化checkbox框
		});
	
	//健康评估////////////////////////////////////////////////
	var currentshownpage11 = 1;
	function query11() {
		go2page11(1);
	}

	function go2page11(pagenumber){
	var pagesize = $("#pageSizeSelector11 option:selected").val();
	
	var pgsj_input_start = $("#pgsj_input_start").val();
	var pgsj_input_end = $("#pgsj_input_end").val();
	var pglx_input = $("#pglx_input").val();
	var pgzt_input = $("#pgzt_input").val();
	var pgr_input = $("#pgr_input").val();

	var reqmsg="{'action':'QUERY_HEALTH_ASSESSMENT_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"olderShow\":\"true\",\"employeeShow\":\"true\",";
		
	var idss="<%=request.getAttribute("olderId")%>";
	reqmsg += "\"olderId\":" + idss + ",";
	if (pgsj_input_start != null && pgsj_input_start != "") {
	    pgsj_input_start = pgsj_input_start.substring(0, 4) + pgsj_input_start.substring(5, 7) + pgsj_input_start.substring(8, 10) + "000000";
		reqmsg += "\"assessmentTime_ge\":\"" + pgsj_input_start + "\",";
	}
	if (pgsj_input_end != null && pgsj_input_end != "") {
		pgsj_input_end = pgsj_input_end.substring(0, 4) + pgsj_input_end.substring(5, 7) + pgsj_input_end.substring(8, 10) + "240000";
		reqmsg += "\"assessmentTime_le\":\"" + pgsj_input_end + "\",";
	}
	if(pgsj_input_start > pgsj_input_end){
		alert("评估开始时间不能大于结束时间");
		return;
	}
	if (pglx_input != null && pglx_input != "全部") {
		reqmsg += "\"type\":" + pglx_input + ",";
	}
	if (pgzt_input != null && pgzt_input != "全部") {
		reqmsg += "\"status\":" + pgzt_input + ",";
	}
	if (pgr_input != null && pgr_input != "") {
		reqmsg += "\"employeeName\":\"" + pgr_input + "\",";
	}

	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "healthAssessment.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData11(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
	}

function changeData11(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.healthAssessmentList, function(i, item) {
			htmlcode += "<tr>";		
		    htmlcode += "<td>" + item.older.name + "</td>";	
		    htmlcode += "<td>" + item.older.memberNum + "</td>";
		    if(item.employeeName != null && item.employeeName !=""){
				htmlcode += "<td>" + item.employeeName + "</td>";
		    }else{
		    	htmlcode += "<td></td>";
		    }
		    htmlcode += "<td>" + changeStatus11(item.status) + "</td>";		
		    htmlcode += "<td>" + changeType11(item.type) + "</td>";		
		    htmlcode += "<td>" + formateTime11(item.assessmentTime) + "</td>";
			
			htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			var userId_login = "<%=request.getAttribute("userId")%>";
			if (userId_login == null) {
				userId_login = "";
			}
			<c:if test="${older_queryjkpgXQ_opt_control != 'yes' or older_queryjkpgXQ_opt_show == 'yes'}">
			if(item.type == 1){
				htmlcode += "<li><a href=\""+headUrl+"/rehabilitationEvaluation.do?main&oldid=" + item.older.id + "&id=" + item.id + "\" target=\"_blank\">查看详情</a></li>";
			}else if(item.type == 2){
				htmlcode += "<li><a href=\""+headUrl+"/nursingEvaluation.do?main&oldid=" + item.older.id + "&id=" + item.id + "\" target=\"_blank\">查看详情</a></li>";
			}else if(item.type == 3){
				htmlcode += "<li><a href=\""+headUrl+"/mixedhealthassessment.do?main&oldid=" + item.older.id + "&id=" + item.id + "\" target=\"_blank\">查看详情</a></li>";
			}
			</c:if>
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer11").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml11(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml11(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml11(1, 1);
		genarateRecordNumberHtml11(1, 10, 0);
	}
	reset();
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml11
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml11(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info11").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml11
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml11(currentpage, totalpage, pagesize) {
	currentshownpage11 = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page11('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page11('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page11('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page11('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page11('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page11('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea11").html(htmlcode);
}


/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime11(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}

//评估类别转化
function changeType11(type){
	var typeName = "";
	switch(type){
		case 1:
			typeName = "康复评估";
			break;
		case 2:
			typeName = "护理评估";
			break;
		case 3:
			typeName = "混合健康评估";
			break;
		default:
			typeName = "未知";
			break;
	}
	return typeName;
}
//评估状态转化
function changeStatus11(status){
	var statusName = "";
	switch(status){
		case 1:
			statusName = "未完成";
			break;
		case 2:
			statusName = "已完成";
			break;
		default:
			statusName = "未知";
			break;
	}
	return statusName;
}

    </script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
