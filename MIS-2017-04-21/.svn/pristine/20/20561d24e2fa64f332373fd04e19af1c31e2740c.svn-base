<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ page import="fsk.init.SystemInit" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%
	String nickname = (String) session.getAttribute("nickname");
	if (nickname == null) {
		nickname = "";
	}
	String photourlMR = SystemInit.photourl;
	String header = SystemInit.header;
	String headerImage = SystemInit.headerImage;
%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>新增站点</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  <link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  <link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
<style>
.accordion .panel,.accordion .panel:first-child{border-top:1px solid #ECECEC;border-bottom:1px solid #ECECEC;}
.checkbox-inline{padding-left:0;padding-right:30px;}
 .checkbox-inline + .checkbox-inline{margin-left:0;}
 .fa-plus-mine{background:red}
</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>
<body>
<!-- 上侧栏开始 -->
    <div id="head-nav" class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="fa fa-gear"></span>
          </button>
          <a class="navbar-brand" href="#"  style="width:auto;background: url(images/<%=headerImage %>) no-repeat 0 10px;"><span><%=header %>/新增站点</span></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right user-nav">
            <li class="dropdown profile_menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="images/avatar2.jpg"/>
                <span id="accountNickname"><%=nickname %></span>
<!--                 <b class="caret"></b> -->
              </a>
<!--               <ul class="dropdown-menu"> -->
<!--                 <li><a href="#" class="md-trigger" data-modal="md-scale3">密码修改</a></li> -->
<!--                 <li class="divider"></li> -->
<!--                 <li><a href="systemLogin.do?logout">退出登录</a></li> -->
<!--               </ul> -->
            </li>
          </ul>
        </div><!--/.nav-collapse animate-collapse -->
      </div>
    </div>  <!-- 上侧栏结束 -->

	
<div id="cl-wrapper" style="padding-top:0">	
<div class="container-fluid" id="pcont">
	<div class="cl-mcont">

    
    <div class="row">
      <div class="col-sm-12">
        <div class="tab-container" >

          <div class="tab-content" >
            <div id="olderBasicInfo" class="tab-pane  cont active" ><!-- 基本信息开始 -->
					<div class="panel-group accordion accordion-semi" id="accordion1-1" style="margin-top:20px;">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a data-toggle="collapse" data-parent="#accordion1-1" href="#ac1-1">
								<i class="fa fa-angle-right"></i>基本信息
							</a>
						  </h4>
						</div>
						<div id="ac1-1" class="panel-collapse collapse in">
						  <div class="panel-body form-horizontal">
								<div class="form-group">
								
									<form style="display:none;" id="image_submit" action="position.do?pic2" method="post"  enctype="multipart/form-data">
               							<input type="hidden" name="srcPath" id="srcPath" value="" />
               							<input type="hidden" name="type" id="type" value="sitePhoto_" />
  										<input type="hidden" name="x1" id="x1" value="0" />
  										<input type="hidden" name="y1" id="y1" value="0" />
  										<input type="hidden" name="x2" id="x2" value="0" />
  										<input type="hidden" name="y2" id="y2" value="0" />
		 							</form>  
								 	<input type="hidden" id="hide_siteTupian" value="" /> 
								 	<button type="button" class="btn btn-primary btn-flat" style="display:none;" id="sure_SC" onclick="uploadPic_cut()">确定</button> 
								 	<input id="quedintupian" style="display:none;" type="button" value="确定" onclick="uploadPic()">
								 	
									<label class="col-sm-2 control-label" for="nick">上传头像</label>
									<div class="col-sm-10"> 
									  <div class="avatar-upload">
										<img src="photos/zhandian.png" id="touxiangId" style="height:150px;width:150px" class="profile-avatar img-thumbnail"/>
										<form id="picuploadform1" class="secondcol" action="position.do?pic1" method="post" enctype="multipart/form-data">
                							<input id="pic4upload1" name="pic4upload" type="file" onchange="javascript:$('#quedintupian').click()" accept="image/*">
             				 			</form>
									  </div>
									</div>
								 </div>
		 					
								<div class="form-group">
								  <label class="col-sm-2 control-label">名称<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="name_input" >
								  </div>
								  <input id="zhanzhang_modalId"  class="btn btn-primary btn-flat btn-rad md-trigger" type="hidden" data-modal="zhanzhang_modal" value="站长">
								  <label  class="col-sm-2 control-label">站长</label>
								 	<div class="col-sm-4">
									<input type="text" class="form-control" id="zhanzhang_input" tag="hedangdang" onclick="guanlianzhanzhang()">
									<input type="hidden" id="zhanzhangId_input" >
								  </div>								 
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">联系人<span style="color:red">*</span></span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="lianxiren_input" >
								  </div>
								  <label  class="col-sm-2 control-label">联系电话<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="lianxidianhua_input" >
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">站点类别<span style="color:red">*</span></span></label>
								  <div class="col-sm-4">
									<select class="form-control" id="siteleibie_input">
										<option value="医疗护理站 ">医疗护理站</option>
										<option value="照护站">照护站</option>
										<option value="日间照料中心">日间照料中心</option>
										<option value="长者照护之家">长者照护之家</option>
										<option value="养老院">养老院</option>
										<option value="其他">其他</option>
									</select>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">地址（省）<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<select class="form-control" id="quyushen_input">
									
									</select>
								  </div>
								  <label  class="col-sm-2 control-label">地址（市）<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<select class="form-control" id="quyushi_input">
									
									</select>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">地址（区）<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<select class="form-control" id="quyuqu_input">
								
									</select>
								  </div>
								  <label  class="col-sm-2 control-label">地址（街道）<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<select class="form-control" id="quyujiedao_input">
									
									</select>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">地址（具体地址）<span style="color:red">*</span></label>
								  <div class="col-sm-10" >
									<input type="text" class="form-control" id="jutidizhi" >
								  </div>
								</div>
								
						  </div>
						</div>
					  </div>
					</div>	
					<div class="panel-group accordion accordion-semi" id="accordion1-2" >
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a class="" data-toggle="collapse" data-parent="#accordion1-2" href="#ac1-2">
							  <i class="fa fa-angle-right"></i>服务信息
							</a>
						  </h4>
						</div>
						<div id="ac1-2" class="panel-collapse collapse in">
						  <div class="panel-body">
						    <div class="table-responsive">
							<table class="table no-border hover">
								<thead class="no-border">
									<tr>
										<th style="width:20%;"><strong>服务区域（省）</strong></th>
										<th style="width:20%;"><strong>服务区域（市）</strong></th>
										<th style="width:20%;"><strong>服务区域（区）</strong></th>
										<th style="width:30%;"><strong>服务区域（街道）</strong></th>
										<th ><strong>操作</strong></th>
									</tr>
								</thead>
								<a class="label label-primary md-trigger" data-modal="add-address" id="adddzxx" style="display:none;"><i class="fa fa-plus"></i></a>
								<a class="label label-primary md-trigger" data-modal="add-addressBJ" id="editdzxx" style="display:none;"><i class="fa fa-pencil"></i></a> <a class="label label-danger" id="deldzxx" style="display:none;"><i class="fa fa-times"></i></a>
								<tbody class="no-border-y" id="addressMessge">
									<tr id="addressMessge_add">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td>
											<a class="label label-primary md-trigger" data-modal="add-address" onclick="dizhixinxi()"><i class="fa fa-plus"></i></a>
										</td>
									</tr>
							   </tbody>
							</table>		
							</div>
								
						  </div>
						</div>
					  </div>
					</div>




					<div class="row"><div class="col-sm-12" style=
					"text-align:center;"><button class="btn btn-flat btn-rad  btn-success md-trigger" data-modal="saveAllBasicHeal"  onclick="saveAdd()">保存</button></div></div>
			</div>


          </div>
        </div>    
        

      </div>
      

    </div>

	</div>
	
</div> 
	
</div> <!-- 主页面结束 -->
                <!-- 关联站长-->
                <div class="md-modal colored-header custom-width md-effect-9" id="zhanzhang_modal">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>关联站长 </h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body " id="erciquerenxinxi">
                      <div class="row">
							<div class="col-sm-1" style="clear:both;text-align: center; vertical-align: middle; height: 34px; line-height: 34px;width:100px;">
								<label>姓名</label>
							</div>
							<div class="col-sm-2" style="margin-bottom:10px;">
								<input class="form-control" type="text" style="width: 100%" id="name_input_t">
							</div>
							<div class="col-sm-1" style="margin-bottom:5px;">
								<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;" onclick="query_t()">查询</button>
							</div>
                      </div>
                      <!-- 数据表格开始 -->
					  <div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th><strong>选择</strong></th>
														<th><strong>所属站点</strong></th>
														<th><strong>站长</strong></th>
														<th><strong>服务区域</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer_t" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
					  <!-- 数据表格结束 -->
					  <!-- 数据条数提示开始 -->
					  <div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info_t" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
					  <!-- 数据条数提示结束 -->
					  <!-- 分页条开始 -->
					  <div class="row">
										<div class="col-sm-4" style="clear:both;">
											<div class="pull-left" style="margin:10px 0" id="datatable2_length">
												<label class="pull-left" style="margin:10px 0;">每页</label>
												<label class="pull-left" style="margin:10px 0;">
												<select id="pageSizeSelector_t" class="form-control"  aria-controls="datatable2" size="1" name="datatable2_length" onchange="query_t()">
												<option selected="selected" value="10">10</option>
												<option value="25">25</option>
												<option value="50">50</option>
												<option value="100">100</option>
												</select> 
												</label>
												<label class="pull-left" style="margin:10px 0;">条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea_t" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li>
													</ul>
												</div>
											</div>
										</div>
									</div>
					  <!-- 分页条结束 -->
					  </div>
					  <div class="modal-footer">
                       <button type="button" id="glzzquxiao" style="display:none;" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>

				<!-- 服务地址信息(新增) -->
                <div class="md-modal colored-header custom-width md-effect-9" id="add-address">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>服务地址信息添加</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
						<div class="form-group">
                          <label>省</label> <select class="form-control" id="dizhixinxishen"></select>
                        </div>
                        <div class="form-group">
                          <label>市</label> <select class="form-control" id="dizhixinxishi"></select>
                        </div>
						<div class="form-group">
                          <label>区</label> <select class="form-control" id="dizhixinxiqu"></select>
                        </div>
						<div class="form-group">
                          <label>街道</label> <select class="form-control" id="dizhixinxijiedao"></select>
                        </div> 			
						</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="savedzxi()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
                <!-- 服务地址信息(编辑) -->
                <div class="md-modal colored-header custom-width md-effect-9" id="add-addressBJ">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>服务地址信息修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                     <input id="flagNumForBJ" type="hidden" value="">
                      <div class="modal-body form">
						<div class="form-group">
                          <label>省</label> <select class="form-control" id="dizhixinxishenBJ"></select>
                        </div>
                        <div class="form-group">
                          <label>市</label> <select class="form-control" id="dizhixinxishiBJ"></select>
                        </div>
						<div class="form-group">
                          <label>区</label> <select class="form-control" id="dizhixinxiquBJ"></select>
                        </div>
						<div class="form-group">
                          <label>街道</label> <select class="form-control" id="dizhixinxijiedaoBJ"></select>
                        </div> 			
						</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" id="savedzxiBJ">保存编辑</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>

				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
    
      //获取市信息
      function getquyushixinxi(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#quyushi_input").html(html);
      }
     
      //获取区信息
      function getquyuquxinxi(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#quyuqu_input").html(html);
      }
     
      //获取街道信息
      function getquyujiedaoxinxi(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#quyujiedao_input").html(html);
      }
      
      $(document).ready(function(){
    	var homeUrl = "<%=request.getContextPath()%>" + "/welcome.do?main";
      	$(".navbar-brand").attr("href",homeUrl);
        //initialize the javascript
        App.init();   
        
         ///主页面 设置默认站点地址信息////////////////////////////////////////////////////////////////////////////////////////////
        //获取默认省  
        var result = new Array();
        result = getAddresses(4897);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#quyushen_input").html(html);
        
        //获取默认市
        getquyushixinxi($("#quyushen_input").val());
        //获取默认区
        getquyuquxinxi($("#quyushi_input").val());
        //获取默认街道
        getquyujiedaoxinxi($("#quyuqu_input").val());
        //省级选择框变化事件
        $("#quyushen_input").change(function(e){
        	getquyushixinxi($("#quyushen_input").val());
        	getquyuquxinxi($("#quyushi_input").val());
        	getquyujiedaoxinxi($("#quyuqu_input").val());
        });
        //市级选择框变化事件
        $("#quyushi_input").change(function(e){
        	getquyuquxinxi($("#quyushi_input").val());
        	getquyujiedaoxinxi($("#quyuqu_input").val());
        });
        //区级选择框变化事件
        $("#quyuqu_input").change(function(e){
        	getquyujiedaoxinxi($("#quyuqu_input").val());
        });
       
			
			///弹出框 服务地址信息////////////////////////////////////////////////////////////////////////////////////////////
			//弹出框省级选择框变化事件
			$("#dizhixinxishen").change(function(e){
        		getquyushixinxiT($("#dizhixinxishen").val());
        		getquyuquxinxiT($("#dizhixinxishi").val());
        		getquyujiedaoxinxiT($("#dizhixinxiqu").val());
        	});
        	//弹出框市级选择框变化事件
        	$("#dizhixinxishi").change(function(e){
        		getquyuquxinxiT($("#dizhixinxishi").val());
        		getquyujiedaoxinxiT($("#dizhixinxiqu").val());
        	});
        	//弹出框区级选择框变化事件
        	$("#dizhixinxiqu").change(function(e){
        		getquyujiedaoxinxiT($("#dizhixinxiqu").val());
        	});
        	//弹出框省级选择框变化事件-编辑
        	$("#dizhixinxishenBJ").change(function(e){
        		var resultbj = new Array();
    			resultbj = getAddresses($("#dizhixinxishenBJ").val());
        		var htmlbj="";
        		for(var i=0;i<resultbj.length;i++){
        			htmlbj+="<option value=\""+resultbj[i].id+"\">"+resultbj[i].name+"</option>";
        		}
        		$("#dizhixinxishiBJ").html(htmlbj);
        		
        		var resultbj2 = new Array();
    			resultbj2 = getAddresses($("#dizhixinxishiBJ").val());
        		var htmlbj2="";
        		for(var i=0;i<resultbj2.length;i++){
        			htmlbj2+="<option value=\""+resultbj2[i].id+"\">"+resultbj2[i].name+"</option>";
        		}
        		$("#dizhixinxiquBJ").html(htmlbj2);
        		
        		var resultbj3 = new Array();
    			resultbj3 = getAddresses($("#dizhixinxiquBJ").val());
        		var htmlbj3="";
        		for(var i=0;i<resultbj3.length;i++){
        			htmlbj3+="<option value=\""+resultbj3[i].id+"\">"+resultbj3[i].name+"</option>";
        		}
        		$("#dizhixinxijiedaoBJ").html(htmlbj3);
        	});
        	//弹出框市级选择框变化事件-编辑
        	$("#dizhixinxishiBJ").change(function(e){
        		var resultbj2 = new Array();
    			resultbj2 = getAddresses($("#dizhixinxishiBJ").val());
        		var htmlbj2="";
        		for(var i=0;i<resultbj2.length;i++){
        			htmlbj2+="<option value=\""+resultbj2[i].id+"\">"+resultbj2[i].name+"</option>";
        		}
        		$("#dizhixinxiquBJ").html(htmlbj2);
        		
        		var resultbj3 = new Array();
    			resultbj3 = getAddresses($("#dizhixinxiquBJ").val());
        		var htmlbj3="";
        		for(var i=0;i<resultbj3.length;i++){
        			htmlbj3+="<option value=\""+resultbj3[i].id+"\">"+resultbj3[i].name+"</option>";
        		}
        		$("#dizhixinxijiedaoBJ").html(htmlbj3);
        	});
        	//弹出框区级选择框变化事件-编辑
        	$("#dizhixinxiquBJ").change(function(e){
        		var resultbj3 = new Array();
    			resultbj3 = getAddresses($("#dizhixinxiquBJ").val());
        		var htmlbj3="";
        		for(var i=0;i<resultbj3.length;i++){
        			htmlbj3+="<option value=\""+resultbj3[i].id+"\">"+resultbj3[i].name+"</option>";
        		}
        		$("#dizhixinxijiedaoBJ").html(htmlbj3);
        	});
        	
		});		

		//弹出框"地址信息"////////////////////////////////////////////////////////////////////////////////////////////
		//打开地址信息弹窗框，并且设置默认值
		function dizhixinxi(){
			$("#dizhixinxidzlx").val(0);
			//获取省  
        	var result = new Array();
        	result = getAddresses(4897);
        	var html="";
        	for(var i=0;i<result.length;i++){
        		html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        	}
        	$("#dizhixinxishen").html(html);
        	
        	//获取默认市
        	getquyushixinxiT($("#dizhixinxishen").val());
        	//获取默认区
        	getquyuquxinxiT($("#dizhixinxishi").val());
        	//获取街道
        	getquyujiedaoxinxiT($("#dizhixinxiqu").val());
        	
			$("#adddzxx").click();
		}
		//弹出框获取市信息
      	function getquyushixinxiT(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#dizhixinxishi").html(html);
      	}
     	//弹出框获取区信息
      	function getquyuquxinxiT(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#dizhixinxiqu").html(html);
      	}
      	//弹出框获取街道信息
      	function getquyujiedaoxinxiT(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#dizhixinxijiedao").html(html);
      	}
      	
		//保存弹出框地址信息
		function savedzxi(){
			var newhtml = '<tr><td>'+ $("#dizhixinxishen").find("option:selected").text() +'<input type=\"hidden\" value=\"' + $("#dizhixinxishen").val() + '\"></td><td>'+ $("#dizhixinxishi").find("option:selected").text() +'<input type=\"hidden\" value=\"' + $("#dizhixinxishi").val() + '\"></td><td>'+ $("#dizhixinxiqu").find("option:selected").text() +'<input type=\"hidden\" value=\"' + $("#dizhixinxiqu").val() + '\"></td><td>'+ $("#dizhixinxijiedao").find("option:selected").text() +'<input type=\"hidden\" value=\"' + $("#dizhixinxijiedao").val() + '\"></td><td ><a class="label label-default" onclick="editxinxi(this)"><i class="fa fa-pencil"></i></a> <a class="label label-danger" onclick="$(this).parent().parent().remove();"><i class="fa fa-times"></i></a></td></tr>';
		 	$(newhtml).insertBefore("#addressMessge_add"); 
		}
		//编辑弹出框地址信息
		function editxinxi(par){
			var shen = $(par).parent().prev().prev().prev().prev().find("input").val();
			var shi = $(par).parent().prev().prev().prev().find("input").val();
			var qu = $(par).parent().prev().prev().find("input").val();
			var jiedao = $(par).parent().prev().find("input").val();
			
			//获取省  
        	var result = new Array();
        	result = getAddresses(4897);
        	var html="";
        	for(var i=0;i<result.length;i++){
        		html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        	}
        	$("#dizhixinxishenBJ").html(html);
        	
        	//获取默认市
        	var result2 = new Array();
    		result2 = getAddresses(shen);
        	var html2="";
        	for(var i=0;i<result2.length;i++){
        		html2+="<option value=\""+result2[i].id+"\">"+result2[i].name+"</option>";
        	}
        	$("#dizhixinxishiBJ").html(html2);
        
        	//获取默认区
        	var result3 = new Array();
    		result3 = getAddresses(shi);
        	var html3="";
        	for(var i=0;i<result3.length;i++){
        		html3+="<option value=\""+result3[i].id+"\">"+result3[i].name+"</option>";
        	}
        	$("#dizhixinxiquBJ").html(html3);
        	
        	//获取默认街道
        	var result4 = new Array();
    		result4 = getAddresses(qu);
        	var html4="";
        	for(var i=0;i<result4.length;i++){
        		html4+="<option value=\""+result4[i].id+"\">"+result4[i].name+"</option>";
        	}
        	$("#dizhixinxijiedaoBJ").html(html4);
        	
        	$("#dizhixinxishenBJ").val(shen);
        	$("#dizhixinxishiBJ").val(shi);
        	$("#dizhixinxiquBJ").val(qu);
			$("#dizhixinxijiedaoBJ").val(jiedao);
			
			$("#editdzxx").click();
			
			document.getElementById("savedzxiBJ").onclick = function(){			
				$(par).parent().prev().html($("#dizhixinxijiedaoBJ").find("option:selected").text() + "<input type=\"hidden\" value=\"" + $("#dizhixinxijiedaoBJ").val() + "\">");
				$(par).parent().prev().prev().html($("#dizhixinxiquBJ").find("option:selected").text() + "<input type=\"hidden\" value=\"" + $("#dizhixinxiquBJ").val() + "\">");
				$(par).parent().prev().prev().prev().html($("#dizhixinxishiBJ").find("option:selected").text() + "<input type=\"hidden\" value=\"" + $("#dizhixinxishiBJ").val() + "\">");
				$(par).parent().prev().prev().prev().prev().html($("#dizhixinxishenBJ").find("option:selected").text() + "<input type=\"hidden\" value=\"" + $("#dizhixinxishenBJ").val() + "\">");
			}
		}
	
		//关联站长 
		//根据角色名称查找角色ID
	function getIdByRoleName(name){
		var id="0";
		 jQuery.ajax({
          type : "post",
          async:false,
          url : "addOlders.do?getIdByRoleName",
          dataType : "json",
          data: {
               "RoleName":name
          },
          success : function(data){
              if(data.des=="success"){
              		id = data.id;
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
		return id;
		}
		//根据ID查找姓名
function getzhanzhangName(id){
	if(id == null || id == ""){
		return "无";
	}
	var name="";
	jQuery.ajax({
          type : "post",
          async:false,
          url : "site.do?getName",
          dataType : "json",
          data: {
               "id":id
          },
          success : function(data){
             name=data.name;
          },
          error:function(){
	           alert("error");
          }
     });
     return name;
}
	var currentshownpage_t = 1;
	//查询关联站长选择列表
	function guanlianzhanzhang(){
		query_t();
		$("#zhanzhang_modalId").click();
	}
	function query_t() {
		go2page_t(1);
	}
	function go2page_t(pagenumber){
	var pagesize = $("#pageSizeSelector_t option:selected").val();
	var name2search = $("#name_input_t").val();
	
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"siteListShow\":\"true\",\"dataDicListShow\":\"true\",";
	
	if (name2search != null && name2search != "") {
		reqmsg += "\"name_like\":\"" + name2search + "\",";
	}

	var roleIds = getIdByRoleName("站长");
	reqmsg += "\"roleIds\":\""+roleIds+"\",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData_t(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
	function changeData_t(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.employeeList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\">";
			htmlcode += "<td class=\"btn btn-primary btn-md\" style=\"color:#fff;\" onclick=\"savezz("+item.id+",'"+item.name+"')\">选择</td>";
		    if (item.siteList != null && item.siteList.length > 0) {//所属站点
		    	if(item.siteList[0] != null){
					var siteName = "";
					jQuery.each(item.siteList, function(j, item2) {
						if(item2 != null){
							siteName += item2.name + ",";
						}
					});
					if(siteName != ""){
						siteName = siteName.substring(0, siteName.length-1);
					}
					htmlcode += "<td>" + siteName + "</td>";
				}else{
		    		htmlcode += "<td>无</td>";
		    	}	
			}else{
		    	htmlcode += "<td>无</td>";
		    }
		    htmlcode += "<td>" + item.name + "</td>";
		    if(item.siteStreetName != null && item.siteStreetName != ""){
		    	htmlcode += "<td>" + item.siteStreetName + "</td>";
		    }else{
		    	htmlcode += "<td>无</td>";
		    }
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer_t").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml_t(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml_t(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml_t(1, 1);
		genarateRecordNumberHtml_t(1, 10, 0);
	}
}
/**
 * 生成分页信息
 * @method genaratePaginateHtml_t
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml_t(currentpage, totalpage, pagesize) {
	currentshownpage_t = currentpage;

	var htmlcode = "";
	
// 	上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_t('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_t('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
// 	具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_t('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_t('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
// 	下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_t('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_t('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea_t").html(htmlcode);
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml_t
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml_t(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info_t").html(recordInfos);
}
		//保存关联站长
		function savezz(id,name){
			$("#zhanzhang_input").val(name);
			$("#zhanzhangId_input").val(id);
			$("#glzzquxiao").click();
		}
		
		//保存新增站点
		function saveAdd(){
			var touxiangSrc=$("#hide_siteTupian").val();//头像
			if(touxiangSrc == null || touxiangSrc == ""){
				touxiangSrc = "<%=photourlMR %>" + "/photos/zhandian.png";
			}
	
			var name_input = $("#name_input").val();//名称  
			if($.trim(name_input) == ""){
	 			alert("名称必填");
	 			return;
			}
			var zhanzhang_input= $("#zhanzhangId_input").val();//站长
			if($("#zhanzhang_input").val() == "" || $("#zhanzhang_input").val() == null){
				zhanzhang_input = "0";
			}
			var lianxiren_input = $("#lianxiren_input").val();//联系人
			if($.trim(lianxiren_input) == ""){
	 			alert("联系人必填");
	 			return;
			}
			var lianxidianhua_input = $("#lianxidianhua_input").val();//联系电话
			if($.trim(lianxidianhua_input) == ""){
	 			alert("联系电话必填");
	 			return;
			}
			var siteleibie_input = $("#siteleibie_input").val();//站点类别
			var quyushen_input = $("#quyushen_input").val();//地址（省）
			if($.trim(quyushen_input) == ""){
	 			alert("地址（省）必选");
	 			return;
			}
			var quyushi_input = $("#quyushi_input").val();//地址（市）
			if($.trim(quyushi_input) == ""){
	 			alert("地址（市）必选");
	 			return;
			}
			var quyuqu_input = $("#quyuqu_input").val();//地址（区）
			if($.trim(quyuqu_input) == ""){
	 			alert("地址（区）必选");
	 			return;
			}
			var quyujiedao_input = $("#quyujiedao_input").val();//地址（街道）
			if($.trim(quyujiedao_input) == ""){
	 			alert("地址（街道）必选");
	 			return;
			}
			var jutidizhi = $("#jutidizhi").val();//地址（具体地址）
			if($.trim(jutidizhi) == ""){
	 			alert("具体地址必填");
	 			return;
			}

			var reqmsg="{'action':'ADD_SITE_INFO_REQUEST','content':{";
	
			if (touxiangSrc != null && touxiangSrc != "") {
        		reqmsg += "\"mainPhoto\":\"" + touxiangSrc + "\",";
			}
    		if (name_input != null && name_input != "") {
        		reqmsg += "\"name\":\"" + name_input + "\",";
			}
    		
        	reqmsg += "\"masterEmployeeId\":" + zhanzhang_input + ",";
			
    		if (lianxiren_input != null && lianxiren_input != "") {
       			reqmsg += "\"contactPerson\":\"" + lianxiren_input + "\",";
			}
			if (lianxidianhua_input != null && lianxidianhua_input != "") {
       			reqmsg += "\"contactTel\":\"" + lianxidianhua_input + "\",";
			}
			if (siteleibie_input != null && siteleibie_input != "") {
       			reqmsg += "\"type\":\"" + siteleibie_input + "\",";
			}
			if (quyushen_input != null && quyushen_input != "") {
        		reqmsg += "\"provinceId\":" + quyushen_input + ",";
			}
    		if (quyushi_input != null && quyushi_input != "") {
        		reqmsg += "\"cityId\":" + quyushi_input + ",";
			}
			if (quyuqu_input != null && quyuqu_input != "") {
        		reqmsg += "\"areaId\":" + quyuqu_input + ",";
			}
			if (quyujiedao_input != null && quyujiedao_input != "") {
        		reqmsg += "\"streetId\":" + quyujiedao_input + ",";
			}
			if (jutidizhi != null && jutidizhi != "") {
        		reqmsg += "\"address\":\"" + jutidizhi + "\",";
			}
			
	var add11=$("#addressMessge tr:first td:last a");
	if(add11.length != 1){//有服务地址信息
		reqmsg +="\"site_dataDic_list\":[";
		$("#addressMessge tr:last").remove();
		var add3=$("#addressMessge tr");
		for(var i=0;i<add3.length;i++){
			reqmsg +="{\"dataDicId\":" + $("#addressMessge").find("tr:eq("+i+")").find("td:eq(3)").find("input").val() + "},";
		}
		
		reqmsg=reqmsg.substr(0,reqmsg.length-1);
		reqmsg +="],";
	}
			
			reqmsg=reqmsg.substr(0,reqmsg.length-1);
			reqmsg += "}}";
	
			jQuery.ajax({
          	type : "post",
          	async:true,
          	url : "addSite.do?handler",
          	dataType : "json",
          	data: {
           	    "reqmsg":reqmsg
          	},
          	success : function(data){
              if(data.des=="success"){
              	alert("保存成功");
              	var siteId=data.content.id;
              	var path="<%=request.getContextPath()%>";
              	var url=path+"/daeSite.do?main&siteId="+siteId;
              	window.location.replace(url);
              }else if(data.des=="failure"){
                 alert("保存失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

    //上传图片
	function uploadPic() {
		var currPic = $("#pic4upload1").val();
		if (currPic != null && currPic != "") {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						$("#srcPath").val(data); 
						//$("#touxiangId2").attr("src", data);  //将当前图片设为上传的图片
						openImagejsp(data);
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#picuploadform1").ajaxSubmit(ajax_option);
		} else {
			//alert("请选择图片");
		}
	}
	//打开图片控件页面
	function openImagejsp(data){
		window.open ("view/imageCut/jquery-image-cut/image.jsp?"+data, "newwindow", "height=550, width=1100, top=200, left=450, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");
	}
	 //上传裁剪后图片
	function uploadPic_cut() {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						var result = JSON.parse(data);
						$("#hide_siteTupian").val(result.base64);
						$("#touxiangId").attr("src", result.url);  //将当前图片设为上传的图片
						
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#image_submit").ajaxSubmit(ajax_option);
	}
    </script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
