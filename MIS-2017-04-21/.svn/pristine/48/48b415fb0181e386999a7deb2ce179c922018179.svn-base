<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="images/logo.png">

    <title>Clean Zone</title>
  
    <!-- Bootstrap core CSS -->
    <link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
	    <link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

  <link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
  <link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
	<link rel="stylesheet" type="text/css" href="js/intro.js/introjs.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <style type="text/css">
      .timeTip{width:220px;height:80px;background:#f3f9ff;border:2px solid #dadada;z-index:10;}
      .timeTip div{margin:20px 30px}
      .hideAndShow{display:none;}
  </style>
<script type="text/javascript" src="js/addressJS.js"></script>
<script type="text/javascript" src="js/sortListTool.js"></script>
</head>
<body style="opacity: 1; margin-left: 0px;">
	<div style="width: 100%; height: 100%;">
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2>员工管理</h2>
				<ol class="breadcrumb">
					<li>内部管理</li>
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
					<li class="active">员工管理</li>
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->

		<div class="cl-mcont">
			<div class="row">
				<div class="col-md-12">
					<div class="block-flat">
						<div class="content">
							<div class="table-responsive">
								<div class="dataTables_wrapper form-inline">
								    <!-- 查询框开始 -->
									<div class="row">
										
										<div class="col-sm-1" style=" text-align: right;vertical-align: middle; height: 34px; line-height: 34px;">
											<label>姓名</label>
										</div>
										<div class="col-sm-5" style="margin-bottom:10px;">
											<input class="form-control" type="text" style="width: 100%" id="name_input">
										</div>
										<div class="col-sm-1  " style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>星级</label>
										</div>
										<div class="col-sm-5  "  style="margin-bottom:10px;">
										<select class="form-control" id="xingji_input" style="width: 100%" >
											<option value="">全部</option>
											<option value="1">一星</option>
											<option value="2">二星</option>
											<option value="3">三星</option>
											<option value="4">四星</option>
											<option value="5">五星</option>
										</select>
										</div>
										<div class="col-sm-1  " style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>职称名称</label>
										</div>
										<div class="col-sm-5  "  style="margin-bottom:10px;">
										<select class="form-control" id="zhicheng1_input" style="width: 100%" >
										
										</select>
										</div>
										<div class="col-sm-1  " style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>职称等级</label>
										</div>
										<div class="col-sm-5  "  style="margin-bottom:10px;">
										<select class="form-control" id="zhicheng2_input" style="width: 100%" >
										
										</select>
										</div>
										<div class="col-sm-1 hideAndShow" style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>所属站点</label>
										</div>
										<div class="col-sm-11  hideAndShow " style="margin-bottom:10px;">
											<select class="form-control" type="text" id="zhandian_input" style="width: 100%" >
												
											</select>
										</div>
										<div class="col-sm-1   hideAndShow" style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>角色</label>
										</div>
										<div class="col-sm-11  hideAndShow " style="margin-bottom:10px;">
											<select id="juese_input" class="select2" multiple>
                  	  						</select>
										</div>
										<div class="col-sm-1   hideAndShow" style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>所属部门1</label>
										</div>
										<div class="col-sm-5   hideAndShow"  style="margin-bottom:10px;">
										<select class="form-control" id="ssbumen_input" style="width: 100%" >
										
										</select>
										</div>
										<div class="col-sm-1   hideAndShow" style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
											<label>所属部门2</label>
										</div>
										<div class="col-sm-5   hideAndShow"  style="margin-bottom:10px;">
										<select class="form-control" id="ssbumen_input2" style="width: 100%" >
										
										</select>
										</div>
										
									</div>
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									<div class="row">
										<div class="col-sm-12">
											
										    <c:if test="${employee_query_btn_control != 'yes' or employee_query_btn_show == 'yes'}">
											<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query()">查询</button>
										    </c:if>
											<a style="cursor:pointer;text-decoration:underline;vertical-align:bottom;"  onclick="$('.hideAndShow').toggle();">更多查询条件</a>
										    <c:if test="${employee_del_btn_control != 'yes' or employee_del_btn_show == 'yes'}">
											<button type="button" class="btn btn-danger btn-flat" style="float: right; margin-right: 0px;" onclick="doDel()">
												<span><i class="fa fa-trash-o" style="margin-right:5px;"></i>删除</span>
											</button>
											</c:if>
											<c:if test="${employee_add_btn_control != 'yes' or employee_add_btn_show == 'yes'}">
											<button type="button" class="btn btn-primary btn-flat" data-modal="md-scale" style="float: right;" onclick="doAdd()">
												<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
											</button>
											<a href="<%=request.getContextPath()%>/addEmployee.do?main" id="addA" target="_blank" style="display:none;">新增</a>
											</c:if>
											<c:if test="${employee_daochu_btn_control != 'yes' or employee_daochu_btn_show == 'yes'}">
											<button type="button" id="daochuanniu" class="btn btn-primary btn-flat  md-trigger" style="display:none;" data-modal="Export-daochu">
											<button type="button" class="btn btn-primary btn-flat" style="float: right;"  onclick="exportxls();">
                        						<span><i class="fa fa-upload" style="margin-right:5px;"></i>导出</span>
                     						</button>
                     						<form action="employee.do?exportxls"  method="post" style="display:none;">  <!-- 导出功能 form不可见 -->
	                    						<input type="text" name="name_input" value="" id="">
	                    						<input type="text" name="zhandian_input" value="" id="">
	                    						<input type="text" name="ssbumen_input" value="" id="">
	                    						<input type="text" name="ssbumen_input2" value="" id="">
	                    						<input type="text" name="xingji_input" value="" id="">
	                    						<input type="text" name="juese_input" value="" id="">
	                    						<input type="text" name="zhicheng2_input" value="" id="">
	                    						<input type="submit" value="Submit" id="SubmitButton" />
                    						</form>
                     						</c:if>
                     						<c:if test="${employee_daoru_btn_control != 'yes' or employee_daoru_btn_show == 'yes'}">
                      						<button type="button" class="btn btn-primary btn-flat md-trigger" style="float: right;" data-modal="Import-confi">
                        						<span><i class="fa fa-download" style="margin-right:5px;"></i>导入</span>
                      						</button>
                      						</c:if>
										</div>
									</div>
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
									<div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th style="width:2%;"><input id="allselectchecker" type="checkbox" class="col_selector" onclick="selectAll();"></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_name')"><strong>姓名</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_gender')"><strong>性别</strong></th>
														<th><strong>所属站点</strong></th>
														<th><strong>角色</strong></th>
														<th><strong>职称</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'starLevel')"><strong>星级</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'department')"><strong>所属部门</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 -->
								    <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="datatable2_length">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector" class="form-control" aria-controls="datatable2" size="1" name="datatable2_length" onchange="query()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
							</div>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</div>
	
	<!-- Nifty Modal -->
	<div class="md-modal md-effect-1" id="md-scale" style="height:650px;overflow:hidden;overflow-y:auto;background:#fff;">
    	<div class="row">
			<div class="col-md-12">
				<div class="block-flat">
					<div class="header">
						<h3>员工信息表信息</h3>
					</div>
			
					<div class="content">
						<form class="form-horizontal group-border-dashed" action="#" style="border-radius: 0px;">
							<input type="hidden" name="entityId" id="entityId">
							<div class="form-group">
								<label class="col-sm-3 control-label">账号ID</label>
								<div class="col-sm-6">
									<input id="userId" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">站点ID</label>
								<div class="col-sm-6">
									<input id="siteId" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">头像</label>
								<div class="col-sm-6">
									<input id="mainPhoto" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">姓名</label>
								<div class="col-sm-6">
									<input id="name" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">身份证号</label>
								<div class="col-sm-6">
									<input id="idnumber" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">性别</label>
								<div class="col-sm-6">
									<input id="gender" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">手机</label>
								<div class="col-sm-6">
									<input id="mobileTel" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">固话</label>
								<div class="col-sm-6">
									<input id="homeTel" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">出生日期</label>
								<div class="col-sm-6">
									<input id="birthdate" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">部门</label>
								<div class="col-sm-6">
									<input id="department" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">职称</label>
								<div class="col-sm-6">
									<input id="positionalTitle" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">星级</label>
								<div class="col-sm-6">
									<input id="starLevel" type="text" class="form-control">
								</div>
							</div>
							<div class="form-group" style="text-align: center;">
								<button type="button" class="btn btn-primary btn-rad" onclick="saveInfo();">
									<span><i class="fa fa-check" style="margin-right:5px;"></i>保存</span>
								</button>
								<button id="cancel_button" type="button" class="btn btn-primary btn-rad md-close" style="margin-left: 50px;">
									<span><i class="fa fa-times" style="margin-right:5px;"></i>取消</span>
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Nifty Modal -->

		<div class="md-modal md-effect-1" id="Import-confi" >  <!-- 导入配置模态框 -->
				<div class="md-content">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>导入配置</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					<div style="margin-bottom:25px;margin-top:15px;text-align:center">
                 <button type="button" class="btn btn-default btn-lg">
                  		输入excel文件，导入员工信息
                  </button>
                  </div>
				</div>  
			</div> <!-- 导入配置 结束-->
			
		<div class="md-modal md-effect-1" id="Export-daochu" >  <!-- 导出提示框  开始-->
				<div class="md-content">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>正在导出，请稍后...</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                  </div>
		</div> <!-- 导出 结束-->
	
	<div class="md-overlay"></div> <!-- Nifty Modal的遮罩层-->
	
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
<script type="text/javascript" src="js/behaviour/general.js"></script>
<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
<script src="js/skycons/skycons.js" type="text/javascript"></script>
<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
<script src="js/intro.js/intro.js" type="text/javascript"></script> 
<script src="js/behaviour/voice-commands.js"></script>
<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>

<script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page(currentshownpage);
}

var currentshownpage = 1;
var path="employee.do";

      //获取职称信息
      function getzhicheng1(){
        var result = new Array();
    	result = getAddresses(4921);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng1_input").html(html);
      }
      
      //获取职称信息
      function getzhicheng2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng2_input").html(html);
      }
      
	  //获取部门1信息
      function getbumen1(){
        var result = new Array();
    	result = getAddresses(4945);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input").html(html);
      }
      
      //获取部门2信息
      function getbumen2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input2").html(html);
      }
      
$(document).ready(function(){
    App.init();
    $(".md-trigger").modalEffects();
	query();
	getzhicheng1();
	$("#zhicheng2_input").html("<option value=\"\">全部</option>");
	getzhandian();
	getallRoll();
	
	$("#zhicheng1_input").change(function(e){
		if($("#zhicheng1_input").val() == ""){
			$("#zhicheng2_input").html("<option value=\"\">全部</option>");
		}else{
        	getzhicheng2($("#zhicheng1_input").val());
        }
    });
    
    	getbumen1();
		$("#ssbumen_input2").html("<option value=\"\">全部</option>");
		
    	$("#ssbumen_input").change(function(e){
        	if($("#ssbumen_input").val() == ""){
				$("#ssbumen_input2").html("<option value=\"\">全部</option>");
			}else{
        		getbumen2($("#ssbumen_input").val());
        	}
    	});
});

   

function selectAll() {
	if ($("#allselectchecker").is(':checked')) {
		$(".col_selector").prop("checked", true);
	} else {
		$(".col_selector").prop("checked", false);
	}
}

function doAdd() {
	document.getElementById("addA").click();
}

function doDel() {
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
		if (confirm("是否确认删除?"))  { 
		jQuery.ajax({
			type:"post",
			url:path+"?del",
			async:true,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
		}
	} else {
		alert("请选择要删除的数据");
	}
}

function del2(id) {
	  if (confirm("是否确认删除?"))  { 
		jQuery.ajax({
			type:"post",
			url:path+"?del",
			async:true,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	  }
}

/**
 * 保存信息
 * @method saveInfo
 */
function saveInfo() {
	var id = $("#entityId").val();
	var userId = $("#userId").val();
	var siteId = $("#siteId").val();
	var mainPhoto = $("#mainPhoto").val();
	var name = $("#name").val();
	var idnumber = $("#idnumber").val();
	var gender = $("#gender").val();
	var mobileTel = $("#mobileTel").val();
	var homeTel = $("#homeTel").val();
	var birthdate = $("#birthdate").val();
	var department = $("#department").val();
	var positionalTitle = $("#positionalTitle").val();
	var starLevel = $("#starLevel").val();
	
	var reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{";
	
	if (id != null && id != "") {
		reqmsg += "\"id\":" + id + ",";
	}
    if (userId != null && userId != "") {
        reqmsg += "\"userId\":" + userId + ",";
	}else{
        reqmsg += "\"userId\":0,";
	}
    if (siteId != null && siteId != "") {
        reqmsg += "\"siteId\":" + siteId + ",";
	}else{
        reqmsg += "\"siteId\":0,";
	}
	    reqmsg += "\"mainPhoto\":\"" + mainPhoto + "\",";
	    reqmsg += "\"name\":\"" + name + "\",";
	    reqmsg += "\"idnumber\":\"" + idnumber + "\",";
	    reqmsg += "\"gender\":\"" + gender + "\",";
	    reqmsg += "\"mobileTel\":\"" + mobileTel + "\",";
	    reqmsg += "\"homeTel\":\"" + homeTel + "\",";
	    reqmsg += "\"birthdate\":\"" + birthdate + "\",";
	    reqmsg += "\"department\":\"" + department + "\",";
    if (positionalTitle != null && positionalTitle != "") {
        reqmsg += "\"positionalTitle\":" + positionalTitle + ",";
	}else{
        reqmsg += "\"positionalTitle\":0,";
	}
    if (starLevel != null && starLevel != "") {
        reqmsg += "\"starLevel\":" + starLevel + ",";
	}else{
        reqmsg += "\"starLevel\":0,";
	}
	
	reqmsg += "}}";
	
	jQuery.ajax({
          type : "post",
          async:true,
          url : path+"?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	$("#cancel_button").click();
            	  go2page(currentshownpage);
              }else if(data.des=="failure"){
                 alert("保存失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function go2page(pagenumber){
	var pagesize = $("#pageSizeSelector option:selected").val();
	var name2search = $("#name_input").val();
	var zhandian_input = $("#zhandian_input").val();
	var juese_input = $("#juese_input").val();
	
	var zhicheng1_input = $("#zhicheng1_input").val();
	var zhicheng2_input = $("#zhicheng2_input").val();
	
	var xingji_input = $("#xingji_input").val();
	var ssbumen_input = $("#ssbumen_input").val();
	var ssbumen_input2 = $("#ssbumen_input2").val();
	
	var reqmsg = "{'action':'QUERY_EMPLOYEE_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"siteListShow\":\"true\",\"dataDicListShow\":\"true\",";
	
	if (name2search != null && name2search != "") {
		reqmsg += "\"name_like\":\"" + name2search + "\",";
	}
	if (zhandian_input != null && zhandian_input != "") {
		reqmsg += "\"siteId\":" + zhandian_input + ",";
	}
	if (juese_input != null && juese_input != "") {
		reqmsg += "\"roleIds\":\"" + juese_input + "\",";
	}
	
	if($("#zhicheng1_input").val() != null){
		if($("#zhicheng1_input").val() != ""){
			reqmsg += "\"zhicheng1\":\"" + zhicheng1_input + "\"," + "\"zhicheng2\":\"" + zhicheng2_input + "\",";
		}else if($("#zhicheng1_input").val() == "" && $("#zhicheng1_input").val() != ""){
			reqmsg += "\"zhicheng1\":\"\"," + "\"zhicheng2\":\"" + zhicheng2_input + "\",";
		}
	}
	
	if (xingji_input != null && xingji_input != "") {
		reqmsg += "\"starLevel\":" + xingji_input + ",";
	}
	if (ssbumen_input != null && ssbumen_input != "") {
		reqmsg += "\"department\":" + ssbumen_input + ",";
	}
	if (ssbumen_input2 != null && ssbumen_input2 != "") {
		reqmsg += "\"secondDepartmentId\":" + ssbumen_input2 + ",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : path+"?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function changeData(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.employeeList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector\"></td>";
		    htmlcode += "<td>" + item.name + "</td>";			
		    htmlcode += "<td>" + item.gender + "</td>";	
		    if (item.siteList != null && item.siteList.length > 0) {//所属站点
		    	if(item.siteList[0] != null){
					var siteName = "";
					jQuery.each(item.siteList, function(j, item2) {
						if(item2 != null){
							siteName += item2.name + ",";
						}
					});
					if(siteName != ""){
						siteName = siteName.substring(0, siteName.length-1);
					}
					htmlcode += "<td>"+siteName+"</td>";
				}else{
		    		htmlcode += "<td>无</td>";
		    	}	
			}else{
		    	htmlcode += "<td>无</td>";
		    }	
		    htmlcode += "<td>" + item.roleNames + "</td>";	
		    if(item.zhichengs != null && item.zhichengs != ""){
		    	htmlcode += "<td>" + item.zhichengs + "</td>";	
		    }else{
		    	htmlcode += "<td>无</td>";			    
		    }	
		    if(item.starLevel != null && item.starLevel != ""){
				htmlcode += "<td>" + pipeiStarLevel(item.starLevel) + "</td>";	
			}else{
				htmlcode += "<td></td>";	
			}
			if(item.department != null && item.department != ""){
				htmlcode += "<td>" + getNameById(item.department) + "/" + getNameById(item.secondDepartmentId) + "</td>";
			}else{
				htmlcode += "<td></td>";
			}
			
		    htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${employee_queryXQ_opt_control != 'yes' or employee_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/daeEmployee.do?main&employeeId="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${employee_del_opt_control != 'yes' or older_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
					
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml(1, 1);
		genarateRecordNumberHtml(1, 10, 0);
	}
}

function changeInfo(data){
    if (data.content != null) {
        $("#entityId").val(data.content.id);
		$("#userId").val(data.content.userId);
		$("#siteId").val(data.content.siteId);
		$("#mainPhoto").val(data.content.mainPhoto);
		$("#name").val(data.content.name);
		$("#idnumber").val(data.content.idnumber);
		$("#gender").val(data.content.gender);
		$("#mobileTel").val(data.content.mobileTel);
		$("#homeTel").val(data.content.homeTel);
		$("#birthdate").val(data.content.birthdate);
		$("#department").val(data.content.department);
		$("#positionalTitle").val(data.content.positionalTitle);
		$("#starLevel").val(data.content.starLevel);
    }
}

/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}

function query() {
	go2page(1);
}

/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";	
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}

		//获取所有站点
		function getzhandian(){
		  var html="<option value=\"\">全部</option>";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getzhandian",
	          dataType : "json",
	          data: {
	               "zhandian":"站点"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	html=html+"<option value=\""+id[i]+"\">"+name[i]+"</option>";
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
		  $("#zhandian_input").html(html);
		}
		
		//获取所有角色
		function getallRoll(){
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getRoleName",
	          dataType : "json",
	          data: {
	               "RoleName":"角色"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	if(name[i].indexOf("老人") == -1){
	            	  		html=html+"<option value=\""+id[i]+"\">"+name[i]+"</option>";
	            	  	}
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#juese_input").html(html);
		}
		
//导出
function exportxls(){
	if (confirm("是否确认导出?"))  { 
	var name_input = $("#name_input").val();//姓名
	var zhandian_input = $("#zhandian_input").val();//所属站点
	var ssbumen_input = $("#ssbumen_input").val();//所属部门1
	var ssbumen_input2 = $("#ssbumen_input2").val();//所属部门2
	var xingji_input = $("#xingji_input").val();//星级
	var juese_input = $("#juese_input").val();//角色
	var zhicheng2_input = $("#zhicheng2_input").val();//职称2
	
	$("[name=name_input]").val(name_input);
	$("[name=zhandian_input]").val(zhandian_input);
	$("[name=ssbumen_input]").val(ssbumen_input);
	$("[name=ssbumen_input2]").val(ssbumen_input2);
	$("[name=xingji_input]").val(xingji_input);
	$("[name=juese_input]").val(juese_input);
	$("[name=zhicheng2_input]").val(zhicheng2_input);
	$("#SubmitButton").click();
	$("#daochuanniu").click();
   	}
}

//星级转化
function pipeiStarLevel(star){
     	var name = "未知";
     	switch (star)
		{
			case 1:
  			name = "一星";
  			break;
  			
			case 2:
  			name = "二星";
  			break;

			case 3:
  			name = "三星";
  			break;
  			
  			case 4:
  			name = "四星";
  			break;
  			
  			case 5:
  			name = "五星";
  			break;
  			
  			default:
  			break;
		}
		return name;
}
</script>
  </body>
</html>