<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>护理计划</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  	<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

 	<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />	
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>
<style>

</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>	
<div id="cl-wrapper" style="padding-top:0px">	
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2>护理计划</h2>
				<ol class="breadcrumb">
					<li >服务管理</li>
					<li class="active">护理计划</li>
					<input type="hidden" id="addUserName" value="">
					<input type="hidden" id="olderId_hide" value="">
					<input type="hidden" id="fwName_hide" value="">
					<input type="hidden" id="fwTel_hide" value="">
					<input type="hidden" id="fwAddress_hide" value="">
					<input type="hidden" id="fwxminput_Id4_hide" value="">
					<input type="hidden" id="fwxminput_healthInsurance_hide" value="">
					<input type="hidden" id="fwxminput_SCPRICE4_hide" value="">
					<input type="hidden" id="fwxminput_YBPRICE4_hide" value="">
					<input type="hidden" id="fuwuzixianginput_hide" value="">
					<input type="hidden" id="yjfwsc_hide" value="">
					<input type="hidden" id="fuzerenId_hide" value="">
					<input type="hidden" id="fuzerenName_hide" value="">
					<input type="hidden" id="fuzerenRole_hide" value="">
					<input type="hidden" id="fuzerenBH_hide" value="">
					<input type="hidden" id="fuzerenSiteId_hide" value="">
					<input type="hidden" id="fuzerenSiteName_hide" value="">
					<input type="hidden" id="cyrinput_hide" value="">
					
					<input type="hidden" id="oldId_hide">
					<input type="hidden" id="oldName_hide">
					
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->
	<div class="cl-mcont">
    <div class="block-flat">
						<div class="row">
									
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>老人姓名</label>
										</div>
										<div class="col-sm-4 col-md-4 col-lg-4" style="margin-bottom:10px;">
											<input class="form-control" type="text"  id="name_input" >
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>添加人</label>
										</div>
										<div class="col-sm-4 col-md-4 col-lg-4" style="margin-bottom:10px;">
											<input class="form-control" type="text"  id="addname_input" >
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>开始日期</label>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="startTime1_input" placeholder="开始时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="startTime2_input" placeholder="结束时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>截止时间</label>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="endTime1_input" placeholder="开始时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group date datetime" data-min-view="2" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px;">
												<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>
												<input class="form-control" size="16" value="" readonly="" type="text" id="endTime2_input" placeholder="结束时间">
												<span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
											</div>
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>状态</label>
										</div>
										<div class="col-sm-4 col-md-4 col-lg-4" style="margin-bottom:10px;">
											<select class="form-control" id="state_input">
												<option value="">全部</option>
                								<option value="0">制定中</option>
                								<option value="1">待审核</option>
                								<option value="2">有效</option>
                								<option value="3">无效</option>
                							</select>
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>审核时间</label>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group">
											<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>                    
				                     		 <input class="form-control datetime" size="16" type="text" id="startcheck_input" placeholder="开始时间"  readonly/>
				                      		 <span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
				                      		 </div>
										</div>
										<div class="col-sm-5 col-md-5 col-lg-2" style="margin-bottom:10px;">
											<div class="input-group">
											<span class="input-group-addon btn btn-primary"><span class="glyphicon glyphicon-th"></span></span>                    
				                     		 <input class="form-control datetime" size="16" type="text" id="endcheck_input" placeholder="结束时间" readonly/>
				                      		 <span class="input-group-btn"><button class="btn btn-danger deleteThisTime" type="button"><span class="fa fa-times"></span></button></span>
				                       		</div>
										</div>
										
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-top:20px">		
											<c:if test="${NursingPlanList_query_btn_control != 'yes' or NursingPlanList_query_btn_show == 'yes'}">
											<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query()">查询</button>
											</c:if>
											<div class="btn-group" style="margin-top:5px;float:right;margin-right:0">
												<%-- <c:if test="${NursingPlanList_scgd_btn_control != 'yes' or NursingPlanList_scgd_btn_show == 'yes'}">
						  						 <button type="button" class="btn btn-success dropdown-toggle" id="create_gdId" data-toggle="dropdown" onclick="create_gd()" style="margin-left:5px;margin-right:0">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>生成工单</span>
						 						 </button>
						 						</c:if>  --%>
												<c:if test="${NursingPlanList_add_btn_control != 'yes' or NursingPlanList_add_btn_show == 'yes'}">
						  						 <button type="button" style="display:none;" class="btn btn-primary dropdown-toggle md-trigger" id="xinzengId" data-toggle="dropdown" data-modal="kh_hl_md"></button>
						  						 <button type="button" class="btn btn-primary dropdown-toggle md-trigger" data-toggle="dropdown" data-modal="kh_hl_md" onclick="qingkongTC()" style="margin-left:5px;margin-right:0">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
						 						 </button>
						 						 <a href="<%=request.getContextPath()%>/nursingPlan.do?mainAdd" id="addA" target="_blank" style="display:none;">新增</a>
						 						</c:if> 
						 						<c:if test="${NursingPlanList_del_btn_control != 'yes' or NursingPlanList_del_btn_show == 'yes'}"> 
						 						 <button type="button" class="btn btn-danger dropdown-toggle md-trigger" data-toggle="dropdown" data-modal="" style="margin-left:5px;margin-right:0"  onclick="doDel()">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>删除</span>
						 						 </button>
												</c:if>  
												<c:if test="${NursingPlanList_qx_btn_control != 'yes' or NursingPlanList_qx_btn_show == 'yes'}">
						 						  <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" onclick="quxiao_hljh()" style="margin-left:5px;margin-right:0">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>取消</span>
						 						  </button>
												</c:if>	
										 	</div>
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
													<th style="width:2%;"><input id="allselectchecker" type="checkbox" class="col_selector" onclick="selectAll();"></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'code')"><strong>计划标号</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_olderName')"><strong>老人姓名</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_addEmployeeName')"><strong>添加人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'status')"><strong>状态</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'startDate')"><strong>开始时间</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'endDate')"><strong>截止时间</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'checkTime')"><strong>审核通过时间</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">		
													<%-- <tr>
							                          <td><input type="checkbox" class="col_selector"></td>
							                          <td>53452405</td>
							                          <td>张三</td>
							                          <td>护员1</td>
							                          <td>2015-12-25</td>							                          
							                          <td>2016-12-12</td>							                          
							                          <td>
							                            <div class="btn-group">
							                              <button class="btn btn-default btn-xs" type="button">操作</button>
							                              <button data-toggle="dropdown" class="btn btn-xs btn-primary dropdown-toggle" type="button">
							                                <span class="caret"></span><span class="sr-only">Toggle Dropdown</span>
							                              </button>
							                              <ul role="menu" class="dropdown-menu pull-right">
							                                 <li><a href="<%=request.getContextPath()%>/nursingPlan.do?mainXQ" target="_blank">查看详情</a></li>
							                                <li><a href="###">复制</a></li>
							                                <li><a href="###">延长</a></li>
							                                <li><a href="##">删除</a></li>
							                              </ul>
							                            </div>
							                          </td>
							                        </tr> --%>
							                      																								
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 -->
								    <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector"   size="1"  onchange="query()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
								</div>

							</div> 
	
					</div> <!-- 主页面结束 -->

    <!-- 模态框开始-->
               
  				<!-- 护理计划进入页-->
                <div class="md-modal colored-header custom-width md-effect-9" id="kh_hl_md">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>选择会员</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <input type="hidden" id="zwmbxz_hljhId" value="">
                      </div>
                      <div class="modal-body form form-horizontal">
                     <!--  <form class="" > -->
                     	<div class="form-group">
                        <label class="col-sm-4 control-label">选择</label>
						<div class="col-sm-6 " >
							<select class="form-control" id="hljh_input_choose" onchange="hljh_input_choose()">
								<option value="1">会员号</option>
								<option value="2">会员卡号</option>
							</select>
						</div></div>
						<div class="form-group" id="hyIfxianshi">
						    <label class="col-sm-4 control-label">会员号</label>
						<div class="col-sm-6 " >
							<input class="form-control" type="text"  id="huiyuanhao_input_choose" value="">
						</div>
                        </div>
                        <div class="form-group" id="hkyIfxianshi">
						    <label class="col-sm-4 control-label">会员卡号</label>
						<div class="col-sm-6 " >
							<input class="form-control" type="text"  id="huiyuankahao_input_choose" value="">
						</div>
                        </div>
                        <!-- </form> -->	
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat" data-dismiss="modal" id="tcSure" onclick="sureChoose()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="quxiao_tanchuang">取消</button>
                      </div>
                    </div>
                </div>
                
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page(currentshownpage);
}

     function zwbmxz(id){
     	$("#zwmbxz_hljhId").val(id);
     	$("#xinzengId").click();
     	$("#huiyuanhao_input_choose").val("");
     	$("#huiyuankahao_input_choose").val("");
     }
     function hljh_input_choose(){
     	$("#huiyuanhao_input_choose").val("");
     	$("#huiyuankahao_input_choose").val("");
     	var choose = $("#hljh_input_choose").val();
     	if(choose == "1"){
     		$("#hyIfxianshi").show();
     		$("#hkyIfxianshi").hide();
     	}
     	if(choose == "2"){
     		$("#hyIfxianshi").hide();
     		$("#hkyIfxianshi").show();
     	}
     }
     function qingkongTC(){
     	$("#zwmbxz_hljhId").val("");
     	$("#huiyuanhao_input_choose").val("");
     	$("#huiyuankahao_input_choose").val("");
     }
     function sureChoose(){
    	if($.trim($("#huiyuanhao_input_choose").val()) == "" && $.trim($("#huiyuankahao_input_choose").val()) == ""){
    		alert("请输入信息");
    		return;
    	}
    	var id = "";
    	if($.trim($("#huiyuanhao_input_choose").val()) != ""){
    		id = checkHYH($.trim($("#huiyuanhao_input_choose").val()));
    		if(id == ""){
    	    	alert("会员号不存在");
    			return;
    		}
    	}
    	if($.trim($("#huiyuankahao_input_choose").val()) != ""){
    		id = checkHYKH($.trim($("#huiyuankahao_input_choose").val()));
    		if(id == ""){
    	    	alert("会员卡号不存在");
    			return;
    		}
    	}
    	var id_hljh = checkIfhljh(id);
    	var headUrl = "<%=request.getContextPath()%>";
    	var url = "";
    	
    	if($("#zwmbxz_hljhId").val() != null && $("#zwmbxz_hljhId").val() != ""){//作为模板新增
    		if(id_hljh != ""){
    			alert("此会员已存在护理计划，无法作为模板新增");
    			return;
    		}
    		getOldId($.trim($("#huiyuanhao_input_choose").val()),$.trim($("#huiyuankahao_input_choose").val()));
    		var oldId_hide = $("#oldId_hide").val();
    		var oldName_hide = $("#oldName_hide").val();
    		url = headUrl+"/nursingPlan.do?mainAdd&flag=moban&id="+$("#zwmbxz_hljhId").val() + "&oldId=" + oldId_hide + "&oldName=" + oldName_hide;
    		$("#addA").attr("href",url);
    		doAdd();
    		$("#oldId_hide").val("");
    		$("#oldName_hide").val("");
    		$("#zwmbxz_hljhId").val("");
    		$("#quxiao_tanchuang").click();
    		return;
    	}
    	
    	if(id_hljh == ""){
    		getOldId($.trim($("#huiyuanhao_input_choose").val()),$.trim($("#huiyuankahao_input_choose").val()));
    		if(confirm("此会员还没有护理计划，点击确定后为您跳转新增页")){
    			var oldId_hide = $("#oldId_hide").val();
    			var oldName_hide = $("#oldName_hide").val();
    			url = headUrl + "/nursingPlan.do?mainAdd&oldId=" + oldId_hide + "&oldName=" + oldName_hide;
    			$("#oldId_hide").val("");
    			$("#oldName_hide").val("");
    		    $("#addA").attr("href",url);
    			doAdd();
    		}
    	}else{
    		if(confirm("此会员已存在护理计划，点击确定后为您跳转详情页")){
				url = headUrl + "/nursingPlan.do?mainAdd&id=" + id_hljh;
    		    $("#addA").attr("href",url);
    			doAdd();
    		}
    	}
    	$("#quxiao_tanchuang").click();
    }
    
    //检查会员号是否存在
    function checkHYH(idnumber){
    	var id = "";
    	jQuery.ajax({
          type : "post",
          async:false,
          url : "nursingPlan.do?checkHYH",
          dataType : "json",
          data: {
               "idnumber":idnumber
          },
          success : function(data){
              if(data.des=="success"){
            	 id = data.id;
              }else if(data.des=="failure"){
                 //alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
     	return id;
    }
    
     //检查会员卡号是否存在
    function checkHYKH(idnumber_Card){
    	var id = "";
    	jQuery.ajax({
          type : "post",
          async:false,
          url : "nursingPlan.do?checkHYKH",
          dataType : "json",
          data: {
               "idnumber_Card":idnumber_Card
          },
          success : function(data){
              if(data.des=="success"){
            	 id = data.id;
              }else if(data.des=="failure"){
                 //alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
     	return id;
    }
    
    //检查会员是否存在护理计划
    function checkIfhljh(id){
    	var id_hljh = "";
    	jQuery.ajax({
          type : "post",
          async:false,
          url : "nursingPlan.do?checkIfhljh",
          dataType : "json",
          data: {
               "id":id
          },
          success : function(data){
              if(data.des=="success"){
            	 id_hljh = data.id_hljh;
              }else if(data.des=="failure"){
                 //alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
     	return id_hljh;
    }
    
 //时间转化yyyy-mm-dd hh:mm 转为yyyymmddhhmm
 function formatTime(time){
 	var times = "";
	times = String(time);
	if(times == null || times == ""){
		return "";
	}
	times = times.split("-")[0] + times.split("-")[1] + String(times.split("-")[2]).substr(0,2) + String(times.split("-")[2]).substr(3,2) + String(times.split("-")[2]).substr(6,2);
	return times;
 }
    
   $(document).ready(function(){
   		var status="<%=request.getAttribute("status")%>";
      	if(status != null && status != ""){
      		$("#state_input").val(status);
      	}
      	
   		query();
    	$(".deleteThisTime").click(function(){               //清除日期框中的值
    	       $(this).parent().prev()[0].value = "";
    	    });
        App.init();
      
      	$("#huiyuanhao_input_choose").keydown(function() { //焦点在弹窗第一个时，按回车，焦点跳转确定
			if (event.keyCode == 13) {
				$("#tcSure").click();
				return;
			}
		});
		$("#huiyuankahao_input_choose").keydown(function() { //焦点在弹窗第二个时，按回车，焦点跳转确定
			if (event.keyCode == 13) {
				$("#tcSure").click();
				return;
			}
		});
		
		$("#hyIfxianshi").show();
     	$("#hkyIfxianshi").hide();
     	
     	
   		getLoginName();
    });
   
   
    function doAdd() {
		document.getElementById("addA").click();
	}
	
	function doDel() {
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"nursingPlan.do?del",
			async:true,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
		}
	} else {
		alert("请选择要删除的数据");
	}
}

function del2(id) {
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"nursingPlan.do?del",
			async:true,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page(currentshownpage);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	}
}

	var currentshownpage = 1;
	function selectAll() {
		if ($("#allselectchecker").is(':checked')) {
			$(".col_selector").prop("checked", true);
		} else {
			$(".col_selector").prop("checked", false);
		}
	}
	
	function query() {
		go2page(1);
	}
	
	function go2page(pagenumber){
	var pagesize = $("#pageSizeSelector option:selected").val();
	var name_input = $.trim($("#name_input").val());
	var addname_input = $.trim($("#addname_input").val());
	var startTime1_input = $("#startTime1_input").val();
	var startTime2_input = $("#startTime2_input").val();
	var endTime1_input = $("#endTime1_input").val();
	var endTime2_input = $("#endTime2_input").val();
	var state_input = $("#state_input").val();
	var startcheck_input = $("#startcheck_input").val();
	var endcheck_input = $("#endcheck_input").val();

	var reqmsg="{'action':'QUERY_NURSING_PLAN_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
	
	if (name_input != null && name_input != "") {
		reqmsg += "\"olderName_like\":\"" + name_input + "\",";
	}
	if (addname_input != null && addname_input != "") {
		reqmsg += "\"addEmployeeName_like\":\"" + addname_input + "\",";
	}
	if (startTime1_input != null && startTime1_input != "") {
		reqmsg += "\"startDate_ge\":\"" + startTime1_input.substring(0, 4) + startTime1_input.substring(5, 7) + startTime1_input.substring(8, 10) + "000000" + "\",";
	}
	if (startTime2_input != null && startTime2_input != "") {
		reqmsg += "\"startDate_le\":\"" + startTime2_input.substring(0, 4) + startTime2_input.substring(5, 7) + startTime2_input.substring(8, 10) + "000000" + "\",";
	}
	if (endTime1_input != null && endTime1_input != "") {
		reqmsg += "\"endDate_ge\":\"" + endTime1_input.substring(0, 4) + endTime1_input.substring(5, 7) + endTime1_input.substring(8, 10) + "000000" + "\",";
	}
	if (endTime2_input != null && endTime2_input != "") {
		reqmsg += "\"endDate_le\":\"" + endTime2_input.substring(0, 4) + endTime2_input.substring(5, 7) + endTime2_input.substring(8, 10) + "000000" + "\",";
	}
	if (startTime1_input != null && startTime1_input != "" && startTime2_input != null && startTime2_input != "") {
		if(startTime2_input < startTime1_input){
			alert("开始日期的时间起始不正确");
			return;
		}
	}
	if (endTime1_input != null && endTime1_input != "" && endTime2_input != null && endTime2_input != "") {
		if(endTime2_input < endTime1_input){
			alert("截止时间的时间起始不正确");
			return;
		}
	}
	if (startcheck_input != null && startcheck_input != "") {
		reqmsg += "\"checkTime_ge\":\"" + formatTime(startcheck_input) + "01" + "\",";
	}
	if (endcheck_input != null && endcheck_input != "") {
		reqmsg += "\"checkTime_le\":\"" + formatTime(endcheck_input) + "59" + "\",";
	}
	if (startcheck_input != null && startcheck_input != "" && endcheck_input != null && endcheck_input != "") {
		if(startcheck_input > endcheck_input){
			alert("审核通过时间的时间起始不正确");
			return;
		}
	}
	if (state_input != null && state_input != "") {
		reqmsg += "\"status\":" + state_input + ",";
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "nursingPlan.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}
function changeData(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.nursingPlanList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector\"><input type=\"hidden\" value=\"" + item.status + "\" style=\"display:none;\"></td>";		
		    htmlcode += "<td>" + item.code + "</td>";	
		    htmlcode += "<td>" + item.olderName + "</td>";
		    htmlcode += "<td>" + item.addEmployeeName + "</td>";
		    htmlcode += "<td>" + changeState(item.status) + "</td>";		
		    htmlcode += "<td>" + formateTime2(item.startDate) + "</td>";	
		    htmlcode += "<td>" + formateTime2(item.endDate) + "</td>";	
		    htmlcode += "<td>" + formateTime3(item.checkTime) + "</td>";
		   
			htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${NursingPlanList_queryXQ_opt_control != 'yes' or NursingPlanList_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/nursingPlan.do?mainAdd&id="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${NursingPlanList_addAsMB_opt_control != 'yes' or NursingPlanList_addAsMB_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"zwbmxz('"+item.id+"')\"><a href=\"###\">作为模板新增</a></li>";
			</c:if>	
			/* <c:if test="${NursingPlanList_scgd_opt_control != 'yes' or NursingPlanList_scgd_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"create_gd2('" + item.id + "','" + item.status + "')\"><a href=\"###\">生成工单</a></li>";
			</c:if>	 */
			<c:if test="${NursingPlanList_del_opt_control != 'yes' or NursingPlanList_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			<c:if test="${NursingPlanList_qx_opt_control != 'yes' or NursingPlanList_qx_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"quxiao_hljh2('" + item.id + "')\"><a href=\"###\">取消</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml(1, 1);
		genarateRecordNumberHtml(1, 10, 0);
	}
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}

/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD)
 */
function formateTime2(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8);
	} else {
		return time;
	}
}
/**
 * 格式化时间
 * @method formateTime3
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD hh:mm)
 */
function formateTime3(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12);
	} else {
		return time;
	}
}


function changeState(state){
     	var name = "未知";
     	switch (state)
		{
			case 0:
  			name = "制定中";
  			break;
  			
			case 1:
  			name = "待审核";
  			break;

			case 2:
  			name = "有效";
  			break;
  			
  			case 3:
  			name = "无效";
  			break;
  			
  			default:
  			break;
		}
		return name;
}

function quxiao_hljh2(id){
	  if (confirm("是否确认取消?"))  {  
	  	   var reqmsg="{'action':'ADD_NURSING_PLAN_INFO_REQUEST','content':{";
	  	   
		   if (id != null && id != "") {
		   		reqmsg += "\"ids2del\":\"" + id + "\",";
		   }
		   
		   reqmsg += "\"status\":3,";
		   reqmsg += "}}";
	
    	jQuery.ajax({
          type : "post",
          async:true,
          url : "nursingPlan.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.result=="100"){
              	 go2page(currentshownpage);
              	 alert("取消成功");
              }else{
                 alert("取消失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
     
	  }
}

function quxiao_hljh(){
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
	  if (confirm("是否确认取消?"))  {  
	  	   var reqmsg="{'action':'ADD_NURSING_PLAN_INFO_REQUEST','content':{";
	  	   
		   if (ids2del != null && ids2del != "") {
		   		reqmsg += "\"ids2del\":\"" + ids2del + "\",";
		   }
		   
		   reqmsg += "\"status\":3,";
		   reqmsg += "}}";

    	jQuery.ajax({
          type : "post",
          async:true,
          url : "nursingPlan.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.result=="100"){
              	 go2page(currentshownpage);
              	 alert("取消成功");
              }else{
                 alert("取消失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
     
	  }
	} else {
		alert("请选择要取消的数据");
	}	
}


function create_gd(){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	var selectedItemNumber = $("tbody .col_selector:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		var state = 1;
		$("tbody .col_selector:checked").each(function() {
			ids2del += $(this).val() + ",";
			if($(this).parent().find("input:eq(1)").val() != "2"){
				state = 0;
			}
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
		if(state == 0){
			alert("请选择有效的工单!");
			return;
		}
	  if (confirm("是否确认生成?"))  {  
	  	   var ids2delList = ids2del.split(",");
	  	   for(var i=0;i<ids2delList.length;i++){
	  	   		var flag = create_gd_juti(ids2delList[i]);
	  	   		if(flag == 0){
	  	   			alert("选中的第" + (i+1) + "个护理计划生成失败");
	  	   		}
	  	   		if(flag == 1){
	  	   			alert("选中的第" + (i+1) + "个护理计划生成成功");
	  	   		}
	  	   		if(flag == 2){
	  	 			alert("选中的第" + (i+1) + "个护理计划中还有服务未选择负责人，无法生成");
	  			}
	  	   }
	  }
	} else {
		alert("请选择要生成工单的护理计划");
	}	
}
function create_gd2(id,state){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
    if(state != 2){
		alert("请选择有效的工单!");
		return;
	}
	if (confirm("是否确认生成?"))  {
	  var flag = create_gd_juti(id);
	  if(flag == 0){
	  	 alert("生成失败");
	  	 return;
	  }
	  if(flag == 1){
	  	 alert("生成成功");
	  	 return;
	  }
	  if(flag == 2){
	  	 alert("护理计划中还有服务未选择负责人，无法生成");
	  	 return;
	  }
	}
}
function create_gd_juti(id){
	var reqmsg="{'action':'QUERY_NURSING_PLAN_INFO_REQUEST','content':{\"nursingPlanServiceListShow\":\"true\",";
	reqmsg += "\"id\":" + id + ",";
	reqmsg += "}}";
	var cishu = 0;
	var flag = 1;
    jQuery.ajax({
          type : "post",
          async:false,
          url : "nursingPlan.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
             if(data.des=="success"){
              	if(data.content != null){
              		$("#olderId_hide").val(data.content.olderId);
              		$("#fwName_hide").val(data.content.contactName);
              		$("#fwTel_hide").val(data.content.contactTel);
              		$("#fwAddress_hide").val(data.content.serviceAddress);
              		jQuery.each(data.content.nursingPlanServiceList, function(i, item) {
              			if(item.employeeDistributionList.length == 0){
              				flag = 2;
              				return;
              			}
					});
					if(flag != 2){
              		jQuery.each(data.content.nursingPlanServiceList, function(i, item) {
              			$("#fwxminput_Id4_hide").val(item.serviceId);
              			$("#fwxminput_healthInsurance_hide").val(item.healthInsurance);
              			getFWXM(item.serviceId);
              			$("#fuwuzixianginput_hide").val(item.serviceChilds);
              			$("#yjfwsc_hide").val(item.expectedServiceTime);
              			jQuery.each(item.employeeDistributionList, function(j, item2) {
              			     getefzrName(item2.chargeEmployeeId);
              			     if(item2.partakeEmployeeName != null && item2.partakeEmployeeName != ""){
							 	$("#cyrinput_hide").val(item2.partakeEmployeeName.split("|||")[1]);
              			     }
							 cishu = parseInt(item2.employeeServiceNum);
							 for(var z=0;z<cishu;z++){
							 	flag = save();
							 	if(flag == 0){
							 		return 0;
							 	}
							 }
							 $("#cyrinput_hide").val("");
						});
						$("#fwxminput_Id4_hide").val("");
						$("#fwxminput_healthInsurance_hide").val();
						$("#fuwuzixianginput_hide").val("");
						$("#yjfwsc_hide").val("");
					});
					}
					$("#olderId_hide").val("");
					$("#fwName_hide").val("");
					$("#fwTel_hide").val("");
					$("#fwAddress_hide").val("");
            	}
            }else{
                 alert("查询失败");
            }
          },
          error:function(){
	           alert("error");
          }
    });
    return flag;
}
function save(){
	var olderId = $("#olderId_hide").val();
	var flag = 1;
	var olderData = getOlderJBXX(olderId);
	var olderMemberNum = "";
	var olderName = "";
	var olderBirthdate = "";
	var serviceAreaId = 0;
	var serviceStreetId = 0;
	if(olderData != ""){
		var obj = JSON.parse(olderData);
		olderMemberNum = obj.memberNum;
		olderName = obj.name;
		olderBirthdate = obj.birthdate;
		serviceAreaId = obj.serviceAreaId;
		serviceStreetId = obj.serviceStreetId;
	}
	
	var fuzerenSiteId_hide = $("#fuzerenSiteId_hide").val();
	var fuzerenSiteName_hide = $("#fuzerenSiteName_hide").val();

	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
	var fwxminput_SCPRICE4_hide = $("#fwxminput_SCPRICE4_hide").val();
	var fwxminput_YBPRICE4_hide = $("#fwxminput_YBPRICE4_hide").val();
	
	var fuwuzixianginput_search = $("#fuwuzixianginput_hide").val();
	if(fuwuzixianginput_search == null || fuwuzixianginput_search == ""){
		fuwuzixianginput_search = "";
	}
	
	var yjfwsc = $("#yjfwsc_hide").val();
	
	var fuzerenId_hide = $("#fuzerenId_hide").val();
	var fuzerenName_hide = $("#fuzerenName_hide").val();
	var fuzerenRole_hide = $("#fuzerenRole_hide").val();
	var fuzerenBH_hide = $("#fuzerenBH_hide").val();
	
	
	var cyrinput_search = $("#cyrinput_hide").val();
	var canyurenArray = null;
	if(cyrinput_search != null && cyrinput_search !=""){
		canyurenArray = String(cyrinput_search).split(",");
	}
	
	var name = $("#addUserName").val();
	
	var contactName = $("#fwName_hide").val();
	var contactTel = $("#fwTel_hide").val();
	var address = $("#fwAddress_hide").val();
	
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	reqmsg += "\"addType\":\"web工单\",";
	reqmsg += "\"hasPay\":\"N\",";
	
	if (olderId != null && olderId != "") {
        reqmsg += "\"olderId\":" + olderId + ",";
	}
	if (olderMemberNum != null && olderMemberNum != "") {
        reqmsg += "\"olderMemberNum\":\"" + olderMemberNum + "\",";
	}
	if (olderName != null && olderName != "") {
        reqmsg += "\"olderName\":\"" + olderName + "\",";
	}
	if (olderBirthdate != null && olderBirthdate != "") {
        reqmsg += "\"olderBirthdate\":\"" + olderBirthdate + "\",";
	}
	if (serviceAreaId != null && serviceAreaId != 0) {
        reqmsg += "\"serviceAreaId\":" + serviceAreaId + ",";
	}
	if (serviceStreetId != null && serviceStreetId != 0) {
        reqmsg += "\"serviceStreetId\":" + serviceStreetId + ",";
	}
	if (contactName != null && contactName != "") {
        reqmsg += "\"contactName\":\"" + contactName + "\",";
	}
	if (contactTel != null && contactTel != "") {
        reqmsg += "\"contactTel\":\"" + contactTel + "\",";
	}
	if (address != null && address != "") {
        reqmsg += "\"address\":\"" + address + "\",";
	}
	
    reqmsg += "\"status\":2,";

	if (fuzerenSiteId_hide != null && fuzerenSiteId_hide != "") {
        reqmsg += "\"siteId\":" + fuzerenSiteId_hide + ",";
	}
	if (fuzerenSiteName_hide != null && fuzerenSiteName_hide != "") {
        reqmsg += "\"siteName\":\"" + fuzerenSiteName_hide + "\",";
	}
	
	var fwxminput_healthInsurance_hide = $("#fwxminput_healthInsurance_hide").val();
	if(fwxminput_healthInsurance_hide == "1"){
		reqmsg += "\"healthInsurance\":1,";
		reqmsg += "\"price\":" + fwxminput_YBPRICE4_hide + ",";
	}else if(fwxminput_healthInsurance_hide == "2"){
		reqmsg += "\"healthInsurance\":2,";
		reqmsg += "\"price\":" + fwxminput_SCPRICE4_hide + ",";
	}
	
	reqmsg += "\"addPerson\":\"" + name + "\",";
	reqmsg += "\"addTime\":\"" + getNowFormatDate2() + "\",";
	
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
        reqmsg += "\"serviceTask_service_list\":[{";
        reqmsg += "\"serviceId\":" + fwxminput_Id4_hide + "," ;
        reqmsg += "\"fuwuSonNames\":\"" + fuwuzixianginput_search + "\",";
        reqmsg += "\"yjfuwuTime\":\"" + yjfwsc + "分钟\",";
        reqmsg += "}]," ;
	}
	
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "\"chargeEmployeeId\":" + fuzerenId_hide +",";
	}
	
	reqmsg += "\"serviceEmployeeList\":[" ;
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "{\"employeeId\":" + fuzerenId_hide +",";
		reqmsg += "\"name\":\"" + fuzerenName_hide +"\",";
		reqmsg += "\"employeeCode\":\"" + fuzerenBH_hide +"\",";
		reqmsg += "\"role\":\"" + fuzerenRole_hide +"\",";
		reqmsg += "\"type\":1},";
	}
	if(canyurenArray != null && canyurenArray != ""){
		for(var i = 0;i < canyurenArray.length;i++){
			var nameroles = getcyrNameRole(canyurenArray[i]);
			reqmsg += "{\"employeeId\":" + canyurenArray[i] +",";
			if(nameroles.split("||").length == 3){
				reqmsg += "\"name\":\"" + nameroles.split("||")[0] +"\",";
				reqmsg += "\"role\":\"" + nameroles.split("||")[1] +"\",";
				reqmsg += "\"employeeCode\":\"" + nameroles.split("||")[2] +"\",";
			}
			reqmsg += "\"type\":2},";
		}
	}
	reqmsg += "],";
	
	reqmsg += "\"serviceLogList\":[" ;
	reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
	reqmsg += "\"createPerson\":\"" + name +"\",";
	reqmsg += "\"type\":\"新增工单\",";
	reqmsg += "\"log\":\"" + name + "新增了工单\"}";
	reqmsg += "],";
	
	reqmsg=reqmsg.substr(0,reqmsg.length-1);
	reqmsg += "}}";
	
	jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	//alert("保存成功");
              }else if(data.des=="failure"){
                 flag = 0;
                 alert("保存失败");
              }else{
              	flag = 0;
              	alert(data.des);
              }
          },
          error:function(){
               flag = 0;
	           alert("error");
          }
     });
     return flag;
}
//获取老人基本信息
function getOlderJBXX(olderId){
	var olderData = "";
	var reqmsg="{'action':'QUERY_OLDER_INFO_REQUEST','content':{\"olderAddressListShow\":\"true\",\"id\":"+olderId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "daeOlder.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if(data.content != null){
            	  	olderData = JSON.stringify(data.content);
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    });
    return olderData;
}
//获取负责人基本信息
function getefzrName(id){
	$("#fuzerenId_hide").val("");
	$("#fuzerenName_hide").val("");
	$("#fuzerenRole_hide").val("");
	$("#fuzerenBH_hide").val("");
	$("#fuzerenSiteId_hide").val("");
    $("#fuzerenSiteName_hide").val("");
	var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"siteListShow\":\"true\",";	
	reqmsg += "\"id\":" + id + ",";
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  if(data.content != null){
              	  		$("#fuzerenId_hide").val(data.content.id);
						$("#fuzerenName_hide").val(data.content.name);
						$("#fuzerenRole_hide").val(data.content.roleNames);
						$("#fuzerenBH_hide").val(data.content.indexNum);
            	  		if(data.content.siteList != null && data.content.siteList.length > 0){
            	  			$("#fuzerenSiteId_hide").val(data.content.siteList[0].id);
            	  			$("#fuzerenSiteName_hide").val(data.content.siteList[0].name);
            	  		}
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//获取服务项目
function getFWXM(id){
	$("#fwxminput_SCPRICE4_hide").val("");
	$("#fwxminput_YBPRICE4_hide").val("");
	var reqmsg="{'action':'QUERY_SERVICE_INFO_REQUEST','content':{";
	
	reqmsg += "\"id\":" + id + ",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  if(data.content != null){
              	  	data.content.marketPrice = data.content.marketPrice + "";
              	  	data.content.medicalPrice = data.content.medicalPrice + "";
              	  	if(data.content.marketPrice != null && data.content.marketPrice != ""){
              	  		$("#fwxminput_SCPRICE4_hide").val(data.content.marketPrice);
              	  	}
              	  	if(data.content.medicalPrice != null && data.content.medicalPrice != ""){
              	  		$("#fwxminput_YBPRICE4_hide").val(data.content.medicalPrice);
              	  	}
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//获取参与人姓名角色
	function getcyrNameRole(id){
		  var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"id\":"+id+"}}";
		  var nameroles = "";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	   nameroles = data.content.name + "||" + data.content.roleNames + "||" + data.content.indexNum;
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
     	  return nameroles;
	}
//获取当前时间return yyyymmddhhmmss
function getNowFormatDate2() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}
//获取当前登陆员工姓名
	function getLoginName(){
    	  var userId_login = "<%=request.getAttribute("userId")%>";
		  var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"siteListShow\":\"true\",\"userId\":"+userId_login+"}}";

		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	    var siteIds = "";
            	  	if(data.content.employeeList != null && data.content.employeeList.length == 1){
            	  		if(data.content.employeeList[0] != null && data.content.employeeList[0] != ""){
            	  			var name = data.content.employeeList[0].name;
            	  			$("#addUserName").val(name);
            	  			var roleNames = data.content.employeeList[0].roleNames;
            	  	   		if(roleNames.indexOf("站长") == -1 && roleNames.indexOf("组长") == -1){//都不包含，不能使用审核通过，退回按钮
            	  	   	   		$("#create_gdId").hide();
            	  	   		}
            	  		}
            	  	}
				}
			}else if(data.des=="failure"){
                 alert("查询失败");
            }
          },
          error:function(){
	           alert("error");
          }
     	  });
	}
	
function getOldId(huiyuanhao,huiyuankahao){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{";
	
	if (huiyuanhao != null && huiyuanhao != "") {
		reqmsg += "\"memberNum\":\"" + huiyuanhao + "\",";
	}
	if (huiyuankahao != null && huiyuankahao != "") {
		reqmsg += "\"memberCard\":\"" + huiyuankahao + "\",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
                if (data.content != null){
                	if (data.content.olderList != null) {
            	  		$("#oldId_hide").val(data.content.olderList[0].id);
            	  		$("#oldName_hide").val(data.content.olderList[0].name);
              		}
                }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
    </script>
    



  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
