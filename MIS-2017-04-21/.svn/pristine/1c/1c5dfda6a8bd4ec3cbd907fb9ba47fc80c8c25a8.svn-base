<%@ page contentType="text/html;charset=UTF-8" language="java"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<title>服药提醒</title>
<link rel="shortcut icon" href="images/logo.png">
<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />
<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">
<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
<link href="css/style.css" rel="stylesheet" />
<style>
.font16 {
	font-size: 16px;
	margin: 0px 5px;
}

.plan-head,.plan-name {
	vertical-align: middle;
	height: 34px;
	line-height: 34px;
}

.button-mg {
	margin-left: 5px;
	margin-right: 0;
}

.hideAndShow {
	display: none;
}

.cursor {
	cursor: pointer;
}

.operate {
	display: none;
}

.margin-r5 {
	margin-right: 5px;
}

.margin-b10 {
	margin-bottom: 10px;
}
</style>
</head>
<body style="overflow-y: hidden;">
	<div id="cl-wrapper" style="padding-top:0;background:#fff;">
		<input type="hidden" value="" id="olderId">
		<input type="hidden" value="" id="planId">
		<div class="cl-mcont" style="background:#fff;">
			<div class="row" id="infoList">
				<div class="col-sm-2 plan-head">
					<h3 style="margin-top:auto">服药计划</h3>
				</div>
				<div class="col-sm-10 margin-b10" style="text-align:left">
					<button type="button" class="btn btn-primary button-mg" id="editInfo" onclick="editInfo()">
						<span>
							<i class="fa fa-edit margin-r5"></i>编辑
						</span>
					</button>
					<button type="button" class="btn btn-primary button-mg" id="saveInfo" onclick="saveInfo()">
						<span>
							<i class="fa fa-check margin-r5"></i>保存
						</span>
					</button>
					<button type="button" class="btn btn-danger button-mg" id="closeInfo" onclick="closeInfo()">
						<span>
							<i class="fa fa-times margin-r5"></i>取消
						</span>
					</button>
				</div>
				<div class="col-sm-2 plan-name">
					<label>编号</label>
				</div>
				<div class="col-sm-4 margin-b10">
					<input class="form-control" type="text" style="width: 100%" id="planNum" disabled>
				</div>
				<div class="col-sm-2 plan-name">
					<label>状态</label>
				</div>
				<div class="col-sm-4 margin-b10">
					<select id="status" class="form-control" style="width:100%" disabled>
						<option value="" selected="selected"></option>
						<option value="1">有效</option>
						<option value="2">无效</option>
					</select>
				</div>
				<div class="col-sm-2 col-md-2 plan-name">
					<label>开始时间</label>
				</div>
				<div class="col-sm-4 col-md-4">
					<div class="input-group">
						<input class="form-control datetime" size="16" data-min-view="2" data-date-format="yyyy-mm-dd" id="startime" placeholder="开始时间" type="text" disabled />
						<span class="input-group-btn">
							<button class="btn btn-danger deleteThisTime" type="button">
								<span class="fa fa-times"></span>
							</button>
						</span>
					</div>
				</div>
				<div class="col-sm-2 col-md-2 plan-name">
					<label>结束时间</label>
				</div>
				<div class="col-sm-4 col-md-4">
					<div class="input-group">
						<input class="form-control datetime" size="16" data-min-view="2" data-date-format="yyyy-mm-dd" id="endtime" placeholder="结束时间" type="text" disabled />
						<span class="input-group-btn">
							<button class="btn btn-danger deleteThisTime" type="button">
								<span class="fa fa-times"></span>
							</button>
						</span>
					</div>
				</div>
				<div class="col-sm-2 plan-name">
					<label>是否通知关联微信号</label>
				</div>
				<div class="col-sm-4 margin-b10" id="noticeWechat">
					<input class="" type="radio" name="noticeWechat" value="Y" id="noticeWechatY" disabled>
					<span class="font16">是</span>
					<input class="" type="radio" name="noticeWechat" value="N" id="noticeWechatN" checked disabled>
					<span class="font16">否</span>
				</div>
				<div class="col-sm-2 plan-name">
					<label>是否通知关联护理员</label>
				</div>
				<div class="col-sm-4 margin-b10" id="noticeEmployee">
					<input class="" type="radio" name="noticeEmployee" value="Y" id="noticeEmployeeY" disabled>
					<span class="font16">是</span>
					<input class="" type="radio" name="noticeEmployee" value="N" id="noticeEmployeeN" checked disabled>
					<span class="font16">否</span>
				</div>
			</div>
			<!-- 查询框结束 -->
			<!-- 数据表格开始 -->
			<div class="row">
				<div class="col-sm-12">
					<table class="table no-border hover">
						<thead class="no-border">
							<tr role="row">
								<th style="width:20%">
									<strong>提醒时间</strong>
								</th>
								<th style="width:70%">
									<strong>提醒内容</strong>
								</th>
								<th class="operate">
									<strong>操作</strong>
								</th>
							</tr>
						</thead>
						<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all" class="no-border-y" <tr>
								<td></td>
								<td></td> 
								<td class="operate"><a class="label label-primary md-trigger cursor" onclick="addWarn()"><i class="fa fa-plus"></i></a></td>
							</tr></tbody>
					</table>
				</div>
			</div>
			<div id="getHeight" style="margin-top:100px"></div>
		</div>
	</div>
	<!-- 主页面结束 -->
	<!-- 模态框开始-->
	<button type="button" class="btn btn-primary btn-flat md-trigger hideAndShow" id="showWarn" data-modal="md-scale"></button>
	<div class="md-modal md-effect-1" id="md-scale">
		<div class="row">
			<div class="col-md-12">
				<div class="block-flat">
					<div class="header">
						<button type="button" class="close md-close" data-dismiss="modal">×</button>
						<h3>服药提醒详情</h3>
					</div>
					<input class="form-control" id="warnId" type="hidden" />
					<div class="content form-horizontal group-border-dashed">
						<div class="form-group">
							<label class="col-sm-3 control-label">提醒时间</label>
							<div class="col-sm-9">
								<div class="input-group">
									<input class="form-control datetime" size="16" id="noticeTime" data-start-view="1" data-date-format="hh:ii" placeholder="提醒时间" type="text" />
									<span class="input-group-btn">
										<button class="btn btn-danger deleteThisTime" type="button">
											<span class="fa fa-times"></span>
										</button>
									</span>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">提醒内容</label>
							<div class="col-sm-9">
								<textarea id="noticeContent" type="text" class="form-control"></textarea>
							</div>
						</div>
						<div class="form-group" style="text-align: center;">
							<button type="button" class="btn btn-primary btn-rad" onclick="saveWarnInfo()" style="text-align:center; margin-right:15px;">
								<span>
									<i class="fa fa-check margin-r5"></i>确定
								</span>
							</button>
							<button id="cancel_button" type="button" class="btn btn-primary btn-rad md-close" style="text-align:center">
								<span>
									<i class="fa fa-times margin-r5"></i>取消
								</span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="md-overlay"></div>
	
	<script type="text/javascript" src="js/mordo.tools/mordo.timeProcessing.js"></script>
	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
	<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
	<script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
	<script type="text/javascript" src="js/masonry.js"></script>
	<script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>
	<script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
	<script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>
	
	<script type="text/javascript">
		$(document).ready(function(){	
		$("#saveInfo").hide();//保存按钮隐藏
		$("#closeInfo").hide();//取消按钮隐藏
		$("#editInfo").show();//编辑按钮显示
    	App.init();
    	$(".md-trigger").modalEffects();
    	$(".deleteThisTime").click(function(){               //清除日期框中的值
 	       $(this).parent().prev()[0].value = "";
 		});
    	go2page('1');
    	$(".operate").hide();
    	reset();
	});
	
	//iframe内嵌页面设置高度
   	function reset() {
 		window.parent.reset();
	}
	
	//查询信息	
	var currentshownpage = 1;
	function go2page(pagenumber){
		var Code="<tr>";
		Code+="<td></td>";
		Code+="<td></td>";
		Code+="<td  class=\"operate\"><a class=\"label label-primary md-trigger cursor\" onclick=\"addWarn()\"><i class=\"fa fa-plus\"></i></a></td>";							
		Code+="</tr>";
		$("#datacontainer").html(Code);
		var olderId="<%=request.getAttribute("olderId")%>";
		olderId = parseInt(olderId);
		var reqmsg="{\"action\":\"QUERY_MED_PLAN_LIST_REQUEST\",\"content\":{";
		reqmsg += "\"olderId\":" + olderId + ",";
		reqmsg += "\"medNoticeListShow\":\"" + true + "\"";
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:true,
	          url : "medPlan.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  changeDatafy(data);
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	    });
	}

	function changeDatafy(data){
		var htmlCode = "";
		if (data.content != null) {
			jQuery.each(data.content.medPlanList, function(i, item) {
				$("#planId").val(item.id);
				$("#planNum").val(item.planNum);
				$("#status").val(item.status);
				$("#startime").val(formateTime(item.startime));
				$("#endtime").val(formateTime(item.endtime));
				if(item.noticeWechat){
					$("input[type='radio'][name=noticeWechat][value='" + item.noticeWechat + "']").attr("checked",true);
				}else{
					$("input[type='radio'][name=noticeWechat][value='N']").attr("checked",true);
				}
				if(item.noticeEmployee){
					$("input[type='radio'][name=noticeEmployee][value='N']").attr("checked",true);
				}else{
					$("input[type='radio'][name=noticeEmployee][value='N']").attr("checked",true);
				}
				
				if(item.medNoticeList){
					$("#datacontainer").html("");
					jQuery.each(item.medNoticeList, function(i, items) {
						htmlCode+="<tr data-time=\"" + items.noticeTime + "\" class=\"tr\">";
						htmlCode += "<td>" + formateTime(items.noticeTime) + "</td>";		
						htmlCode += "<td>" + items.noticeContent + "</td>";	
						htmlCode+="<td  class=\"operate\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + items.noticeTime +"','" + items.noticeContent +"')\">";
						htmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td></tr>";
					});
					htmlCode+="<tr>";
					htmlCode+="<td></td>";
					htmlCode+="<td></td>";
					htmlCode+="<td  class=\"operate\"><a class=\"label label-primary md-trigger cursor\" onclick=\"addWarn()\"><i class=\"fa fa-plus\"></i></a></td>";							
					htmlCode+="</tr>";
				}
			});
			$("#datacontainer").html(htmlCode);
			reset();
		}
	}
	
	//编辑服药计划信息
	function editInfo(){
		$("#saveInfo").show();
		$("#closeInfo").show();
		$("#editInfo").hide();
		$(".operate").show();
		$("#infoList").find("input").removeAttr("disabled");
		$("#noticeWechat").find("input").removeAttr("disabled");
		$("#noticeEmployee").find("input").removeAttr("disabled");
		$("#status").removeAttr("disabled");
		$("#planNum").attr("disabled","disabled");
	}
	
	//保存服药计划信息
	function saveInfo(){
		var olderId="<%=request.getAttribute("olderId")%>";
		olderId = parseInt(olderId);
		$("#olderId").val(olderId);
		var id = $("#planId").val();
		var planNum = $("#planNum").val();//服务编号
		var status = $("#status").val();//状态
		if(status != ""){
			status = parseInt(status);
		}
		var startime = $("#startime").val();//开始时间
		startime = formatDateCGtoD1(startime);
		var endtime = $("#endtime").val();//结束时间
		endtime = formatDateCGtoD1(endtime);
		var noticeWechat = $("#noticeWechat input[name='noticeWechat']:checked ").val();//关联微信
		var noticeEmployee = $("#noticeEmployee input[name='noticeEmployee']:checked ").val();//关联护理员
		
		var reqmsg="{\"action\":\"ADD_MED_PLAN_INFO_REQUEST\",\"content\":{";
		if ( id!= null && id != "") { 
			reqmsg += "\"id\":" + id + ",";
			if (planNum != null && planNum != "") { 
				reqmsg += "\"planNum\":\"" + planNum + "\",";
			}else{
				alert("编号不能为空");
				return;
			}
		}
		reqmsg += "\"olderId\":" + olderId + ",";
		
		if (status != null && status != "") { 
			reqmsg += "\"status\":" + status + ",";
		}else{
			alert("状态不能为空");
			return;
		}
		if (startime != null && startime != "") {
			reqmsg += "\"startime\":\"" + startime + "\",";
		}else{
			alert("开始时间不能为空");
			return;
		}
		if (endtime != null && endtime != "") {
			reqmsg += "\"endtime\":\"" + endtime +"\",";
		}else{
			alert("结束时间不能为空");
			return;
		}
		if (noticeWechat != null && noticeWechat != "") {
			reqmsg += "\"noticeWechat\":\"" + noticeWechat + "\",";
		}
		if (noticeEmployee != null && noticeEmployee != "") {
			reqmsg += "\"noticeEmployee\":\"" + noticeEmployee + "\",";
		}
		
		var medNoticeList = "";
		$("#datacontainer tr").each(function(index) {
			var noticeTime = $(this).find("td").eq(0).text();//提醒时间
			noticeTime = formatDateCGtoD1(noticeTime);
			var noticeContent = $(this).find("td").eq(1).text();//提醒内容
			if (noticeTime != "") {
				var medNotice = JSON.parse("{}");
				medNotice.noticeTime = noticeTime;
				medNotice.noticeContent = noticeContent;
				medNoticeList += JSON.stringify(medNotice);
			}
		});
		medNoticeList = medNoticeList.replace(/}{/g,"},{");
		if (medNoticeList != "") {medNoticeList = "[" + medNoticeList + "]";
			reqmsg += "\"medNoticeList\":" + medNoticeList;
		}else{
			medNoticeList = "[]";
			reqmsg += "\"medNoticeList\":" + medNoticeList;
		}
		reqmsg += "}}";

	    jQuery.ajax({
	          type : "post",
	          async:true,
	          url : "medPlan.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  $("#olderId").val(data.content.olderId);
	            	  $("#planId").val(data.content.id);
	            	  $("#saveInfo").hide();
	          		  $("#closeInfo").hide();
	          		  $("#editInfo").show();
	          		  $("#infoList").find("input").attr("disabled","disabled");
	          		  $("#status").attr("disabled","disabled");
	          		  alert("保存成功");
	          		  $(".operate").hide();
	          		  go2page(1);
	              }else if(data.des=="failure"){
	                 alert("保存失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
    
	//取消保存服药计划信息
	function closeInfo(){
		$("#saveInfo").hide();
		$("#closeInfo").hide();
		$("#editInfo").show();
		$(".operate").hide();
		$("#noticeEmployeeN").click();
		$("#noticeWechatN").click();
		$("#infoList").find("input").attr("disabled","disabled");
		$("#status").attr("disabled","disabled");
		var planNum = $("#planNum").val();
		if(planNum == ""){
			$("#infoList").find("input").val("");
			$("#status").val("").trigger("change");
		}
		go2page('1');
	}
	
	var addOrEdit;//判断新增或编辑
	var tr;//获取当前点击对象
	//新增服药提醒
	function addWarn(){
		addOrEdit = "add";
		$("#warnId").val("");
		$("#noticeTime").val("");
		$("#noticeContent").val("");
		$("#showWarn").click();
		reset();
	}
	
	//编辑服药提醒
	$(document).on("click",".doEdit",function() {
		tr = $(this).parent().parent();
	});
	function doEdit(noticeTime,noticeContent){
		addOrEdit = "edit";
		$("#noticeTime").val(formateTime(noticeTime));
		$("#noticeContent").val(noticeContent);
		$("#showWarn").click();
	}
	
	//删除提醒
    function doDel(a) {
		if (confirm("是否确认删除?"))  {  
			 $(a).parents("tr").remove();
		}
	}
	
	//保存提醒信息
	function saveWarnInfo(){
		var noticeTime = $("#noticeTime").val();
		if(noticeTime == ""){
			alert("提醒时间不可为空");
			return;
		}
		var noticeContent = $("#noticeContent").val();
		if(noticeContent == ""){
			alert("提醒内容不可为空");
			return;
		}
		var htmlCode = "";
		
		var add = true;//判断是否将提醒内容合并了
		if(addOrEdit == "add"){
			$("#datacontainer tr").each(function(){
				var listTime = $(this).find("td").eq(0).text();
				var listContent = $(this).find("td").eq(1).text();
				if(listTime == noticeTime){
					if (confirm("提醒时间重复,是否将提醒内容合并?")){
						noticeTime = formatDateCGtoD1(noticeTime);
						noticeContent = noticeContent +","+ listContent ;
						htmlCode += "<td>" + formateTime(noticeTime) + "</td>";		
						htmlCode += "<td>" + noticeContent + "</td>";	
						htmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + noticeTime +"','" + noticeContent +"')\">";
						htmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td>";
						$(this).html(htmlCode);
						add = false;
						$("#cancel_button").click();
						return;
					}else{
						alert("请重新选择提醒时间");
						add = false;
						return;
					}
				}
			});
			if(add){//判断若未发生时间重复，则将该条信息添加到提醒列表下方
				noticeTime = formatDateCGtoD1(noticeTime);
				$("#datacontainer tr").last().remove();
				htmlCode+="<tr data-time=" + noticeTime + " class=\"tr\">";
				htmlCode += "<td>" + formateTime(noticeTime) + "</td>";		
				htmlCode += "<td>" + noticeContent + "</td>";	
				htmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + noticeTime +"','" + noticeContent +"')\">";
				htmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td></tr>";
				htmlCode+="<tr>";
				htmlCode+="<td></td>";
				htmlCode+="<td></td>";
				htmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-primary md-trigger cursor\" onclick=\"addWarn()\"><i class=\"fa fa-plus\"></i></a></td>";							
				htmlCode+="</tr>";
				$("#datacontainer").append(htmlCode);
				htmlCode=null;
				reset();
				tr = null;
				addOrEdit = null;
				$("#cancel_button").click();
			}
			add = true;
			
			
		}else{
			var edit = true;//判断内容是否修改
			$(tr).siblings().each(function(){
				var listTime = $(this).find("td").eq(0).text();
				var listContent = $(this).find("td").eq(1).text();
				if(listTime == noticeTime){
					if (confirm("提醒时间重复,是否将提醒内容合并?")){ 
						noticeTime = formatDateCGtoD1(noticeTime);
						noticeContent = listContent +","+noticeContent;
						htmlCode += "<td>" + formateTime(noticeTime) + "</td>";		
						htmlCode += "<td>" + noticeContent + "</td>";	
						htmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + noticeTime +"','" + noticeContent +"')\">";
						htmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td>";
						$(this).html(htmlCode);
						$(tr).remove();
						$("#cancel_button").click();
						return;
					}else{
						alert("请重新选择提醒时间");
						edit = false;
					}
				}
			});
			if(edit){
				noticeTime = formatDateCGtoD1(noticeTime);
				htmlCode += "<td>" + formateTime(noticeTime) + "</td>";		
				htmlCode += "<td>" + noticeContent + "</td>";	
				htmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + noticeTime +"','" + noticeContent +"')\">";
				htmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td>";
				$(tr).html(htmlCode);
				$(tr).attr("data-time",noticeTime);
				htmlCode=null;
				reset();
				tr = null;
				addOrEdit = null;
				$("#cancel_button").click();
			}
			edit = false;
		}
		
		//将填写好的服药提醒按提醒时间排序
		var timeArray = new Array();
		$("#datacontainer .tr").each(function(index){
			var trNum = $(this).attr("data-time");
			timeArray[index] = trNum;
		});
		var newHtmlCode = "";
		timeArray = timeArray.sort();
		for(var i = 0; i < timeArray.length; i++){
			$("#datacontainer .tr").each(function(){
				if(timeArray[i] == $(this).attr("data-time")){
					var time = $(this).find("td").eq(0).text();
					var content = $(this).find("td").eq(1).text();
					newHtmlCode+="<tr data-time=\"" + formatDateCGtoD1(time) + "\" class=\"tr\">";
					newHtmlCode += "<td>" + formateTime(time) + "</td>";		
					newHtmlCode += "<td>" + content + "</td>";	
					newHtmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-default cursor doEdit\" onclick=\"doEdit('" + formatDateCGtoD1(time) +"','" + content +"')\">";
					newHtmlCode+="<i class=\"fa fa-pencil\"></i></a><a class=\"label label-danger cursor\" onclick=\"doDel(this)\"><i class=\"fa fa-times\"></i></a></td></tr>";
					newHtmlCode+="<tr>";
				}
			});
		}
		newHtmlCode+="<tr>";
		newHtmlCode+="<td></td>";
		newHtmlCode+="<td></td>";
		newHtmlCode+="<td  class=\"operate\" style=\"display: table-cell;\"><a class=\"label label-primary md-trigger cursor\" onclick=\"addWarn()\"><i class=\"fa fa-plus\"></i></a></td>";							
		newHtmlCode+="</tr>";
		$("#datacontainer").html(newHtmlCode);
	}
	
	//日期转化2016-10-10 20161010
	//日期转化10:10 1010
	function formatDateCGtoD1(time){
		if(time != null && time.length == 10){
			time = time.substring(0, 4) + time.substring(5, 7) + time.substring(8, 10);
		}
		if(time != null && time.length == 5){
			time = time.substring(0, 2) + time.substring(3, 5);
		}
		return time; 
	}
	</script>
	
	<script src="js/behaviour/voice-commands.js"></script>
	<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
	<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>