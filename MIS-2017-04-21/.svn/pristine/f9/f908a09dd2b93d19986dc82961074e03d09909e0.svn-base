<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ page import="fsk.init.SystemInit" %>
<%
	String nickname = (String) session.getAttribute("nickname");
	if (nickname == null) {
		nickname = "";
	}
	String header = SystemInit.header;
	String headerImage = SystemInit.headerImage;
%>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="images/logo.png">

	<title>员工编辑</title>

	<!-- Bootstrap core CSS -->
	<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />

	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
  	<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

  	<link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
	<link href="css/style.css" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>	
<style>
.accordion .panel,.accordion .panel:first-child{border-top:1px solid #ECECEC;border-bottom:1px solid #ECECEC;}
.checkbox-inline{padding-left:0;padding-right:30px;}
 .checkbox-inline + .checkbox-inline{margin-left:0;}
.hideAndShow{display:none;}

.hideul{position:absolute;top:33px;z-index:200;right:15px;left:15px;display:none}
.hideul ul{ border:1px solid #ccc;width:100%;background:#f4f4f4;padding-left:0}
.hideul ul li{ list-style-type:none;text-indent:20px}
.hideul ul li:hover{ background:#ddd}
</style>
<script type="text/javascript" src="js/addressJS.js"></script>
</head>

<body>

<!-- 上侧栏开始 -->
    <div id="head-nav" class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="fa fa-gear"></span>
          </button>
          <a class="navbar-brand" href="#"  style="width:auto;background: url(images/<%=headerImage %>) no-repeat 0 10px;"><span><%=header %>/员工编辑</span></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right user-nav">
            <li class="dropdown profile_menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="images/avatar2.jpg"/>
                <span id="accountNickname"><%=nickname %></span>
<!--                 <b class="caret"></b> -->
              </a>
<!--               <ul class="dropdown-menu"> -->
<!--                 <li><a href="#" class="md-trigger" data-modal="md-scale3">密码修改</a></li> -->
<!--                 <li class="divider"></li> -->
<!--                 <li><a href="systemLogin.do?logout">退出登录</a></li> -->
<!--               </ul> -->
            </li>
          </ul>
        </div><!--/.nav-collapse animate-collapse -->
      </div>
    </div>  <!-- 上侧栏结束 -->
	
<div id="cl-wrapper" style="padding-top:40px;">	
<div class="container-fluid" id="pcont">
	<div class="cl-mcont">
    <div class="row">
      <div class="col-sm-12">
        <div class="block-flat profile-info">
          <div class="row">
            <div class="col-sm-2">
              <div class="avatar">
                <img src="photos/av.jpg" id="touxiangId"  class="profile-avatar" />
                <input type="hidden" id="hide_employeeTupian" value="" /> 
              </div>
            </div>
            <div class="col-sm-7">
              <div class="personal">
                <h1 class="name" style="font-size:24px;" id="head_name"></h1>
                <p class="description" style="line-height:13px" id="head_juesezhicheng"><p>
                <p class="description" style="line-height:13px;" id="head_zhandian"><p>
                <p class="description" style="line-height:13px" id="head_sexId"><p>
                <form style="display:none;" id="picuploadform" class="secondcol" action="position.do?pic1" method="post" enctype="multipart/form-data">
                	<input id="pic4upload" name="pic4upload" type="file" onchange="javascript:$('#quedintupian').click()" accept="image/*">
             	</form>
             	<form style="display:none;" id="image_submit" action="position.do?pic2" method="post"  enctype="multipart/form-data">
               		<input type="hidden" name="srcPath" id="srcPath" value="" />
               		<input type="hidden" name="type" id="type" value="employeePhoto_" />
  					<input type="hidden" name="x1" id="x1" value="0" />
  					<input type="hidden" name="y1" id="y1" value="0" />
  					<input type="hidden" name="x2" id="x2" value="0" />
  					<input type="hidden" name="y2" id="y2" value="0" />
		 		</form>  
		 		<button type="button" class="btn btn-primary btn-flat" style="display:none;" id="sure_SC" onclick="uploadPic_cut()">确定</button> 
                <c:if test="${employeeXQ_xghead_btn_control != 'yes' or employeeXQ_xghead_btn_show == 'yes'}">
                	<button class="btn btn-primary btn-flat btn-rad" onclick="javascript:$('#pic4upload').click()">修改头像</button>
                </c:if>	
                <input id="quedintupian" style="display:none;" type="button" value="确定" onclick="uploadPic()">
             
                
              </div>
            </div>
            <div class="col-sm-3">
              <table class="no-border no-strip skills">
                <tbody class="no-border-x no-border-y">
                  <tr>
                    <td style="width:50%;color:#666">服务次数</td>   <!-- 4个相关展示信息 -->
                    <td style="color:#999">88</td>
                  </tr>
                  <tr>
                    <td style="color:#666">月服务时间</td>
                    <td style="color:#999">108小时</td>
                  </tr>
                  <tr>
                    <td style="color:#666">服务金额</td>
                    <td style="color:#999">18,888</td>
                  </tr>
                  <tr>
                    <td style="color:#666">服务综合评价</td>
                    <td style="color:#999"><i class="fa fa-star" style="width:15px;"></i><i class="fa fa-star" style="width:15px;"></i><i class="fa fa-star" style="width:15px;"></i><i class="fa fa-star" style="width:15px;"></i><i class="fa fa-star-half-empty " style="width:15px;"></i></td>
                  </tr>
                  <input id="hide_userId" type="hidden" >
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row" style="margin-top:0">
      <div class="col-sm-12">
        <div class="tab-container" >
          <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#siteBasicInfo">基本信息</a></li>
            <li id="ssyg_biaoqian" onclick="query2()"><a data-toggle="tab" href="#siteEmployees">所属员工</a></li>
            <li><a data-toggle="tab" href="#siteHistoryServer">历史服务</a></li>
          </ul>
          <div class="tab-content" >
            <div id="siteBasicInfo" class="tab-pane  cont active" ><!-- 基本信息开始 -->
				
					<div class="panel-group accordion accordion-semi" id="accordion1-1" style="margin-top:20px;">
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a data-toggle="collapse" data-parent="#accordion1-1" href="#ac1-1">
								<i class="fa fa-angle-right"></i>基本信息
							</a>
						  </h4>
						</div>
						<div id="ac1-1" class="panel-collapse collapse in">
						  <div class="panel-body">
							<form class="form-horizontal" >
								<div class="form-group">
								  <label class="col-sm-2 control-label">姓名<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="name_input" readonly="readonly" tag="hedangdang">
									<input type="hidden" id="name_input_hide">
								  </div>
								  <label  class="col-sm-2 control-label">性别</label>
								  <div class="col-sm-4">
									<select class="form-control" id="gender_input" disabled="disabled" tag="hedangdang"><option value="男">男</option><option value="女">女</option></select>
								  	<input type="hidden" id="gender_input_hide">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">身份证号<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="idNumber_input" readonly="readonly" tag="hedangdang">
								 	<input type="hidden" id="idNumber_input_hide">
								  </div>
								  <label  class="col-sm-2 control-label">联系方式<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="telephone_input" readonly="readonly" tag="hedangdang">
								 	<input type="hidden" id="telephone_input_hide">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">出生日期</label>
								  <div class="col-sm-4">
									<div class="input-group " style="margin-bottom:0;">
										<input class="form-control datetime " size="16" id="birthday_input" type="text" value="" data-date-format="yyyy-mm-dd" data-min-view="2"  placeholder="日期格式：yyyy-mm-dd"  disabled="disabled">
										<span class="input-group-addon btn btn-primary" ><span class="glyphicon glyphicon-th"></span></span>
									<input type="hidden" id="birthday_input_hide">
									</div>
								  </div>
								  <label class="col-sm-2 control-label">账号名<span style="color:red">*</span></label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" readonly="readonly" id="zhanghaoId_input" >
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">员工编号</label>
								  <div class="col-sm-4">
									<input type="text" class="form-control" id="yuangongBH_input" readonly="readonly">
								  </div>
								</div>
							</form>
						  </div>
						</div>
					  </div>
					</div>	
					<div class="panel-group accordion accordion-semi" id="accordion1-2" >
					  <div class="panel panel-default">
						<div class="panel-heading">
						  <h4 class="panel-title">
							<a class="" data-toggle="collapse" data-parent="#accordion1-2" href="#ac1-2">
							  <i class="fa fa-angle-right"></i>服务信息
							</a>
						  </h4>
						</div>
						<div id="ac1-2" class="panel-collapse collapse in">
						  <div class="panel-body">
							  <form class="form-horizontal" >
								<div class="form-group">
								  <label class="col-sm-2 control-label">角色<span style="color:red">*</span></label>
								  <div class="col-sm-2 control-label" style="text-align:left"  id="juese_input">
																
								  </div>
								  <input type="hidden" id="juese_input_hide">
								  <div class="col-sm-2" style="text-align:right"  onclick="xiugaijuese()">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editRole" value="修改" style="display:none"  >
								  </div>
								  <label  class="col-sm-2 control-label">员工职称</label>
								  <div class="col-sm-2 " id="ygzc_input" style="padding-top:7px">
									
								  </div>
								  <div class="col-sm-2" style="text-align:right">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editZhicheng" value="修改" style="display:none">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">组长</label>
								  <div class="col-sm-4">
									<div class="input-group " >
										<input type="hidden" id="zuzhanginputId_search" value="0">
										<input class="form-control"  type="text" id="zuzhanginput_search" onclick="getzuzhangName()" oninput="getzuzhangName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
										<ul id="hideul_nei1">
							
										</ul>
									</div>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">员工星级</label>
								  <div class="col-sm-4">
									<select class="form-control" id="yuangongxj_input" disabled="disabled" tag="hedangdang">
									<option value="0"></option>
									<option value="1">一星</option>
									<option value="2">二星</option>
									<option value="3">三星</option>
									<option value="4">四星</option>
									<option value="5">五星</option>
									</select>
									<input type="hidden" id="yuangongxj_input_hide">
								  </div>
								  <label class="col-sm-2 control-label">所属站点</label>
								  <div class="col-sm-2 control-label" style="text-align:left" id="sszhandian_input">
																
								  </div>
								  <input type="hidden" id="sszhandianIds_input">
								  <div class="col-sm-2" style="text-align:right" onclick="xiugaisite()">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="editSite" value="修改" style="display:none">
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">所属部门1</label>
								  <div class="col-sm-4">
									<select class="form-control" id="ssbumen_input" disabled="disabled" tag="hedangdang">
									
									</select>
								  </div>
								  <label class="col-sm-2 control-label">所属部门2</label>
								  <div class="col-sm-4">
									<select class="form-control" id="ssbumen_input2" disabled="disabled" tag="hedangdang">
									
									</select>
								  </div>
								</div>
								<div class="form-group">
								  <label class="col-sm-2 control-label">关联微信号</label>
								   <div class="col-sm-2 " style="padding-top:7px">
									<span id="wechatName"></span>
									<span id="wechatName_hide" style="display:none"></span>									
									 </div>
								  <div class="col-sm-2" style="text-align:right">
									<input type="button" class="btn btn-primary btn-flat btn-rad md-trigger" data-modal="open2wechat" value="修改" onclick="$('#nickname').val('');searchWeChat(1);" style="display:none">
								  </div>
								</div>
							</form>
						  </div>
						</div>
					  </div>
					</div>
					
					<input type="hidden" value="保存全部二次确定假按钮" class="md-trigger" data-modal="saveAllBasicHeal" id="fake-saveAllBasicHeal">					
					<div class="row"><div class="col-sm-12" style=
					"text-align:center;"  id="hedangdang1"><button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit()">编辑信息</button></div></div>
			</div>
			
			  <div id="siteEmployees" class="tab-pane "> <!-- 所属员工 -->
			    <input type="hidden" value="" id="sortType">
				<input type="hidden" value="" id="sortColumn">
				<div class="block-flats">
				  <div class="content">
                  <div class="row" style="margin-bottom: 15px;">
				  <div class="col-sm-1" >
					<c:if test="${employee_querysxyg_btn_control != 'yes' or employee_querysxyg_btn_show == 'yes'}">
                    	<button class="btn btn-primary "  onclick="query2();">查询</button>
                    </c:if>	
				  </div>
				  <div class="col-sm-2" >
				  	<a style="cursor:pointer;text-decoration:underline;vertical-align:bottom;"  onclick="$('.hideAndShow').toggle();">更多查询条件</a>
				  </div>
                   <div class="col-sm-1" style="clear:both;text-align: center; vertical-align: middle; height: 34px; line-height: 34px;width:100px;">
						<label>姓名</label>
					</div>
					<div class="col-sm-2" style="margin-bottom:10px;">
						<input class="form-control" type="text" style="width: 100%" id="name_input2">
					</div>
					<div class="col-sm-1   hideAndShow" style="clear:both;text-align: center; vertical-align: middle; height: 34px; line-height: 34px;width:100px;">
						<label>角色</label>
					</div>
					<div class="col-sm-2   hideAndShow" style="margin-bottom:10px;">
						<select id="juese_input2" class="select2" multiple>
                  	  	</select>
					</div>
					<div class="col-sm-1   hideAndShow" style="clear:both;text-align: center; vertical-align: middle; height: 34px; line-height: 34px;width:100px;">
						<label>职称名称</label>
					</div>
					<div class="col-sm-2   hideAndShow"  style="margin-bottom:10px;">
					<select class="form-control" id="zhicheng1_input2" style="width: 100%" >
					
					</select>
					</div>
					<div class="col-sm-1   hideAndShow" style="text-align: right; vertical-align: middle; height: 34px; line-height: 34px;">
						<label>职称等级</label>
					</div>
					<div class="col-sm-2   hideAndShow"  style="margin-bottom:10px;">
					<select class="form-control" id="zhicheng2_input2" style="width: 100%" >
					
					</select>
					</div>
					

                  </div>
                  
                  <div class="row">
                    <div class="col-sm-12">
                      <c:if test="${employee_delsxyg_btn_control != 'yes' or employee_delsxyg_btn_show == 'yes'}">
                      <button type="button" class="btn btn-danger btn-flat" style="float: right; margin-right: 0px;"  onclick="doDel2()">
                        <span><i class="fa fa-trash-o" style="margin-right:0px;"></i>删除</span>
                      </button>
                      </c:if>
                      <c:if test="${employee_addsxyg_btn_control != 'yes' or employee_addsxyg_btn_show == 'yes'}">
                      <button type="button" class="btn btn-primary btn-flat md-trigger"  data-modal="guanlian-yuangong" style="float: right;" onclick="headAdd()">
                        <span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
                      </button>
                      </c:if>
                    </div>
                  </div>
                  
                  <div class="table-responsive">
                  	
                    <table class="table table-bordered hover"  >
                      <thead>
                        <tr>
                          <th style="width:2%;"><input type="checkbox" class="col_selector" id="allselectchecker2" onclick="selectAll2()"></th>
                          <th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_name')">姓名</th>
                          <th>角色</th>
                          <th>职称</th>
                          <th name="needSort" class="sorting" onclick="queryBySort(this,'starLevel')">星级</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody id="datacontainer2"  role="alert" aria-live="polite" aria-relevant="all">
                        
                      </tbody>
                    </table>
                  </div>
                  
                  <div class="row" style="margin-right: 0px;">
					<div class="col-sm-12">
						<div id="datatable_info2" class="dataTables_info">
								当前显示0 条总记录中的第0-0条
						</div>
							<!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="pull-left" style="margin:10px 0" id="datatable2_length">
												<label class="pull-left" style="margin:10px 0;">每页</label>
												<label class="pull-left" style="margin:10px 0;">
												<select id="pageSizeSelector2" class="form-control"  aria-controls="datatable2" size="1" name="datatable2_length" onchange="query2()">
												<option selected="selected" value="10">10</option>
												<option value="25">25</option>
												<option value="50">50</option>
												<option value="100">100</option>
												</select> 
												</label>
												<label class="pull-left" style="margin:10px 0;">条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea2" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->					
					<div class="clearfix"></div>
					
                  </div></div>
                </div>
		  
              </div>
            </div>
            
			<div id="siteHistoryServer" class="tab-pane"><!-- 历史服务 -->
					<input type="hidden" id="addUserName" value="">
					<input type="hidden" id="addUserSites" value="">
					<input type="hidden" value="" id="sortType2">
					<input type="hidden" value="" id="sortColumn2">
										<div class="row">
									
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>老人姓名</label>
										</div>
										<div class="col-sm-4 "  style="position:relative">
											<div class="input-group " >
												<input class="form-control"  type="text" id="oldinput_search" onclick="getolderName()" oninput="getolderName()" onmouseout="javascript:$('#hideul-11').hide();" onmouseover="javascript:$('#hideul-11').show();">
												<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-11"  onmouseover="javascript:$('#hideul-11').show();" onmouseout="javascript:$('#hideul-11').hide();">
												<ul id="hideul_nei11">
							
												</ul>
											</div>
										</div>
										
										<div class="col-sm-2 " style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>服务项目</label>
										</div>
										<div class="col-sm-4 "  style="position:relative">
											<div class="input-group " >
												<input type="hidden" value="" id="fwxminput_Id"> 
												<input class="form-control"  type="text" id="fwxminput_search" onclick="getFWXM()" oninput="getFWXM()" onmouseout="javascript:$('#hideul-2').hide();" onmouseover="javascript:$('#hideul-2').show();">
												<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-2"  onmouseover="javascript:$('#hideul-2').show();" onmouseout="javascript:$('#hideul-2').hide();">
												<ul id="hideul_nei2">
							
												</ul>
											</div>
										</div>
										
										<div class="col-sm-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>工单编号</label>
										</div>
										<div class="col-sm-4" style="margin-bottom:10px;">
											<input class="form-control" type="text" style="width: 100%" id="fuwugdbh_input">
										</div>
										
										<div class="col-sm-2  col-md-2" style="vertical-align: middle; height: 34px; line-height: 34px;">
											<label>服务状态</label>
										</div>
										<div class="col-sm-4 col-md-4" style="margin-bottom:10px;">
											<select id="fuwustate_input" class="select2" multiple>
                      							<option value="1">取消</option>
                       							<option value="2">待排班</option>
                       							<option value="3">待审核</option>
                       							<option value="4">审核通过</option>
                       							<option value="5">服务开始</option>
                       							<option value="6">服务结束</option>
                       							<option value="7">回访结束</option>
                  	  						</select>
										</div>
										<div class="col-sm-2  col-md-2" style=" vertical-align: middle; height: 34px; line-height: 34px;">
											<label>收费类别</label>
										</div>
										<div class="col-sm-4 col-md-4" style="margin-bottom:10px;">
											<select id="fuwutype_input" class="select2">
                      							<option value="">全部</option>
                       							<option value="1">医保</option>
                       							<option value="2">市场</option>
                  	  						</select>
										</div>
										
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									
										<div class="col-sm-12" style="margin-top:20px">	
											<c:if test="${serviceTask_query_btn_control != 'yes' or serviceTask_query_btn_show == 'yes'}">	
												<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;margin-left:0;" onclick="query5()">查询</button>
											</c:if>	
											<div class="btn-group" style="margin-top:5px;float:right;margin-right:0">
												 <c:if test="${serviceTask_add_btn_control != 'yes' or serviceTask_add_btn_show == 'yes'}">
						  						 <button type="button" class="btn btn-primary dropdown-toggle  md-trigger" data-toggle="dropdown" data-modal="servicegongdan_add" onclick="qingkongXZ()">
													<span><i class="fa fa-plus" style="margin-right:5px;"></i>新增</span>
						 						 </button>
						 						 </c:if>	
						 						 <c:if test="${serviceTask_del_btn_control != 'yes' or serviceTask_del_btn_show == 'yes'}">
						 						 <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown"  style="margin-left:5px;margin-right:0" onclick="doDel5()">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>删除</span>
						 						 </button>
												 </c:if>	
												 <c:if test="${serviceTask_qx_btn_control != 'yes' or serviceTask_qx_btn_show == 'yes'}">
												  <button type="button" class="btn btn-danger dropdown-toggle  md-trigger" data-toggle="dropdown" style="display:none;" data-modal="servicegongdan_quxiao" id="quxiao_open5"></button>
						 						  <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" onclick="quxiao_qingkong()" style="margin-left:5px;margin-right:0">
													<span><i class="fa fa-minus" style="margin-right:5px;"></i>取消</span>
						 						  </button>
												 </c:if>	
										 	</div>
										</div>
								
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
								
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th style="width:2%;"><input id="allselectchecker5" type="checkbox" class="col_selector5" onclick="selectAll5();"></th>
														<th name="needSort" class="sorting" onclick="queryBySort2(this,'serviceCode')"><strong>服务工单编号</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort2(this,'chinese_olderName')"><strong>老人</strong></th>
														<th><strong>服务项目</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort2(this,'status')"><strong>工单状态</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort2(this,'healthInsurance')"><strong>收费类别</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort2(this,'serviceStartTime')"><strong>服务时间</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer5" role="alert" aria-live="polite" aria-relevant="all">	
																															
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 --
									<!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info5" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector5"   size="1"  onchange="query5()"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea5" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
            
		              
            </div>

          </div>
        </div>    
        

      </div>
      

    </div>

	</div>
	
</div> 
	
</div> <!-- 主页面结束 -->

 <!-- 模态框开始 -->
 <!-- 关联微信号修改 -->
 			<div class="md-modal colored-header custom-width md-effect-9" id="open2wechat" style="width:60%">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>修改关联微信号</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true" id="closeWeChat">&times;</button>
                      </div>
                      <div class="modal-body form">
                         			<div class="row">
										<div class="col-sm-12 "  >
											<div class="input-group " >
												<input class="form-control"  type="text"  placeholder="输入微信昵称搜索" id="nickname">
												<span class="input-group-btn"><button onclick="searchWeChat(1)" class="btn btn-primary " type="button" style="height:34px"><span class="fa fa-search"></span></button></span>
											</div>
										</div>
										
									</div>
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
									<div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" >
												<thead>
													<tr role="row">										
														<th><strong>昵称</strong></th>
														<th><strong>性别</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer4" >																														
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 -->
								    <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info4" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="datatable2_length">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector4"  size="1"  onchange="searchWeChat(1)"><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea4" class="pagination"></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->					
						</div>
                    </div>
                </div>
 <!-- 可服务项目 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="Emergency-contact">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>可服务项目添加或修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        <div class="form-group">
                          <label>名称</label> <input type="text" class="form-control" >
                        </div>
                        <div class="form-group">
                          <label>地点</label> <input type="text" class="form-control" >
                        </div>
						<div class="form-group">
                          <label>时间</label> <input type="text" class="form-control" >
                        </div> 
						<div class="form-group">
                          <label>价格</label> <input type="text" class="form-control" >
                        </div>  						
						</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
				 <!-- 角色修改 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="editRole">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>员工角色修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					   <div class="modal-body form">
                      <form class="form-horizontal" >
							<div class="form-group" style="margin-left:20px;margin-right:20px;">									
									<div class="col-sm-12" id="guanlian-juesechoose">
									<!-- （多选:站长、值班人员、护理员、医师、管理员等 -->
<!-- 									  <label class="checkbox-inline" > <input type="checkbox" name="rad15" checked="" class="icheck"  >&nbsp;站长</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck"  >&nbsp;值班人员</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck"  >&nbsp;护理员</label>  -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;医师</label> -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;管理员</label> -->
<!-- 									  <label class="checkbox-inline"> <input type="checkbox" name="rad15" class="icheck" >&nbsp;其他</label>  -->
									</div>
							</div> 
<!-- 							<div class="form-group" style="margin-left:5px;"> -->
<!--                           		<label>其他</label> <input type="text" class="form-control" > -->
<!--                         	</div>							 -->
						</form></div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="savejuese()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>

 				<!-- 所属站点修改 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="editSite">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>所属站点修改</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
					   <div class="modal-body form">
                      <form class="form-horizontal" >
							<div class="form-group" style="margin-left:20px;margin-right:20px;">									
									<div class="col-sm-12" id="guanlian-sitechoose">
									
									</div>
							</div> 
						</form></div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="saveSite()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
                
				<!-- 二次确认：员工基本信息 保存全部-->
                <div class="md-modal colored-header custom-width md-effect-9" id="saveAllBasicHeal">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>信息修改确认</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body " id="erciquerenxinxi">
							
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="baocun1()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>

				<!-- 编辑职称-->
                <div class="md-modal colored-header md-effect-9" style="width:60%;max-width:60%" id="editZhicheng">
                    <div class="md-content">
                      <div class="modal-header">
                        <h4 style="display:inline;">编辑职称</h4>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        				
							<table class=" table-bordered  mytable" >
								<thead>
								     <tr>
										<th style="border-right:0">请选择:
										<select class="form-control" id="zhicheng1_input" style="width: 100%" >
										
										</select>
										</th>
										
										<th style="border-left:0;border-right:0">
										<select class="form-control" id="zhicheng2_input" style="width: 100%" >
										
										</select>
										</th>
										<th style="text-align:center"><span onclick="addNewZhiCheng()"><i class="fa fa-plus" ></i></span></th>
									</tr>
									<tr >
										<th><strong>职称名称</strong></th>
										<th><strong>职称等级</strong></th>
										<th><strong>点击撤销</strong></th>
									</tr>
								</thead>
								<tbody id="tbodyhtml" >		
								  <!-- <tr class="whitebg" > 
                                    <td style="width:25%"><input id="zhichengmc_1" style="border-style:none" readonly="readonly" type="text"></td>
                                    <td style="width:25%"><input id="zhichengmc_1" style="border-style:none" readonly="readonly" type="text"></td>                                  
                                    <td style="text-align:center;width:10%"><span onclick="$(this).parent().parent().remove();"><i class="fa fa-minus" ></i></span></td>                                    
                                  </tr>	 -->
                                  <tr class="whitebg" style="display:none;" id="qitashuoming"> 
                                    <td style="width:60%" colspan="3"></td>
                                  </tr>																												
								</tbody>
							</table>
						
					  </div>
                      <div class="modal-footer" style="padding-top:0;border:0">
                        <button type="button" class="btn btn-primary btn-flat md-close"  onclick="baocunZC()">保存</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" onclick="quxiaoZC()">取消</button>
                      </div>
                    </div>
                </div>
                
                 <!-- 新增员工 -->
                <div class="md-modal colored-header custom-width md-effect-9" id="guanlian-yuangong">
                   <div class="md-content"  onclick="checkSelect_t2()" style="height:800px;overflow-y:scroll;width:700px;">
                         <div class="modal-header">
                        <h3>新增员工 </h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <input type="hidden" id="hfids_t2">
                        <input type="hidden" id="hname_t2">  
                        <input type="hidden" id="allchooseId_t2">
                        <input type="hidden" id="allchooseName_t2">
                      </div>
                      <div class="modal-body " id="erciquerenxinxi">
                      <div class="row">
							<div class="col-sm-1" style="clear:both;text-align: center; vertical-align: middle; height: 34px; line-height: 34px;width:100px;">
								<label>姓名</label>
							</div>
							<div class="col-sm-2" style="margin-bottom:10px;">
								<input class="form-control" type="text" style="width: 100%" id="name_input_t2">
							</div>
							<div class="col-sm-1" style="margin-bottom:5px;">
								<button class="btn btn-primary" style="margin-bottom: 0px !important; height: 34px;" onclick="query_t2()">查询</button>
							</div>
                      </div>
                      <!-- 数据表格开始 -->
					  <div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th style="width:2%;"><input id="firstcheckbox_t2" type="checkbox" class="col_selector_t2" onclick="selectAll_t2();"></th>
														<th><strong>姓名</strong></th>
														<th><strong>所属站点</strong></th>
														<th><strong>角色</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer_t2" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
					  <!-- 数据表格结束 -->
					  <!-- 数据条数提示开始 -->
					  <div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info_t2" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
					  <!-- 数据条数提示结束 -->
					  <!-- 分页条开始 -->
					  <div class="row">
										<div class="col-sm-4" style="clear:both;">
											<div class="pull-left" style="margin:10px 0" id="datatable2_length">
												<label class="pull-left" style="margin:10px 0;">每页</label>
												<label class="pull-left" style="margin:10px 0;">
												<select id="pageSizeSelector_t2" class="form-control"  aria-controls="datatable2" size="1" name="datatable2_length" onchange="query_t2()">
												<option selected="selected" value="10">10</option>
												<option value="25">25</option>
												<option value="50">50</option>
												<option value="100">100</option>
												</select> 
												</label>
												<label class="pull-left" style="margin:10px 0;">条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea_t2" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li>
													</ul>
												</div>
											</div>
										</div>
									</div>
					  <!-- 分页条结束 -->
					  </div>
					  <div class="modal-footer">
					   <button type="button" class="btn btn-primary btn-flat md-close" data-dismiss="modal" onclick="savexinzeng_yg()">保存</button>
                       <button type="button" id="glysquxiao" style="display:none;" class="btn btn-default btn-flat md-close" data-dismiss="modal">取消</button>
                      </div>
                    </div>
                </div>
                
                
                   <!-- 新增服务工单 -->
               <div class="md-modal md-effect-1" id="servicegongdan_add"  style="min-width:550px">
				<div class="md-content" style="height:800px;overflow-y:scroll">
                      <div class="modal-header" style="border-bottom:1px solid #ddd;margin:0 20px;">
                        <h3>新增服务工单</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      </div>
                      <div class="modal-body form">
                        <div class="form-group" style="margin-bottom:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">老人</div> 
                         		<div class="col-sm-4 col-xs-8"  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="olderId_hide" value="">
										<input class="form-control"  type="text" id="oldinput_search2" onclick="getolderName2()" oninput="getolderName2()" onmouseout="javascript:$('#hideul-12').hide();" onmouseover="javascript:$('#hideul-12').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-12"  onmouseover="javascript:$('#hideul-12').show();" onmouseout="javascript:$('#hideul-12').hide();">
										<ul id="hideul_nei12">
							
										</ul>
									</div>
								</div> 
								<div class="col-sm-2 col-xs-4">联系人</div> 
                         		<div class="col-sm-4 col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentName" style="margin-bottom: 15px;">
								</div>
                         		<div class="col-sm-2 col-xs-4">联系电话</div> 
                         		<div class="col-sm-4 col-xs-8" >
									<input type="text" class="form-control" id="oldinput_contentTel" style="margin-bottom: 15px;">
								</div>
							</div>
                        </div>
                        <div class="form-group" style="margin-bottom:0;margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">联系地址</div> 
                         		<div class="col-sm-10 col-xs-8 " >
									<input type="text" class="form-control" id="oldinput_contentAddress" style="margin-bottom: 15px;">
								</div>
							</div>
                        </div>
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                     			<div class="col-sm-2 col-xs-4">负责人</div>                     		
								<input type="hidden" id="fuzerenId_hide" value="">
								<input type="hidden" id="fuzerenName_hide" value="">
								<input type="hidden" id="fuzerenRole_hide" value="">
								<input type="hidden" id="fuzerenBH_hide" value="">
								<input type="hidden" id="fuzerenSiteId_hide" value="">
								<input type="hidden" id="fuzerenSiteName_hide" value="">								
								<div class="col-sm-10 col-xs-8 " >
									<input type="text" class="form-control" id="fprinput_search" readonly="readonly">
								</div> 								
                        	</div>
                        </div> 
                		<div class="form-group" style="margin-top:0">
                			<div class="row">
                			<div class="col-sm-2 col-xs-4">参与人</div>
                			<div class="col-sm-10 col-xs-8" >
                  				<select class="select2" id="cyrinput_search" multiple>
                       			
                  				</select>
               			    </div>
               			    </div>
             		    </div>
                        <div class="form-group" style="margin-bottom:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">服务内容</div> 
                         		<div class="col-sm-10 col-xs-8 "  style="position:relative;">
									<div class="input-group " >
										<input type="hidden" id="fwxminput_Id4_hide" value="">
										<input type="hidden" id="fwxminput_SCPRICE4_hide" value="">
										<input type="hidden" id="fwxminput_YBPRICE4_hide" value="">
										<input class="form-control"  type="text" id="fwxminput_search4" onclick="getFWXM4()" oninput="getFWXM4()" onmouseout="javascript:$('#hideul-24').hide();" onmouseover="javascript:$('#hideul-24').show();">
										<span class="input-group-btn"><button class="btn btn-primary " type="button"><span class="fa fa-search"></span></button></span>
									</div>
									<div class="hideul" id="hideul-24"  onmouseover="javascript:$('#hideul-24').show();" onmouseout="javascript:$('#hideul-24').hide();">
										<ul id="hideul_nei24">
							
										</ul>
									</div>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">服务子项</div> 
                         		<div class="col-sm-10 col-xs-8 " >
									<select class="select2" id="fuwuzixianginput_search" multiple>
                       			
                  					</select>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">预计服务时长</div> 
                         		<div class="col-sm-4 col-xs-8">
									<div class="input-group" ><input type="text" class="form-control" id="yjfwsc" onpaste="return false;" onkeypress="keyPress()"><span class="input-group-addon">分钟</span></div>
								</div>
                         		<div class="col-sm-2 col-xs-4" style="padding-top:5px">收费类型</div> 
                         		<div class="col-sm-4 col-xs-8 ">
									<select id="fuwusflx_search" class="form-control" onchange="getFWXM_jiage()">
                       					<option value="医保">医保</option>
                       					<option value="市场">市场</option>
                  					</select>
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group" style="margin-top:0">
                        	<div class="row">
                         		<div class="col-sm-2 col-xs-4">价格</div> 
                         		<div class="col-sm-10 col-xs-8 " id="fuwusfjg_search">
                         		暂无
								</div> 
                        	</div>
                        </div> 
                        <div class="form-group">
                        	<div class="row">
                        	<div class=" col-sm-12">
                         		<table class="table no-border " >
								<thead class="no-border">
									<tr>										
										<th ><strong>&nbsp;&nbsp;预计服务时间</strong></th>									
																		
										<th style="text-align:right;" ><strong>操作</strong></th>
									</tr>
								</thead>
								<tbody class="no-border-y mytablenopadding" id="yujiFWDate">
									<!-- <tr>
										<td >
											<input class="form-control datetime" size="16" type="text" value="" />
										</td>															
										<td > <a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td>
									</tr> -->									
									<tr id="addshuizhong">								
										<td> </td>
										<td style="text-align:right"><a class="label btn-primary " onclick="addshuizhong();"><i class="fa fa-plus"></i></a> </td>
									</tr>
								</tbody>
							</table>
                         		</div>
                        	</div>
                        </div> 
                        
                                      
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn  btn-primary btn-flat" id="model_sure" onclick="saveMany()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="closeAll" onclick="qingkongXZ()">取消</button>
                      </div>
				</div>  
			  </div> 
  				
  				<!-- 工单取消-->
                <div class="md-modal colored-header custom-width md-effect-9" id="servicegongdan_quxiao">
                    <div class="md-content">
                      <div class="modal-header">
                        <h3>取消操作日志</h3>
                        <button type="button" class="close md-close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <input type="hidden" id="idForQX" value="">
                      </div>
                      <div class="modal-body form form-horizontal">
                     <!--  <form class="" > -->
						<div class="form-group" id="hyIfxianshi">
						    <label class="col-sm-4 control-label">备注</label>
						<div class="col-sm-6 " >
							<textarea class="form-control" id="beizhu_input_quxiao"></textarea>		
						</div>
                        </div>
                        <!-- </form> -->	
					  </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-flat" data-dismiss="modal" onclick="sureQuxiao()">确定</button>
                        <button type="button" class="btn btn-default btn-flat md-close" data-dismiss="modal" id="quxiao_tanchuang">取消</button>
                      </div>
                    </div>
                </div>
                
                
				 <div class="md-overlay"></div>


	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
  <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>

	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>   
  <script type="text/javascript" src="js/masonry.js"></script>
  <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>

  <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
  <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
  <!-- The basic File Upload plugin -->
  <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script type="text/javascript" src="js/jquery.icheck/icheck.min.js"></script>


    <script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page2(currentshownpage2);
}

//根据排序规则重新查询
function queryBySort2(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType2").val(classFlag);
	$("#sortColumn2").val(column);
	go2page5(currentshownpage5);
}

    function addNewZhiCheng(){ //新增一个职称行
    	var zhicheng1_input = $("#zhicheng1_input").val();
    	var zhicheng1_inputName = $("#zhicheng1_input").find("option:selected").text();
    	var zhicheng2_input = $("#zhicheng2_input").val();
    	var zhicheng2_inputName = $("#zhicheng2_input").find("option:selected").text();
    	var bodys = $("#tbodyhtml").find("tr");
    	if(bodys.length > 1){
    	    for(var i=0;i<bodys.length-1;i++){
    			if($("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(0)").find("input:eq(0)").val() == zhicheng1_input){
    				if($("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(0)").val() == zhicheng2_input){
    					alert("此条职称已添加!");
    					return;
    				}
    			}
    		}
    	}
    	var tbodyhtml = "<tr class=\"whitebg\" ><td style=\"width:25%\"><input style=\"display:none\" value=\"" + zhicheng1_input + "\" type=\"hidden\"><input style=\"border-style:none\" readonly=\"readonly\" value=\"" + zhicheng1_inputName + "\" type=\"text\"></td><td style=\"width:25%\"><input style=\"display:none\" value=\"" + zhicheng2_input + "\" type=\"hidden\"><input style=\"border-style:none\" value=\"" + zhicheng2_inputName + "\" readonly=\"readonly\" type=\"text\"></td><td style=\"text-align:center;width:10%\"><span onclick=\"$(this).parent().parent().remove();\"><i class=\"fa fa-minus\" ></i></span></td></tr>";
    	$(tbodyhtml).insertBefore("#qitashuoming"); //在其他说明前插入空的一行
    }

    function searchWeChat(pagenumber){ //搜索微信
    	var pagesize = $("#pageSizeSelector4 option:selected").val();
    	var nickname = $("#nickname").val();	
    	var reqmsg="{'action':'QUERY_WECHAT_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{";
    	
    	if (nickname != null && nickname != "") {
    		reqmsg += "\"nickname_like\":\"" + nickname + "\",";
    	}	
    	reqmsg += "}}";

        jQuery.ajax({
              type : "post",
              async:true,
              url : "wechat.do?handler",
              dataType : "json",
              data: {
                   "reqmsg":reqmsg
              },
              success : function(data){
                  if(data.des=="success"){
                	  changeDataWeChat(data);
                  }else if(data.des=="failure"){
                     alert("查询微信列表失败");
                  }
              },
              error:function(){
    	           alert("error");
              }
         });
    }
    function changeDataWeChat(data){
    	var htmlcode = "";
    	if (data.content != null) {
    		jQuery.each(data.content.wechatList, function(i, item) {
    			htmlcode += "<tr>";    		   
    		    htmlcode += "<td>" + item.nickname + "</td>";	
    		    htmlcode += "<td>" + item.gender + "</td>";    			
    		    htmlcode += "<td><button class=\"btn btn-success btn-xs\" type=\"button\" onclick=\"setWeChatValue('" + item.id + "','" + item.nickname + "','" + item.openid + "')\">选择</button></td>";  			
    			htmlcode += "</tr>";
    		});
    	}
    	$("#datacontainer4").html(htmlcode);
    	if (data.page != null) {
    		genaratePaginateHtml4(data.page.pageno, data.page.pageCount);
    		genarateRecordNumberHtml4(data.page.pageno, data.page.pagesize, data.page.recordCount);
    	} else {
    		genaratePaginateHtml4(1, 1);
    		genarateRecordNumberHtml4(1, 10, 0);
    	}
    }
    function setWeChatValue(id,name,openid){
    	var headUrl = "<%=request.getContextPath()%>"
		var htmlcode = "<a href=\""+headUrl+"/wechatDetail.do?main&roleIds="+id+"\" target=\"_blank\" tag1=\""+id+"\" tag2=\""+openid+"\">";
		htmlcode += name;
		htmlcode += "</a>";
		$("#wechatName").html(htmlcode);
		$("#closeWeChat").click();
    	
    }
    
    //保存职称模态框信息
    function baocunZC(){
		var html="";
    	var bodys = $("#tbodyhtml").find("tr");
    	if(bodys.length > 1){
    		 for(var i=0;i<bodys.length-1;i++){
    			   html +="<span style=\"margin-right:10px\" id=\"zhicheng"+i+"\">"+ $("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(1)").val() +"</span><input id=\"zhichengId"+i+"\" type=\"hidden\" value=\""+$("#tbodyhtml").find("tr:eq("+i+")").find("td:eq(1)").find("input:eq(0)").val()+"\">";
    		 }
    	}
    	$("#ygzc_input").html(html);
    }
    //关闭职称模态框
    function quxiaoZC(){
    	$("#tbodyhtml").html("<tr class=\"whitebg\" style=\"display:none;\" id=\"qitashuoming\"><td style=\"width:60%\" colspan=\"3\"></td></tr>");
    }
    
     //获取职称信息
      function getzhicheng1(){
        var result = new Array();
    	result = getAddresses(4921);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng1_input").html(html);
      }
      
      //获取职称信息
      function getzhicheng2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng2_input").html(html);
      }
      
      //获取职称信息2
      function getzhicheng12(){
        var result = new Array();
    	result = getAddresses(4921);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng1_input2").html(html);
      }
      
      //获取职称信息2
      function getzhicheng22(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        html+="<option value=\"\">全部</option>";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#zhicheng2_input2").html(html);
      }
      
      //获取部门1信息
      function getbumen1(){
        var result = new Array();
    	result = getAddresses(4945);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input").html(html);
      }
      
      //获取部门2信息
      function getbumen2(id){
        var result = new Array();
    	result = getAddresses(id);
        var html="";
        for(var i=0;i<result.length;i++){
        	html+="<option value=\""+result[i].id+"\">"+result[i].name+"</option>";
        }
        $("#ssbumen_input2").html(html);
      }
      
      $(document).ready(function(){
    	var homeUrl = "<%=request.getContextPath()%>" + "/welcome.do?main";
      	$(".navbar-brand").attr("href",homeUrl);
      	query5();
		getLoginName();
        getcyrName();
        getefprName();
        //initialize the javascript
        App.init();
        getzhicheng1();
		getzhicheng2($("#zhicheng1_input").val());
		
		getzhicheng12();
		$("#zhicheng2_input2").html("<option value=\"\">全部</option>");
		$("#zhicheng1_input2").change(function(e){
		if($("#zhicheng1_input2").val() == ""){
			$("#zhicheng2_input2").html("<option value=\"\">全部</option>");
		}else{
        	getzhicheng22($("#zhicheng1_input2").val());
        }
    	});
    
		$("#zhicheng1_input").change(function(e){
        	getzhicheng2($("#zhicheng1_input").val());
    	});
    	
    	getbumen1();
		//getbumen2(4946);
		
		var buxuan = "<option value=\"\"></option>";
		var bumen1 = $("#ssbumen_input").html();
		$("#ssbumen_input").html(buxuan + bumen1);
		var bumen2 = $("#ssbumen_input2").html();
		$("#ssbumen_input2").html(buxuan + bumen2);
		
    	$("#ssbumen_input").change(function(e){
        	if($("#ssbumen_input").val() == ""){
				$("#ssbumen_input2").html("<option value=\"\"></option>");
			}else{
        		getbumen2($("#ssbumen_input").val());
        	}
    	});
    	
		 $(".md-trigger").modalEffects();  //初始化模态框
		 query();
		 
		 getallRoll();
		 
		$("#oldinput_search2").keydown(function() { //焦点在弹窗第一个时，按回车，焦点跳转到第二个
			if (event.keyCode == 13) {
				$("#oldinput_contentName").focus();
				return;
			}
		});
		$("#oldinput_contentName").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentTel").focus();
				return;
			}
		});
		$("#oldinput_contentTel").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#oldinput_contentAddress").focus();
				return;
			}
		});
		$("#oldinput_contentAddress").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#cyrinput_search").focus();
				return;
			}
		});
		$("#cyrinput_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fwxminput_search4").focus();
				return;
			}
		});
		$("#fwxminput_search4").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#fuwuzixianginput_search").focus();
				return;
			}
		});
		$("#fuwuzixianginput_search").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#yjfwsc").focus();
				return;
			}
		});
		$("#yjfwsc").keydown(function() { //...
			if (event.keyCode == 13) {
				$("#model_sure").focus();
				return;
			}
		});
		
		});

function openFakeSaveButton(){
	var html="您修改了员工<span style=\"color:#3380ff\">"+$("#head_name").html()+"</span>的信息，是否确认保存？";
	$("#erciquerenxinxi").html(html);
	$('#fake-saveAllBasicHeal').click();
}
function able2edit(){
	$('input[tag=hedangdang]').removeAttr("readonly");//去掉input的
	$('select[tag=hedangdang]').removeAttr("disabled");//去掉select的
	$('input[data-min-view=2]').removeAttr("disabled");;//日期控件
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit()">编辑信息</button><button class="btn btn-flat btn-rad  btn-success"  style="margin-left:30px" onclick="openFakeSaveButton();">保存全部</button><button class="btn btn-default btn-flat btn-rad" style="margin-left:30px" onclick="disabled2edit()">取消修改</button>';
	$('#hedangdang1').html(buttonHTML);
	$('td[tag=hedangdang]').removeAttr("style");
	$('th[tag=hedangdang]').removeAttr("style");
	$('input[data-modal=editRole]').removeAttr("style");
	$('input[data-modal=editZhicheng]').removeAttr("style");
	$('input[data-modal=editSite]').removeAttr("style");
	$('input[data-modal=open2wechat]').removeAttr("style");
//"<tr onclick=\"goVehicleProcessChesun('obtain_carinsurance_quote','"+kindInfos[i].kindCode+"')\"></tr>"
}
function disabled2edit(){
	query();
	$('input[tag=hedangdang]').attr("readonly","readonly");//去掉input的
	$('select[tag=hedangdang]').attr("disabled","disabled");//去掉select的
	$('input[data-min-view=2]').attr("disabled","disabled");//日期控件
	var buttonHTML = '<button class="btn btn-flat btn-rad  btn-primary"  onclick="able2edit()">编辑信息</button>';
	$('#hedangdang1').html(buttonHTML);
	$('td[tag=hedangdang]').css({"display":"none"});
	$('th[tag=hedangdang]').css({"display":"none"});
	$('input[data-modal=editRole]').css({"display":"none"});
	$('input[data-modal=editZhicheng]').css({"display":"none"});
	$('input[data-modal=editSite]').css({"display":"none"});
	$('input[data-modal=open2wechat]').css({"display":"none"});
	$("#wechatName").html($("#wechatName_hide").html());
}
function removeThisInfo(par){
	$(par).parent().parent().remove();
}

		//修改关联站点
		function xiugaisite(){
			var siteinput = $("#sszhandian_input input");
			var sites = new Array();//站点
			if(siteinput != null && siteinput.length>0){
				for(var i=0;i<siteinput.length;i++){
					sites.push($("#sszhandian_input").find("input:eq("+i+")").val());
				}
			}
			
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getzhandian",
	          dataType : "json",
	          data: {
	               "zhandian":"站点"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	html=html+"<label class=\"checkbox-inline\" style=\" margin-left:20px;\"> <input type=\"checkbox\" name=\"rad16\" value=\""+name[i]+"\" class=\"icheck\" id=\""+id[i]+"\" >&nbsp;"+name[i]+"</label>";
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#guanlian-sitechoose").html(html);
		  var boxes = document.getElementsByName("rad16");
		  for(i=0;i<boxes.length;i++){
				for(j=0;j<sites.length;j++){
					if(boxes[i].id == sites[j]){
						boxes[i].checked = true;
						break;
					}
				}
		  }	
		  
		}
		//保存关联站点
		function saveSite(){
			var html="";
 			var boxes = document.getElementsByName("rad16");
 			if(boxes != null){
			for(i=0;i<boxes.length;i++){
					if(boxes[i].checked == true){
						html+="<span style=\"margin-right:10px\" id=\"site"+i+"\">"+boxes[i].value+"</span><input id=\"siteId"+i+"\" type=\"hidden\" value=\""+boxes[i].id+"\">";
					}
			}
			}
			$("#sszhandian_input").html(html);
		}
		
		//修改关联角色
		function xiugaijuese(){
			var jueseinput = $("#juese_input input");
			var juese = new Array();//角色
			if(jueseinput != null && jueseinput.length>0){
				for(var i=0;i<jueseinput.length;i++){
					juese.push($("#juese_input").find("input:eq("+i+")").val());
				}
			}
			
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "daeEmployee.do?getRoleName",
	          dataType : "json",
	          data: {
	               "RoleName":"角色"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	if("老人".indexOf(name[i]) == -1){
	            	  		html=html+"<label class=\"checkbox-inline\" style=\" margin-left:20px;\"> <input type=\"checkbox\" name=\"rad15\" value=\""+name[i]+"\" class=\"icheck\" id=\""+id[i]+"\" >&nbsp;"+name[i]+"</label>";
	            	  	}
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#guanlian-juesechoose").html(html);
		  var boxes = document.getElementsByName("rad15");
		  for(i=0;i<boxes.length;i++){
				for(j=0;j<juese.length;j++){
					if(boxes[i].id == juese[j]){
						boxes[i].checked = true;
						break;
					}
				}
		  }	
		}
		//保存关联角色
		function savejuese(){
			var html="";
 			var boxes = document.getElementsByName("rad15");
 			if(boxes != null){
			for(i=0;i<boxes.length;i++){
					if(boxes[i].checked == true){
						html+="<span style=\"margin-right:10px\" id=\"juse"+i+"\">"+boxes[i].value+"</span><input id=\"juseId"+i+"\" type=\"hidden\" value=\""+boxes[i].id+"\">";
					}
			}
			}
			$("#juese_input").html(html);
		}
		
		//查询员工信息
		function query(){
		var employeeId="<%=request.getAttribute("employeeId")%>";
		var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"leaderEmployeeShow\":\"true\",\"siteListShow\":\"true\",\"dataDicListShow\":\"true\",\"id\":"+employeeId+"}}";

		  jQuery.ajax({
          type : "post",
          async:true,
          url : "daeEmployee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    	 });
	}
	
	function changeData(data){
		if (data.content != null) {
			if(data.content.mainPhoto != null && data.content.mainPhoto != ""){
				$("#touxiangId").attr("src",data.content.mainPhoto + "?random=" + Math.random());//头像
				$("#hide_employeeTupian").val(data.content.mainPhoto);//头像
			}
			$("#hide_userId").val(data.content.userId);//userId
 			
 			//主体
 			$("#name_input").val(data.content.name);
 			$("#gender_input").val(data.content.gender);
 			$("#idNumber_input").val(data.content.idnumber);
 			$("#telephone_input").val(data.content.mobileTel);
 			if(data.content.birthdate != "" && data.content.birthdate != null){
 				$("#birthday_input").val(riqiChange(data.content.birthdate));
 			}
 			$("#zhanghaoId_input").val(data.content.zhanghaoId);
			$("#yuangongBH_input").val(data.content.indexNum);
			
 			//角色
 			var names = "";
 			if(data.content.roleIds != null && data.content.roleIds != ""){
 				var ids=data.content.roleIds.split(",");
 				names = data.content.roleNames.split(",");
 				var html="";
 				for(var i=0;i<ids.length;i++){
 					html+="<span style=\"margin-right:10px\" id=\"juse"+i+"\">"+names[i]+"</span><input id=\"juseId"+i+"\" type=\"hidden\" value=\""+ids[i]+"\">";
 				}
 				$("#juese_input").html(html);
 			}

			if(names.indexOf("站长") == -1 && names.indexOf("组长") == -1){
				$("#ssyg_biaoqian").attr("style","display:none");
			}
 			//站点
 			var htmlSite = "";
 			var htmlSiteIds= "";
 			if(data.content.siteList != null && data.content.siteList.length > 0){
				jQuery.each(data.content.siteList, function(i, item) {
					htmlSite +="<span style=\"margin-right:10px\" id=\"site"+item.id+"\">"+item.name+"</span><input id=\"siteId"+item.id+"\" type=\"hidden\" value=\""+item.id+"\">";
					htmlSiteIds += item.id + ",";
				});
				if(htmlSiteIds != ""){
					htmlSiteIds = htmlSiteIds.substring(0, htmlSiteIds.length-1);
				}
				$("#sszhandian_input").html(htmlSite);
				$("#sszhandianIds_input").val(htmlSiteIds);
			}
			
			//职称
			var htmlZC = "";
 			if(data.content.dataDicList != null && data.content.dataDicList.length > 0){
				jQuery.each(data.content.dataDicList, function(i, item) {
					htmlZC +="<span style=\"margin-right:10px\" id=\"zc"+item.id+"\">"+item.name+"</span><input id=\"zcId"+item.id+"\" type=\"hidden\" value=\""+item.id+"\">";
				});
				$("#ygzc_input").html(htmlZC);
			}
			
			if(data.content.leaderEmployeeId != null && data.content.leaderEmployeeId != ""){
				$("#zuzhanginputId_search").val(data.content.leaderEmployeeId);
				if(data.content.leaderEmployee != null && data.content.leaderEmployee != ""){
					$("#zuzhanginput_search").val(data.content.leaderEmployee.name);
				}
			}
			
			

 			$("#yuangongxj_input").val(data.content.starLevel);
 			
 			$("#ssbumen_input").val(data.content.department);
 			getbumen2(data.content.department);
 			$("#ssbumen_input2").val(data.content.secondDepartmentId);
 			if(data.content.wechatId !=0 && data.content.wechatId !="" && data.content.wechatId !=null){ 				
 				var headUrl = "<%=request.getContextPath()%>"
 				var htmlcode = "<a href=\""+headUrl+"/wechatDetail.do?main&roleIds="+data.content.wechatId+"\" target=\"_blank\" tag1=\""+data.content.wechatId+"\" tag2=\""+data.content.wechatOpenid+"\">";
 				htmlcode += data.content.wechatName;
 				htmlcode += "</a>";
 				$("#wechatName").html(htmlcode);
 				$("#wechatName_hide").html(htmlcode);
 			}
 			
 			//head
 			if(data.content.name != null && data.content.name != ""){
 				$("#head_name").html(data.content.name);//姓名
 			}else{
 				$("#head_name").html("未知姓名");//姓名
 			}
 			var rn = data.content.roleNames;
 			var pt = htmlZC;
 			
 			if(rn == null || rn == ""){
 				rn="未知角色";
 			}
 			if(pt == null || pt == ""){
 				pt="未知职称";
 			}
 			$("#head_juesezhicheng").html(rn+"/"+pt);
 			
 			if(htmlSite != ""){
 				$("#head_zhandian").html(htmlSite);
 			}else{
 				$("#head_zhandian").html("未知站点");
 			}
 			
 			var gd=data.content.gender;
 			var idn=data.content.idnumber;
 			if(gd == null || gd == ""){
 				gd="未知性别";
 			}
 			if(idn == null || idn == ""){
 				idn="未知身份证";
 			}
 			$("#head_sexId").html(gd+"/"+idn);
 			
 		}
 	}	
 			
   //转化日期 20160606121212 2016-06-06
   function riqiChange(data){
   		var date_=data;
    	var date2=data.substr(0,4)+"-"+data.substr(4,2)+"-"+data.substr(6,2);
    	if(date2 == "--"){
    		date2 = "无";
    	}
    	return date2;
   }
   
   //修改头像
function baocuntouxiang(){
	var touxiangSrc=$("#hide_employeeTupian").val();//头像
	var reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{";
	
	if (touxiangSrc != null && touxiangSrc != "") {
       	reqmsg += "\"mainPhoto\":\"" + touxiangSrc + "\",";
	}
	var employeeId="<%=request.getAttribute("employeeId")%>";
	reqmsg+="\"id\":"+employeeId+",";
	reqmsg+="\"userId\":"+$("#hide_userId").val();
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:true,
          url : "daeEmployee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	 alert("修改头像成功");
              }else if(data.des=="failure"){
                 alert("修改头像失败");
              }else{
              	 alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
   
    function baocun1(){
	var name_input = $("#name_input").val();//姓名
	if($.trim(name_input) == ""){
	 	alert("姓名必填");
	 	return;
	}
	var gender_input = $("#gender_input").val();//性别
	var identityId_input = $("#idNumber_input").val();//身份证
	if($.trim(identityId_input) == ""){
	 	alert("身份证必填");
	 	return;
	}
	
	var reg = /(^\d{15}$)|(^\d{17}([0-9]|X)$)/; 
	if(!reg.test(identityId_input)){  
        alert("身份证格式错误"); 
        return; 
    }
    
	var telephone_input = $("#telephone_input").val();//联系方式
	var birthDay_input="";//出身年月
	if($("#birthday_input").val() != ""){
	 	birthDay_input=$("#birthday_input").val();
	 	birthDay_input=birthDay_input.split("-")[0]+birthDay_input.split("-")[1]+birthDay_input.split("-")[2];
	}

	var jueseinput=$("#juese_input input");
	var juese="";//角色
	if(jueseinput != null && jueseinput.length>0){
		for(var i=0;i<jueseinput.length;i++){
			juese=juese+$("#juese_input").find("input:eq("+i+")").val()+",";
		}
		if(juese != ""){
			juese=juese.substr(0,juese.length-1);
		}
	}
	if(juese == ""){
		alert("请选择角色");
	 	return;
	}
	
	var yuangongxj_input = $("#yuangongxj_input").val();//员工星级
	var ssbumen_input = $("#ssbumen_input").val();//所属部门1
	var ssbumen_input2 = $("#ssbumen_input2").val();//所属部门2
	
	var reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{";
	
	var siteinput=$("#sszhandian_input input");//站点
	if(siteinput != null && siteinput.length>0){
		reqmsg += "\"employee_site_list\":[";
		for(var i=0;i<siteinput.length;i++){
			reqmsg += "{\"siteId\":" + $("#sszhandian_input").find("input:eq("+i+")").val() + "},";
		}
		reqmsg += "],";
	}
	
	var zcinput=$("#ygzc_input input");//职称
	if(zcinput != null && zcinput.length>0){
		reqmsg += "\"employee_dataDic_list\":[";
		for(var i=0;i<zcinput.length;i++){
			reqmsg += "{\"dataDicId\":" + $("#ygzc_input").find("input:eq("+i+")").val() + "},";
		}
		reqmsg += "],";
	}

	var zuzhanginputId_search = $("#zuzhanginputId_search").val();//组长
	var zuzhanginput_search = $.trim($("#zuzhanginput_search").val());//组长
	if(zuzhanginput_search == null || zuzhanginput_search == ""){
		zuzhanginputId_search = "0";
		$("#zuzhanginputId_search").val("0");
	}else{
		if(zuzhanginputId_search == "0"){
			alert("所选组长不存在");
			return;
		}
	}
	reqmsg += "\"leaderEmployeeId\":" + zuzhanginputId_search + ",";
	
    if (name_input != null && name_input != "") {
        reqmsg += "\"name\":\"" + name_input + "\",";
	}else{
		reqmsg += "\"name\":\"\",";
	}
    if (gender_input != null && gender_input != "") {
        reqmsg += "\"gender\":\"" + gender_input + "\",";
	}else{
		reqmsg += "\"gender\":\"\",";
	}
    if (identityId_input != null && identityId_input != "") {
        reqmsg += "\"idnumber\":\"" + identityId_input + "\",";
	}else{
		reqmsg += "\"idnumber\":\"\",";
	}
    if (telephone_input != null && telephone_input != "") {
        reqmsg += "\"mobileTel\":\"" + telephone_input + "\",";
	}else{
		alert("联系方式不能为空!");
		return;
	}
    if (birthDay_input != null && birthDay_input != "") {
        reqmsg += "\"birthdate\":\"" + birthDay_input + "\",";
	}else{
		reqmsg += "\"birthdate\":\"\",";
	}
    if (juese != null && juese != "") {
        reqmsg += "\"roleIds\":\"" + juese + "\",";
	}else{
		reqmsg += "\"roleIds\":\"\",";
	}
    if (yuangongxj_input != null && yuangongxj_input != "") {
        reqmsg += "\"starLevel\":" + yuangongxj_input + ",";
	}else{
		reqmsg += "\"starLevel\":0,";
	}
	if (ssbumen_input != null && ssbumen_input != "") {
        reqmsg += "\"department\":" + ssbumen_input + ",";
	}else{
		reqmsg += "\"department\":0,";
	}
	var wechatId = $("#wechatName a").attr("tag1");
	var openid = $("#wechatName a").attr("tag2");
	if (wechatId != null && wechatId != "") {
        reqmsg += "\"wechatId\":" + wechatId + ",";
	}else{
		reqmsg += "\"wechatId\":0,";
	}
	if (openid != null && openid != "") {
        reqmsg += "\"wechatOpenid\":\"" + openid + "\",";
	}
	var wechatName = $("#wechatName a").text();
	if (wechatName != null && wechatName != "") {
        reqmsg += "\"wechatName\":\"" + wechatName + "\",";
	}

	if (ssbumen_input2 != null && ssbumen_input2 != "") {
        reqmsg += "\"secondDepartmentId\":" + ssbumen_input2 + ",";
	}else{
		reqmsg += "\"secondDepartmentId\":0,";
	}
	
	var employeeId="<%=request.getAttribute("employeeId")%>";
	reqmsg+="\"id\":"+employeeId+",";
	reqmsg+="\"userId\":"+$("#hide_userId").val();
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:true,
          url : "daeEmployee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	alert("修改成功");
              	var id=data.content.id;
              	var path="<%=request.getContextPath()%>";
              	var url=path+"/daeEmployee.do?main&employeeId="+id;
              	window.location.replace(url);
              }else if(data.des=="failure"){
                 alert("修改失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
    
    }
    
    //标签2////////////////////////////////////////////////////////////////////////////
	var currentshownpage2 = 1;
	//所属员工页签删除员工
	function doDel2() {
	var selectedItemNumber = $("tbody .col_selector2:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector2:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
		var reqmsg = "";
		var sszhandianIds_input=$("#sszhandianIds_input").val();
		sszhandianIds_input = sszhandianIds_input.split(",")[0];
		var jueses = $("#juese_input").html();
		if(jueses.indexOf("站长") != -1){//包含
		    reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"delEmployeesIds\":\""+ids2del + "\",\"delSiteId\":"+ sszhandianIds_input +"}}";
		}else{
			if(jueses.indexOf("组长") != -1){
				var changeleaderEmployeeId="<%=request.getAttribute("employeeId")%>";
				reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"delEmployeesIds\":\""+ids2del + "\",\"delleaderEmployeeId\":"+changeleaderEmployeeId+"}}";
			}
		}

	    if (confirm("是否确认删除?"))  {  
				jQuery.ajax({
          			type : "post",
          			async:true,
          			url : "employee.do?handler",
         			dataType : "json",
          			data: {
               			"reqmsg":reqmsg
          			},
          			success : function(data){
                    if(data.result=="100"){
                    	alert(data.des);
            	  		query2();
               		}else{
                 		alert(data.des);
              		}
          		},
          		error:function(){
	     		      alert("error");
         		 }
    		    });
       }
	} else {
		alert("请选择要删除的数据");
	}
}
	//所属员工页签新增员工
	function doAdd2() {
		document.getElementById("addA2").click();
	}
function selectAll2() {
	if ($("#allselectchecker2").is(':checked')) {
		$(".col_selector2").prop("checked", true);
	} else {
		$(".col_selector2").prop("checked", false);
	}
}
//查询所属员工页签员工
function query2() {
	go2page2(1);
}

function go2page2(pagenumber){
	var pagesize = $("#pageSizeSelector2 option:selected").val();
	var name_input2 = $("#name_input2").val();
	var juese_input2 = $("#juese_input2").val();
	
	var zhicheng1_input2 = $("#zhicheng1_input2").val();
	var zhicheng2_input2 = $("#zhicheng2_input2").val();
	
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST',";
	
	var sortType = $("#sortType").val();
	var sortColumn = $("#sortColumn").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"siteListShow\":\"true\",\"dataDicListShow\":\"true\",";
	
	var jueses = $("#juese_input").html();
	var sszhandianIds_input = $("#sszhandianIds_input").val();

 	if(jueses.indexOf("站长") != -1){//包含
 		reqmsg += "\"siteIds\":\"" + sszhandianIds_input + "\",";
 	}else{
		if(jueses.indexOf("组长") != -1){
			var leaderEmployeeId="<%=request.getAttribute("employeeId")%>";
			reqmsg+="\"leaderEmployeeId\":"+leaderEmployeeId+ ",";
		}
	}
	if (name_input2 != null && name_input2 != "") {
		reqmsg += "\"name_like\":\"" + name_input2 + "\",";
	}
	if (juese_input2 != null && juese_input2 != "") {
		reqmsg += "\"roleIds\":\"" + juese_input2 + "\",";
	}
	
	if($("#zhicheng1_input2").val() != null){
	if($("#zhicheng1_input2").val() != ""){
		reqmsg += "\"zhicheng1\":\"" + zhicheng1_input2 + "\"," + "\"zhicheng2\":\"" + zhicheng2_input2 + "\",";
	}else if($("#zhicheng1_input2").val() == "" && $("#zhicheng1_input2").val() != ""){
		reqmsg += "\"zhicheng1\":\"\"," + "\"zhicheng2\":\"" + zhicheng2_input2 + "\",";
	}
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData2(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

function changeData2(data){
	var htmlcode = "";
	if (data.content != null) {
		jQuery.each(data.content.employeeList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector2\"></td>";			
		    htmlcode += "<td>" + item.name + "</td>";				
		    htmlcode += "<td>" + item.roleNames + "</td>";
		    if(item.zhichengs != null && item.zhichengs != ""){
		    	htmlcode += "<td>" + item.zhichengs + "</td>";	
		    }else{
		    	htmlcode += "<td>无</td>";			    
		    }				
		    htmlcode += "<td>" + xingjiChange(item.starLevel)+ "</td>";	
		    
		    htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${employee_querysxyg_opt_control != 'yes' or employee_querysxyg_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/daeEmployee.do?main&employeeId="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${employee_delsxyg_opt_control != 'yes' or employee_delsxyg_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
					
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer2").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml2(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml2(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml2(1, 1);
		genarateRecordNumberHtml2(1, 10, 0);
	}
}

		//获取所有角色
		function getallRoll(){
		  var html="";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getRoleName",
	          dataType : "json",
	          data: {
	               "RoleName":"角色"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	html=html+"<option value=\""+id[i]+"\">"+name[i]+"</option>";
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
	      
		  $("#juese_input2").html(html);
		}

//星级转化
function xingjiChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="一星";
  			break;
  			
			case 2:
  			name="二星";
  			break;

			case 3:
  			name="三星";
  			break;
  			
  			case 4:
  			name="四星";
  			break;
  			
  			case 5:
  			name="五星";
  			break;
  			
  			default:
  			break;
		}
		return name;
}
//删除所属员工
function del2(id) {
		var reqmsg = "";
		var sszhandianIds_input=$("#sszhandianIds_input").val();
		sszhandianIds_input = sszhandianIds_input.split(",")[0];
		
		var jueses = $("#juese_input").html();
		if(jueses.indexOf("站长") != -1){//包含
		    reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"delEmployeesIds\":\""+id + "\",\"delSiteId\":"+ sszhandianIds_input +"}}";
		}else{
			if(jueses.indexOf("组长") != -1){
				var changeleaderEmployeeId="<%=request.getAttribute("employeeId")%>";
				reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"delEmployeesIds\":\""+id + "\",\"delleaderEmployeeId\":"+changeleaderEmployeeId+"}}";
			}
		}

			  if (confirm("是否确认删除?"))  {  
				jQuery.ajax({
          			type : "post",
          			async:true,
          			url : "employee.do?handler",
         			dataType : "json",
          			data: {
               			"reqmsg":reqmsg
          			},
          		success : function(data){
                    if(data.result=="100"){
                    	alert(data.des);
            	  		query2();
               		}else{
                 		alert(data.des);
              		}
          		},
          		error:function(){
	     		      alert("error");
         		 }
    		    });
    		 }
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml2
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml2(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info2").html(recordInfos);
}
/**
 * 生成分页信息
 * @method genaratePaginateHtml2
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml2(currentpage, totalpage, pagesize) {
	currentshownpage2 = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page2('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page2('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page2('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page2('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page2('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page2('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea2").html(htmlcode);
}
 /**
  * 生成记录数信息
  * @method genarateRecordNumberHtml2
  * @param {Number} currentpage 当前页
  * @param {Number} pagesize 每页记录条目数
  * @param {Number} totalRecord 总记录数
  */
 function genarateRecordNumberHtml4(currentpage, pagesize, totalRecord) {
 	var recordInfos = "";
 	if (totalRecord > 0) {
 	    recordInfos = "当前显示" + totalRecord + "条总记录";
 		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
 		if (currentpage * pagesize > totalRecord) {
 			recordInfos += totalRecord;
 		} else {
 			recordInfos += currentpage * pagesize;
 		}
 		recordInfos += "条 ";
 	} else {
 		recordInfos = "当前显示0 条总记录中的第0-0条";
 	}
 	
 	$("#datatable_info4").html(recordInfos);
 }
 /**
  * 生成分页信息
  * @method genaratePaginateHtml2
  * @param {Number} currentpage 当前页
  * @param {Number} totalpage 总页数
  */
 function genaratePaginateHtml4(currentpage, totalpage, pagesize) {
 	currentshownpage4 = currentpage;
 	var htmlcode = "";
 	
 	//上一页
 	if (currentpage > 1) {
 		htmlcode += "<li class=\"pre\"><a href=\"###\" onclick=\"searchWeChat('1')\">首页</a></li>";
 		htmlcode += "<li class=\"pre\"><a href=\"###\" onclick=\"searchWeChat('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span></a></li>";
 	} else {
 		htmlcode += "<li class=\"pre disabled\"><a href=\"###\">首页</a></li>";
 		htmlcode += "<li class=\"pre disabled\"><a href=\"###\"><span class=\"fa fa-angle-left\"></span></a></li>";
 	}
 	
 	//具体页码
 	if (totalpage <= 5) {
 		for (var i = 1; i <= totalpage; i++) {
 			if (currentpage == i) {
 				htmlcode += "<li class=\"active\"><a href=\"###\">" + i + "</a></li>";
 			} else {
 				htmlcode += "<li><a href=\"###\" onclick=\"searchWeChat('" + i + "')\">" + i + "</a></li>";
 			}
 		}
 	} else {
 		var startpage = currentpage;
 		var endpage = currentpage;
 		while (true) {
 			if (endpage - startpage >= 4) {
 				break;
 			} else {
 				if (startpage > 1) {
 					startpage = startpage - 1;
 				}
 				if (endpage < totalpage) {
 					endpage = endpage - (-1);
 				}
 			}
 		}
 		
 		for (var i = startpage; i <= endpage; i++) {
 			if (currentpage == i) {
 				htmlcode += "<li class=\"active\"><a href=\"###\">" + i + "</a></li>";
 			} else {
 				htmlcode += "<li><a href=\"###\" onclick=\"searchWeChat('" + i + "')\">" + i + "</a></li>";
 			}
 		}
 	}
 	
 	//下一页
 	if (totalpage > currentpage) {
 		htmlcode += "<li class=\"next\"><a href=\"###\" onclick=\"searchWeChat('" + (parseInt(currentpage) + 1) + "')\"><span class=\"fa fa-angle-right\"></span></a></li>";
 		htmlcode += "<li class=\"next\"><a href=\"###\" onclick=\"searchWeChat('" + parseInt(totalpage) + "')\">末页</a></li>";
 	} else {
 		htmlcode += "<li class=\"next disabled\"><a href=\"###\"><span class=\"fa fa-angle-right\"></span></a></li>";
 		htmlcode += "<li class=\"next disabled\"><a href=\"###\">末页</a></li>";
 	}
 	$("#paginationArea4").html(htmlcode);
 }
	/////////////////////////////////////////////////////////////////////////////////////
	
	//新增本站员工//////////////////////////////////////////////////
   function headAdd(){
   	query_t2();
   }
   var currentshownpage_t2 = 1;
   function query_t2() {
	  go2page_t2(1);
   }
   function go2page_t2(pagenumber){
	var pagesize = $("#pageSizeSelector_t2 option:selected").val();
	var name2search = $("#name_input_t2").val();
	
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"siteListShow\":\"true\",\"dataDicListShow\":\"true\",";

	if (name2search != null && name2search != "") {
		reqmsg += "\"name_like\":\"" + name2search + "\",";
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData_t2(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
	function changeData_t2(data){
	var htmlcode = "";
	if (data.content != null) {
	var allchooseId2="";
	var allchooseName2="";
	jQuery.each(data.content.employeeList, function(i, item) {
		allchooseId2=allchooseId2+item.id+",";
		allchooseName2=allchooseName2+item.name+",";
		allchooseId2.replace(",,",",");
		allchooseName2.replace(",,",",");
	});
	
	if(allchooseId2 != ""){
		allchooseId2 = allchooseId2.substr(0,allchooseId2.length-1)
	}
	if(allchooseName2 != ""){
		allchooseName2 = allchooseName2.substr(0,allchooseName2.length-1)
	}
	$("#allchooseId_t2").val(allchooseId2);
	$("#allchooseName_t2").val(allchooseName2);
	
		var leaderEmployeeId="<%=request.getAttribute("employeeId")%>";
		var jueses = $("#juese_input").html();
		var sszhandianIds_input = $("#sszhandianIds_input").val();

		if(jueses.indexOf("站长") != -1){//包含
		  jQuery.each(data.content.employeeList, function(i, item) {
			var siteName = "";
			var siteId = "";
		 	if (item.siteList != null && item.siteList.length > 0) {//所属站点
		    	if(item.siteList[0] != null){
					jQuery.each(item.siteList, function(j, item2) {
						if(item2 != null && item2 != ""){
							siteName += item2.name + ",";
							siteId += item2.id + ",";
						}
					});
					if(siteName != ""){
						siteName = siteName.substring(0, siteName.length-1);
					}
					if(siteId != ""){
						siteId = siteId.substring(0, siteId.length-1);
					}
				}
			}
			
			var aa=sszhandianIds_input.split(",");
			var bb=siteId.split(",");
			var flag = false;
			for(var i=0;i<aa.length;i++){
				for(var j=0;j<bb.length;j++){
					if(aa[i] == bb[j]){
						flag = true;
					}
				}
			}
			if(flag == false){
				htmlcode += "<tr class=\"gradeA odd\">";
				htmlcode += "<td><input id=\""+item.id+"\" value=\""+item.name+"\" name=\"index_t2\" type=\"checkbox\" onclick=\"selectOne_t2("+item.id+",'"+item.name+"')\" class=\"col_selector_t2\"></td>";
				htmlcode += "<td>" + item.name + "</td>";	
		    	if(siteName != ""){
		    		 htmlcode += "<td>" + siteName + "</td>";	
		    	}else{
		    		 htmlcode += "<td>无</td>";	
		    	}
		    	htmlcode += "<td>" + item.roleNames + "</td>";		
				htmlcode += "</tr>";
			}else{
				htmlcode += "<tr class=\"gradeA odd\">";
				htmlcode += "<td></td>";
				htmlcode += "<td>" + item.name + "</td>";	
		    	if(siteName != ""){
		    		 htmlcode += "<td>" + siteName + "</td>";	
		    	}else{
		    		 htmlcode += "<td>无</td>";	
		    	}
		    	htmlcode += "<td>" + item.roleNames + "</td>";		
				htmlcode += "</tr>";
			}
		});
		}else{
			if(jueses.indexOf("组长") != -1){//包含
			jQuery.each(data.content.employeeList, function(i, item) {
			var siteName = "";
			var siteId = "";
		 	if (item.siteList != null && item.siteList.length > 0) {//所属站点
		    	if(item.siteList[0] != null){
					jQuery.each(item.siteList, function(j, item2) {
						siteName += item2.name + ",";
						siteId += item2.id + ",";
					});
					if(siteName != ""){
						siteName = siteName.substring(0, siteName.length-1);
					}
					if(siteId != ""){
						siteId = siteId.substring(0, siteId.length-1);
					}
				}
			}
			if(item.leaderEmployeeId != leaderEmployeeId){
				htmlcode += "<tr class=\"gradeA odd\">";
				htmlcode += "<td><input id=\""+item.id+"\" value=\""+item.name+"\" name=\"index_t2\" type=\"checkbox\" onclick=\"selectOne_t2("+item.id+",'"+item.name+"')\" class=\"col_selector_t2\"></td>";
				htmlcode += "<td>" + item.name + "</td>";	
		    	if(siteName != ""){
		    		 htmlcode += "<td>" + siteName + "</td>";	
		    	}else{
		    		 htmlcode += "<td>无</td>";	
		    	}
		    	htmlcode += "<td>" + item.roleNames + "</td>";		
				htmlcode += "</tr>";
			}else{
				htmlcode += "<tr class=\"gradeA odd\">";
				htmlcode += "<td></td>";
				htmlcode += "<td>" + item.name + "</td>";	
		    	if(siteName != ""){
		    		 htmlcode += "<td>" + siteName + "</td>";	
		    	}else{
		    		 htmlcode += "<td>无</td>";	
		    	}
		    	htmlcode += "<td>" + item.roleNames + "</td>";		
				htmlcode += "</tr>";
			}
		});
		}
		}
	}

	$("#datacontainer_t2").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml_t2(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml_t2(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml_t2(1, 1);
		genarateRecordNumberHtml_t2(1, 10, 0);
	}
	checkSelect_t2();
}
/**
 * 生成分页信息
 * @method genaratePaginateHtml_t2
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml_t2(currentpage, totalpage, pagesize) {
	currentshownpage_t2 = currentpage;

	var htmlcode = "";
	
	// 	上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_t2('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page_t2('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	// 	具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_t2('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page_t2('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	// 	下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_t2('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page_t2('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea_t2").html(htmlcode);
}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml_t2
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml_t2(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info_t2").html(recordInfos);
}
      function checkSelect_t2() {//检查所有复选框
            var checklist = document.getElementsByName("index_t2");
            var haveChoose = document.getElementById("hfids_t2").value.toString();
            var haveChoose2 = new Array();
            var haveChoose2 = haveChoose.split(",");
            if (haveChoose == "") {
                for (var i = 0; i < checklist.length; i++) {
                    checklist[i].checked = 0;
                }
            } else {
                for (var i = 0; i < checklist.length; i++) {
                    for (var j = 0; j < haveChoose2.length; j++) {
                        if (checklist[i].id == haveChoose2[j]) {
                            checklist[i].checked = 1;
                        }
                    }
                }
            }
        }
  function selectOne_t2(id, name) {//单框
            if (document.getElementById(id).checked) {
                if (document.getElementById("hfids_t2").value == "") {
                    document.getElementById("hfids_t2").value = document.getElementById("hfids_t2").value + id;
                } else {
                    document.getElementById("hfids_t2").value = document.getElementById("hfids_t2").value + "," + id;
                }
                if (document.getElementById("hname_t2").value == "") {
                    document.getElementById("hname_t2").value = document.getElementById("hname_t2").value + name;
                } else {
                    document.getElementById("hname_t2").value = document.getElementById("hname_t2").value + "," + name;
                }
            } else {
                var p = document.getElementById("hfids_t2").value.toString();
                var pp = p.split(",");
                if (pp[0] == id) {
                    var strings = p.replace(id+",", "");
                    document.getElementById("hfids_t2").value = strings;
                }else{
                    var strings = p.replace("," + id, "");
                    document.getElementById("hfids_t2").value = strings;
                }

                var p2 = document.getElementById("hname_t2").value.toString();
                var pp2 = p2.split(",");
                if (pp2[0] == name) {
                    var strings2 = p2.replace(name + ",", "");
                    document.getElementById("hname_t2").value = strings2;
                } else {
                    var strings2 = p2.replace("," + name, "");
                    document.getElementById("hname_t2").value = strings2;
                }
            }
            document.getElementById("firstcheckbox_t2").checked = false;
   }
function selectAll_t2() {//全选框
            if (document.getElementById("firstcheckbox_t2").checked) {
                document.getElementById("hfids_t2").value = $("#allchooseId_t2").val();
                
                document.getElementById("hname_t2").value = $("#allchooseName_t2").val();
                var checklist = document.getElementsByName("index_t2");
                for (var i = 0; i < checklist.length; i++) {
                    checklist[i].checked = 1;
                }
            } else {
                document.getElementById("hfids_t2").value = "";
                document.getElementById("hname_t2").value = "";
                var checklist = document.getElementsByName("index_t2");
                for (var i = 0; i < checklist.length; i++) {
                    checklist[i].checked = 0;
                }
            }
}
   		//保存新增
		function savexinzeng_yg(){
			var html="";
			var sszhandianIds_input=$("#sszhandianIds_input").val();
			sszhandianIds_input = sszhandianIds_input.split(",")[0];
			var jueses = $("#juese_input").html();
			var reqmsg = "";
			if(document.getElementById("hfids_t2").value != "" && document.getElementById("hname_t2").value != ""){
				var ids = document.getElementById("hfids_t2").value;
				if(jueses.indexOf("站长") != -1){//包含
					 reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"changeEmployeesIds\":\""+ids + "\",\"changesiteId\":"+sszhandianIds_input+"}}";
				}else{
					if(jueses.indexOf("组长") != -1){
						var changeleaderEmployeeId="<%=request.getAttribute("employeeId")%>";
						reqmsg="{'action':'ADD_EMPLOYEE_INFO_REQUEST','content':{\"changeEmployeesIds\":\""+ids + "\",\"changeleaderEmployeeId\":"+changeleaderEmployeeId+"}}";
					}
				}

				jQuery.ajax({
          			type : "post",
          			async:true,
          			url : "employee.do?handler",
         			dataType : "json",
          			data: {
               			"reqmsg":reqmsg
          			},
          		success : function(data){
                    if(data.result=="100"){
                    	alert(data.des);
            	  		query2();
               		}else{
                 		alert(data.des);
              		}
          		},
          		error:function(){
	     		      alert("error");
         		 }
    		    });
			}
		}
		
		 //上传图片
	function uploadPic() {
		var currPic = $("#pic4upload").val();
		if (currPic != null && currPic != "") {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						$("#srcPath").val(data); 
						//$("#touxiangId2").attr("src", data);  //将当前图片设为上传的图片
						openImagejsp(data);
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#picuploadform").ajaxSubmit(ajax_option);
		} else {
			//alert("请选择图片");
		}
	}
	function openImagejsp(data){
		window.open ("view/imageCut/jquery-image-cut/image.jsp?"+data, "newwindow", "height=550, width=1100, top=200, left=450, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no");
	}
	 //上传裁剪后图片
	function uploadPic_cut() {
			var ajax_option = {
				async:false,
				data:{},
				success:function(data) {
					if (data != null && data != "") {
						var result = JSON.parse(data);
						$("#hide_employeeTupian").val(result.base64);
						$("#touxiangId").attr("src", result.url);  //将当前图片设为上传的图片
						baocuntouxiang();
					} else {
						alert("图片上传失败");
					}
				}
			};
			$("#image_submit").ajaxSubmit(ajax_option);
	}
	
	
	//通过角色名称获取对应id
	function getIdByRoleName(name){
		var id="0";
		 jQuery.ajax({
          type : "post",
          async:false,
          url : "addEmployee.do?getIdByRoleName",
          dataType : "json",
          data: {
               "RoleName":name
          },
          success : function(data){
              if(data.des=="success"){
              		id = data.id;
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	});
		return id;
	}
//实时获取组长姓名
function getzuzhangName(){
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $.trim($("#zuzhanginput_search").val());
	var roleIds = getIdByRoleName("组长");
	reqmsg += "\"roleIds\":\"" + roleIds + "\",";
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"zuzhangNamefuzhi(" + item.id + ",'" + item.name + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei1").html(htmlcode);
		    	  $("#hideul-1").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//分配人姓名赋值
function zuzhangNamefuzhi(id,name){
	$("#zuzhanginputId_search").val(id);
	$("#zuzhanginput_search").val(name);
	$("#hideul_nei1").html("");
	$("#hideul-1").hide();
}


////历史服务//////////////////////////////
	 //只能输入数字0-9
        function keyPress() {
            var theEvent = window.event || arguments.callee.caller.arguments[0];
    		var keyCode = theEvent.keyCode || theEvent.which;
    		if ((keyCode < 48 || keyCode > 57) && keyCode != 8 && keyCode != 37 && keyCode != 39) {
               theEvent.preventDefault();
            }
        } 
      
      function addshuizhong(){
   		var addhtml = '<tr><td ><input class="form-control datetime" size="16"  type="text"></td><td><a class="label label-danger" onclick="$(this).parent().parent().remove();" ><i class="fa fa-times"></i></a></td></tr>';
   		$(addhtml).insertBefore("#addshuizhong"); 
   	  var config = {dateTime:true};  //初始化新增的datepicker，不会导致格式错乱
      $( ".ui-datepicker" ).datepicker();
     if(config.dateTime){
     $(".datetime").datetimepicker({autoclose: true});
   }
   }
  
	
	//查询历史服务信息
	function query5() {
		go2page5(1);
	}
	var currentshownpage5 = 1;
    function selectAll5() {
		if ($("#allselectchecker5").is(':checked')) {
			$(".col_selector5").prop("checked", true);
		} else {
			$(".col_selector5").prop("checked", false);
		}
	}
	function go2page5(pagenumber){
	var pagesize = $("#pageSizeSelector5 option:selected").val();
	var oldinput_search = $.trim($("#oldinput_search").val());
	var fwxminput_Id = $("#fwxminput_Id").val();
	var fwxminput_search = $("#fwxminput_search").val();
	var fuwustate_input = $("#fuwustate_input").val();
	var fuwutype_input = $("#fuwutype_input").val();
	var fuwugdbh_input = $("#fuwugdbh_input").val();
	
	var reqmsg="{'action':'QUERY_SERVICE_TASK_LIST_REQUEST',";
	
	var sortType = $("#sortType2").val();
	var sortColumn = $("#sortColumn2").val();
	if(sortType != null && sortType != ""){
		reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
	}
	
	reqmsg += "'page':{'pageno':'" + pagenumber + "','pagesize':'" + pagesize + "'},'content':{\"serviceListShow\":\"true\",";
	
	reqmsg += "\"source_isNull\":\"null\",";
	var employeeId="<%=request.getAttribute("employeeId")%>";
	if (employeeId != null && employeeId != "") {
		reqmsg += "\"chargeEmployeeId\":" + employeeId + ",";
	}
	if (oldinput_search != null && oldinput_search != "") {
		reqmsg += "\"olderName_like\":\"" + oldinput_search + "\",";
	}
	if (fwxminput_Id != null && fwxminput_Id != "") {
		reqmsg += "\"serviceId\":" + fwxminput_Id + ",";
	}
	if((fwxminput_search != "" && fwxminput_search != null) && (fwxminput_Id == "" || fwxminput_Id == null)){
		reqmsg += "\"serviceId\":0,";
	}
	if (fuwustate_input != null && fuwustate_input != "") {
		reqmsg += "\"status_in\":\"" + fuwustate_input + "\",";
	}
	if (fuwutype_input != null && fuwutype_input != "") {
		reqmsg += "\"healthInsurance\":" + fuwutype_input + ",";
	}
	if (fuwugdbh_input != null && fuwugdbh_input != "") {
		reqmsg += "\"serviceCode\":\"" + fuwugdbh_input + "\",";
	}
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:true,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  changeData5(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

/**
 * 格式化时间
 * @method formateTime
 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
 */
function formateTime(time) {
	if (time != null && time.length == 14) {
		return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
	} else {
		return time;
	}
}

function changeData5(data){
	var htmlcode = "";
	if (data.content != null) {
		var fwxm = "";
		jQuery.each(data.content.serviceTaskList, function(i, item) {
			htmlcode += "<tr class=\"gradeA odd\"><td><input type=\"checkbox\" value=\"" + item.id + "\" class=\"col_selector5\"></td>";		
		    htmlcode += "<td>" + item.serviceCode + "</td>";
		    htmlcode += "<td>" + item.olderName + "</td>";
		    fwxm = "";
		    jQuery.each(item.serviceList, function(j, item2) {
		    	fwxm += item2.name + ",";
		    });
		    if(fwxm != ""){
		    	fwxm = fwxm.substr(0,fwxm.length-1);
		    }
		    htmlcode += "<td>" + fwxm + "</td>";
		    htmlcode += "<td>" + fwstateChange(item.status) + "</td>";				
		    htmlcode += "<td>" + fwlbChange(item.healthInsurance) + "</td>";
		    htmlcode += "<td>" + formateTime(item.serviceStartTime) + "</td>";
		   
			htmlcode += "<td><div class=\"btn-group\">";
			htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
			htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
			htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
			htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
			htmlcode += "</button>";
			htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
			var headUrl = "<%=request.getContextPath()%>";
			<c:if test="${serviceTask_queryXQ_opt_control != 'yes' or serviceTask_queryXQ_opt_show == 'yes'}">
			htmlcode += "<li><a href=\""+headUrl+"/serviceTask.do?mainXQ&id="+item.id+"\" target=\"_blank\">查看详情</a></li>";
			</c:if>	
			<c:if test="${serviceTask_del_opt_control != 'yes' or serviceTask_del_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"del25('" + item.id + "')\"><a href=\"###\">删除</a></li>";
			</c:if>	
			<c:if test="${serviceTask_qx_opt_control != 'yes' or serviceTask_qx_opt_show == 'yes'}">
			htmlcode += "<li onclick=\"quxiao_qingkong2('" + item.id + "')\"><a href=\"###\">取消</a></li>";
			</c:if>	
			htmlcode += "</ul>";
			htmlcode += "</div></td>";		
			htmlcode += "</tr>";
		});
	}
	$("#datacontainer5").html(htmlcode);
	if (data.page != null) {
		genaratePaginateHtml5(data.page.pageno, data.page.pageCount);
		genarateRecordNumberHtml5(data.page.pageno, data.page.pagesize, data.page.recordCount);
	} else {
		genaratePaginateHtml5(1, 1);
		genarateRecordNumberHtml5(51, 10, 0);
	}
}
	//服务状态
	function fwstateChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="取消";
  			break;
  			
			case 2:
  			name="待排班";
  			break;
  			
  			case 3:
  			name="待审核";
  			break;
  			
  			case 4:
  			name="审核通过";
  			break;
  			
  			case 5:
  			name="服务开始";
  			break;
  			
  			case 6:
  			name="服务结束";
  			break;
  			
  			case 7:
  			name="回访结束";
  			break;
  			
  			default:
  			break;
		}
		return name;
	}
	
	//服务类别
	function fwlbChange(id){
		var name="未知";
     	switch (id)
		{
			case 1:
  			name="医保";
  			break;
  			
			case 2:
  			name="市场";
  			break;
  			
  			default:
  			break;
		}
		return name;
	}
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml5
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml5(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info5").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml5
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml5(currentpage, totalpage, pagesize) {
	currentshownpage5 = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page5('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page5('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page5('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page5('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page5('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page5('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea5").html(htmlcode);
}
//删除历史服务信息
function doDel5() {
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	var selectedItemNumber = $("tbody .col_selector5:checked").length;
	if (selectedItemNumber >= 1) {
		var ids2del = "";
		$("tbody .col_selector5:checked").each(function() {
			ids2del += $(this).val() + ",";
		});
		if (ids2del != "") {
			ids2del = ids2del.substring(0, ids2del.length - 1);
		}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"serviceTask.do?del",
			async:true,
			dataType:"json",
			data:{ids:ids2del},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page5(currentshownpage5);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
		}
	} else {
		alert("请选择要删除的数据");
	}
}
//删除历史服务信息
function del25(id) {
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	  if (confirm("是否确认删除?"))  {  
		jQuery.ajax({
			type:"post",
			url:"serviceTask.do?del",
			async:true,
			dataType:"json",
			data:{ids:id},
			success:function(data) {
				alert(data.des);
				if (data.result == "success") {
					go2page5(currentshownpage5);
				}else if(data.des=="failure"){
                 alert("删除失败");
                }
			},
			error:function() {
				alert("error");
			}
		});
	}
}

//实时获取老人姓名
function getolderName(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	var name = $.trim($("#oldinput_search").val());
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei11").html("");
		$("#hideul-11").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"olderNamefuzhi('" + item.name + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei11").html(htmlcode);
		    	  $("#hideul-11").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi(name){
	$("#oldinput_search").val(name);
	$("#hideul_nei11").html("");
	$("#hideul-11").hide();
}

//实时获取服务项目
function getFWXM(){
	var reqmsg="{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	reqmsg += "\"status\":1,";
	var name = $("#fwxminput_search").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei2").html("");
		$("#hideul-2").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceList != null){
            	  		jQuery.each(data.content.serviceList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"fwxmNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei2").html(htmlcode);
		    	  $("#hideul-2").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//服务项目名称赋值
function fwxmNamefuzhi(name,id){
	$("#fwxminput_Id").val(id);
	$("#fwxminput_search").val(name);
	$("#hideul_nei2").html("");
	$("#hideul-2").hide();
}

//实时获取老人姓名
function getolderName2(){
	var reqmsg="{'action':'QUERY_OLDER_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{\"olderAddressListShow\":\"true\",";
	var name = $("#oldinput_search2").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei12").html("");
		$("#hideul-12").hide();
		return;
	}
	reqmsg += "}}";
	
	var address = "";
    jQuery.ajax({
          type : "post",
          async:false,
          url : "older.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.olderList != null){
            	  		jQuery.each(data.content.olderList, function(i, item) {
            	  			if(item != null){
            	  				if(item.olderAddressList != null){
 									jQuery.each(item.olderAddressList, function(j, item2) {//居住地
 										if(item2.addressType == 0){
 											if(item2.address != "" && item2.address != null){
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId)+","+item2.address;
 											}else{
 												address=getNameById(item2.provinceId)+","+getNameById(item2.cityId)+","+getNameById(item2.areaId);
 											}
 										}
 									});
 								}
		    					htmlcode += "<li onclick=\"olderNamefuzhi2(" + item.id + ",'" + item.name + "  " + item.memberNum + "','" + item.memberSource + "','" + item.name + "','" + item.mobileTel + "','" + address + "')\">" + item.name + "  " + item.memberNum + "</li>";		
            	  			}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei12").html(htmlcode);
		    	  $("#hideul-12").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//老人姓名赋值
function olderNamefuzhi2(id,namememberNum,memberSource,name,mobileTel,address){
	var oldinput_contentName = $.trim($("#oldinput_contentName").val());
	var oldinput_contentTel = $.trim($("#oldinput_contentTel").val());
	var oldinput_contentAddress = $.trim($("#oldinput_contentAddress").val());
	if(oldinput_contentName != "" || oldinput_contentTel != "" || oldinput_contentAddress != ""){
		if (confirm("是否需要覆盖老人联系人信息"))  {  
 			$("#oldinput_contentName").val(name);
 			$("#oldinput_contentTel").val(mobileTel);
 			$("#oldinput_contentAddress").val(address);
 		}
	}else{
		$("#oldinput_contentName").val(name);
 		$("#oldinput_contentTel").val(mobileTel);
 		$("#oldinput_contentAddress").val(address);
	}
	
	$("#olderId_hide").val(id);
	$("#oldinput_search2").val(name);
	$("#hideul_nei12").html("");
	$("#hideul-12").hide();
	if(memberSource == "医保"){
        $("#fuwusflx_search").val("医保");
    }else{
        $("#fuwusflx_search").val("市场");
    }
	getFWXM_jiage();
}

//实时获取负责人姓名
function getefprName(){
	var employeeId="<%=request.getAttribute("employeeId")%>";
	var siteIds = $("#addUserSites").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"siteListShow\":\"true\",";
	
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	reqmsg += "\"id\":" + employeeId + ",";
	
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  			if(item != null){
		    					fprNamefuzhi(item.id,item.name,item.roleNames,item.indexNum);
            	  			}
            	  			if(item.siteList != null && item.siteList.length > 0){
            	  				$("#fuzerenSiteId_hide").val(item.siteList[0].id);
            	  				$("#fuzerenSiteName_hide").val(item.siteList[0].name);
            	  			}
		    	  		});
		    	 	 }
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//负责人姓名赋值
function fprNamefuzhi(id,name,roleNames,bianhao){
	$("#fuzerenId_hide").val(id);
	$("#fprinput_search").val(name);
	$("#fuzerenName_hide").val(name);
	$("#fuzerenRole_hide").val(roleNames);
	$("#fuzerenBH_hide").val(bianhao);
}

//实时获取参与人姓名
function getcyrName(){
	var siteIds = $("#addUserSites").val();
	var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'2000000'},'content':{";
	//var name = $("#cyrinput_search").val();
	//if (name != null && name != "") {
	//	reqmsg += "\"name_like\":\"" + name + "\"";
	//}else{
	//	$("#cyrinput_search").val("");
	//	return;
	//}
	if(siteIds != "" && siteIds != null){
		reqmsg += "\"siteIds\":\"" + siteIds + "\",";
	}
	
	reqmsg += "}}";
	
    jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.employeeList != null){
            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<option value=\"" + item.id + "\">" + item.name + "  " + item.indexNum + "</option>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#cyrinput_search").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//获取服务项目价格
function getFWXM_jiage(){
	var reqmsg="{'action':'QUERY_SERVICE_INFO_REQUEST','content':{";
	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
	var name = $("#fwxminput_search4").val();
	if (name == null || name == "") {
		return;
	}
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
		reqmsg += "\"id\":" + fwxminput_Id4_hide + ",";
	}else{
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
            	  	if($("#fuwusflx_search").val() == "医保"){
            	  		$("#fuwusfjg_search").html(data.content.medicalPrice);
            	  	}else if($("#fuwusflx_search").val() == "市场"){
            	  		$("#fuwusfjg_search").html(data.content.marketPrice);
            	  	}
		    	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//实时获取服务项目
function getFWXM4(){
	$("#fuwuzixianginput_search").html("");
	$("#fuwuzixianginput_search").val("").trigger("change");
	var reqmsg="{'action':'QUERY_SERVICE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
	reqmsg += "\"status\":1,";
	var name = $("#fwxminput_search4").val();
	if (name != null && name != "") {
		reqmsg += "\"name_like\":\"" + name + "\"";
	}else{
		$("#hideul_nei24").html("");
		$("#hideul-24").hide();
		return;
	}
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "service.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceList != null){
            	  		jQuery.each(data.content.serviceList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"fwxmNamefuzhi4('" + item.name + "','" + item.id + "'," + item.marketPrice + "," + item.medicalPrice + ")\">" + item.name + "</li>";		
            	  				}	
		    	  		});
		    	 	 }
		    	  }
		    	  $("#hideul_nei24").html(htmlcode);
		    	  $("#hideul-24").show();
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}
//服务项目名称赋值4
function fwxmNamefuzhi4(name,id,marketPrice,medicalPrice){
	if($("#fuwusflx_search").val() == "医保"){
        $("#fuwusfjg_search").html(medicalPrice);
    }else if($("#fuwusflx_search").val() == "市场"){
        $("#fuwusfjg_search").html(marketPrice);
    }
	$("#fwxminput_Id4_hide").val(id);
	$("#fwxminput_search4").val(name);
	$("#fwxminput_SCPRICE4_hide").val(marketPrice);
	$("#fwxminput_YBPRICE4_hide").val(medicalPrice);
	$("#hideul_nei24").html("");
	$("#hideul-24").hide();
	
	var reqmsg="{'action':'QUERY_SERVICE_CHILD_LIST_REQUEST','page':{'pageno':'1','pagesize':'1000'},'content':{";
	reqmsg += "\"serviceId\":" + id + ",";
	reqmsg += "}}";

    jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceChild.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	  var htmlcode = "";
              	  if(data.content != null){
              	  	 if(data.content.serviceChildList != null){
            	  		jQuery.each(data.content.serviceChildList, function(i, item) {
            	  			if(item != null){
		    					htmlcode += "<option value=\"" + item.name + "\">" + item.name + "</option>";		
            	  			}
		    	  		});
		    	 	 }
		    	  }
		    	  $("#fuwuzixianginput_search").html(htmlcode);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     });
}

//获取老人基本信息
function getOlderJBXX(olderId){
	var olderData = "";
	var reqmsg="{'action':'QUERY_OLDER_INFO_REQUEST','content':{\"olderAddressListShow\":\"true\",\"id\":"+olderId+"}}";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "daeOlder.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if(data.content != null){
            	  	olderData = JSON.stringify(data.content);
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
    });
    return olderData;
}
 	//获取当前登陆员工姓名
	function getLoginName(){
    	  var userId_login = "<%=request.getAttribute("userId")%>";
		  var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'1'},'content':{\"siteListShow\":\"true\",\"userId\":"+userId_login+"}}";

		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	    var siteIds = "";
            	  	if(data.content.employeeList != null && data.content.employeeList.length == 1){
            	  		if(data.content.employeeList[0] != null && data.content.employeeList[0] != ""){
            	  			var name = data.content.employeeList[0].name;
            	  			$("#addUserName").val(name);
            	  			if (data.content.employeeList[0].siteList != null && data.content.employeeList[0].siteList.length > 0) {//所属站点
            	  				jQuery.each(data.content.employeeList[0].siteList, function(j, item2) {
									siteIds += item2.id + ",";
								});
								if(siteIds != ""){
									siteIds = siteIds.substring(0, siteIds.length-1);
								}
								$("#addUserSites").val(siteIds);
            	  			}
            	  		}
            	  	}
				}
			}else if(data.des=="failure"){
                 alert("查询失败");
            }
          },
          error:function(){
	           alert("error");
          }
     	  });
	}
	//获取参与人姓名角色
	function getcyrNameRole(id){
		  var reqmsg="{'action':'QUERY_EMPLOYEE_INFO_REQUEST','content':{\"id\":"+id+"}}";
		  var nameroles = "";
		  jQuery.ajax({
          type : "post",
          async:false,
          url : "employee.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
            	  if (data.content != null) {
            	  	   nameroles = data.content.name + "||" + data.content.roleNames + "||" + data.content.indexNum;
            	  }
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          },
          error:function(){
	           alert("error");
          }
     	  });
     	  return nameroles;
	}
//获取当前时间return yyyymmddhhmmss
function getNowFormatDate2() {
    var date = new Date();
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    var strHour = date.getHours();
    var strMinutes = date.getMinutes();
    var strSeconds = date.getSeconds();
    
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    if (strHour >= 0 && strHour <= 9) {
        strHour = "0" + strHour;
    }
    if (strMinutes >= 0 && strMinutes <= 9) {
        strMinutes = "0" + strMinutes;
    }
    if (strSeconds >= 0 && strSeconds <= 9) {
        strSeconds = "0" + strSeconds;
    }
    var currentdate = date.getFullYear() + "" + month + "" + strDate + "" + strHour + "" + strMinutes + "" + strSeconds;
    return currentdate;
}

//到2016-08-08 12:12分的时间选择器转化YYYYMMDDhhmmss
function changeTime(time){
	var times = "";
	times = String(time);
	if(times == null || times == ""){
		return;
	}
	times = times.split("-")[0] + times.split("-")[1] + String(times.split("-")[2]).substr(0,2) + String(times.split("-")[2]).substr(3,2) + String(times.split("-")[2]).substr(6,2) + "00";
	return times;
}
	//确定保存服务工单
	function saveMany(){
		var yujiFWDateList = $("#yujiFWDate tr");
		var time = "";
		var flag = 0;
		var olderId = $("#olderId_hide").val();
		if(olderId == null || olderId == ""){
			alert("请选择老人");
			return;
		}
		var contactName = $.trim($("#oldinput_contentName").val());
		var contactTel = $.trim($("#oldinput_contentTel").val());
		var address = $.trim($("#oldinput_contentAddress").val());
		if(contactName == null || contactName == ""){
			alert("请填写联系人");
			return;
		}
		if(contactTel == null || contactTel == ""){
			alert("请填写联系电话");
			return;
		}
		if(address == null || address == ""){
			alert("请填写联系地址");
			return;
		}
		var fuzerenId_hide = $("#fuzerenId_hide").val();
		if(fuzerenId_hide == null || fuzerenId_hide == ""){
			alert("请选择负责人");
			return;
		}
		var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
		if(fwxminput_Id4_hide == "" || fwxminput_Id4_hide == null){
			alert("请选择服务内容");
			return;
		}
		//var fuwuzixianginput_search = $("#fuwuzixianginput_search").val();
		//if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		//	alert("请选择服务子项");
		//	return;
		//}
		var yjfwsc = $("#yjfwsc").val();
		var reg1 = new RegExp("^(0|[1-9][0-9]*)$"); 
		if(!reg1.test(yjfwsc)){ 
       		alert("请输入符合规范的预计服务时长!");
       		return;
   	 	}
	if(yujiFWDateList.length > 1){//有时间
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			if(time == null || time == ""){
				alert("请选择时间");
				return;
			}
		}
		for(var i = 0;i<yujiFWDateList.length-1;i++){
			time = changeTime($("#yujiFWDate").find("tr:eq("+i+")").find("td:eq(0)").find("input").val());
			flag = save(time);
		}
		if(flag == 1){
			$("#closeAll").click();
            alert("新增成功");
            query5();
		}else{
			alert("新增失败");
		}
	}else{
		//演示逻辑
		//flag = save('');
		//if(flag == 1){
		//	$("#closeAll").click();
        //    alert("新增成功");
        //    query();
		//}else{
		//	alert("新增失败");
		//}
		alert("请选择预计服务时间");
		return;
	}
}
//执行保存服务工单操作，按照预计服务时间生成对应工单数量
function save(yujiFWDate){
	var olderId = $("#olderId_hide").val();
	
	var flag = 0;
	var olderData = getOlderJBXX(olderId);
	var olderMemberNum = "";
	var olderName = "";
	var olderBirthdate = "";
	var serviceAreaId = 0;
	var serviceStreetId = 0;
	var contactName = $.trim($("#oldinput_contentName").val());
	var contactTel = $.trim($("#oldinput_contentTel").val());
	var address = $.trim($("#oldinput_contentAddress").val());
	if(olderData != ""){
		var obj = JSON.parse(olderData);
		olderMemberNum = obj.memberNum;
		olderName = obj.name;
		olderBirthdate = obj.birthdate;
		serviceAreaId = obj.serviceAreaId;
		serviceStreetId = obj.serviceStreetId;
		/*contactName = obj.name;
		contactTel = obj.mobileTel;
		if(obj.olderAddressList != null){
 			jQuery.each(obj.olderAddressList, function(i, item) {//居住地
 				if(item.addressType == 0){
 					if(item.address != "" && item.address != null){
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId)+","+item.address;
 					}else{
 						address=getNameById(item.provinceId)+","+getNameById(item.cityId)+","+getNameById(item.areaId);
 					}
 				}
 			});
 		}*/
	}
	
	var fuzerenSiteId_hide = $("#fuzerenSiteId_hide").val();
	var fuzerenSiteName_hide = $("#fuzerenSiteName_hide").val();

	var fwxminput_Id4_hide = $("#fwxminput_Id4_hide").val();
	var fwxminput_SCPRICE4_hide = $("#fwxminput_SCPRICE4_hide").val();
	var fwxminput_YBPRICE4_hide = $("#fwxminput_YBPRICE4_hide").val();
	
	var fuwuzixianginput_search = $("#fuwuzixianginput_search").val();
	if(fuwuzixianginput_search == "" || fuwuzixianginput_search == null){
		fuwuzixianginput_search = "";
	}
	
	var yjfwsc = $("#yjfwsc").val();
	
	var fuzerenId_hide = $("#fuzerenId_hide").val();
	var fuzerenName_hide = $("#fuzerenName_hide").val();
	var fuzerenRole_hide = $("#fuzerenRole_hide").val();
	var fuzerenBH_hide = $("#fuzerenBH_hide").val();
	
	var cyrinput_search = $("#cyrinput_search").val();
	var canyurenArray = null;
	if(cyrinput_search != null && cyrinput_search !=""){
		canyurenArray = String(cyrinput_search).split(",");
	}
	
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	if (olderId != null && olderId != "") {
        reqmsg += "\"olderId\":" + olderId + ",";
	}
	if (olderMemberNum != null && olderMemberNum != "") {
        reqmsg += "\"olderMemberNum\":\"" + olderMemberNum + "\",";
	}
	if (olderName != null && olderName != "") {
        reqmsg += "\"olderName\":\"" + olderName + "\",";
	}
	if (olderBirthdate != null && olderBirthdate != "") {
        reqmsg += "\"olderBirthdate\":\"" + olderBirthdate + "\",";
	}
	if (serviceAreaId != null && serviceAreaId != 0) {
        reqmsg += "\"serviceAreaId\":" + serviceAreaId + ",";
	}
	if (serviceStreetId != null && serviceStreetId != 0) {
        reqmsg += "\"serviceStreetId\":" + serviceStreetId + ",";
	}
	if (contactName != null && contactName != "") {
        reqmsg += "\"contactName\":\"" + contactName + "\",";
	}
	if (contactTel != null && contactTel != "") {
        reqmsg += "\"contactTel\":\"" + contactTel + "\",";
	}
	if (address != null && address != "") {
        reqmsg += "\"address\":\"" + address + "\",";
	}
	
	if (yujiFWDate != null && yujiFWDate != "") {
        reqmsg += "\"serviceExpectTime\":\"" + yujiFWDate + "\",";
	}
	//else{//下次删除
	//	reqmsg += "\"status\":2,";
	//}
    reqmsg += "\"status\":4,";

	if (fuzerenSiteId_hide != null && fuzerenSiteId_hide != "") {
        reqmsg += "\"siteId\":" + fuzerenSiteId_hide + ",";
	}
	if (fuzerenSiteName_hide != null && fuzerenSiteName_hide != "") {
        reqmsg += "\"siteName\":\"" + fuzerenSiteName_hide + "\",";
	}
	
	var fuwusflx_search = $("#fuwusflx_search").val();
	if(fuwusflx_search == "医保"){
		reqmsg += "\"healthInsurance\":1,";
		reqmsg += "\"price\":" + fwxminput_YBPRICE4_hide + ",";
	}else{
		reqmsg += "\"healthInsurance\":2,";
		reqmsg += "\"price\":" + fwxminput_SCPRICE4_hide + ",";
	}
	

	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	reqmsg += "\"addPerson\":\"" + name + "\",";
	reqmsg += "\"addTime\":\"" + getNowFormatDate2() + "\",";
	
	if (fwxminput_Id4_hide != null && fwxminput_Id4_hide != "") {
        reqmsg += "\"serviceTask_service_list\":[{";
        reqmsg += "\"serviceId\":" + fwxminput_Id4_hide + "," ;
        reqmsg += "\"fuwuSonNames\":\"" + fuwuzixianginput_search + "\",";
        reqmsg += "\"yjfuwuTime\":\"" + yjfwsc + "分钟\",";
        reqmsg += "}]," ;
	}
	
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "\"chargeEmployeeId\":" + fuzerenId_hide +",";
	}
	
	reqmsg += "\"serviceEmployeeList\":[" ;
	if (fuzerenId_hide != null && fuzerenId_hide != "") {
		reqmsg += "{\"employeeId\":" + fuzerenId_hide +",";
		reqmsg += "\"name\":\"" + fuzerenName_hide +"\",";
		reqmsg += "\"employeeCode\":\"" + fuzerenBH_hide +"\",";
		reqmsg += "\"role\":\"" + fuzerenRole_hide +"\",";
		reqmsg += "\"type\":1},";
	}
	if(canyurenArray != null && canyurenArray != ""){
		for(var i = 0;i < canyurenArray.length;i++){
			var nameroles = getcyrNameRole(canyurenArray[i]);
			reqmsg += "{\"employeeId\":" + canyurenArray[i] +",";
			if(nameroles.split("||").length == 3){
				reqmsg += "\"name\":\"" + nameroles.split("||")[0] +"\",";
				reqmsg += "\"role\":\"" + nameroles.split("||")[1] +"\",";
				reqmsg += "\"employeeCode\":\"" + nameroles.split("||")[2] +"\",";
			}
			reqmsg += "\"type\":2},";
		}
	}
	reqmsg += "],";
	
	reqmsg += "\"serviceLogList\":[" ;
	reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
	reqmsg += "\"createPerson\":\"" + name +"\",";
	reqmsg += "\"type\":\"新增工单\",";
	reqmsg += "\"log\":\"" + name + "新增了工单\"}";
	reqmsg += "],";
	
	reqmsg=reqmsg.substr(0,reqmsg.length-1);
	reqmsg += "}}";

	jQuery.ajax({
          type : "post",
          async:false,
          url : "serviceTask.do?handler",
          dataType : "json",
          data: {
               "reqmsg":reqmsg
          },
          success : function(data){
              if(data.des=="success"){
              	flag = 1;
              	//alert("保存成功");
              }else if(data.des=="failure"){
                 alert("保存失败");
              }else{
              	alert(data.des);
              }
          },
          error:function(){
	           alert("error");
          }
     });
     return flag;
}
//重置新增服务工单弹窗
function qingkongXZ(){
	$("#olderId_hide").val("");
	$("#oldinput_search2").val("");
	$("#oldinput_contentName").val("");
	$("#oldinput_contentTel").val("");
	$("#oldinput_contentAddress").val("");
	
	//$("#fuzerenId_hide").val("");
	//$("#fuzerenSiteId_hide").val("");
	//$("#fuzerenSiteName_hide").val("");
	//$("#fuzerenName_hide").val("");
	//$("#fuzerenRole_hide").val("");
	//$("#fuzerenBH_hide").val("");
	
	//$("#fprinput_search").val("");
	
	$("#cyrinput_search").val("").trigger("change");
	
	$("#fwxminput_search4").val("");
	$("#fwxminput_Id4_hide").val("");
	$("#fwxminput_SCPRICE4_hide").val("");
	$("#fwxminput_YBPRICE4_hide").val("");
	
	var html = "";
	html += "<tr id=\"addshuizhong\">";			
	html += "<td> </td>";					
	html += "<td style=\"text-align:right\"><a class=\"label btn-primary \" onclick=\"addshuizhong();\"><i class=\"fa fa-plus\"></i></a> </td>";								
	html += "</tr>";								
	$("#yujiFWDate").html(html);	
	
	$("#fuwuzixianginput_search").html("");
	$("#fuwuzixianginput_search").val("").trigger("change");
	$("#yjfwsc").val("");	
	
	$("#fuwusflx_search").val("医保");	
	$("#fuwusfjg_search").html("暂无");						
}

//取消服务工单-弹窗出现
function quxiao_qingkong(){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	$("#beizhu_input_quxiao").val("");
	var selectedItemNumber = $("tbody .col_selector5:checked").length;
	if (selectedItemNumber < 1) {
		alert("请选择要取消的数据");
		return;
	}else{
		$("#idForQX").val("");
		$("#quxiao_open5").click();
	}
}
function quxiao_qingkong2(id){
	var name = $("#addUserName").val();
	if(name == "" || name == null){
		alert("当前非员工,无法操作");
		return;
	}
	$("#beizhu_input_quxiao").val("");
	$("#quxiao_open5").click();
	$("#idForQX").val(id);
}
//操作取消服务工单
function sureQuxiao() {
	var beizhu_input_quxiao = $("#beizhu_input_quxiao").val();
	if(beizhu_input_quxiao != null && beizhu_input_quxiao != ""){
		if(beizhu_input_quxiao.length > 200){
			alert("备注超出字数限制200字");
			return;
		}
	}
	var name = $("#addUserName").val();
	var reqmsg="{'action':'ADD_SERVICE_TASK_INFO_REQUEST','content':{";
	
	var idForQX = $("#idForQX").val();
	if(idForQX != null && idForQX != ""){//单个
		 reqmsg += "\"id\":" + idForQX + ",";
	}else{
		var selectedItemNumber = $("tbody .col_selector5:checked").length;
		if (selectedItemNumber >= 1) {
			var ids2del = "";
			$("tbody .col_selector5:checked").each(function() {
				ids2del += $(this).val() + ",";
			});
			if (ids2del != "") {
				ids2del = ids2del.substring(0, ids2del.length - 1);
			}
		  
			if (ids2del != null && ids2del != "") {
        		reqmsg += "\"ids2del\":\"" + ids2del + "\",";
			}
		} else {
			alert("请选择要取消的数据");
			return;
		}
	}
	
		reqmsg += "\"status\":1,";
	
		reqmsg += "\"serviceLogList\":[" ;
		reqmsg += "{\"createTime\":\"" + getNowFormatDate2() +"\",";
		reqmsg += "\"createPerson\":\"" + name +"\",";
		reqmsg += "\"type\":\"取消工单\",";
		if(beizhu_input_quxiao == null || beizhu_input_quxiao == ""){
			reqmsg += "\"log\":\"" + name + "取消了工单\"}";
		}else{
			reqmsg += "\"log\":\"" + beizhu_input_quxiao + "\"}";
		}
		reqmsg += "],";
	
		reqmsg += "}}";
		
		jQuery.ajax({
         	 type : "post",
         	 async:false,
         	 url : "serviceTask.do?handler",
        	  dataType : "json",
        	  data: {
        	       "reqmsg":reqmsg
        	  },
         	 success : function(data){
         	     if(data.result == "100"){
         	     	go2page5(currentshownpage5);
         	     	alert("取消工单成功");
         	     	$("#quxiao_tanchuang").click();
         	     }else{
         	        alert("取消工单失败");
         	        $("#quxiao_tanchuang").click();
         	     }
         	 },
         	 error:function(){
	     	      alert("error");
          	}
     	});
}
    </script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
  <script src="js/behaviour/voice-commands.js"></script>
  <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
</body>
</html>
