package fsk.parse.medicalHistory;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import com.framework.system.util.JsonUtil;

import javax.servlet.http.HttpServletRequest;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.apache.log4j.Logger;
import fsk.entity.medicalHistory.MedicalHistoryEntity;



import fsk.entity.caseRecord.CaseRecordEntity;

import com.framework.system.util.JsonUtil;
import com.framework.system.db.query.OrderVO;
 /**   
 * @Title: Parse
 * @Description: 既往病史解析器
 * @author feng.gu
 * @date 2016-07-19 11:09:36
 * @version V1.0   
 *
 */
public class MedicalHistoryParse {
	private static Logger logger = Logger.getLogger(MedicalHistoryParse.class);
	private static MedicalHistoryParse medicalHistoryParse;

	/**
	 * 获取实例
	 * 
	 * @return
	 */
	public static MedicalHistoryParse getInstance() {
		if (medicalHistoryParse == null) {
			medicalHistoryParse = new MedicalHistoryParse();
		}
		return medicalHistoryParse;
	}

	public Map<String, Object> parse(int type, String command,String reqStr,
			HttpServletRequest request) {
		// 定义返回参数
		Map<String, Object> parseMap = new HashMap<String, Object>();
		if (type == 1) {
			// json
			parseMap = this.parseByJson(command,reqStr, request);
		} else if (type == 2) {
			// xml
			parseMap = this.parseByXml(command,reqStr, request);
		}
		return parseMap;
	}

	private Map<String, Object> parseByJson(String command,String reqStr,
			HttpServletRequest request) {
		// 定义返回参数
		Map<String, Object> parseMap = new HashMap<String, Object>();
		try {
			String actionReturn = null;
			MedicalHistoryEntity medicalHistoryReturn = null;
			List<MedicalHistoryEntity> medicalHistoryListReturn = null;
			Integer idReturn = null;			
			Map<String, Object> queryMapReturn = null;
			int pagenoReturn = 1;
			int pagesizeReturn = 10;
			List<OrderVO> orderListReturn = null;
			
															Boolean caseRecordShowReturn = false;
			Boolean delCaseRecordReturn = false;
															
			//json
			Map reqParams = JsonUtil.getMap4Json(reqStr);
			JSONObject contentreq = (JSONObject)reqParams.get("content");
			if ("ADD_MEDICAL_HISTORY_INFO_REQUEST".equals(command)) {
				actionReturn = "save";
				medicalHistoryReturn = new MedicalHistoryEntity();
				if(true){
					if(contentreq!=null){
												    						    Integer id = (Integer)contentreq.get("id");
	                		if(id!=null){
			                	medicalHistoryReturn.setId(id);
			                }
						    												    						    Integer caseRecordId = (Integer)contentreq.get("caseRecordId");
	                		if(caseRecordId!=null){
			                	medicalHistoryReturn.setCaseRecordId(caseRecordId);
			                }
						    												    						    String disease = (String)contentreq.get("disease");
	                		if(disease!=null){
			                	medicalHistoryReturn.setDisease(disease);
			                }
						    												    						    String diseaseCourse = (String)contentreq.get("diseaseCourse");
	                		if(diseaseCourse!=null){
			                	medicalHistoryReturn.setDiseaseCourse(diseaseCourse);
			                }
						    												    						    String mainTreatment = (String)contentreq.get("mainTreatment");
	                		if(mainTreatment!=null){
			                	medicalHistoryReturn.setMainTreatment(mainTreatment);
			                }
						    												    						    String diseaseControl = (String)contentreq.get("diseaseControl");
	                		if(diseaseControl!=null){
			                	medicalHistoryReturn.setDiseaseControl(diseaseControl);
			                }
						    												    						    String other = (String)contentreq.get("other");
	                		if(other!=null){
			                	medicalHistoryReturn.setOther(other);
			                }
						    											}					
				}
																				if(true){
					Object caseRecord = contentreq.get("caseRecord");
					if(caseRecord!=null){
						JSONObject obj = (JSONObject)caseRecord;
						if(obj!=null){
							CaseRecordEntity entity = new CaseRecordEntity();						
																						    Integer id = (Integer)obj.get("id");
		                		if(id!=null){
				                	entity.setId(id);
				                }
							    																						    Integer olderId = (Integer)obj.get("olderId");
		                		if(olderId!=null){
				                	entity.setOlderId(olderId);
				                }
							    																						    String recoveryTime = (String)obj.get("recoveryTime");
		                		if(recoveryTime!=null){
				                	entity.setRecoveryTime(recoveryTime);
				                }
							    																						    String other = (String)obj.get("other");
		                		if(other!=null){
				                	entity.setOther(other);
				                }
							    																						    String des = (String)obj.get("des");
		                		if(des!=null){
				                	entity.setDes(des);
				                }
							    																						    String assessmentPerson = (String)obj.get("assessmentPerson");
		                		if(assessmentPerson!=null){
				                	entity.setAssessmentPerson(assessmentPerson);
				                }
							    																						    String assessmentTime = (String)obj.get("assessmentTime");
		                		if(assessmentTime!=null){
				                	entity.setAssessmentTime(assessmentTime);
				                }
							    														medicalHistoryReturn.setCaseRecord(entity);
						}						
					}
				}
																			} else if ("QUERY_MEDICAL_HISTORY_INFO_REQUEST".equals(command)) {
				actionReturn = "getById";
				if(true){
					if(contentreq!=null){
						idReturn = (Integer)contentreq.get("id");
					        																												String caseRecordShow = (String)contentreq.get("caseRecordShow");
							if("true".equals(caseRecordShow)){
								caseRecordShowReturn = true;
							}
																																	}	
				}
			} else if ("QUERY_MEDICAL_HISTORY_LIST_REQUEST".equals(command)) {
				actionReturn = "getListByCondition";
				if(true){
					if(contentreq!=null){
						queryMapReturn = new HashMap<String, Object>();
																		Integer id_gt = (Integer)contentreq.get("id_gt");
						Integer id_ge = (Integer)contentreq.get("id_ge");
						Integer id_lt = (Integer)contentreq.get("id_lt");
						Integer id_le = (Integer)contentreq.get("id_le");
						String id_in = (String)contentreq.get("id_in");
						Integer id = (Integer)contentreq.get("id");
                        if(id_gt!=null){
                        	queryMapReturn.put("id_gt", id_gt);
						}
						if(id_ge!=null){
                        	queryMapReturn.put("id_ge", id_ge);
						}
						if(id_lt!=null){
                        	queryMapReturn.put("id_lt", id_lt);
						}
						if(id_le!=null){
                        	queryMapReturn.put("id_le", id_le);
						}
						if(id_in!=null){
                        	queryMapReturn.put("id_in", id_in);
						}
						if(id!=null){
                        	queryMapReturn.put("id", id);
						}		
																								Integer caseRecordId_gt = (Integer)contentreq.get("caseRecordId_gt");
						Integer caseRecordId_ge = (Integer)contentreq.get("caseRecordId_ge");
						Integer caseRecordId_lt = (Integer)contentreq.get("caseRecordId_lt");
						Integer caseRecordId_le = (Integer)contentreq.get("caseRecordId_le");
						String caseRecordId_in = (String)contentreq.get("caseRecordId_in");
						Integer caseRecordId = (Integer)contentreq.get("caseRecordId");
                        if(caseRecordId_gt!=null){
                        	queryMapReturn.put("caseRecordId_gt", caseRecordId_gt);
						}
						if(caseRecordId_ge!=null){
                        	queryMapReturn.put("caseRecordId_ge", caseRecordId_ge);
						}
						if(caseRecordId_lt!=null){
                        	queryMapReturn.put("caseRecordId_lt", caseRecordId_lt);
						}
						if(caseRecordId_le!=null){
                        	queryMapReturn.put("caseRecordId_le", caseRecordId_le);
						}
						if(caseRecordId_in!=null){
                        	queryMapReturn.put("caseRecordId_in", caseRecordId_in);
						}
						if(caseRecordId!=null){
                        	queryMapReturn.put("caseRecordId", caseRecordId);
						}		
																																String disease_like = (String)contentreq.get("disease_like");
							String disease_isNull = (String)contentreq.get("disease_isNull");
							String disease_isNotNull = (String)contentreq.get("disease_isNotNull");
							String disease_in = (String)contentreq.get("disease_in");
							String disease = (String)contentreq.get("disease");
							if(disease_like!=null){
	                        	queryMapReturn.put("disease_like", disease_like);
							}
							if(disease_isNull!=null){
	                        	queryMapReturn.put("disease_isNull", disease_isNull);
							}
							if(disease_isNotNull!=null){
	                        	queryMapReturn.put("disease_isNotNull", disease_isNotNull);
							}
							if(disease_in!=null){
	                        	queryMapReturn.put("disease_in", disease_in);
							}
							if(disease!=null){
	                        	queryMapReturn.put("disease", disease);
							}						           
																																							String diseaseCourse_like = (String)contentreq.get("diseaseCourse_like");
							String diseaseCourse_isNull = (String)contentreq.get("diseaseCourse_isNull");
							String diseaseCourse_isNotNull = (String)contentreq.get("diseaseCourse_isNotNull");
							String diseaseCourse_in = (String)contentreq.get("diseaseCourse_in");
							String diseaseCourse = (String)contentreq.get("diseaseCourse");
							if(diseaseCourse_like!=null){
	                        	queryMapReturn.put("diseaseCourse_like", diseaseCourse_like);
							}
							if(diseaseCourse_isNull!=null){
	                        	queryMapReturn.put("diseaseCourse_isNull", diseaseCourse_isNull);
							}
							if(diseaseCourse_isNotNull!=null){
	                        	queryMapReturn.put("diseaseCourse_isNotNull", diseaseCourse_isNotNull);
							}
							if(diseaseCourse_in!=null){
	                        	queryMapReturn.put("diseaseCourse_in", diseaseCourse_in);
							}
							if(diseaseCourse!=null){
	                        	queryMapReturn.put("diseaseCourse", diseaseCourse);
							}						           
																																							String mainTreatment_like = (String)contentreq.get("mainTreatment_like");
							String mainTreatment_isNull = (String)contentreq.get("mainTreatment_isNull");
							String mainTreatment_isNotNull = (String)contentreq.get("mainTreatment_isNotNull");
							String mainTreatment_in = (String)contentreq.get("mainTreatment_in");
							String mainTreatment = (String)contentreq.get("mainTreatment");
							if(mainTreatment_like!=null){
	                        	queryMapReturn.put("mainTreatment_like", mainTreatment_like);
							}
							if(mainTreatment_isNull!=null){
	                        	queryMapReturn.put("mainTreatment_isNull", mainTreatment_isNull);
							}
							if(mainTreatment_isNotNull!=null){
	                        	queryMapReturn.put("mainTreatment_isNotNull", mainTreatment_isNotNull);
							}
							if(mainTreatment_in!=null){
	                        	queryMapReturn.put("mainTreatment_in", mainTreatment_in);
							}
							if(mainTreatment!=null){
	                        	queryMapReturn.put("mainTreatment", mainTreatment);
							}						           
																																							String diseaseControl_like = (String)contentreq.get("diseaseControl_like");
							String diseaseControl_isNull = (String)contentreq.get("diseaseControl_isNull");
							String diseaseControl_isNotNull = (String)contentreq.get("diseaseControl_isNotNull");
							String diseaseControl_in = (String)contentreq.get("diseaseControl_in");
							String diseaseControl = (String)contentreq.get("diseaseControl");
							if(diseaseControl_like!=null){
	                        	queryMapReturn.put("diseaseControl_like", diseaseControl_like);
							}
							if(diseaseControl_isNull!=null){
	                        	queryMapReturn.put("diseaseControl_isNull", diseaseControl_isNull);
							}
							if(diseaseControl_isNotNull!=null){
	                        	queryMapReturn.put("diseaseControl_isNotNull", diseaseControl_isNotNull);
							}
							if(diseaseControl_in!=null){
	                        	queryMapReturn.put("diseaseControl_in", diseaseControl_in);
							}
							if(diseaseControl!=null){
	                        	queryMapReturn.put("diseaseControl", diseaseControl);
							}						           
																																							String other_like = (String)contentreq.get("other_like");
							String other_isNull = (String)contentreq.get("other_isNull");
							String other_isNotNull = (String)contentreq.get("other_isNotNull");
							String other_in = (String)contentreq.get("other_in");
							String other = (String)contentreq.get("other");
							if(other_like!=null){
	                        	queryMapReturn.put("other_like", other_like);
							}
							if(other_isNull!=null){
	                        	queryMapReturn.put("other_isNull", other_isNull);
							}
							if(other_isNotNull!=null){
	                        	queryMapReturn.put("other_isNotNull", other_isNotNull);
							}
							if(other_in!=null){
	                        	queryMapReturn.put("other_in", other_in);
							}
							if(other!=null){
	                        	queryMapReturn.put("other", other);
							}						           
																						
						    																												
																																			String caseRecordShow = (String)contentreq.get("caseRecordShow");
							if("true".equals(caseRecordShow)){
								caseRecordShowReturn = true;
							}
																																	}
					JSONObject pagereq = (JSONObject)reqParams.get("page");
				    if (pagereq != null) {
				    String pagenotemp = (String)pagereq.get("pageno");
				    String pagesizetemp = (String)pagereq.get("pagesize");
				    if ((pagenotemp != null) && (!"".equals(pagenotemp.trim()))) {
				          pagenoReturn = Integer.valueOf(pagenotemp).intValue();
				    }
				    if ((pagesizetemp != null) && (!"".equals(pagesizetemp.trim()))) {
				          pagesizeReturn = Integer.valueOf(pagesizetemp).intValue();
				        }
				    }
				    Object orderreq = (Object) reqParams.get("order");
					if (orderreq != null) {
						JSONArray order = (JSONArray)orderreq;
						orderListReturn = new ArrayList<OrderVO>();
						for(int i=0;i<order.size();i++){
							JSONObject obj = order.getJSONObject(i);
							OrderVO orderVO = new OrderVO();
							orderVO.setName((String)obj.get("column"));
							orderVO.setOrderType((String)obj.get("type"));
							orderListReturn.add(orderVO);
						}						
					}
				}
			} else if ("DEL_MEDICAL_HISTORY_INFO_REQUEST".equals(command)) {
				actionReturn = "del";
				if(true){
					if(contentreq!=null){
						idReturn = (Integer)contentreq.get("id");	
						    																												String delCaseRecord = (String)contentreq.get("delCaseRecord");
							if("true".equals(delCaseRecord)){
								delCaseRecordReturn = true;
							}
																																	}	
				}
			} else if ("DEL_MEDICAL_HISTORY_LIST_REQUEST".equals(command)) {
				actionReturn = "delList";
				if(true){
					if(contentreq!=null){
						queryMapReturn = new HashMap<String, Object>();
																		Integer id_gt = (Integer)contentreq.get("id_gt");
						Integer id_ge = (Integer)contentreq.get("id_ge");
						Integer id_lt = (Integer)contentreq.get("id_lt");
						Integer id_le = (Integer)contentreq.get("id_le");
						String id_in = (String)contentreq.get("id_in");
						Integer id = (Integer)contentreq.get("id");
                        if(id_gt!=null){
                        	queryMapReturn.put("id_gt", id_gt);
						}
						if(id_ge!=null){
                        	queryMapReturn.put("id_ge", id_ge);
						}
						if(id_lt!=null){
                        	queryMapReturn.put("id_lt", id_lt);
						}
						if(id_le!=null){
                        	queryMapReturn.put("id_le", id_le);
						}
						if(id_in!=null){
                        	queryMapReturn.put("id_in", id_in);
						}
						if(id!=null){
                        	queryMapReturn.put("id", id);
						}		
																								Integer caseRecordId_gt = (Integer)contentreq.get("caseRecordId_gt");
						Integer caseRecordId_ge = (Integer)contentreq.get("caseRecordId_ge");
						Integer caseRecordId_lt = (Integer)contentreq.get("caseRecordId_lt");
						Integer caseRecordId_le = (Integer)contentreq.get("caseRecordId_le");
						String caseRecordId_in = (String)contentreq.get("caseRecordId_in");
						Integer caseRecordId = (Integer)contentreq.get("caseRecordId");
                        if(caseRecordId_gt!=null){
                        	queryMapReturn.put("caseRecordId_gt", caseRecordId_gt);
						}
						if(caseRecordId_ge!=null){
                        	queryMapReturn.put("caseRecordId_ge", caseRecordId_ge);
						}
						if(caseRecordId_lt!=null){
                        	queryMapReturn.put("caseRecordId_lt", caseRecordId_lt);
						}
						if(caseRecordId_le!=null){
                        	queryMapReturn.put("caseRecordId_le", caseRecordId_le);
						}
						if(caseRecordId_in!=null){
                        	queryMapReturn.put("caseRecordId_in", caseRecordId_in);
						}
						if(caseRecordId!=null){
                        	queryMapReturn.put("caseRecordId", caseRecordId);
						}		
																																String disease_like = (String)contentreq.get("disease_like");
							String disease_isNull = (String)contentreq.get("disease_isNull");
							String disease_isNotNull = (String)contentreq.get("disease_isNotNull");
							String disease_in = (String)contentreq.get("disease_in");
							String disease = (String)contentreq.get("disease");
							if(disease_like!=null){
	                        	queryMapReturn.put("disease_like", disease_like);
							}
							if(disease_isNull!=null){
	                        	queryMapReturn.put("disease_isNull", disease_isNull);
							}
							if(disease_isNotNull!=null){
	                        	queryMapReturn.put("disease_isNotNull", disease_isNotNull);
							}
							if(disease_in!=null){
	                        	queryMapReturn.put("disease_in", disease_in);
							}
							if(disease!=null){
	                        	queryMapReturn.put("disease", disease);
							}						           
																																							String diseaseCourse_like = (String)contentreq.get("diseaseCourse_like");
							String diseaseCourse_isNull = (String)contentreq.get("diseaseCourse_isNull");
							String diseaseCourse_isNotNull = (String)contentreq.get("diseaseCourse_isNotNull");
							String diseaseCourse_in = (String)contentreq.get("diseaseCourse_in");
							String diseaseCourse = (String)contentreq.get("diseaseCourse");
							if(diseaseCourse_like!=null){
	                        	queryMapReturn.put("diseaseCourse_like", diseaseCourse_like);
							}
							if(diseaseCourse_isNull!=null){
	                        	queryMapReturn.put("diseaseCourse_isNull", diseaseCourse_isNull);
							}
							if(diseaseCourse_isNotNull!=null){
	                        	queryMapReturn.put("diseaseCourse_isNotNull", diseaseCourse_isNotNull);
							}
							if(diseaseCourse_in!=null){
	                        	queryMapReturn.put("diseaseCourse_in", diseaseCourse_in);
							}
							if(diseaseCourse!=null){
	                        	queryMapReturn.put("diseaseCourse", diseaseCourse);
							}						           
																																							String mainTreatment_like = (String)contentreq.get("mainTreatment_like");
							String mainTreatment_isNull = (String)contentreq.get("mainTreatment_isNull");
							String mainTreatment_isNotNull = (String)contentreq.get("mainTreatment_isNotNull");
							String mainTreatment_in = (String)contentreq.get("mainTreatment_in");
							String mainTreatment = (String)contentreq.get("mainTreatment");
							if(mainTreatment_like!=null){
	                        	queryMapReturn.put("mainTreatment_like", mainTreatment_like);
							}
							if(mainTreatment_isNull!=null){
	                        	queryMapReturn.put("mainTreatment_isNull", mainTreatment_isNull);
							}
							if(mainTreatment_isNotNull!=null){
	                        	queryMapReturn.put("mainTreatment_isNotNull", mainTreatment_isNotNull);
							}
							if(mainTreatment_in!=null){
	                        	queryMapReturn.put("mainTreatment_in", mainTreatment_in);
							}
							if(mainTreatment!=null){
	                        	queryMapReturn.put("mainTreatment", mainTreatment);
							}						           
																																							String diseaseControl_like = (String)contentreq.get("diseaseControl_like");
							String diseaseControl_isNull = (String)contentreq.get("diseaseControl_isNull");
							String diseaseControl_isNotNull = (String)contentreq.get("diseaseControl_isNotNull");
							String diseaseControl_in = (String)contentreq.get("diseaseControl_in");
							String diseaseControl = (String)contentreq.get("diseaseControl");
							if(diseaseControl_like!=null){
	                        	queryMapReturn.put("diseaseControl_like", diseaseControl_like);
							}
							if(diseaseControl_isNull!=null){
	                        	queryMapReturn.put("diseaseControl_isNull", diseaseControl_isNull);
							}
							if(diseaseControl_isNotNull!=null){
	                        	queryMapReturn.put("diseaseControl_isNotNull", diseaseControl_isNotNull);
							}
							if(diseaseControl_in!=null){
	                        	queryMapReturn.put("diseaseControl_in", diseaseControl_in);
							}
							if(diseaseControl!=null){
	                        	queryMapReturn.put("diseaseControl", diseaseControl);
							}						           
																																							String other_like = (String)contentreq.get("other_like");
							String other_isNull = (String)contentreq.get("other_isNull");
							String other_isNotNull = (String)contentreq.get("other_isNotNull");
							String other_in = (String)contentreq.get("other_in");
							String other = (String)contentreq.get("other");
							if(other_like!=null){
	                        	queryMapReturn.put("other_like", other_like);
							}
							if(other_isNull!=null){
	                        	queryMapReturn.put("other_isNull", other_isNull);
							}
							if(other_isNotNull!=null){
	                        	queryMapReturn.put("other_isNotNull", other_isNotNull);
							}
							if(other_in!=null){
	                        	queryMapReturn.put("other_in", other_in);
							}
							if(other!=null){
	                        	queryMapReturn.put("other", other);
							}						           
																									
																														String delCaseRecord = (String)contentreq.get("delCaseRecord");
						if("true".equals(delCaseRecord)){
							delCaseRecordReturn = true;
						}
																													}
					JSONObject pagereq = (JSONObject)reqParams.get("page");
				    if (pagereq != null) {
				    String pagenotemp = (String)pagereq.get("pageno");
				    String pagesizetemp = (String)pagereq.get("pagesize");
				    if ((pagenotemp != null) && (!"".equals(pagenotemp.trim()))) {
				          pagenoReturn = Integer.valueOf(pagenotemp).intValue();
				    }
				    if ((pagesizetemp != null) && (!"".equals(pagesizetemp.trim()))) {
				          pagesizeReturn = Integer.valueOf(pagesizetemp).intValue();
				        }
				    }
				}
			}

			if (actionReturn != null && !"".equals(actionReturn)) {
				parseMap.put("action", actionReturn);
			}
			if (medicalHistoryReturn != null) {
				parseMap.put("medicalHistory", medicalHistoryReturn);
			}
			if (medicalHistoryListReturn != null && medicalHistoryListReturn.size() > 0) {
				parseMap.put("medicalHistoryList", medicalHistoryListReturn);
			}
			if (idReturn != null) {
				parseMap.put("id", idReturn);
			}	
			if (orderListReturn != null && orderListReturn.size() > 0) {
				parseMap.put("orderList", orderListReturn);
			}		
			if (queryMapReturn != null) {
				parseMap.put("queryMap", queryMapReturn);
			}
			if (pagenoReturn > 0) {
				parseMap.put("pageno", pagenoReturn);
			}
			if (pagesizeReturn > 0) {
				parseMap.put("pagesize", pagesizeReturn);
			}
			
			
															if (caseRecordShowReturn != null) {
				parseMap.put("caseRecordShow", caseRecordShowReturn);
			}
			if (delCaseRecordReturn != null) {
				parseMap.put("delCaseRecord", delCaseRecordReturn);
			}
															
			
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			logger.error(e);
		}
		return parseMap;
	}

	private Map<String, Object> parseByXml(String command,String reqStr,
			HttpServletRequest request) {
		// TODO Auto-generated method stub
		return null;
	}
}
