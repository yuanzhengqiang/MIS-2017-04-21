<%@ page contentType="text/html;charset=UTF-8" language="java"%> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%> 
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>交接班列表</title>
  
  	<link rel="shortcut icon" href="images/logo.png">	
    <!-- Bootstrap core CSS -->
    <link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
	<link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />
 	<link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
  	<link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
	<link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
	<link rel="stylesheet" type="text/css" href="js/intro.js/introjs.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
	<link rel="stylesheet" type="text/css" href="js/jquery.datatables/bootstrap-adapter/css/datatables.css" />
	<script type="text/javascript" src="js/sortListTool.js"></script>
  	<!-- Custom styles for this template -->
  	<link href="css/style.css" rel="stylesheet" />
  	<style type="text/css">
  	body{
		margin-left: 0px;
		opacity: 1; 
	}
	.hideul{
		position:absolute;
		top:33px;
		right:15px;
		left:15px;
		display:none;
		z-index:200;
	}
	.hideul ul{ 
		width:100%;
		padding-left:0;
		background:#f4f4f4;
		border:1px solid #ccc;
	}
	.hideul ul li{ 
		list-style-type:none;
		text-indent:20px
	}
	.height34{
		vertical-align: middle; 
		height: 34px; 
		line-height: 34px;
	}
	.button-query{
		margin-bottom: 0px !important; 
		height: 34px;
		margin-left:0;
	}
	.query-a{
		cursor:pointer;
		text-decoration:underline;
		vertical-align:bottom;
	}
	.hideul ul li:hover{ background:#ddd;}
	.hideAndShow{display:none;}
	.margin-b5{margin-bottom:5px;}
	.margin-b10{margin-bottom:10px;}
	</style>
</head>
<body>
	<div style="width: 100%; height: 100%;">
		<div class="container-fluid" style="padding: 0px">
		<!-- 头部开始 -->
			<div class="page-head">
				<h2 id="head_oldSum">交接班列表</h2>
				<ol class="breadcrumb">
					<li>内部管理</li>
					<input type="hidden" value="" id="sortType">
					<input type="hidden" value="" id="sortColumn">
					<li class="active">交接班列表</li>
				</ol>
			</div>
		</div>
		<!-- 头部结束 -->

		<div class="cl-mcont">
			<div class="row">
				<div class="col-md-12">
					<div class="block-flat">
						<div class="content">
							<div class="table-responsive">
								<div class="dataTables_wrapper form-inline">
								    <!-- 查询框开始 -->
									<div class="row">
										<div class="col-sm-2 height34">
											<label>交接班编号</label>
										</div>
										<div class="col-sm-4 margin-b10">
											<input class="form-control" type="text" style="width: 100%" id="serialNumber">
										</div>
										<div class="col-sm-2 height34">
											<label>服务站点</label>
										</div>
										<div class="col-sm-4 margin-b10">
											<select class="form-control" type="text" id="serviceSite" style="width: 100%;" >
												
											</select>
										</div>
										<div class="col-sm-2 height34">
											<label>交接班时间区间</label>
										</div>
										<div class="col-sm-4 margin-b5">
											<div class="input-group">
												<input class="form-control datetime" size="16" id="createTimeStartDate" placeholder="开始时间" type="text" readonly /> 
												<span class="input-group-btn">
													<button class="btn btn-danger deleteThisTime" type="button">
														<span class="fa fa-times"></span>
													</button> 
												</span>
											</div>
										</div>
										<div class="col-sm-2 height34">
										</div>
										<div class="col-sm-4 margin-b5">
											<div class="input-group">
												<input class="form-control datetime" size="16" id="createTimeEndDate" placeholder="结束时间" type="text" readonly /> 
												<span class="input-group-btn">
													<button class="btn btn-danger deleteThisTime" type="button">
														<span class="fa fa-times"></span>
													</button> 
												</span>
											</div>
										</div>
										<div class="col-sm-2 hideAndShow height34">
											<label>接班人</label>
										</div>
										<div class="col-sm-4 hideAndShow margin-b10">
											<div class="input-group " >
												<input class="form-control"  type="text" id="receiveEmployee" oninput="getjiebrName()" onmouseout="javascript:$('#hideul-1').hide();" onmouseover="javascript:$('#hideul-1').show();">
												<input type="hidden" type="text" id="receiveEmployeeId" >
												<span class="input-group-btn"><button class="btn btn-primary"  onclick="getjiebrName()" type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-1"  onmouseover="javascript:$('#hideul-1').show();" onmouseout="javascript:$('#hideul-1').hide();">
												<ul id="hideul_nei1">
												
												</ul>
											</div>
										</div>
										<div class="col-sm-2 hideAndShow height34">
											<label>交班人</label>
										</div>
										<div class="col-sm-4 hideAndShow margin-b10">
											<div class="input-group " >
												<input class="form-control"  type="text" id="sendEmployee" oninput="getjiaobrName()" onmouseout="javascript:$('#hideul-2').hide();" onmouseover="javascript:$('#hideul-2').show();">
												<input type="hidden" type="text" id="sendEmployeeId" >
												<span class="input-group-btn"><button class="btn btn-primary "  onclick="getjiaobrName()" type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-2"  onmouseover="javascript:$('#hideul-2').show();" onmouseout="javascript:$('#hideul-2').hide();">
												<ul id="hideul_nei2">
												
												</ul>
											</div>
										</div>
										<div class="col-sm-2 hideAndShow height34">
											<label>监督人</label>
										</div>
										<div class="col-sm-4 hideAndShow margin-b10">
											<div class="input-group " >
												<input class="form-control"  type="text" id="superviseEmployee"oninput="getjiandrName()" onmouseout="javascript:$('#hideul-3').hide();" onmouseover="javascript:$('#hideul-3').show();">
												<input type="hidden" type="text" id="superviseEmployeeId" >
												<span class="input-group-btn"><button class="btn btn-primary "  onclick="getjiandrName()"  type="button"><span class="fa fa-search"></span></button></span>
											</div>
											<div class="hideul" id="hideul-3"  onmouseover="javascript:$('#hideul-3').show();" onmouseout="javascript:$('#hideul-3').hide();">
												<ul id="hideul_nei3">
												
												</ul>
											</div>
										</div>
									</div>
									<!-- 查询框结束 -->
									<!-- 操作按钮开始 -->
									<div class="row">
										<div class="col-sm-12">
											<c:if test="${sendReserviceList_query_btn_control != 'yes' or sendReserviceList_query_btn_show == 'yes'}">
												<button class="btn btn-primary button-query" onclick="go2page(1)">查询</button>
											</c:if>
											<a class="query-a" onclick="$('.hideAndShow').toggle();">更多查询条件</a>
										</div>
									</div>
									<!-- 操作按钮结束 -->
                                    <!-- 数据表格开始 -->
									<div class="row">
										<div class="col-sm-12">							
											<table class="table table-bordered dataTable hover" id="datatable" aria-describedby="datatable_info">
												<thead>
													<tr role="row">
														<th name="needSort" class="sorting" onclick="queryBySort(this,'serialNumber')"><strong>交接班编号</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_serviceSiteName')"><strong>服务站点</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_sendEmployeeName')"><strong>交班人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_receiveEmployeeName')"><strong>接班人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'chinese_superviseEmployeeName')"><strong>监督人</strong></th>
														<th name="needSort" class="sorting" onclick="queryBySort(this,'createTime')"><strong>交接班时间</strong></th>
														<th><strong>操作</strong></th>
													</tr>
												</thead>
												<tbody id="datacontainer" role="alert" aria-live="polite" aria-relevant="all">																														
												</tbody>
											</table>
										</div>
									</div>
									<!-- 数据表格结束 -->
								    <!-- 数据条数提示开始 -->
									<div class="row">
										<div class="col-sm-12">
											<div class="pull-left">
												<div id="datatable_info" class="dataTables_info">
													当前显示0 条总记录中的第0-0条
												</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
									<!-- 数据条数提示结束 -->
								    <!-- 分页条开始 -->
									<div class="row">
										<div class="col-sm-4">
											<div class="dataTables_length" id="datatable2_length">
												<label style="margin-top:18px;">每页 <select id="pageSizeSelector" onchange="go2page('1')" class="form-control" aria-controls="datatable2" size="1" name="datatable2_length" ><option selected="selected" value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> 条</label>
											</div>
										</div>
										<div class="col-sm-8">
											<div class="pull-right">
												<div class="dataTables_paginate paging_bs_normal">
													<ul id="paginationArea" class="pagination">
													<li class="prev disabled"><a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a></li>
													<li class="active"><a href="#">1</a></li>
													<li class="next"><a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span></a></li></ul>
												</div>
											</div>
										</div>
									</div>
									<!-- 分页条结束 -->
								</div>
							</div>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</div>
	<!-- Nifty Modal -->
	<div class="md-overlay"></div> <!-- Nifty Modal的遮罩层-->
	<script type="text/javascript" src="js/addressJS.js"></script>
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
	<script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript" src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
	<script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/skycons/skycons.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
	<script src="js/intro.js/intro.js" type="text/javascript"></script> 
	<script src="js/behaviour/voice-commands.js"></script>
	<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.resize.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.labels.js"></script>
	<script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
	<script type="text/javascript" src="js/jquery.form.js"></script>
	<script type="text/javascript">
//根据排序规则重新查询
function queryBySort(par,column){
	var classFlag = listSortClickEvent(par);
	var type = judgmentChinese(column);
	if(type != null && type != ""){
		classFlag = type + classFlag;
		column = column.substr(8,column.length);
	}
	$("#sortType").val(classFlag);
	$("#sortColumn").val(column);
	go2page(currentshownpage);
}

	var currentshownpage = 1;
	var path="sendReceive.do";
	      
	$(document).ready(function(){
		getzhandian();//获取站点
	    App.init();
	    $(".md-trigger").modalEffects();
	    go2page('1');
	    $(".deleteThisTime").click(function(){               //清除日期框中的值
	       $(this).parent().prev()[0].value = "";
		});
		
	});
	
	//全选
	function selectAll() {
		if ($("#allselectchecker").is(':checked')) {
			$(".col_selector").prop("checked", true);
		} else {
			$(".col_selector").prop("checked", false);
		}
	}
	
	//获取所有站点
	function getzhandian(){
	  var html="<option value=\"\">"+"</option>";
	  jQuery.ajax({
	      type : "post",
	      async:false,
	      url : "addEmployee.do?getzhandian",
	      dataType : "json",
	      data: {
	           "zhandian":"站点"
	      },
	      success : function(data){
	          if(data.des=="success"){
	        	  var id=data.id.split(",");
	        	  var name=data.name.split(",");
	        	  for(var i=0;i<id.length;i++){
	        	  	html +="<option value=\""+id[i]+"\">"+name[i]+"</option>";
	        	  }
	          }
	      },
	      error:function(){
	           alert("error");
	      }
	  });
	  $("#serviceSite").html(html);
	}
	
	//实时获取交班人姓名
	function getjiaobrName(){
		var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
		var name = $.trim($("#sendEmployee").val());
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\"";
		}else{
			$("#hideul_nei2").html("");
			$("#hideul-2").hide();
			return;
		}
		reqmsg += "}}";
	
	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "employee.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.employeeList != null){
	            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"jiaobrNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "-" + item.indexNum + "</li>";	
            	  				}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei2").html(htmlcode);
			    	  $("#hideul-2").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	
	//交班人姓名赋值
	function jiaobrNamefuzhi(name,id){
		$("#sendEmployee").val(name);
		$("#sendEmployeeId").val(id);
		$("#hideul_nei2").html("");
		$("#hideul-2").hide();
	}
	
	//实时获取接班人姓名
	function getjiebrName(){
		var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
		var name = $.trim($("#receiveEmployee").val());
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\"";
		}else{
			$("#hideul_nei1").html("");
			$("#hideul-1").hide();
			return;
		}
		reqmsg += "}}";
	
	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "employee.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.employeeList != null){
	            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"jiebrNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "-" + item.indexNum + "</li>";	
            	  				}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei1").html(htmlcode);
			    	  $("#hideul-1").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	
	//接班人姓名赋值
	function jiebrNamefuzhi(name,id){
		$("#receiveEmployee").val(name);
		$("#receiveEmployeeId").val(id);
		$("#hideul_nei1").html("");
		$("#hideul-1").hide();
	}
	
	//实时获取监督人姓名
	function getjiandrName(){
		var reqmsg="{'action':'QUERY_EMPLOYEE_LIST_REQUEST','page':{'pageno':'1','pagesize':'5'},'content':{";
		var name = $.trim($("#superviseEmployee").val());
		if (name != null && name != "") {
			reqmsg += "\"name_like\":\"" + name + "\"";
		}else{
			$("#hideul_nei3").html("");
			$("#hideul-3").hide();
			return;
		}
		reqmsg += "}}";
	
	    jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "employee.do?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	              	  var htmlcode = "";
	              	  if(data.content != null){
	              	  	 if(data.content.employeeList != null){
	            	  		jQuery.each(data.content.employeeList, function(i, item) {
            	  				if(item != null){
		    						htmlcode += "<li onclick=\"jiandrNamefuzhi('" + item.name + "','" + item.id + "')\">" + item.name + "-" + item.indexNum + "</li>";	
            	  				}	
			    	  		});
			    	 	 }
			    	  }
			    	  $("#hideul_nei3").html(htmlcode);
			    	  $("#hideul-3").show();
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	
	//监督人姓名赋值
	function jiandrNamefuzhi(name,id){
		$("#superviseEmployee").val(name);
		$("#superviseEmployeeId").val(id);
		$("#hideul_nei3").html("");
		$("#hideul-3").hide();
	}
	
	//删除信息
	function doDel() {
		var selectedItemNumber = $("tbody .col_selector:checked").length;
		if (selectedItemNumber >= 1) {
			var ids2del = "";
			$("tbody .col_selector:checked").each(function() {
				ids2del += $(this).val() + ",";
			});
			if (ids2del != "") {
				ids2del = ids2del.substring(0, ids2del.length - 1);
			}
		  if (confirm("是否确认删除?"))  {  
			jQuery.ajax({
				type:"post",
				url:path+"?del",
				async:true,
				dataType:"json",
				data:{ids:ids2del},
				success:function(data) {
					alert(data.des);
					if (data.result == "success") {
						go2page(currentshownpage);
					}else if(data.des=="failure"){
	                 alert("删除失败");
	                }
				},
				error:function() {
					alert("error");
				}
			});
			}
		} else {
			alert("请选择要删除的数据");
		}
	}
	
	function del2(id) {
		  if (confirm("是否确认删除?"))  {  
			jQuery.ajax({
				type:"post",
				url:path+"?del",
				async:true,
				dataType:"json",
				data:{ids:id},
				success:function(data) {
					alert(data.des);
					if (data.result == "success") {
						go2page(currentshownpage);
					}else if(data.des=="failure"){
	                    alert("删除失败");
	                }
				},
				error:function() {
					alert("error");
				}
			});
		}
	}
	
	//时间转换
	function formatDateCGtoD1(time){
		if(time == null || time == "" || time.length != 16){
			time = "";
			return time;
		}
		time = time.substring(0, 4) + time.substring(5, 7) + time.substring(8, 10) + time.substring(11, 13) + time.substring(14, 16);
		return time; 
	}
	
	//时间比较
	function compareTime(startTime, endTime) {
		startTime = startTime.replace(/[^0-9]/g, "");
		endTime = endTime.replace(/[^0-9]/g, "");
		if (parseInt(startTime) > parseInt(endTime)) {
			alert('注意：条件搜索中，开始时间不得大于结束时间！');
			return true;
		} else {
			return false;
		}
	}
	
	//查询
	function go2page(pagenumber){
		var pagesize = $("#pageSizeSelector option:selected").val();
		var serialNumber = $("#serialNumber").val();
		var serviceSiteId = $("#serviceSite").val();//服务站点
		if(serviceSiteId){
			serviceSiteId = parseInt(serviceSiteId);
		}
		var receiveEmployee = $("#receiveEmployee").val();//接班人
		var receiveEmployeeId = $("#receiveEmployeeId").val();//接班人id
		if(receiveEmployeeId){
			receiveEmployeeId = parseInt(receiveEmployeeId);
		}
		var sendEmployee = $("#sendEmployee").val();//交班人
		var sendEmployeeId = $("#sendEmployeeId").val();//交班人id
		if(sendEmployeeId){
			sendEmployeeId = parseInt(sendEmployeeId);
		}
		var superviseEmployee = $("#superviseEmployee").val();//监督人
		var superviseEmployeeId = $("#superviseEmployeeId").val();//监督人id
		if(superviseEmployeeId){
			superviseEmployeeId = parseInt(superviseEmployeeId);
		}
		var createTimeStartDate = $("#createTimeStartDate").val();//交接班开始时间
		createTimeStartDate = formatDateCGtoD1(createTimeStartDate);
	 	var createTimeEndDate = $("#createTimeEndDate").val();//交接班结束时间
	 	createTimeEndDate = formatDateCGtoD1(createTimeEndDate);
	 	compareTime(createTimeStartDate,createTimeEndDate);
	 	
		var reqmsg = "{\"action\":\"QUERY_SEND_RECEIVE_LIST_REQUEST\",";
		
		var sortType = $("#sortType").val();
		var sortColumn = $("#sortColumn").val();
		if(sortType != null && sortType != ""){
			reqmsg += "'order':[{'column':'" + sortColumn + "','type':'" + sortType + "'}],";
		}
		
		reqmsg += "\"page\":{\"pageno\":\"" + pagenumber + "\",\"pagesize\":\"" + pagesize + "\"},\"content\":{";
		reqmsg += "\"status\":2,";
		if (serviceSiteId != null && serviceSiteId != "") {
			reqmsg += "\"serviceSiteShow\":\"" + true + "\",";
			reqmsg += "\"serviceSiteId\":" + serviceSiteId + ",";
		}
		if (sendEmployee != null && sendEmployee != "") {
			reqmsg += "\"sendEmployeeShow\":\"" + true + "\",";
			reqmsg += "\"sendEmployeeId\":" + sendEmployeeId + ",";
		}
		if (receiveEmployee != null && receiveEmployee != "") {
			reqmsg += "\"receiveEmployeeShow\":\"" + true + "\",";
			reqmsg += "\"receiveEmployeeId\":" + receiveEmployeeId + ",";
		}
		if (superviseEmployee != null && superviseEmployee != "") {
			reqmsg += "\"superviseEmployeeShow\":\"" + true + "\",";
			reqmsg += "\"superviseEmployeeId\":" + superviseEmployeeId + ",";
		}
		if (serialNumber != null && serialNumber != "") {
			reqmsg += "\"serialNumber\":\"" + serialNumber + "\",";
		}
		if (createTimeStartDate != null && createTimeStartDate != "") {
			createTimeStartDate = createTimeStartDate + "00";
			reqmsg += "\"createTime_ge\":\"" + createTimeStartDate + "\",";
		}
		if (createTimeEndDate != null && createTimeEndDate != "") {
			createTimeEndDate = createTimeEndDate + "00";
			reqmsg += "\"createTime_le\":\"" + createTimeEndDate + "\",";
		}
		reqmsg = reqmsg.substr(0, reqmsg.length - 1);
		
		reqmsg += "}}";
	
	    jQuery.ajax({
	          type : "post",
	          async:true,
	          url : path+"?handler",
	          dataType : "json",
	          data: {
	               "reqmsg":reqmsg
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  changeData1(data);
	              }else if(data.des=="failure"){
	                 alert("查询失败");
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	     });
	}
	
	function changeData1(data){
		var htmlcode = "";
		if (data.content != null) {
			jQuery.each(data.content.sendReceiveList, function(i, item) {
				htmlcode += "<tr id=\"" + item.id + "\">";		
			    htmlcode += "<td>" + item.serialNumber + "</td>";	
			    htmlcode += "<td>" + item.serviceSiteName + "</td>";	
			    htmlcode += "<td>" + item.sendEmployeeName + "</td>";
			    htmlcode += "<td>" + item.receiveEmployeeName + "</td>";		
			    htmlcode += "<td>" + item.superviseEmployeeName + "</td>";				
			    htmlcode += "<td>" + formateTime(item.createTime) + "</td>";		
				htmlcode += "<td><div class=\"btn-group\">";
				htmlcode += "<button class=\"btn btn-default btn-xs\" type=\"button\">操作</button>";
				htmlcode += "<button data-toggle=\"dropdown\" class=\"btn btn-xs btn-primary dropdown-toggle\" type=\"button\">";
				htmlcode += "<span class=\"caret\" style=\"padding:0;\"></span>";
				htmlcode += "<span class=\"sr-only\">Toggle Dropdown</span>";
				htmlcode += "</button>";
				htmlcode += "<ul role=\"menu\" class=\"dropdown-menu pull-right\">";
				var headUrl = "<%=request.getContextPath()%>";
				<c:if test="${sendReserviceList_queryXQ_opt_control != 'yes' or sendReserviceList_queryXQ_opt_show == 'yes'}">
					htmlcode += "<li><a href=\""+headUrl+"/sendReceiveDetail.do?main&id="+item.id+"\" target=\"_blank\">查看详情</a></li>";
				</c:if>	
				<c:if test="${sendReserviceList_del_opt_control != 'yes' or sendReserviceList_del_opt_show == 'yes'}">
					htmlcode += "<li onclick=\"del2('" + item.id + "')\"><a href=\"###\">删除</a></li>";
				</c:if>	
				htmlcode += "</ul>";
				htmlcode += "</div></td>";		
				htmlcode += "</tr>";
			});
		}
		$("#datacontainer").html(htmlcode);
		if (data.page != null) {
			genaratePaginateHtml(data.page.pageno, data.page.pageCount);
			genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
		} else {
			genaratePaginateHtml(1, 1);
			genarateRecordNumberHtml(1, 10, 0);
		}
	}
	
	/**
	 * 格式化时间
	 * @method formateTime
	 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
	 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
	 */
	function formateTime(time) {
		if (time != null && time.length == 14) {
			return time.substring(0, 4) + "-" + time.substring(4, 6) + "-" + time.substring(6, 8) + " " + time.substring(8, 10) + ":" + time.substring(10, 12) + ":" + time.substring(12, 14);
		} else {
			return time;
		}
	}
	
	/**
	 * 生成记录数信息
	 * @method genarateRecordNumberHtml
	 * @param {Number} currentpage 当前页
	 * @param {Number} pagesize 每页记录条目数
	 * @param {Number} totalRecord 总记录数
	 */
	function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
		var recordInfos = "";
		if (totalRecord > 0) {
		    recordInfos = "当前显示" + totalRecord + "条总记录";
			recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
			if (currentpage * pagesize > totalRecord) {
				recordInfos += totalRecord;
			} else {
				recordInfos += currentpage * pagesize;
			}
			recordInfos += "条 ";
		} else {
			recordInfos = "当前显示0 条总记录中的第0-0条";
		}
		
		$("#datatable_info").html(recordInfos);
	}
	
	/**
	 * 生成分页信息
	 * @method genaratePaginateHtml
	 * @param {Number} currentpage 当前页
	 * @param {Number} totalpage 总页数
	 */
	function genaratePaginateHtml(currentpage, totalpage, pagesize) {
		currentshownpage = currentpage;
	
		var htmlcode = "";
		
		//上一页
		if (currentpage > 1) {
			htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
			htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
		} else {
			htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
			htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
		}
		
		//具体页码
		if (totalpage <= 5) {
			for (var i = 1; i <= totalpage; i++) {
				if (currentpage == i) {
					htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
				} else {
					htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
				};
			};
		} else {
			var startpage = currentpage;
			var endpage = currentpage;
			while (true) {
				if (endpage - startpage >= 4) {
					break;
				} else {
					if (startpage > 1) {
						startpage = startpage - 1;
					}
					if (endpage < totalpage) {
						endpage = endpage - (-1);
					};
				};
			}
			
			for (var i = startpage; i <= endpage; i++) {
				if (currentpage == i) {
					htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
				} else {
					htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
				};
			};
		}
		
		//下一页
		if (totalpage > currentpage) {
			htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
			htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		} else {
			htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
			htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		}
		$("#paginationArea").html(htmlcode);
	};
	</script>
</body>
</html>