<%@ page contentType="text/html;charset=UTF-8" language="java"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="images/logo.png">
    <title>回访统计</title>
    <!-- Bootstrap core CSS -->
    <link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="js/jquery.gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" href="fonts/font-awesome-4/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	  <script src="../../assets/js/html5shiv.js"></script>
	  <script src="../../assets/js/respond.min.js"></script>
	<![endif]-->
    <link rel="stylesheet" type="text/css" href="js/jquery.nanoscroller/nanoscroller.css" />
    <link rel="stylesheet" type="text/css" href="js/jquery.easypiechart/jquery.easy-pie-chart.css" />
    <link rel="stylesheet" type="text/css" href="js/bootstrap.switch/bootstrap-switch.css" />
    <link rel="stylesheet" type="text/css"
      href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" type="text/css" href="js/jquery.select2/select2.css" />
    <link rel="stylesheet" type="text/css" href="js/bootstrap.slider/css/slider.css" />
    <link rel="stylesheet" type="text/css" href="js/jquery.niftymodals/css/component.css" />
    <link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">
    <link rel="stylesheet" href="js/jquery.crop/css/jquery.Jcrop.css" type="text/css" />
    <link href="css/style.css" rel="stylesheet" />
    <style>
.accordion .panel,.accordion .panel:first-child {
	border-top: 1px solid #ECECEC;
	border-bottom: 1px solid #ECECEC;
}

.checkbox-inline {
	padding-left: 0;
	padding-right: 30px;
}

.checkbox-inline+.checkbox-inline {
	margin-left: 0;
}

.hideul {
	position: absolute;
	top: 33px;
	z-index: 200;
	right: 15px;
	left: 15px;
	display: none
}

.hideul ul {
	border: 1px solid #ccc;
	width: 100%;
	background: #f4f4f4;
	padding-left: 0
}

.hideul ul li {
	list-style-type: none;
	text-indent: 20px
}

.hideul ul li:hover {
	background: #ddd
}
</style>
  </head>
  <body>
    <div id="cl-wrapper" style="padding: 0px">
      <div class="container-fluid" style="padding: 0px">
        <!-- 头部开始 -->
        <div class="page-head">
          <h2 id="head_devtype">
            回访统计
          </h2>
        </div>
      </div>
      <!-- 头部结束 -->
      <div class="cl-mcont">
        <div class="row" style="margin-top: 0">
          <div class="col-sm-12">
            <div class="panel-group accordion accordion-semi" style="margin-top: 20px;" id="ahbbq1">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a>回访率统计</a>
                  </h4>
                </div>
                <div class="panel-collapse collapse in">
                  <div class="panel-body ">
                    <div class="form-group" style="margin-left:-15px">
                      <div class="col-sm-1 control-label" style="padding-top:5px">年</div>
                      <div class="col-sm-2">
                          <select class="form-control" id="hfltj_year" onchange="changeMonth()">
                            <option value="">全部</option>
                            <option value="2016">2016</option>
                            <option value="2017">2017</option>
                            <option value="2018">2018</option>
                            <option value="2019">2019</option>
                            <option value="2020">2020</option>
                          </select>
                      </div>
                      <div class="col-sm-1 control-label" style="padding-top:5px">月</div>
                      <div class="col-sm-2">
                           <select class="form-control" id="hfltj_month">
                            <option value="">全年</option>
                          </select>                   
                      </div>
                    </div>
                    <!-- 操作按钮开始 -->
                    <div class="row">
                      <div class="col-sm-12">                    
                        <button class="btn btn-primary" style="margin-bottom: 0px !important;margin-left: 0;"
                            onclick="query()">查询</button>
                        <button type="button" id="daochuanniu" class="btn btn-primary btn-flat  md-trigger" style="display:none;" data-modal="Export-daochu">
						<button type="button" class="btn btn-primary btn-flat" style="float: right;"  onclick="exportxls();">
                        	<span><i class="fa fa-upload" style="margin-right:5px;"></i>导出</span>
                     	</button>
                     	<form action="review.do?exportxls"  method="post" style="display:none;">  <!-- 导出功能 form不可见 -->
	                    	<input type="text" name="timeStart" value="" id="">
	                    	<input type="text" name="timeEnd" value="" id="">
	                    	<input type="submit" value="Submit" id="SubmitButton" />
                    	</form>                      
                      </div>                    
                      <div class="col-sm-12">
                        <table >
                          <thead>
                            <tr>
                              <th>
                                <strong>站点名称</strong>
                              </th>
                              <th>
                                <strong>应回访次数</strong>
                              </th>
                              <th>
                                <strong>站点回访总次数</strong>
                              </th>
                              <th>
                                <strong>站点电话回访次数</strong>
                              </th>
                              <th>
                                <strong>站点机构回访次数</strong>
                              </th>
                              <th>
                                <strong>站点入户回访次数</strong>
                              </th>
                              <th>
                                <strong>品保部回访总次数</strong>
                              </th>
                              <th>
                                <strong>品保部电话回访次数</strong>
                              </th>
                              <th>
                                <strong>品保部机构回访次数</strong>
                              </th>
                              <th>
                                <strong>品保部入户回访次数</strong>
                              </th>
                            </tr>
                          </thead>
                          <tbody id="datacontainer" >
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <!-- 数据表格结束 -->
                    <!-- 数据条数提示开始 -->
                    <div class="row">
                      <div class="col-sm-12">
                        <div class="pull-left">
                          <div id="datatable_info" >  当前显示0 条总记录中的第0-0条</div>
                        </div>
                      </div>
                    </div>
                    <!-- 数据条数提示结束 -->
                    <!-- 分页条开始 -->
                    <div class="row" style="margin-top:0">
                      <div class="col-sm-4">
                        <div >
                          <label style="margin-top: 18px;">
                                                                            每页<select id="pageSizeSelector"  size="1"  onchange="query()">
                              <option selected="selected" value="10">
                                10
                              </option>
                              <option value="25">
                                25
                              </option>
                              <option value="50">
                                50
                              </option>
                              <option value="100">
                                100
                              </option>
                            </select>条
                          </label>
                        </div>
                      </div>
                      <div class="col-sm-8">
                        <div class="pull-right">
                          <div class="dataTables_paginate paging_bs_normal">
                            <ul id="paginationArea" class="pagination">
                              <li class="prev disabled">
                                <a href="#"><span class="fa fa-angle-left"></span>&nbsp;上一页</a>
                              </li>
                              <li class="active">
                                <a href="#">1</a>
                              </li>
                              <li class="next">
                                <a href="#">下一页&nbsp;<span class="fa fa-angle-right"></span> </a>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- 分页条结束 -->                    
                  </div>
                </div>
              </div>
            </div>
            <div class="panel-group accordion accordion-semi" id="ahbbq2">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a>满意度统计</a>
                  </h4>
                </div>
                <div class="panel-collapse collapse in">
                  <div class="panel-body ">
                    <div class="form-group" style="margin-left:-15px">
                      <div class="col-sm-1 control-label"  style="padding-top:5px">年</div>
                      <div class="col-sm-2">
                          <select class="form-control" id="mydtj_year" onchange="changeMonth2()">
                            <option value="">全部</option>
                            <option value="2016">2016</option>
                            <option value="2017">2017</option>
                            <option value="2018">2018</option>
                            <option value="2019">2019</option>
                            <option value="2020">2020</option>
                          </select>
                      </div>
                      <div class="col-sm-1 control-label" style="padding-top:5px">月</div>
                      <div class="col-sm-2">
                           <select class="form-control" id="mydtj_month">
                            <option value="">全年</option>
                          </select>                   
                      </div>
                      <div class="col-sm-2 control-label" style="padding-top:5px">服务站点</div>
                      <div class="col-sm-4">
                          <select class="form-control" id="fwzd_select">
                          	<option value="">全部</option>
                          </select>
                      </div>
                      <div class="col-sm-12 control-label" style="padding-top:10px">实际回访数量&nbsp;&nbsp;<span id="sjhfNum">0</span></div>
                    </div>
                    <!-- 操作按钮开始 -->
                    <div class="row">
                      <div class="col-sm-12">                    
                        <button class="btn btn-primary" style="margin-bottom: 5px !important;margin-left: 0;margin-top:10px"
                            onclick="query2()">查询</button>                       
                      </div>  
                      <div class="col-sm-6  col-md-4 threepie" id="threepie1"></div>                 
                      <div class="col-sm-6  col-md-4 threepie" id="threepie2"></div>                 
                      <div class="col-sm-6  col-md-4 threepie" id="threepie3"></div>                 
                      <div class="col-sm-12">
                        <table >
                          <thead>
                            <tr>
                              <th>
                                <strong>回访来源</strong>
                              </th>
                              <th>
                                <strong>很满意</strong>
                              </th>
                              <th>
                                <strong>满意</strong>
                              </th>
                              <th>
                                <strong>一般</strong>
                              </th>
                              <th>
                                <strong>中</strong>
                              </th>
                              <th>
                                <strong>差</strong>
                              </th>
                            </tr>
                          </thead>
                          <tbody id="datacontainer2" >
                            <!-- <tr>
                              <td>站点</td><td>35</td><td>35</td><td>35</td><td>35</td><td>35</td>
                            </tr>
                            <tr style="background:#fff">
                              <td>品保部</td><td>35</td><td>35</td><td>35</td><td>35</td><td>35</td>
                            </tr>
                            <tr>
                              <td>全部</td><td>35</td><td>35</td><td>35</td><td>35</td><td>35</td>
                            </tr> -->
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <!-- 数据表格结束 -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 主页面结束 -->
    <!-- 模态框开始-->
    <div class="md-overlay"></div>
    <script src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
    <script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.nestable/jquery.nestable.js"></script>
    <script type="text/javascript" src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.slider/js/bootstrap-slider.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
    <script type="text/javascript" src="js/masonry.js"></script>
    <script type="text/javascript" src="js/jquery.crop/js/jquery.Jcrop.js"></script>
    <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
    <script src="js/jquery.upload/js/jquery.iframe-transport.js"></script>
    <!-- The basic File Upload plugin -->
    <script src="js/jquery.upload/js/jquery.fileupload.js"></script>
    <script type="text/javascript" src="js/behaviour/general.js"></script>
    <script type="text/javascript" src="js/highcharts.js"></script>
    <script src="js/no-data-to-display.js"></script>
    <script type="text/javascript">
	 $(document).ready(function(){  
	 	getzhandian();
	 	query();
	 	query2();
	 
      	Highcharts.theme = {		//饼图统一设置 样式		
      			credits:{
      				enabled:false // 禁用版权信息
      			},
      			chart: {
      				plotBackgroundColor: null,
      				plotBorderWidth: null,
      				plotShadow: false
      			},
      			tooltip: {
      				pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
      			},
      			legend: {  //图例配置
					itemMarginTop: 3,
					itemMarginBottom: 3,
					itemStyle: {						
					},
					labelFormatter: function(){
						return this.name + '('+Highcharts.numberFormat(this.y, 0) + ')';
					}
				},
      			plotOptions: {
      				pie: {
      					allowPointSelect: true,
      					cursor: 'pointer',
      					showInLegend: true,
      					dataLabels: {
      						style: { fontSize:"11px",color :'#222' },
      						enabled: true,							
      						connectorColor: '#666',
      						distance: 10,
      						formatter: function(){
      	                        if(this.y == 0) {
      	                             return null;
      	                        } else {
      	                             return this.point.name+" ( "+Highcharts.numberFormat(this.percentage,1)+"% )";      
      	                       }
      	                    }
      					}
      				}	
      									
      			}				
      		};
      		Highcharts.setOptions({ //饼图统一设置 各块颜色	
      				colors: ['#f7a35c','#8185ea','#f15c81','#7cb5ed','#424248','#91ed7c']
      			});
      
      		Highcharts.setOptions(Highcharts.theme); //样式应用
      		
      		$("#threepie1").highcharts({
      			title: {
      				text: '<b>站点满意度统计</b>'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '站点满意度统计',
     	            data: []
     	        }]
     	    });
      		$("#threepie2").highcharts({
      			title: {
      				text: '<b>品保部满意度统计</b>'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '品保部满意度统计',
     	            data: []
     	        }]
     	    });
      		$("#threepie3").highcharts({
      			title: {
      				text: '<b>全部满意度统计</b>'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '全部满意度统计',
     	            data: []
     	        }]
     	    });
		
	 });
	 
	 	//获取所有站点
		function getzhandian(){
		  var html = "<option value=\"\">全部</option>";
		  jQuery.ajax({
	          type : "post",
	          async:false,
	          url : "addEmployee.do?getzhandian",
	          dataType : "json",
	          data: {
	               "zhandian":"站点"
	          },
	          success : function(data){
	              if(data.des=="success"){
	            	  var id=data.id.split(",");
	            	  var name=data.name.split(",");
	            	  for(var i=0;i<id.length;i++){
	            	  	html=html+"<option value=\""+id[i]+"\">"+name[i]+"</option>";
	            	  }
	              }
	          },
	          error:function(){
		           alert("error");
	          }
	      });
		  $("#fwzd_select").html(html);
		}
		
	/**
	 * 格式化时间
	 * @method formateTime
	 * @param {String} time 时间信息(YYYYMMDDHHmmSS)
	 * @return 格式化的时间(YYYY-MM-DD HH:mm:SS)
	 */
	function formateTime(time) {
		if (time != null && time.length == 8) {
			return time.substring(0, 4) + "-" + time.substring(4, 6) + "-"
					+ time.substring(6, 8);
		} else if (time != null && time.length == 14) {
			return time.substring(0, 4) + "-" + time.substring(4, 6) + "-"
					+ time.substring(6, 8) + " " + time.substring(8, 10) + ":"
					+ time.substring(10, 12) + ":" + time.substring(12, 14);
		} else {
			return time;
		}
	}
	
	
	//回访率统计年份变化
	function changeMonth(){
		var hfltj_year = $("#hfltj_year").val();
		if(hfltj_year == ""){
			$("#hfltj_month").html("<option value=\"\">全年</option>");
		}else{
			var html = "<option value=\"\">全年</option><option value=\"01\">1月</option><option value=\"02\">2月</option><option value=\"03\">3月</option>";
			html += "<option value=\"04\">4月</option><option value=\"05\">5月</option><option value=\"06\">6月</option>";
			html += "<option value=\"07\">7月</option><option value=\"08\">8月</option><option value=\"09\">9月</option>";
			html += "<option value=\"10\">10月</option><option value=\"11\">11月</option><option value=\"12\">12月</option>";
			$("#hfltj_month").html(html);
		}
	}
	//回访率统计查询
	function query() {
		go2page(1);
	}
	function go2page(pagenumber){
		var pagesize = $("#pageSizeSelector option:selected").val();
		var timeStart = "";
		var timeEnd = "";
		var hfltj_year = $("#hfltj_year").val();
		var hfltj_month = $("#hfltj_month").val();
		if(hfltj_year != null && hfltj_year != ""){
			if(hfltj_month != null && hfltj_month != ""){
				timeStart = hfltj_year + hfltj_month + "01000000";
				timeEnd = hfltj_year + hfltj_month + "31240000";
			}else{
				timeStart = hfltj_year + "0101000000";
				timeEnd = hfltj_year + "1231240000";
			}
		}else{
			timeStart = "20160101000000";
			timeEnd = "20201231240000";
		}

    	jQuery.ajax({
          	type : "post",
          	async:true,
          	url : "review.do?reviewCount",
          	dataType : "json",
          	data: {
               	"pageno":pagenumber,
               	"pagesize":pagesize,
                "startTime":timeStart,
                "endTime":timeEnd
          	},
          	success : function(data){
              if(data.des=="success"){
            	  changeData(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          	},
          	error:function(){
	           alert("error");
          	}
     	});
    }
    function changeData(data){
		var htmlcode = "";
		if (data.content != null) {
			if (data.content.reviewList != null) {
				jQuery.each(data.content.reviewList, function(i, item) {
     				htmlcode += "<tr>";		
		    		htmlcode += "<td>" + item.siteName + "</td>";
		    		htmlcode += "<td>" + item.yinghuifang + "</td>";
		    		htmlcode += "<td>" + item.zhandianhuifangall + "</td>";
		    		htmlcode += "<td>" + item.zhandiandianhua + "</td>";
		    		htmlcode += "<td>" + item.zhandianjigou + "</td>";
		    		htmlcode += "<td>" + item.zhandiantuhu + "</td>";
		    		htmlcode += "<td>" + item.pinbaohuifangall + "</td>";
		    		htmlcode += "<td>" + item.pinbaodianhua + "</td>";
		    		htmlcode += "<td>" + item.pinbaojigou + "</td>";
		    		htmlcode += "<td>" + item.pinbaoruhu + "</td>";
		    		htmlcode += "</tr>";
     			});
     		}
     	}
     	$("#datacontainer").html(htmlcode);
     	if (data.page != null) {
			genaratePaginateHtml(data.page.pageno, data.page.pageCount);
			genarateRecordNumberHtml(data.page.pageno, data.page.pagesize, data.page.recordCount);
		} else {
			genaratePaginateHtml(1, 1);
			genarateRecordNumberHtml(1, 10, 0);
		}
    }
/**
 * 生成记录数信息
 * @method genarateRecordNumberHtml
 * @param {Number} currentpage 当前页
 * @param {Number} pagesize 每页记录条目数
 * @param {Number} totalRecord 总记录数
 */
function genarateRecordNumberHtml(currentpage, pagesize, totalRecord) {
	var recordInfos = "";
	if (totalRecord > 0) {
	    recordInfos = "当前显示" + totalRecord + "条总记录";
		recordInfos += "中第" + ((currentpage - 1) * pagesize + 1) + "-";
		if (currentpage * pagesize > totalRecord) {
			recordInfos += totalRecord;
		} else {
			recordInfos += currentpage * pagesize;
		}
		recordInfos += "条 ";
	} else {
		recordInfos = "当前显示0 条总记录中的第0-0条";
	}
	
	$("#datatable_info").html(recordInfos);
}

/**
 * 生成分页信息
 * @method genaratePaginateHtml
 * @param {Number} currentpage 当前页
 * @param {Number} totalpage 总页数
 */
function genaratePaginateHtml(currentpage, totalpage, pagesize) {
	currentshownpage = currentpage;

	var htmlcode = "";
	
	//上一页
	if (currentpage > 1) {
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('1')\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre\"><a href=\"#\" onclick=\"go2page('" + (currentpage - 1) + "')\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	} else {
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;首页</a></li>";
		htmlcode += "<li class=\"pre disabled\"><a href=\"#\"><span class=\"fa fa-angle-left\"></span>&nbsp;上一页</a></li>";
	}
	
	//具体页码
	if (totalpage <= 5) {
		for (var i = 1; i <= totalpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	} else {
		var startpage = currentpage;
		var endpage = currentpage;
		while (true) {
			if (endpage - startpage >= 4) {
				break;
			} else {
				if (startpage > 1) {
					startpage = startpage - 1;
				}
				if (endpage < totalpage) {
					endpage = endpage - (-1);
				}
			}
		}
		
		for (var i = startpage; i <= endpage; i++) {
			if (currentpage == i) {
				htmlcode += "<li class=\"active\"><a href=\"#\">" + i + "</a></li>";
			} else {
				htmlcode += "<li><a href=\"#\" onclick=\"go2page('" + i + "')\">" + i + "</a></li>";
			}
		}
	}
	
	//下一页
	if (totalpage > currentpage) {
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + (parseInt(currentpage) + 1) + "')\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next\"><a href=\"#\" onclick=\"go2page('" + parseInt(totalpage) + "')\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	} else {
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">下一页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
		htmlcode += "<li class=\"next disabled\"><a href=\"#\">末页&nbsp;<span class=\"fa fa-angle-right\"></span></a></li>";
	}
	$("#paginationArea").html(htmlcode);
}



	//满意度统计年份变化
	function changeMonth2(){
		var mydtj_year = $("#mydtj_year").val();
		if(mydtj_year == ""){
			$("#mydtj_month").html("<option value=\"\">全年</option>");
		}else{
			var html = "<option value=\"\">全年</option><option value=\"01\">1月</option><option value=\"02\">2月</option><option value=\"03\">3月</option>";
			html += "<option value=\"04\">4月</option><option value=\"05\">5月</option><option value=\"06\">6月</option>";
			html += "<option value=\"07\">7月</option><option value=\"08\">8月</option><option value=\"09\">9月</option>";
			html += "<option value=\"10\">10月</option><option value=\"11\">11月</option><option value=\"12\">12月</option>";
			$("#mydtj_month").html(html);
		}
	}
	//满意度统计查询
	function query2() {
		go2page2(1);
	}
	function go2page2(){
		var timeStart = "";
		var timeEnd = "";
		var mydtj_year = $("#mydtj_year").val();
		var mydtj_month = $("#mydtj_month").val();
		if(mydtj_year != null && mydtj_year != ""){
			if(mydtj_month != null && mydtj_month != ""){
				timeStart = mydtj_year + mydtj_month + "01000000";
				timeEnd = mydtj_year + mydtj_month + "31240000";
			}else{
				timeStart = mydtj_year + "0101000000";
				timeEnd = mydtj_year + "1231240000";
			}
		}else{
			timeStart = "20160101000000";
			timeEnd = "20201231240000";
		}
		var siteId = $("#fwzd_select").val();

    	jQuery.ajax({
          	type : "post",
          	async:true,
          	url : "review.do?satisfactionCount",
          	dataType : "json",
          	data: {
               	"siteId":siteId,
                "startTime":timeStart,
                "endTime":timeEnd
          	},
          	success : function(data){
              if(data.des=="success"){
            	  changeData2(data);
              }else if(data.des=="failure"){
                 alert("查询失败");
              }
          	},
          	error:function(){
	           alert("error");
          	}
     	});
    }
    function changeData2(data){
		var siteTJ = "";
		var pgbTJ = "";
		var allTJ = "";
		var htmlcode = "";
		if (data != null) {
			htmlcode += "<tr>";
			htmlcode += "<td>站点</td><td>" + data.siteVeryGood + "</td><td>" + data.siteGood + "</td><td>" + data.siteSoso + "</td><td>" + data.siteBad + "</td><td>" + data.siteVeryBad + "</td>";
            htmlcode += "</tr>";                
            htmlcode += "<tr style=\"background:#fff\">";
			htmlcode += "<td>品保部</td><td>" + data.pinbaoVeryGood + "</td><td>" + data.pinbaoGood + "</td><td>" + data.pinbaoSoso + "</td><td>" + data.pinbaoBad + "</td><td>" + data.pinbaoVeryBad + "</td>";
            htmlcode += "</tr>";   
            htmlcode += "<tr>";
			htmlcode += "<td>全部</td><td>" + data.allVeryGood + "</td><td>" + data.allGood + "</td><td>" + data.allSoso + "</td><td>" + data.allBad + "</td><td>" + data.allVeryBad + "</td>";
            htmlcode += "</tr>";
			$("#datacontainer2").html(htmlcode);
			
			$("#sjhfNum").html(data.realReviewNum);
		
			siteTJ = "[" + "[\"很满意\"," + data.siteVeryGood + "]," + "[\"满意\"," + data.siteGood + "]," + "[\"一般\"," + data.siteSoso + "]," + "[\"中\"," + data.siteBad + "]," + "[\"差\"," + data.siteVeryBad + "]" + "]";
     		pgbTJ = "[" + "[\"很满意\"," + data.pinbaoVeryGood + "]," + "[\"满意\"," + data.pinbaoGood + "]," + "[\"一般\"," + data.pinbaoSoso + "]," + "[\"中\"," + data.pinbaoBad + "]," + "[\"差\"," + data.pinbaoVeryBad + "]" + "]";
     		allTJ = "[" + "[\"很满意\"," + data.allVeryGood + "]," + "[\"满意\"," + data.allGood + "]," + "[\"一般\"," + data.allSoso + "]," + "[\"中\"," + data.allBad + "]," + "[\"差\"," + data.allVeryBad + "]" + "]";
     		
     		if(data.siteVeryGood == "0" && data.siteGood == "0" && data.siteSoso == "0" && data.siteBad == "0" && data.siteVeryBad == "0"){
     			siteTJ = "[]";
     		}
     		if(data.pinbaoVeryGood == "0" && data.pinbaoGood == "0" && data.pinbaoSoso == "0" && data.pinbaoBad == "0" && data.pinbaoVeryBad == "0"){
     			pgbTJ = "[]";
     		}
     		if(data.allVeryGood == "0" && data.allGood == "0" && data.allSoso == "0" && data.allBad == "0" && data.allVeryBad == "0"){
     			allTJ = "[]";
     		}
     		setTubiao(siteTJ,pgbTJ,allTJ);
     	}
     }
     
     
     function setTubiao(siteTJ,pgbTJ,allTJ){
     	 var datas1 = JSON.parse(siteTJ);
     	 var datas2 = JSON.parse(pgbTJ);
     	 var datas3 = JSON.parse(allTJ);
	    
	     $("#threepie1").highcharts({
      			title: {
      				text: '站点满意度统计'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '站点满意度统计',
     	            data: datas1
     	        }]
     	    });
      		$("#threepie2").highcharts({
      			title: {
      				text: '品保部满意度统计'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '品保部满意度统计',
     	            data: datas2
     	        }]
     	    });
      		$("#threepie3").highcharts({
      			title: {
      				text: '全部满意度统计'
      			},
     	        series: [{
     	            type: 'pie',
     	            name: '全部满意度统计',
     	            data: datas3
     	        }]
     	    });
     }
	
	
//导出
function exportxls(){
	if (confirm("是否确认导出?"))  { 
		var timeStart = "";
		var timeEnd = "";
		var hfltj_year = $("#hfltj_year").val();
		var hfltj_month = $("#hfltj_month").val();
		if(hfltj_year != null && hfltj_year != ""){
			if(hfltj_month != null && hfltj_month != ""){
				timeStart = hfltj_year + hfltj_month + "01000000";
				timeEnd = hfltj_year + hfltj_month + "31240000";
			}else{
				timeStart = hfltj_year + "0101000000";
				timeEnd = hfltj_year + "1231240000";
			}
		}else{
			timeStart = "20160101000000";
			timeEnd = "20201231240000";
		}
	
		$("[name=timeStart]").val(timeStart);
		$("[name=timeEnd]").val(timeEnd);
		$("#SubmitButton").click();
		$("#daochuanniu").click();
   	}
}
</script>
    <!-- Bootstrap core JavaScript
================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
  </body>
</html>
